[{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\_layout.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'apiConfig' is defined but never used. Allowed unused vars must match /^_/u.","line":15,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'apiFetch' is defined but never used. Allowed unused vars must match /^_/u.","line":16,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":16},{"ruleId":"no-unused-vars","severity":1,"message":"'AsyncStorage' is defined but never used. Allowed unused vars must match /^_/u.","line":17,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'notification' is defined but never used. Allowed unused args must match /^_/u.","line":50,"column":82,"nodeType":"Identifier","messageId":"unusedVar","endLine":50,"endColumn":94},{"ruleId":"no-unused-vars","severity":1,"message":"'response' is defined but never used. Allowed unused args must match /^_/u.","line":55,"column":86,"nodeType":"Identifier","messageId":"unusedVar","endLine":55,"endColumn":94}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Stack } from \"expo-router\";\r\nimport { useFonts } from \"expo-font\";\r\nimport { Text, Platform } from \"react-native\";\r\nimport { useEffect } from \"react\";\r\nimport { SafeAreaView } from \"react-native-safe-area-context\";\r\nimport { ThemeProvider, useTheme } from \"../theme\";\r\nimport { ToastProvider } from \"../components/ToastProvider\";\r\n\r\nimport NetworkStatusProvider from \"../components/NetworkStatusProvider\";\r\nimport BottomNavigation from \"../components/BottomNavigation\";\r\nimport ErrorBoundary from \"../components/ErrorBoundary\";\r\nimport * as Notifications from 'expo-notifications';\r\nimport { getFCMToken, registerFCMTokenWithBackend } from '../utils/fcm';\r\nimport { NavigationProvider } from \"../context/NavigationContext\";\r\nimport apiConfig from \"../config/apiConfig\";\r\nimport apiFetch from \"../utils/apiFetch\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { PersistQueryClientProvider } from '@tanstack/react-query-persist-client';\r\nimport { queryClient, persister } from '../utils/queryClient';\r\n\r\n// Configure how notifications are displayed when app is in foreground\r\nNotifications.setNotificationHandler({\r\n  handleNotification: async () => ({\r\n    shouldShowAlert: true,\r\n    shouldPlaySound: true,\r\n    shouldSetBadge: true,\r\n  }),\r\n});\r\n\r\n// separate component so we can use useTheme inside ThemeProvider\r\nfunction Inner() {\r\n  const { styles } = useTheme();\r\n\r\n  // Setup push notifications\r\n  useEffect(() => {\r\n    let notificationSubscription;\r\n    let responseSubscription;\r\n\r\n    const setupNotifications = async () => {\r\n      if (Platform.OS === 'web') return;\r\n\r\n      try {\r\n        // Get and register FCM token\r\n        const token = await getFCMToken();\r\n        if (token) {\r\n          await registerFCMTokenWithBackend(token);\r\n        }\r\n\r\n        // Listen for foreground notifications\r\n        notificationSubscription = Notifications.addNotificationReceivedListener(notification => {\r\n          // Handle foreground notification\r\n        });\r\n\r\n        // Listen for notification taps (when user clicks notification)\r\n        responseSubscription = Notifications.addNotificationResponseReceivedListener(response => {\r\n          // You can add navigation logic here if needed\r\n          // e.g., navigate to news page when news notification is tapped\r\n        });\r\n      } catch (error) {\r\n        // Don't throw - app should work even if notifications fail\r\n      }\r\n    };\r\n\r\n    setupNotifications();\r\n\r\n    // Cleanup subscriptions on unmount\r\n    return () => {\r\n      notificationSubscription?.remove();\r\n      responseSubscription?.remove();\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <SafeAreaView style={styles.safeArea}>\r\n      <ToastProvider>\r\n        <NetworkStatusProvider>\r\n          <NavigationProvider>\r\n            <Stack\r\n              screenOptions={{\r\n                headerShown: false,\r\n                animationEnabled: false, // Disable animations\r\n                animation: 'none', // Ensure no animation\r\n                // Enable gesture navigation\r\n                gestureEnabled: true,\r\n                gestureDirection: 'horizontal',\r\n                // Detach inactive screens for better memory usage\r\n                detachInactiveScreens: true,\r\n              }}\r\n            />\r\n            <BottomNavigation />\r\n          </NavigationProvider>\r\n        </NetworkStatusProvider>\r\n      </ToastProvider>\r\n    </SafeAreaView>\r\n  );\r\n}\r\n\r\nexport default function RootLayout() {\r\n  const [fontsLoaded] = useFonts({\r\n    // DMSans - Primary font family\r\n    'DMSans-Regular': require(\"../assets/fonts/DMSans-Regular.ttf\"),\r\n    'DMSans-Medium': require(\"../assets/fonts/DMSans-Medium.ttf\"),\r\n    'DMSans-SemiBold': require(\"../assets/fonts/DMSans-SemiBold.ttf\"),\r\n    'DMSans-Bold': require(\"../assets/fonts/DMSans-Bold.ttf\"),\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (fontsLoaded) {\r\n      Text.defaultProps = {\r\n        ...(Text.defaultProps || {}),\r\n        style: {\r\n          ...(Text.defaultProps?.style || {}),\r\n          fontFamily: \"DMSans-Regular\",\r\n        },\r\n      };\r\n    }\r\n  }, [fontsLoaded]);\r\n\r\n  if (!fontsLoaded) return null;\r\n\r\n  return (\r\n    <PersistQueryClientProvider\r\n      client={queryClient}\r\n      persistOptions={{ persister }}\r\n    >\r\n      <ThemeProvider>\r\n        <ErrorBoundary>\r\n          <Inner />\r\n        </ErrorBoundary>\r\n      </ThemeProvider>\r\n    </PersistQueryClientProvider>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\admin.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":36},{"ruleId":"no-unused-vars","severity":1,"message":"'StyleSheet' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":13},{"ruleId":"no-unused-vars","severity":1,"message":"'Platform' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":11},{"ruleId":"no-unused-vars","severity":1,"message":"'AsyncStorage' is defined but never used. Allowed unused vars must match /^_/u.","line":19,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'apiFetch' is defined but never used. Allowed unused vars must match /^_/u.","line":23,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":16},{"ruleId":"no-unused-vars","severity":1,"message":"'name' is defined but never used. Allowed unused args must match /^_/u.","line":118,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":118,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n  View,\r\n  Text,\r\n  ScrollView,\r\n  Pressable,\r\n  TextInput,\r\n  Alert,\r\n  RefreshControl,\r\n  ActivityIndicator,\r\n  Modal,\r\n  StyleSheet,\r\n  Platform,\r\n\r\n} from \"react-native\";\r\n\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\n\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useRouter } from \"expo-router\";\r\nimport { useTheme } from \"../theme\";\r\nimport apiConfig from \"../config/apiConfig\";\r\nimport apiFetch from \"../utils/apiFetch\";\r\nimport { useToast } from \"../components/ToastProvider\";\r\nimport { useApiQuery, useApiMutation, createApiMutationFn } from \"../hooks/useApi\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport Header from \"../components/Header\";\r\n\r\nexport default function AdminScreen() {\r\n  const router = useRouter();\r\n  const { styles, colors } = useTheme();\r\n  const { showToast } = useToast();\r\n  const queryClient = useQueryClient();\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [refreshing, setRefreshing] = useState(false);\r\n  const [roleFilter, setRoleFilter] = useState(\"all\");\r\n  const [sortBy, setSortBy] = useState(\"createdAt\");\r\n  const [sortOrder, setSortOrder] = useState(\"desc\");\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const pageSize = 20;\r\n  const [showUserModal, setShowUserModal] = useState(false);\r\n  const [modalMode, setModalMode] = useState(\"add\"); // \"add\" or \"edit\"\r\n  const [editingUser, setEditingUser] = useState(null);\r\n  const [userForm, setUserForm] = useState({\r\n    name: \"\",\r\n    phone: \"\",\r\n    email: \"\",\r\n    password: \"\",\r\n    role: \"student\",\r\n    guardianName: \"\",\r\n    guardianPhone: \"\",\r\n    designation: \"\",\r\n    admissionDate: \"\",\r\n    joiningDate: \"\"\r\n  });\r\n  const [errors, setErrors] = useState({});\r\n  const [touched, setTouched] = useState({});\r\n  const [showPassword, setShowPassword] = useState(false);\r\n\r\n  const availableRoles = [\"student\", \"teacher\", \"class teacher\", \"staff\", \"admin\", \"super admin\"];\r\n\r\n  // Check Auth & Admin\r\n  const { data: userData, isLoading: userLoading, error: userError } = useApiQuery(\r\n    ['currentUser'],\r\n    `${apiConfig.baseUrl}/auth/me`\r\n  );\r\n  const user = userData?.user;\r\n  const isAdmin = user?.role === 'admin' || user?.role === 'super admin';\r\n\r\n  // Fetch Users\r\n  const { data: usersData, isLoading: loading, error: usersError, refetch } = useApiQuery(\r\n    ['users', currentPage, searchQuery, roleFilter, sortBy, sortOrder],\r\n    `${apiConfig.baseUrl}/users?page=${currentPage}&limit=${pageSize}&search=${searchQuery}&role=${roleFilter}&sortBy=${sortBy}&order=${sortOrder}`,\r\n    {\r\n      enabled: !!isAdmin, // Only fetch if admin check passes\r\n      keepPreviousData: true,\r\n    }\r\n  );\r\n\r\n  const users = usersData?.data || [];\r\n  const totalPages = usersData?.pagination?.pages || 1;\r\n\r\n  // Mutations\r\n  const createUserMutation = useApiMutation({\r\n    mutationFn: createApiMutationFn(apiConfig.url(apiConfig.endpoints.users.create), 'POST'),\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['users'] });\r\n      showToast(\"User created successfully\", \"success\");\r\n      setUserForm({ name: \"\", phone: \"\", email: \"\", password: \"\", role: \"student\" });\r\n      setShowUserModal(false);\r\n    },\r\n    onError: (error) => showToast(error.message || \"Failed to create user\", \"error\")\r\n  });\r\n\r\n  const updateUserMutation = useApiMutation({\r\n    mutationFn: (data) => createApiMutationFn(apiConfig.url(apiConfig.endpoints.users.update(data._id)), 'PUT')(data),\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['users'] });\r\n      showToast(\"User updated successfully\", \"success\");\r\n      setShowUserModal(false);\r\n    },\r\n    onError: (error) => showToast(error.message || \"Failed to update user\", \"error\")\r\n  });\r\n\r\n  const deleteUserMutation = useApiMutation({\r\n    mutationFn: (id) => createApiMutationFn(apiConfig.url(apiConfig.endpoints.users.delete(id)), 'DELETE')(),\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['users'] });\r\n      showToast(\"User deleted successfully\", \"success\");\r\n    },\r\n    onError: (error) => showToast(error.message || \"Failed to delete user\", \"error\")\r\n  });\r\n\r\n  const updateUserRole = (userId, newRole) => {\r\n    updateUserMutation.mutate({ _id: userId, role: newRole });\r\n  };\r\n\r\n  const deleteUser = (userId, name) => {\r\n    deleteUserMutation.mutate(userId);\r\n  };\r\n\r\n  const onRefresh = async () => {\r\n    setRefreshing(true);\r\n    await refetch();\r\n    setRefreshing(false);\r\n  };\r\n\r\n  const handlePageChange = (newPage) => {\r\n    if (newPage >= 1 && newPage <= totalPages) {\r\n      setCurrentPage(newPage);\r\n    }\r\n  };\r\n\r\n  const getRoleColor = (role) => {\r\n    switch (role) {\r\n      case \"super admin\":\r\n        return colors.roleSuperAdmin;\r\n      case \"admin\":\r\n        return colors.roleAdmin;\r\n      case \"staff\":\r\n        return colors.roleStaff;\r\n      case \"class teacher\":\r\n      case \"teacher\":\r\n        return colors.roleClassTeacher;\r\n      case \"student\":\r\n        return colors.roleStudent;\r\n      default:\r\n        return colors.textSecondary;\r\n    }\r\n  };\r\n\r\n  const handleChange = (field, value) => {\r\n    setUserForm(prev => ({ ...prev, [field]: value }));\r\n    if (errors[field]) {\r\n      setErrors(prev => ({ ...prev, [field]: null }));\r\n    }\r\n  };\r\n\r\n  const handleBlur = (field) => {\r\n    setTouched(prev => ({ ...prev, [field]: true }));\r\n    validateField(field);\r\n  };\r\n\r\n  const validateField = (field) => {\r\n    let newErrors = { ...errors };\r\n    if (field === 'name' && !userForm.name) newErrors.name = \"Name is required\";\r\n    if (field === 'phone' && !userForm.phone) newErrors.phone = \"Phone is required\";\r\n    if (field === 'password' && !userForm.password) newErrors.password = \"Password is required\";\r\n    setErrors(newErrors);\r\n  };\r\n\r\n  const isFormValid = () => {\r\n    return userForm.name && userForm.phone && userForm.password;\r\n  };\r\n\r\n  const saving = createUserMutation.isPending || updateUserMutation.isPending;\r\n\r\n\r\n  const createUser = () => {\r\n    if (!userForm.name || !userForm.phone || !userForm.password) {\r\n      showToast(\"Please fill in all required fields\", \"error\");\r\n      return;\r\n    }\r\n    createUserMutation.mutate(userForm);\r\n  };\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      <ScrollView\r\n        style={{ flex: 1 }}\r\n        contentContainerStyle={{ paddingBottom: 100 }}\r\n        refreshControl={\r\n          <RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} tintColor={colors.primary} />\r\n        }\r\n        showsVerticalScrollIndicator={false}\r\n      >\r\n        <View style={{ paddingHorizontal: 20, paddingTop: 20 }}>\r\n          {/* Minimal Header */}\r\n          <Header title=\"Admin\" subtitle=\"Manage users and permissions\" />\r\n\r\n          {/* Admin Actions - Organized by Category */}\r\n          <View style={{ gap: 24 }}>\r\n            {/* Academic Management Section - Super Admin Only */}\r\n            {user?.role === 'super admin' && (\r\n              <View>\r\n                <Text style={styles.sectionTitle}>\r\n                  Academic Management\r\n                </Text>\r\n                <View style={{ flexDirection: \"row\", flexWrap: \"wrap\", gap: 12 }}>\r\n                  <MenuCard\r\n                    title=\"Academic Year\"\r\n                    icon=\"calendar-today\"\r\n                    color={colors.primary}\r\n                    onPress={() => router.push(\"/admin/academic-year\")}\r\n                  />\r\n                  <MenuCard\r\n                    title=\"Subjects\"\r\n                    icon=\"menu-book\"\r\n                    color=\"#673AB7\"\r\n                    onPress={() => router.push(\"/admin/subjects\")}\r\n                  />\r\n                </View>\r\n              </View>\r\n            )}\r\n\r\n            {/* Teaching Management Section - Admin & Super Admin */}\r\n            <View>\r\n              <Text style={styles.sectionTitle}>\r\n                Teaching Management\r\n              </Text>\r\n              <View style={{ flexDirection: \"row\", flexWrap: \"wrap\", gap: 12 }}>\r\n                <MenuCard\r\n                  title=\"Teacher Subjects\"\r\n                  icon=\"assignment-ind\"\r\n                  color=\"#4CAF50\"\r\n                  onPress={() => router.push(\"/admin/teacher-subjects\")}\r\n                />\r\n              </View>\r\n            </View>\r\n\r\n            {/* Class Operations Section */}\r\n            <View>\r\n              <Text style={styles.sectionTitle}>\r\n                Class Operations\r\n              </Text>\r\n              <View style={{ flexDirection: \"row\", flexWrap: \"wrap\", gap: 12 }}>\r\n                <MenuCard\r\n                  title=\"Timetable\"\r\n                  icon=\"schedule\"\r\n                  color=\"#9C27B0\"\r\n                  onPress={() => router.push(\"/admin/timetable\")}\r\n                />\r\n                <MenuCard\r\n                  title=\"Exams\"\r\n                  icon=\"event\"\r\n                  color=\"#E91E63\"\r\n                  onPress={() => router.push(\"/admin/exam-schedule\")}\r\n                />\r\n              </View>\r\n            </View>\r\n\r\n            {/* Financial Section */}\r\n            <View>\r\n              <Text style={styles.sectionTitle}>\r\n                Financial\r\n              </Text>\r\n              <View style={{ flexDirection: \"row\", flexWrap: \"wrap\", gap: 12 }}>\r\n                <MenuCard\r\n                  title=\"Fees\"\r\n                  icon=\"attach-money\"\r\n                  color=\"#FF5722\"\r\n                  onPress={() => router.push(\"/admin/fees\")}\r\n                />\r\n              </View>\r\n            </View>\r\n\r\n            {/* Communication & Requests Section */}\r\n            <View>\r\n              <Text style={styles.sectionTitle}>\r\n                Communication\r\n              </Text>\r\n              <View style={{ flexDirection: \"row\", flexWrap: \"wrap\", gap: 12 }}>\r\n                <MenuCard\r\n                  title=\"Complaints\"\r\n                  icon=\"feedback\"\r\n                  color=\"#607D8B\"\r\n                  onPress={() => router.push(\"/admin/complaints\")}\r\n                />\r\n                <MenuCard\r\n                  title=\"Broadcast\"\r\n                  icon=\"campaign\"\r\n                  color=\"#3F51B5\"\r\n                  onPress={() => router.push(\"/admin/send-notification\")}\r\n                />\r\n              </View>\r\n            </View>\r\n\r\n            {/* Reports Section */}\r\n            <View>\r\n              <Text style={styles.sectionTitle}>\r\n                Reports\r\n              </Text>\r\n              <View style={{ flexDirection: \"row\", flexWrap: \"wrap\", gap: 12 }}>\r\n                <MenuCard\r\n                  title=\"History\"\r\n                  icon=\"history\"\r\n                  color=\"#795548\"\r\n                  onPress={() => router.push(\"/history\")}\r\n                />\r\n              </View>\r\n            </View>\r\n          </View>\r\n\r\n          {/* User Management Section */}\r\n          <View style={{ marginTop: 32 }}>\r\n            <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\", marginBottom: 16 }}>\r\n              <Text style={styles.sectionTitle}>\r\n                User Management\r\n              </Text>\r\n              <Pressable\r\n                onPress={() => {\r\n                  setModalMode(\"add\");\r\n                  setUserForm({ name: \"\", phone: \"\", email: \"\", password: \"\", role: \"student\" });\r\n                  setShowUserModal(true);\r\n                }}\r\n                style={({ pressed }) => ({\r\n                  flexDirection: \"row\",\r\n                  alignItems: \"center\",\r\n                  backgroundColor: colors.primary,\r\n                  paddingHorizontal: 16,\r\n                  paddingVertical: 8,\r\n                  borderRadius: 20,\r\n                  opacity: pressed ? 0.9 : 1,\r\n                  shadowColor: colors.primary,\r\n                  shadowOffset: { width: 0, height: 4 },\r\n                  shadowOpacity: 0.3,\r\n                  shadowRadius: 8,\r\n                  elevation: 4,\r\n                })}\r\n              >\r\n                <MaterialIcons name=\"add\" size={20} color=\"#fff\" style={{ marginRight: 4 }} />\r\n                <Text style={{ fontSize: 14, fontFamily: \"DMSans-Bold\", color: \"#fff\" }}>\r\n                  Add User\r\n                </Text>\r\n              </Pressable>\r\n            </View>\r\n\r\n            {/* Search Bar */}\r\n            <View style={{ marginBottom: 20 }}>\r\n              <View style={[styles.input, {\r\n                flexDirection: \"row\",\r\n                alignItems: \"center\",\r\n                paddingHorizontal: 16,\r\n                height: 56,\r\n                borderRadius: 16\r\n              }]}>\r\n                <MaterialIcons name=\"search\" size={24} color={colors.textSecondary} />\r\n                <TextInput\r\n                  style={{\r\n                    flex: 1,\r\n                    marginLeft: 12,\r\n                    fontSize: 16,\r\n                    color: colors.textPrimary,\r\n                    fontFamily: \"DMSans-Regular\",\r\n                    height: \"100%\",\r\n                  }}\r\n                  placeholder=\"Search users...\"\r\n                  placeholderTextColor={colors.textSecondary}\r\n                  value={searchQuery}\r\n                  onChangeText={(text) => {\r\n                    setSearchQuery(text);\r\n                    setCurrentPage(1);\r\n                  }}\r\n                />\r\n                {searchQuery.length > 0 && (\r\n                  <Pressable onPress={() => setSearchQuery(\"\")}>\r\n                    <MaterialIcons name=\"close\" size={20} color={colors.textSecondary} />\r\n                  </Pressable>\r\n                )}\r\n              </View>\r\n            </View>\r\n\r\n            {/* Filters and Sort */}\r\n            <View style={{ marginBottom: 20 }}>\r\n              <ScrollView horizontal showsHorizontalScrollIndicator={false} contentContainerStyle={{ gap: 10, paddingRight: 20 }}>\r\n                {/* Role Filter */}\r\n                {[\"all\", \"student\", \"teacher\", \"admin\", \"staff\"].map((role) => (\r\n                  <Pressable\r\n                    key={role}\r\n                    onPress={() => {\r\n                      setRoleFilter(role);\r\n                      setCurrentPage(1);\r\n                    }}\r\n                    style={{\r\n                      paddingHorizontal: 16,\r\n                      paddingVertical: 8,\r\n                      backgroundColor: roleFilter === role ? colors.primary : colors.cardBackground,\r\n                      borderRadius: 20,\r\n                      borderWidth: 1,\r\n                      borderColor: roleFilter === role ? colors.primary : colors.border,\r\n                      elevation: roleFilter === role ? 4 : 0,\r\n                      shadowColor: roleFilter === role ? colors.primary : \"#000\",\r\n                      shadowOffset: { width: 0, height: 2 },\r\n                      shadowOpacity: roleFilter === role ? 0.3 : 0,\r\n                      shadowRadius: 4,\r\n                    }}\r\n                  >\r\n                    <Text style={{\r\n                      color: roleFilter === role ? \"#fff\" : colors.textSecondary,\r\n                      fontFamily: roleFilter === role ? \"DMSans-Bold\" : \"DMSans-Medium\",\r\n                      textTransform: \"capitalize\",\r\n                      fontSize: 14\r\n                    }}>\r\n                      {role === \"all\" ? \"All Roles\" : role}\r\n                    </Text>\r\n                  </Pressable>\r\n                ))}\r\n              </ScrollView>\r\n\r\n              <View style={{ flexDirection: \"row\", marginTop: 16, gap: 12 }}>\r\n                {/* Sort By */}\r\n                <Pressable\r\n                  onPress={() => setSortBy(sortBy === \"createdAt\" ? \"name\" : \"createdAt\")}\r\n                  style={{\r\n                    flexDirection: \"row\",\r\n                    alignItems: \"center\",\r\n                    paddingHorizontal: 14,\r\n                    paddingVertical: 8,\r\n                    backgroundColor: colors.cardBackground,\r\n                    borderRadius: 12,\r\n                    borderWidth: 1,\r\n                    borderColor: colors.border,\r\n                  }}\r\n                >\r\n                  <MaterialIcons name=\"sort\" size={18} color={colors.textSecondary} style={{ marginRight: 6 }} />\r\n                  <Text style={{ color: colors.textSecondary, fontSize: 13, fontFamily: \"DMSans-Medium\" }}>\r\n                    Sort: {sortBy === \"createdAt\" ? \"Date\" : \"Name\"}\r\n                  </Text>\r\n                </Pressable>\r\n\r\n                {/* Sort Order */}\r\n                <Pressable\r\n                  onPress={() => setSortOrder(sortOrder === \"asc\" ? \"desc\" : \"asc\")}\r\n                  style={{\r\n                    flexDirection: \"row\",\r\n                    alignItems: \"center\",\r\n                    paddingHorizontal: 14,\r\n                    paddingVertical: 8,\r\n                    backgroundColor: colors.cardBackground,\r\n                    borderRadius: 12,\r\n                    borderWidth: 1,\r\n                    borderColor: colors.border,\r\n                  }}\r\n                >\r\n                  <MaterialIcons name={sortOrder === \"asc\" ? \"arrow-upward\" : \"arrow-downward\"} size={18} color={colors.textSecondary} style={{ marginRight: 6 }} />\r\n                  <Text style={{ color: colors.textSecondary, fontSize: 13, fontFamily: \"DMSans-Medium\" }}>\r\n                    {sortOrder === \"asc\" ? \"Ascending\" : \"Descending\"}\r\n                  </Text>\r\n                </Pressable>\r\n              </View>\r\n            </View>\r\n\r\n            {/* Users List */}\r\n            <View>\r\n              {loading && users.length === 0 ? (\r\n                <View style={{ padding: 40, alignItems: 'center' }}>\r\n                  <ActivityIndicator size=\"large\" color={colors.primary} />\r\n                  <Text style={{ marginTop: 16, color: colors.textSecondary, fontFamily: \"DMSans-Medium\" }}>Loading users...</Text>\r\n                </View>\r\n              ) : userError ? (\r\n                <View style={{ padding: 20, alignItems: 'center', backgroundColor: colors.error + '10', borderRadius: 12 }}>\r\n                  <MaterialIcons name=\"error-outline\" size={40} color={colors.error} />\r\n                  <Text style={{ marginTop: 8, color: colors.error, fontFamily: \"DMSans-Bold\" }}>Failed to load user profile</Text>\r\n                  <Text style={{ marginTop: 4, color: colors.textSecondary, textAlign: 'center' }}>{userError.message}</Text>\r\n                </View>\r\n              ) : !isAdmin && !userLoading ? (\r\n                <View style={{ padding: 20, alignItems: 'center', backgroundColor: colors.warning + '10', borderRadius: 12 }}>\r\n                  <MaterialIcons name=\"warning\" size={40} color={colors.warning} />\r\n                  <Text style={{ marginTop: 8, color: colors.warning, fontFamily: \"DMSans-Bold\" }}>Access Denied</Text>\r\n                  <Text style={{ marginTop: 4, color: colors.textSecondary, textAlign: 'center' }}>You do not have permission to view this list.</Text>\r\n                  <Text style={{ marginTop: 4, color: colors.textSecondary, fontSize: 12 }}>Current Role: {user?.role || 'Unknown'}</Text>\r\n                </View>\r\n              ) : usersError ? (\r\n                <View style={{ padding: 20, alignItems: 'center', backgroundColor: colors.error + '10', borderRadius: 12 }}>\r\n                  <MaterialIcons name=\"error-outline\" size={40} color={colors.error} />\r\n                  <Text style={{ marginTop: 8, color: colors.error, fontFamily: \"DMSans-Bold\" }}>Failed to load users</Text>\r\n                  <Text style={{ marginTop: 4, color: colors.textSecondary, textAlign: 'center' }}>{usersError.message}</Text>\r\n                  <Pressable onPress={refetch} style={{ marginTop: 12, paddingHorizontal: 16, paddingVertical: 8, backgroundColor: colors.primary, borderRadius: 8 }}>\r\n                    <Text style={{ color: '#fff', fontFamily: \"DMSans-Bold\" }}>Retry</Text>\r\n                  </Pressable>\r\n                </View>\r\n              ) : (\r\n                <>\r\n                  {users.map((userItem) => (\r\n                    <View\r\n                      key={userItem._id}\r\n                      style={[styles.cardMinimal, { marginBottom: 16, padding: 16 }]}\r\n                    >\r\n                      <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\" }}>\r\n                        <View style={{ flex: 1, marginRight: 12 }}>\r\n                          <View style={{ flexDirection: \"row\", alignItems: \"center\", marginBottom: 6 }}>\r\n                            <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginRight: 8 }}>\r\n                              {userItem.name}\r\n                            </Text>\r\n                            <View\r\n                              style={{\r\n                                backgroundColor: getRoleColor(userItem.role) + \"20\",\r\n                                paddingHorizontal: 10,\r\n                                paddingVertical: 4,\r\n                                borderRadius: 12,\r\n                              }}\r\n                            >\r\n                              <Text\r\n                                style={{\r\n                                  fontSize: 11,\r\n                                  fontFamily: \"DMSans-Bold\",\r\n                                  color: getRoleColor(userItem.role),\r\n                                  textTransform: \"uppercase\",\r\n                                }}\r\n                              >\r\n                                {userItem.role}\r\n                              </Text>\r\n                            </View>\r\n                          </View>\r\n\r\n                          <View style={{ gap: 4 }}>\r\n                            {userItem.email ? (\r\n                              <View style={{ flexDirection: \"row\", alignItems: \"center\" }}>\r\n                                <MaterialIcons name=\"email\" size={14} color={colors.textSecondary} style={{ marginRight: 6 }} />\r\n                                <Text style={{ fontSize: 14, color: colors.textSecondary, fontFamily: \"DMSans-Regular\" }}>\r\n                                  {userItem.email}\r\n                                </Text>\r\n                              </View>\r\n                            ) : null}\r\n                            {userItem.phone ? (\r\n                              <View style={{ flexDirection: \"row\", alignItems: \"center\" }}>\r\n                                <MaterialIcons name=\"phone\" size={14} color={colors.textSecondary} style={{ marginRight: 6 }} />\r\n                                <Text style={{ fontSize: 14, color: colors.textSecondary, fontFamily: \"DMSans-Regular\" }}>\r\n                                  {userItem.phone}\r\n                                </Text>\r\n                              </View>\r\n                            ) : null}\r\n                          </View>\r\n                        </View>\r\n\r\n                        <View style={{ flexDirection: \"row\", gap: 12 }}>\r\n                          <Pressable\r\n                            onPress={() => {\r\n                              setModalMode(\"edit\");\r\n                              setEditingUser(userItem);\r\n                              setUserForm({ name: userItem.name, phone: userItem.phone, email: userItem.email, password: \"\", role: userItem.role });\r\n                              setShowUserModal(true);\r\n                            }}\r\n                            style={({ pressed }) => ({\r\n                              padding: 10,\r\n                              backgroundColor: colors.background,\r\n                              borderRadius: 12,\r\n                              opacity: pressed ? 0.7 : 1,\r\n                              borderWidth: 1,\r\n                              borderColor: colors.border\r\n                            })}\r\n                          >\r\n                            <MaterialIcons name=\"edit\" size={20} color={colors.textSecondary} />\r\n                          </Pressable>\r\n\r\n                          <Pressable\r\n                            onPress={() => {\r\n                              Alert.alert(\r\n                                \"Delete User\",\r\n                                `Are you sure you want to delete ${userItem.name}?`,\r\n                                [\r\n                                  { text: \"Cancel\", style: \"cancel\" },\r\n                                  { text: \"Delete\", style: \"destructive\", onPress: () => deleteUser(userItem._id, userItem.name) },\r\n                                ]\r\n                              );\r\n                            }}\r\n                            style={({ pressed }) => ({\r\n                              padding: 10,\r\n                              backgroundColor: colors.error + \"15\",\r\n                              borderRadius: 12,\r\n                              opacity: pressed ? 0.7 : 1,\r\n                            })}\r\n                          >\r\n                            <MaterialIcons name=\"delete-outline\" size={20} color={colors.error} />\r\n                          </Pressable>\r\n                        </View>\r\n                      </View>\r\n                    </View>\r\n                  ))}\r\n\r\n                  {users.length === 0 && (\r\n                    <View style={{ alignItems: \"center\", padding: 40, opacity: 0.6 }}>\r\n                      <MaterialIcons name=\"search-off\" size={64} color={colors.textSecondary} />\r\n                      <Text style={{ color: colors.textSecondary, marginTop: 16, fontSize: 16, fontFamily: \"DMSans-Medium\" }}>\r\n                        No users found\r\n                      </Text>\r\n                    </View>\r\n                  )}\r\n\r\n                  {/* Pagination */}\r\n                  {totalPages > 1 && (\r\n                    <View style={{ flexDirection: \"row\", justifyContent: \"center\", alignItems: \"center\", marginTop: 24, gap: 16 }}>\r\n                      <Pressable\r\n                        onPress={() => handlePageChange(currentPage - 1)}\r\n                        disabled={currentPage === 1}\r\n                        style={{\r\n                          padding: 12,\r\n                          backgroundColor: currentPage === 1 ? colors.background : colors.cardBackground,\r\n                          borderRadius: 12,\r\n                          opacity: currentPage === 1 ? 0.5 : 1,\r\n                          borderWidth: 1,\r\n                          borderColor: colors.border\r\n                        }}\r\n                      >\r\n                        <MaterialIcons name=\"chevron-left\" size={24} color={colors.textPrimary} />\r\n                      </Pressable>\r\n\r\n                      <Text style={{ fontSize: 16, fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>\r\n                        Page {currentPage} of {totalPages}\r\n                      </Text>\r\n\r\n                      <Pressable\r\n                        onPress={() => handlePageChange(currentPage + 1)}\r\n                        disabled={currentPage === totalPages}\r\n                        style={{\r\n                          padding: 12,\r\n                          backgroundColor: currentPage === totalPages ? colors.background : colors.cardBackground,\r\n                          borderRadius: 12,\r\n                          opacity: currentPage === totalPages ? 0.5 : 1,\r\n                          borderWidth: 1,\r\n                          borderColor: colors.border\r\n                        }}\r\n                      >\r\n                        <MaterialIcons name=\"chevron-right\" size={24} color={colors.textPrimary} />\r\n                      </Pressable>\r\n                    </View>\r\n                  )}\r\n                </>\r\n              )}\r\n            </View>\r\n          </View>\r\n        </View>\r\n      </ScrollView>\r\n\r\n      {/* User Modal */}\r\n      <Modal\r\n        visible={showUserModal}\r\n        animationType=\"fade\"\r\n        transparent={true}\r\n        onRequestClose={() => setShowUserModal(false)}\r\n      >\r\n        <View style={{ flex: 1, justifyContent: \"center\", alignItems: \"center\", backgroundColor: \"rgba(0,0,0,0.6)\" }}>\r\n          <View style={[styles.card, {\r\n            width: \"90%\",\r\n            maxWidth: 400,\r\n            maxHeight: \"90%\",\r\n            padding: 0,\r\n            overflow: 'hidden'\r\n          }]}>\r\n            <View style={{ padding: 24, borderBottomWidth: 1, borderBottomColor: colors.border }}>\r\n              <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\" }}>\r\n                <Text style={{ fontSize: 24, fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>\r\n                  {modalMode === \"add\" ? \"New User\" : \"Edit User\"}\r\n                </Text>\r\n                <Pressable onPress={() => setShowUserModal(false)} style={{ padding: 4 }}>\r\n                  <MaterialIcons name=\"close\" size={24} color={colors.textSecondary} />\r\n                </Pressable>\r\n              </View>\r\n            </View>\r\n\r\n            <ScrollView showsVerticalScrollIndicator={false} contentContainerStyle={{ padding: 24 }}>\r\n              {modalMode === \"add\" && (\r\n                <>\r\n                  <View style={{ marginBottom: 20 }}>\r\n                    <Text style={[styles.label, { marginBottom: 8 }]}>NAME</Text>\r\n                    <TextInput\r\n                      style={styles.input}\r\n                      placeholder=\"Enter name\"\r\n                      placeholderTextColor={colors.textSecondary}\r\n                      value={userForm.name}\r\n                      onChangeText={(text) => handleChange(\"name\", text)}\r\n                      onBlur={() => handleBlur(\"name\")}\r\n                    />\r\n                    {errors.name && touched.name && (\r\n                      <Text style={styles.errorText}>{errors.name}</Text>\r\n                    )}\r\n                  </View>\r\n\r\n                  <View style={{ marginBottom: 20 }}>\r\n                    <Text style={[styles.label, { marginBottom: 8 }]}>PHONE</Text>\r\n                    <TextInput\r\n                      style={styles.input}\r\n                      placeholder=\"Enter phone number\"\r\n                      placeholderTextColor={colors.textSecondary}\r\n                      value={userForm.phone}\r\n                      onChangeText={(text) => handleChange(\"phone\", text)}\r\n                      onBlur={() => handleBlur(\"phone\")}\r\n                      keyboardType=\"phone-pad\"\r\n                      maxLength={10}\r\n                    />\r\n                    {errors.phone && touched.phone && (\r\n                      <Text style={styles.errorText}>{errors.phone}</Text>\r\n                    )}\r\n                  </View>\r\n\r\n                  <View style={{ marginBottom: 20 }}>\r\n                    <Text style={[styles.label, { marginBottom: 8 }]}>EMAIL</Text>\r\n                    <TextInput\r\n                      style={styles.input}\r\n                      placeholder=\"Enter email (optional)\"\r\n                      placeholderTextColor={colors.textSecondary}\r\n                      value={userForm.email}\r\n                      onChangeText={(text) => handleChange(\"email\", text)}\r\n                      onBlur={() => handleBlur(\"email\")}\r\n                      keyboardType=\"email-address\"\r\n                      autoCapitalize=\"none\"\r\n                    />\r\n                    {errors.email && touched.email && (\r\n                      <Text style={styles.errorText}>{errors.email}</Text>\r\n                    )}\r\n                  </View>\r\n\r\n                  <View style={{ marginBottom: 24 }}>\r\n                    <Text style={[styles.label, { marginBottom: 8 }]}>PASSWORD</Text>\r\n                    <View style={[styles.input, { flexDirection: \"row\", alignItems: \"center\", paddingHorizontal: 16 }]}>\r\n                      <TextInput\r\n                        style={{\r\n                          flex: 1,\r\n                          fontSize: 16,\r\n                          color: colors.textPrimary,\r\n                          fontFamily: \"DMSans-Regular\",\r\n                          height: \"100%\"\r\n                        }}\r\n                        placeholder=\"Enter password\"\r\n                        placeholderTextColor={colors.textSecondary}\r\n                        value={userForm.password}\r\n                        onChangeText={(text) => handleChange(\"password\", text)}\r\n                        onBlur={() => handleBlur(\"password\")}\r\n                        secureTextEntry={!showPassword}\r\n                      />\r\n                      <Pressable\r\n                        onPress={() => setShowPassword(!showPassword)}\r\n                      >\r\n                        <MaterialIcons\r\n                          name={showPassword ? \"visibility-off\" : \"visibility\"}\r\n                          size={20}\r\n                          color={colors.textSecondary}\r\n                        />\r\n                      </Pressable>\r\n                    </View>\r\n                    {errors.password && touched.password && (\r\n                      <Text style={styles.errorText}>{errors.password}</Text>\r\n                    )}\r\n                  </View>\r\n\r\n                  {/* Role Selection */}\r\n                  <View style={{ marginBottom: 24 }}>\r\n                    <Text style={[styles.label, { marginBottom: 12 }]}>ROLE</Text>\r\n                    <ScrollView horizontal showsHorizontalScrollIndicator={false} contentContainerStyle={{ gap: 8 }}>\r\n                      {availableRoles.map((role) => (\r\n                        <Pressable\r\n                          key={role}\r\n                          onPress={() => handleChange(\"role\", role)}\r\n                          style={{\r\n                            paddingHorizontal: 16,\r\n                            paddingVertical: 10,\r\n                            backgroundColor: userForm.role === role ? colors.primary : colors.background,\r\n                            borderRadius: 12,\r\n                            borderWidth: 1,\r\n                            borderColor: userForm.role === role ? colors.primary : colors.border\r\n                          }}\r\n                        >\r\n                          <Text style={{\r\n                            color: userForm.role === role ? \"#fff\" : colors.textPrimary,\r\n                            fontFamily: \"DMSans-Bold\",\r\n                            textTransform: \"capitalize\",\r\n                            fontSize: 14\r\n                          }}>\r\n                            {role}\r\n                          </Text>\r\n                        </Pressable>\r\n                      ))}\r\n                    </ScrollView>\r\n                  </View>\r\n\r\n                  {/* Student Specific Fields */}\r\n                  {userForm.role === \"student\" && (\r\n                    <>\r\n                      <View style={{ marginBottom: 20 }}>\r\n                        <Text style={[styles.label, { marginBottom: 8 }]}>GUARDIAN NAME</Text>\r\n                        <TextInput\r\n                          style={styles.input}\r\n                          placeholder=\"Enter guardian name\"\r\n                          placeholderTextColor={colors.textSecondary}\r\n                          value={userForm.guardianName}\r\n                          onChangeText={(text) => handleChange(\"guardianName\", text)}\r\n                        />\r\n                      </View>\r\n                      <View style={{ marginBottom: 20 }}>\r\n                        <Text style={[styles.label, { marginBottom: 8 }]}>GUARDIAN PHONE</Text>\r\n                        <TextInput\r\n                          style={styles.input}\r\n                          placeholder=\"Enter guardian phone\"\r\n                          placeholderTextColor={colors.textSecondary}\r\n                          value={userForm.guardianPhone}\r\n                          onChangeText={(text) => handleChange(\"guardianPhone\", text)}\r\n                          keyboardType=\"phone-pad\"\r\n                          maxLength={10}\r\n                        />\r\n                      </View>\r\n                    </>\r\n                  )}\r\n\r\n                  {/* Teacher Specific Fields */}\r\n                  {(userForm.role === \"class teacher\" || userForm.role === \"staff\") && (\r\n                    <>\r\n                      <View style={{ marginBottom: 20 }}>\r\n                        <Text style={[styles.label, { marginBottom: 8 }]}>DESIGNATION</Text>\r\n                        <TextInput\r\n                          style={styles.input}\r\n                          placeholder=\"Enter designation\"\r\n                          placeholderTextColor={colors.textSecondary}\r\n                          value={userForm.designation}\r\n                          onChangeText={(text) => handleChange(\"designation\", text)}\r\n                        />\r\n                      </View>\r\n                    </>\r\n                  )}\r\n                </>\r\n              )}\r\n\r\n              {modalMode === \"edit\" && (\r\n                <View style={{ marginBottom: 32 }}>\r\n                  <Text style={[styles.label, { marginBottom: 12 }]}>ROLE</Text>\r\n                  <View style={{ flexDirection: \"row\", flexWrap: \"wrap\", gap: 8 }}>\r\n                    {availableRoles.map((role) => (\r\n                      <Pressable\r\n                        key={role}\r\n                        onPress={() => setUserForm({ ...userForm, role })}\r\n                        style={{\r\n                          backgroundColor: userForm.role === role ? colors.primary : colors.background,\r\n                          paddingHorizontal: 16,\r\n                          paddingVertical: 10,\r\n                          borderRadius: 12,\r\n                          borderWidth: 1,\r\n                          borderColor: userForm.role === role ? colors.primary : colors.border,\r\n                        }}\r\n                      >\r\n                        <Text\r\n                          style={{\r\n                            fontSize: 14,\r\n                            fontFamily: \"DMSans-Bold\",\r\n                            color: userForm.role === role ? \"#fff\" : colors.textSecondary,\r\n                            textTransform: \"capitalize\",\r\n                          }}\r\n                        >\r\n                          {role}\r\n                        </Text>\r\n                      </Pressable>\r\n                    ))}\r\n                  </View>\r\n                </View>\r\n              )}\r\n\r\n              {/* Action Buttons */}\r\n              <View style={{ flexDirection: \"row\", gap: 16, marginTop: 12 }}>\r\n                <Pressable\r\n                  onPress={() => setShowUserModal(false)}\r\n                  style={({ pressed }) => ({\r\n                    flex: 1,\r\n                    paddingVertical: 16,\r\n                    borderRadius: 16,\r\n                    alignItems: \"center\",\r\n                    backgroundColor: colors.background,\r\n                    borderWidth: 1,\r\n                    borderColor: colors.border,\r\n                    opacity: pressed ? 0.8 : 1,\r\n                  })}\r\n                >\r\n                  <Text style={{ fontSize: 16, fontFamily: \"DMSans-Bold\", color: colors.textSecondary }}>\r\n                    Cancel\r\n                  </Text>\r\n                </Pressable>\r\n\r\n                <Pressable\r\n                  onPress={modalMode === \"add\" ? createUser : () => updateUserRole(editingUser._id, userForm.role)}\r\n                  disabled={(modalMode === \"add\" && !isFormValid()) || saving}\r\n                  style={({ pressed }) => [\r\n                    styles.button,\r\n                    {\r\n                      flex: 1,\r\n                      opacity: ((modalMode === \"add\" && !isFormValid()) || saving) ? 0.5 : (pressed ? 0.9 : 1),\r\n                      marginBottom: 0 // Override default margin\r\n                    }\r\n                  ]}\r\n                >\r\n                  {saving ? (\r\n                    <ActivityIndicator size=\"small\" color=\"#fff\" />\r\n                  ) : (\r\n                    <Text style={styles.buttonText}>\r\n                      {modalMode === \"add\" ? \"Create User\" : \"Save Changes\"}\r\n                    </Text>\r\n                  )}\r\n                </Pressable>\r\n              </View>\r\n            </ScrollView>\r\n          </View>\r\n        </View>\r\n      </Modal>\r\n    </View>\r\n  );\r\n}\r\n\r\n// Helper Component for Menu Cards\r\nconst MenuCard = ({ title, icon, color, onPress }) => {\r\n  const { colors } = useTheme();\r\n\r\n  return (\r\n    <Pressable\r\n      onPress={onPress}\r\n      style={({ pressed }) => ({\r\n        flex: 1,\r\n        minWidth: \"30%\",\r\n        backgroundColor: colors.cardBackground,\r\n        padding: 20,\r\n        borderRadius: 24,\r\n        alignItems: \"center\",\r\n        opacity: pressed ? 0.9 : 1,\r\n        shadowColor: \"#000\",\r\n        shadowOffset: { width: 0, height: 4 },\r\n        shadowOpacity: 0.05,\r\n        shadowRadius: 12,\r\n        elevation: 3,\r\n        borderWidth: 1,\r\n        borderColor: colors.border\r\n      })}\r\n    >\r\n      <View style={{\r\n        backgroundColor: color + \"15\",\r\n        padding: 16,\r\n        borderRadius: 20,\r\n        marginBottom: 12\r\n      }}>\r\n        <MaterialIcons name={icon} size={28} color={color} />\r\n      </View>\r\n      <Text style={{\r\n        fontSize: 14,\r\n        fontFamily: \"DMSans-Bold\",\r\n        color: colors.textPrimary,\r\n        textAlign: \"center\"\r\n      }}>\r\n        {title}\r\n      </Text>\r\n    </Pressable>\r\n  );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\admin\\academic-year.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'StyleSheet' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":15},{"ruleId":"no-unused-vars","severity":1,"message":"'Platform' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":13},{"ruleId":"no-unused-vars","severity":1,"message":"'AsyncStorage' is defined but never used. Allowed unused vars must match /^_/u.","line":16,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":29,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":29,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":30,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":30,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'loadingYears' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":52,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":52,"endColumn":54}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    Pressable,\r\n    TextInput,\r\n    Alert,\r\n    RefreshControl,\r\n    ActivityIndicator,\r\n    Modal,\r\n    StyleSheet,\r\n    Platform,\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useRouter } from \"expo-router\";\r\nimport { Picker } from \"@react-native-picker/picker\";\r\nimport { useTheme } from \"../../theme\";\r\nimport apiConfig from \"../../config/apiConfig\";\r\nimport { useApiQuery, useApiMutation, createApiMutationFn } from \"../../hooks/useApi\";\r\n\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport { useToast } from \"../../components/ToastProvider\";\r\nimport Header from \"../../components/Header\";\r\nimport { formatDate } from \"../../utils/date\";\r\n\r\nexport default function AcademicYearScreen() {\r\n    const router = useRouter();\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n    const queryClient = useQueryClient();\r\n    const [activeTab, setActiveTab] = useState(\"years\"); // \"years\" | \"reports\"\r\n    const [showModal, setShowModal] = useState(false);\r\n    const [form, setForm] = useState({\r\n        name: \"\",\r\n        startDate: \"\",\r\n        endDate: \"\",\r\n        isActive: false\r\n    });\r\n    const [selectedYearId, setSelectedYearId] = useState(null);\r\n    const [refreshing, setRefreshing] = useState(false);\r\n\r\n    // Fetch User Role\r\n    const { data: userData } = useApiQuery(\r\n        ['currentUser'],\r\n        `${apiConfig.baseUrl}/auth/me`\r\n    );\r\n    const userRole = userData?.role;\r\n\r\n    // Fetch Academic Years\r\n    const { data: years = [], isLoading: loadingYears, refetch: refetchYears } = useApiQuery(\r\n        ['academicYears'],\r\n        `${apiConfig.baseUrl}/academic-year`\r\n    );\r\n\r\n    // Fetch Reports\r\n    const { data: reportData, isLoading: reportLoading, refetch: refetchReport } = useApiQuery(\r\n        ['academicYearReport', selectedYearId],\r\n        `${apiConfig.baseUrl}/academic-year/${selectedYearId}/reports`,\r\n        {\r\n            enabled: !!selectedYearId && activeTab === \"reports\",\r\n        }\r\n    );\r\n\r\n    // Set default selected year\r\n    useEffect(() => {\r\n        if (years.length > 0 && !selectedYearId) {\r\n            setSelectedYearId(years[0]._id);\r\n        }\r\n    }, [years, selectedYearId]);\r\n\r\n    // Mutations\r\n    const createYearMutation = useApiMutation({\r\n        mutationFn: createApiMutationFn(`${apiConfig.baseUrl}/academic-year`, 'POST'),\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: ['academicYears'] });\r\n            showToast(\"Academic Year created\", \"success\");\r\n            setShowModal(false);\r\n            setForm({ name: \"\", startDate: \"\", endDate: \"\", isActive: false });\r\n        },\r\n        onError: (error) => showToast(error.message || \"Failed to create\", \"error\")\r\n    });\r\n\r\n    const incrementYearMutation = useApiMutation({\r\n        mutationFn: (nextYearId) => createApiMutationFn(`${apiConfig.baseUrl}/academic-year/increment`, 'POST')({ nextYearId }),\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: ['academicYears'] });\r\n            showToast(\"Year Incremented & Students Promoted!\", \"success\");\r\n        },\r\n        onError: (error) => showToast(error.message || \"Failed to increment year\", \"error\")\r\n    });\r\n\r\n    const handleCreate = () => {\r\n        if (!form.name || !form.startDate || !form.endDate) {\r\n            showToast(\"Please fill all fields\", \"error\");\r\n            return;\r\n        }\r\n\r\n        // Validate format YYYY-YYYY\r\n        if (!/^\\d{4}-\\d{4}$/.test(form.name)) {\r\n            showToast(\"Name must be in YYYY-YYYY format\", \"error\");\r\n            return;\r\n        }\r\n\r\n        createYearMutation.mutate(form);\r\n    };\r\n\r\n    const handleIncrement = (id, name) => {\r\n        Alert.alert(\r\n            \"Activate & Promote\",\r\n            `WARNING: This will activate ${name}, promote all eligible students to the next class, and create history records for the current year. This action cannot be easily undone.`,\r\n            [\r\n                { text: \"Cancel\", style: \"cancel\" },\r\n                {\r\n                    text: \"Proceed\",\r\n                    style: \"destructive\",\r\n                    onPress: () => incrementYearMutation.mutate(id),\r\n                },\r\n            ]\r\n        );\r\n    };\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        await Promise.all([refetchYears(), refetchReport()]);\r\n        setRefreshing(false);\r\n    };\r\n\r\n    const renderYearsTab = () => (\r\n        <View style={{ marginTop: 16 }}>\r\n            {years.map((year) => (\r\n                <View\r\n                    key={year._id}\r\n                    style={{\r\n                        backgroundColor: colors.cardBackground,\r\n                        borderRadius: 16,\r\n                        padding: 16,\r\n                        marginBottom: 12,\r\n                        flexDirection: \"row\",\r\n                        justifyContent: \"space-between\",\r\n                        alignItems: \"center\",\r\n                        borderWidth: year.isActive ? 2 : 0,\r\n                        borderColor: colors.primary\r\n                    }}\r\n                >\r\n                    <View>\r\n                        <Text style={{ fontSize: 18, fontWeight: \"700\", color: colors.textPrimary }}>\r\n                            {year.name}\r\n                        </Text>\r\n                        <Text style={{ fontSize: 14, color: colors.textSecondary, marginTop: 4 }}>\r\n                            {formatDate(year.startDate)} - {formatDate(year.endDate)}\r\n                        </Text>\r\n                        {year.isActive && (\r\n                            <View style={{ backgroundColor: colors.primary + \"20\", alignSelf: \"flex-start\", paddingHorizontal: 8, paddingVertical: 2, borderRadius: 4, marginTop: 8 }}>\r\n                                <Text style={{ color: colors.primary, fontSize: 12, fontWeight: \"600\" }}>ACTIVE</Text>\r\n                            </View>\r\n                        )}\r\n                    </View>\r\n\r\n                    {!year.isActive && userRole === 'super admin' && (\r\n                        <Pressable\r\n                            onPress={() => handleIncrement(year._id, year.name)}\r\n                            style={{\r\n                                backgroundColor: colors.cardBackground,\r\n                                borderWidth: 1,\r\n                                borderColor: colors.primary,\r\n                                paddingHorizontal: 12,\r\n                                paddingVertical: 8,\r\n                                borderRadius: 8\r\n                            }}\r\n                        >\r\n                            <Text style={{ color: colors.primary, fontWeight: \"600\" }}>Activate & Promote</Text>\r\n                        </Pressable>\r\n                    )}\r\n                </View>\r\n            ))}\r\n        </View>\r\n    );\r\n\r\n    const renderReportsTab = () => (\r\n        <View style={{ marginTop: 16 }}>\r\n            <View style={{ backgroundColor: colors.cardBackground, borderRadius: 12, marginBottom: 16 }}>\r\n                <Picker\r\n                    selectedValue={selectedYearId}\r\n                    onValueChange={(itemValue) => setSelectedYearId(itemValue)}\r\n                    style={{ color: colors.textPrimary }}\r\n                    dropdownIconColor={colors.textPrimary}\r\n                >\r\n                    {years.map((year) => (\r\n                        <Picker.Item key={year._id} label={year.name} value={year._id} />\r\n                    ))}\r\n                </Picker>\r\n            </View>\r\n\r\n            {reportLoading ? (\r\n                <ActivityIndicator size=\"large\" color={colors.primary} />\r\n            ) : reportData ? (\r\n                <View>\r\n                    {/* Student Summary */}\r\n                    <View style={localStyles.card(colors)}>\r\n                        <Text style={localStyles.cardTitle(colors)}>Student Distribution</Text>\r\n                        {Object.entries(reportData.classWiseStudents || {}).map(([className, students]) => (\r\n                            <View key={className} style={{ flexDirection: \"row\", justifyContent: \"space-between\", marginBottom: 8 }}>\r\n                                <Text style={{ color: colors.textSecondary }}>{className}</Text>\r\n                                <Text style={{ color: colors.textPrimary, fontWeight: \"600\" }}>{students.length}</Text>\r\n                            </View>\r\n                        ))}\r\n                    </View>\r\n\r\n                    {/* Teacher Leaves */}\r\n                    <View style={localStyles.card(colors)}>\r\n                        <Text style={localStyles.cardTitle(colors)}>Teacher Leaves</Text>\r\n                        {reportData.teacherLeaves && reportData.teacherLeaves.length > 0 ? (\r\n                            reportData.teacherLeaves.map((leave, index) => (\r\n                                <View key={index} style={{ marginBottom: 12, borderBottomWidth: 1, borderBottomColor: colors.border, paddingBottom: 8 }}>\r\n                                    <Text style={{ color: colors.textPrimary, fontWeight: \"600\" }}>{leave.applicant?.name}</Text>\r\n                                    <Text style={{ color: colors.textSecondary, fontSize: 12 }}>\r\n                                        {formatDate(leave.startDate)} - {formatDate(leave.endDate)} ({leave.leaveType})\r\n                                    </Text>\r\n                                    <Text style={{ color: colors.textSecondary, fontSize: 12 }}>Reason: {leave.reason}</Text>\r\n                                </View>\r\n                            ))\r\n                        ) : (\r\n                            <Text style={{ color: colors.textSecondary }}>No leaves recorded.</Text>\r\n                        )}\r\n                    </View>\r\n\r\n                    {/* Teacher Attendance Summary */}\r\n                    <View style={localStyles.card(colors)}>\r\n                        <Text style={localStyles.cardTitle(colors)}>Teacher Attendance Stats</Text>\r\n                        {reportData.teacherAttendance && reportData.teacherAttendance.length > 0 ? (\r\n                            reportData.teacherAttendance.map((record, index) => (\r\n                                <View key={index} style={{ flexDirection: \"row\", justifyContent: \"space-between\", marginBottom: 4 }}>\r\n                                    <Text style={{ color: colors.textSecondary }}>{record.user} ({record.status})</Text>\r\n                                    <Text style={{ color: colors.textPrimary, fontWeight: \"600\" }}>{record.count} days</Text>\r\n                                </View>\r\n                            ))\r\n                        ) : (\r\n                            <Text style={{ color: colors.textSecondary }}>No attendance data.</Text>\r\n                        )}\r\n                    </View>\r\n                </View>\r\n            ) : (\r\n                <Text style={{ color: colors.textSecondary, textAlign: \"center\" }}>Select a year to view reports</Text>\r\n            )}\r\n        </View>\r\n    );\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <ScrollView\r\n                refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} />}\r\n                contentContainerStyle={{ paddingBottom: 100 }}\r\n            >\r\n                <View style={{ padding: 16, paddingTop: 24 }}>\r\n                    <Header title=\"Academic Years\" subtitle=\"Manage & Reports\" showBack />\r\n\r\n                    {/* Tabs */}\r\n                    <View style={{ flexDirection: \"row\", marginTop: 16, backgroundColor: colors.cardBackground, borderRadius: 12, padding: 4 }}>\r\n                        <Pressable\r\n                            onPress={() => setActiveTab(\"years\")}\r\n                            style={{\r\n                                flex: 1,\r\n                                paddingVertical: 10,\r\n                                alignItems: \"center\",\r\n                                borderRadius: 8,\r\n                                backgroundColor: activeTab === \"years\" ? colors.primary : \"transparent\"\r\n                            }}\r\n                        >\r\n                            <Text style={{ color: activeTab === \"years\" ? \"#fff\" : colors.textSecondary, fontWeight: \"600\" }}>Management</Text>\r\n                        </Pressable>\r\n                        <Pressable\r\n                            onPress={() => setActiveTab(\"reports\")}\r\n                            style={{\r\n                                flex: 1,\r\n                                paddingVertical: 10,\r\n                                alignItems: \"center\",\r\n                                borderRadius: 8,\r\n                                backgroundColor: activeTab === \"reports\" ? colors.primary : \"transparent\"\r\n                            }}\r\n                        >\r\n                            <Text style={{ color: activeTab === \"reports\" ? \"#fff\" : colors.textSecondary, fontWeight: \"600\" }}>Reports</Text>\r\n                        </Pressable>\r\n                    </View>\r\n\r\n                    {activeTab === \"years\" ? renderYearsTab() : renderReportsTab()}\r\n                </View>\r\n            </ScrollView>\r\n\r\n            {activeTab === \"years\" && (\r\n                <Pressable\r\n                    onPress={() => setShowModal(true)}\r\n                    style={{\r\n                        position: \"absolute\",\r\n                        bottom: 110,\r\n                        right: 24,\r\n                        backgroundColor: colors.primary,\r\n                        width: 56,\r\n                        height: 56,\r\n                        borderRadius: 28,\r\n                        justifyContent: \"center\",\r\n                        alignItems: \"center\",\r\n                        elevation: 6,\r\n                    }}\r\n                >\r\n                    <MaterialIcons name=\"add\" size={28} color=\"#fff\" />\r\n                </Pressable>\r\n            )}\r\n\r\n            <Modal visible={showModal} animationType=\"slide\" transparent>\r\n                <View style={{ flex: 1, justifyContent: \"center\", backgroundColor: \"rgba(0,0,0,0.5)\", padding: 20 }}>\r\n                    <View style={{ backgroundColor: colors.cardBackground, borderRadius: 16, padding: 24 }}>\r\n                        <Text style={{ fontSize: 20, fontWeight: \"700\", color: colors.textPrimary, marginBottom: 16 }}>\r\n                            New Academic Year\r\n                        </Text>\r\n\r\n                        <TextInput\r\n                            placeholder=\"Name (e.g. 2025-2026)\"\r\n                            placeholderTextColor={colors.textSecondary}\r\n                            style={{\r\n                                backgroundColor: colors.background,\r\n                                padding: 12,\r\n                                borderRadius: 8,\r\n                                color: colors.textPrimary,\r\n                                marginBottom: 12\r\n                            }}\r\n                            value={form.name}\r\n                            onChangeText={(t) => setForm({ ...form, name: t })}\r\n                        />\r\n\r\n                        <TextInput\r\n                            placeholder=\"Start Date (DD-MM-YYYY)\"\r\n                            placeholderTextColor={colors.textSecondary}\r\n                            style={{\r\n                                backgroundColor: colors.background,\r\n                                padding: 12,\r\n                                borderRadius: 8,\r\n                                color: colors.textPrimary,\r\n                                marginBottom: 12\r\n                            }}\r\n                            value={form.startDate}\r\n                            onChangeText={(t) => setForm({ ...form, startDate: t })}\r\n                        />\r\n\r\n                        <TextInput\r\n                            placeholder=\"End Date (DD-MM-YYYY)\"\r\n                            placeholderTextColor={colors.textSecondary}\r\n                            style={{\r\n                                backgroundColor: colors.background,\r\n                                padding: 12,\r\n                                borderRadius: 8,\r\n                                color: colors.textPrimary,\r\n                                marginBottom: 24\r\n                            }}\r\n                            value={form.endDate}\r\n                            onChangeText={(t) => setForm({ ...form, endDate: t })}\r\n                        />\r\n\r\n                        <View style={{ flexDirection: \"row\", justifyContent: \"flex-end\", gap: 12 }}>\r\n                            <Pressable onPress={() => setShowModal(false)} style={{ padding: 12 }}>\r\n                                <Text style={{ color: colors.textSecondary, fontWeight: \"600\" }}>Cancel</Text>\r\n                            </Pressable>\r\n                            <Pressable\r\n                                onPress={handleCreate}\r\n                                disabled={createYearMutation.isPending}\r\n                                style={{\r\n                                    backgroundColor: colors.primary,\r\n                                    paddingHorizontal: 20,\r\n                                    paddingVertical: 12,\r\n                                    borderRadius: 8,\r\n                                    opacity: createYearMutation.isPending ? 0.7 : 1,\r\n                                    minWidth: 80,\r\n                                    alignItems: 'center'\r\n                                }}\r\n                            >\r\n                                {createYearMutation.isPending ? (\r\n                                    <ActivityIndicator size=\"small\" color=\"#fff\" />\r\n                                ) : (\r\n                                    <Text style={{ color: \"#fff\", fontWeight: \"600\" }}>Create</Text>\r\n                                )}\r\n                            </Pressable>\r\n                        </View>\r\n                    </View>\r\n                </View>\r\n            </Modal>\r\n        </View>\r\n    );\r\n}\r\n\r\nconst localStyles = {\r\n    card: (colors) => ({\r\n        backgroundColor: colors.cardBackground,\r\n        borderRadius: 16,\r\n        padding: 16,\r\n        marginBottom: 12,\r\n    }),\r\n    cardTitle: (colors) => ({\r\n        fontSize: 16,\r\n        fontWeight: \"700\",\r\n        color: colors.textPrimary,\r\n        marginBottom: 12,\r\n        borderBottomWidth: 1,\r\n        borderBottomColor: colors.border,\r\n        paddingBottom: 8\r\n    })\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\admin\\attendance.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useCallback' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":49},{"ruleId":"no-unused-vars","severity":1,"message":"'Modal' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":62,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":67},{"ruleId":"no-unused-vars","severity":1,"message":"'AsyncStorage' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport { View, Text, StyleSheet, FlatList, TouchableOpacity, Modal, ActivityIndicator, ScrollView, RefreshControl } from 'react-native';\r\nimport { useRouter } from 'expo-router';\r\nimport { Ionicons } from '@expo/vector-icons';\r\nimport AsyncStorage from '@react-native-async-storage/async-storage';\r\nimport DateTimePicker from '@react-native-community/datetimepicker';\r\nimport { useApiQuery, useApiMutation, createApiMutationFn } from '../../hooks/useApi';\r\nimport { useQueryClient } from '@tanstack/react-query';\r\nimport apiConfig from '../../config/apiConfig';\r\nimport { useToast } from '../../components/ToastProvider';\r\nimport { useTheme } from '../../theme';\r\n\r\nimport AttendanceView from '../../components/AttendanceView';\r\n\r\nexport default function AdminAttendance() {\r\n    const router = useRouter();\r\n    // ... (rest of component)\r\n    const { showToast } = useToast();\r\n    const { colors } = useTheme();\r\n    const queryClient = useQueryClient();\r\n    const [activeTab, setActiveTab] = useState('summary'); // 'summary', 'student', 'staff', 'my_attendance'\r\n    const [date, setDate] = useState(new Date());\r\n    const [showDatePicker, setShowDatePicker] = useState(false);\r\n    const [selectedClass, setSelectedClass] = useState(null);\r\n    const [refreshing, setRefreshing] = useState(false);\r\n\r\n    // Fetch User\r\n    const { data: user } = useApiQuery(\r\n        ['currentUser'],\r\n        `${apiConfig.baseUrl}/auth/me`\r\n    );\r\n\r\n    // Fetch School Summary\r\n    const { data: schoolSummary, isLoading: summaryLoading, refetch: refetchSummary } = useApiQuery(\r\n        ['attendanceSummary', date.toISOString().split('T')[0]],\r\n        `${apiConfig.baseUrl}/attendance/school-summary?date=${date.toISOString().split('T')[0]}`,\r\n        { enabled: activeTab === 'summary' }\r\n    );\r\n\r\n    // Fetch Classes\r\n    const { data: classesData = [] } = useApiQuery(\r\n        ['classes'],\r\n        `${apiConfig.baseUrl}/classes`,\r\n        { enabled: activeTab === 'student' }\r\n    );\r\n    const classes = Array.isArray(classesData) ? classesData : (classesData.data || []);\r\n\r\n    // Fetch Student Attendance\r\n    const { data: studentAttendance = [], isLoading: studentLoading, refetch: refetchStudent } = useApiQuery(\r\n        ['studentAttendance', selectedClass?._id, date.toISOString().split('T')[0]],\r\n        `${apiConfig.baseUrl}/attendance/class/${selectedClass?._id}/date/${date.toISOString().split('T')[0]}`,\r\n        { enabled: activeTab === 'student' && !!selectedClass }\r\n    );\r\n\r\n    // Fetch Staff List\r\n    const { data: staffListResponse, isLoading: staffLoading, refetch: refetchStaff } = useApiQuery(\r\n        ['staffList', date.toISOString().split('T')[0]],\r\n        `${apiConfig.baseUrl}/attendance/staff-list?date=${date.toISOString().split('T')[0]}`,\r\n        { enabled: activeTab === 'staff' }\r\n    );\r\n    const staffList = staffListResponse?.data || [];\r\n\r\n    // Fetch My Attendance\r\n    const { data: myAttendanceData, isLoading: myAttendanceLoading, refetch: refetchMyAttendance } = useApiQuery(\r\n        ['myAttendance'],\r\n        `${apiConfig.baseUrl}/attendance/my-attendance`,\r\n        { enabled: activeTab === 'my_attendance' }\r\n    );\r\n    const myAttendance = myAttendanceData?.attendance || [];\r\n    const mySummary = myAttendanceData?.summary || null;\r\n\r\n    const loading = summaryLoading || studentLoading || staffLoading || myAttendanceLoading;\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        if (activeTab === 'summary') await refetchSummary();\r\n        if (activeTab === 'student') await refetchStudent();\r\n        if (activeTab === 'staff') await refetchStaff();\r\n        if (activeTab === 'my_attendance') await refetchMyAttendance();\r\n        setRefreshing(false);\r\n    };\r\n\r\n    // Local state for modifications before saving\r\n    const [localStudentAttendance, setLocalStudentAttendance] = useState([]);\r\n    const [localStaffList, setLocalStaffList] = useState([]);\r\n\r\n    useEffect(() => {\r\n        if (studentAttendance) setLocalStudentAttendance(studentAttendance);\r\n    }, [studentAttendance]);\r\n\r\n    useEffect(() => {\r\n        if (staffList) setLocalStaffList(staffList);\r\n    }, [staffList]);\r\n\r\n    // Mutations\r\n    const saveStudentAttendanceMutation = useApiMutation({\r\n        mutationFn: createApiMutationFn(`${apiConfig.baseUrl}/attendance/mark`, 'POST'),\r\n        onSuccess: () => {\r\n            showToast('Student attendance saved', 'success');\r\n            queryClient.invalidateQueries({ queryKey: ['studentAttendance'] });\r\n            queryClient.invalidateQueries({ queryKey: ['attendanceSummary'] });\r\n        },\r\n        onError: () => showToast('Failed to save attendance', 'error')\r\n    });\r\n\r\n    const saveStaffAttendanceMutation = useApiMutation({\r\n        mutationFn: createApiMutationFn(`${apiConfig.baseUrl}/attendance/mark-staff`, 'POST'),\r\n        onSuccess: () => {\r\n            showToast('Staff attendance saved', 'success');\r\n            queryClient.invalidateQueries({ queryKey: ['staffList'] });\r\n            queryClient.invalidateQueries({ queryKey: ['attendanceSummary'] });\r\n        },\r\n        onError: () => showToast('Failed to save attendance', 'error')\r\n    });\r\n\r\n    // --- Student Attendance Handlers ---\r\n\r\n    const toggleStudentStatus = (index) => {\r\n        const newAttendance = [...localStudentAttendance];\r\n        const currentStatus = newAttendance[index].status;\r\n        // Cycle: null -> present -> absent -> late -> excused -> null\r\n        // Simplified: present -> absent -> late -> present\r\n        let nextStatus = 'present';\r\n        if (currentStatus === 'present') nextStatus = 'absent';\r\n        else if (currentStatus === 'absent') nextStatus = 'late';\r\n        else if (currentStatus === 'late') nextStatus = 'excused';\r\n        else if (currentStatus === 'excused') nextStatus = 'present';\r\n\r\n        if (!currentStatus) nextStatus = 'present';\r\n\r\n        newAttendance[index].status = nextStatus;\r\n        setLocalStudentAttendance(newAttendance);\r\n    };\r\n\r\n    const markAllStudentsPresent = () => {\r\n        const newAttendance = localStudentAttendance.map(item => ({\r\n            ...item,\r\n            status: 'present'\r\n        }));\r\n        setLocalStudentAttendance(newAttendance);\r\n    };\r\n\r\n    const saveStudentAttendance = () => {\r\n        if (!selectedClass) return;\r\n        const records = localStudentAttendance\r\n            .filter(item => item.status)\r\n            .map(item => ({\r\n                studentId: item.student._id,\r\n                status: item.status,\r\n                remarks: item.remarks\r\n            }));\r\n\r\n        if (records.length === 0) {\r\n            showToast('No attendance marked to save', 'info');\r\n            return;\r\n        }\r\n\r\n        saveStudentAttendanceMutation.mutate({\r\n            classId: selectedClass._id,\r\n            date: date.toISOString().split('T')[0],\r\n            attendanceRecords: records\r\n        });\r\n    };\r\n\r\n    // --- Staff Attendance Handlers ---\r\n\r\n    const markAllStaffPresent = () => {\r\n        const newStaffList = localStaffList.map(item => ({\r\n            ...item,\r\n            status: 'present'\r\n        }));\r\n        setLocalStaffList(newStaffList);\r\n    };\r\n\r\n    const toggleStaffStatus = (index) => {\r\n        const newStaffList = [...localStaffList];\r\n        const currentStatus = newStaffList[index].status;\r\n        // Cycle: null -> present -> absent -> late -> null\r\n        let nextStatus = 'present';\r\n        if (currentStatus === 'present') nextStatus = 'absent';\r\n        else if (currentStatus === 'absent') nextStatus = 'late';\r\n        else if (currentStatus === 'late') nextStatus = 'present';\r\n\r\n        // If it was null, start with present\r\n        if (!currentStatus) nextStatus = 'present';\r\n\r\n        newStaffList[index].status = nextStatus;\r\n        setLocalStaffList(newStaffList);\r\n    };\r\n\r\n    const saveStaffAttendance = () => {\r\n        const records = localStaffList\r\n            .filter(item => item.status) // Only send marked records\r\n            .map(item => ({\r\n                userId: item.user._id,\r\n                status: item.status,\r\n                remarks: item.remarks\r\n            }));\r\n\r\n        if (records.length === 0) {\r\n            showToast('No attendance marked to save', 'info');\r\n            return;\r\n        }\r\n\r\n        saveStaffAttendanceMutation.mutate({\r\n            date: date.toISOString().split('T')[0],\r\n            attendanceRecords: records\r\n        });\r\n    };\r\n\r\n    // --- Render Helpers ---\r\n\r\n    const getStatusColor = (status) => {\r\n        switch (status) {\r\n            case 'present': return '#4CAF50';\r\n            case 'absent': return '#F44336';\r\n            case 'late': return '#FF9800';\r\n            case 'excused': return '#2196F3';\r\n            default: return '#e0e0e0';\r\n        }\r\n    };\r\n\r\n    const renderStaffItem = ({ item, index }) => (\r\n        <TouchableOpacity\r\n            style={styles.staffCard}\r\n            onPress={() => toggleStaffStatus(index)}\r\n        >\r\n            <View style={styles.staffInfo}>\r\n                <Text style={styles.staffName}>{item.user.name}</Text>\r\n                <Text style={styles.staffRole}>Class Teacher</Text>\r\n            </View>\r\n            <View style={[styles.statusIndicator, { backgroundColor: getStatusColor(item.status) }]}>\r\n                <Text style={styles.statusText}>{item.status ? item.status.toUpperCase() : 'MARK'}</Text>\r\n            </View>\r\n        </TouchableOpacity>\r\n    );\r\n\r\n\r\n\r\n    return (\r\n        <View style={styles.container}>\r\n            <View style={styles.header}>\r\n                <TouchableOpacity onPress={() => router.back()} style={styles.backButton}>\r\n                    <Ionicons name=\"arrow-back\" size={24} color=\"#333\" />\r\n                </TouchableOpacity>\r\n                <Text style={styles.headerTitle}>Attendance Management</Text>\r\n                <View style={{ width: 24 }} />\r\n            </View>\r\n\r\n            <View style={styles.tabContainer}>\r\n                <TouchableOpacity\r\n                    style={[styles.tab, activeTab === 'summary' && { borderBottomColor: colors.primary }]}\r\n                    onPress={() => setActiveTab('summary')}\r\n                >\r\n                    <Text style={[styles.tabText, activeTab === 'summary' && { color: colors.primary, fontWeight: 'bold' }]}>Summary</Text>\r\n                </TouchableOpacity>\r\n                <TouchableOpacity\r\n                    style={[styles.tab, activeTab === 'student' && { borderBottomColor: colors.primary }]}\r\n                    onPress={() => setActiveTab('student')}\r\n                >\r\n                    <Text style={[styles.tabText, activeTab === 'student' && { color: colors.primary, fontWeight: 'bold' }]}>Student</Text>\r\n                </TouchableOpacity>\r\n                <TouchableOpacity\r\n                    style={[styles.tab, activeTab === 'staff' && { borderBottomColor: colors.primary }]}\r\n                    onPress={() => setActiveTab('staff')}\r\n                >\r\n                    <Text style={[styles.tabText, activeTab === 'staff' && { color: colors.primary, fontWeight: 'bold' }]}>Staff</Text>\r\n                </TouchableOpacity>\r\n                {user?.role !== 'super admin' && (\r\n                    <TouchableOpacity\r\n                        style={[styles.tab, activeTab === 'my_attendance' && { borderBottomColor: colors.primary }]}\r\n                        onPress={() => setActiveTab('my_attendance')}\r\n                    >\r\n                        <Text style={[styles.tabText, activeTab === 'my_attendance' && { color: colors.primary, fontWeight: 'bold' }]}>My Log</Text>\r\n                    </TouchableOpacity>\r\n                )}\r\n            </View>\r\n\r\n            {/* Date Picker for Student/Staff/Summary tabs */}\r\n            {activeTab !== 'my_attendance' && (\r\n                <View style={styles.dateBar}>\r\n                    <TouchableOpacity onPress={() => setShowDatePicker(true)} style={[styles.dateSelector, { backgroundColor: colors.primary + '15' }]}>\r\n                        <Ionicons name=\"calendar\" size={20} color={colors.primary} />\r\n                        <Text style={[styles.dateText, { color: colors.primary }]}>{date.toDateString()}</Text>\r\n                    </TouchableOpacity>\r\n                    {showDatePicker && (\r\n                        <DateTimePicker\r\n                            value={date}\r\n                            mode=\"date\"\r\n                            display=\"default\"\r\n                            onChange={(event, selectedDate) => {\r\n                                setShowDatePicker(false);\r\n                                if (selectedDate) setDate(selectedDate);\r\n                            }}\r\n                        />\r\n                    )}\r\n                </View>\r\n            )}\r\n\r\n            {loading ? (\r\n                <ActivityIndicator size=\"large\" color={colors.primary} style={styles.loader} />\r\n            ) : (\r\n                <View style={{ flex: 1 }}>\r\n                    {activeTab === 'summary' && schoolSummary && (\r\n                        <ScrollView style={{ flex: 1, padding: 16 }} refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} />}>\r\n                            {/* Summary Cards */}\r\n                            <View style={{ flexDirection: 'row', gap: 12, marginBottom: 24 }}>\r\n                                <View style={[styles.summaryCardSmall, { backgroundColor: '#E3F2FD' }]}>\r\n                                    <Text style={[styles.summaryValue, { color: '#1976D2' }]}>{schoolSummary?.students?.present || 0}/{schoolSummary?.students?.total || 0}</Text>\r\n                                    <Text style={styles.summaryLabel}>Student Attendance</Text>\r\n                                </View>\r\n                                <View style={[styles.summaryCardSmall, { backgroundColor: '#E8F5E9' }]}>\r\n                                    <Text style={[styles.summaryValue, { color: '#388E3C' }]}>{schoolSummary?.teachers?.present || 0}/{schoolSummary?.teachers?.total || 0}</Text>\r\n                                    <Text style={styles.summaryLabel}>Teacher Attendance</Text>\r\n                                </View>\r\n                            </View>\r\n\r\n                            {/* Absent List */}\r\n                            <Text style={styles.sectionTitle}>Absent Today</Text>\r\n                            {(schoolSummary?.absentList || []).length === 0 ? (\r\n                                <Text style={styles.emptyText}>No one marked absent yet.</Text>\r\n                            ) : (\r\n                                schoolSummary.absentList.map((item) => (\r\n                                    <View key={item._id} style={styles.absentRow}>\r\n                                        <View>\r\n                                            <Text style={styles.absentName}>{item.name}</Text>\r\n                                            <Text style={styles.absentRole}>{item.role}  {item.className}</Text>\r\n                                        </View>\r\n                                        <View style={styles.absentTag}>\r\n                                            <Text style={styles.absentTagText}>Absent</Text>\r\n                                        </View>\r\n                                    </View>\r\n                                ))\r\n                            )}\r\n                        </ScrollView>\r\n                    )}\r\n\r\n                    {activeTab === 'student' && (\r\n                        <View style={{ flex: 1 }}>\r\n                            <View style={{ padding: 16, paddingBottom: 0 }}>\r\n                                <Text style={styles.sectionTitle}>Select Class</Text>\r\n                                <ScrollView horizontal showsHorizontalScrollIndicator={false} style={styles.classScroll}>\r\n                                    {classes.map((cls) => (\r\n                                        <TouchableOpacity\r\n                                            key={cls._id}\r\n                                            style={[styles.classChip, selectedClass?._id === cls._id && { backgroundColor: colors.primary, borderColor: colors.primary }]}\r\n                                            onPress={() => setSelectedClass(cls)}\r\n                                        >\r\n                                            <Text style={[styles.classChipText, selectedClass?._id === cls._id && styles.activeClassChipText]}>\r\n                                                {cls.name} {cls.section}\r\n                                            </Text>\r\n                                        </TouchableOpacity>\r\n                                    ))}\r\n                                </ScrollView>\r\n                            </View>\r\n\r\n                            {selectedClass && (\r\n                                <>\r\n                                    <View style={styles.actionHeader}>\r\n                                        <TouchableOpacity onPress={markAllStudentsPresent} style={styles.textButton}>\r\n                                            <Text style={[styles.textButtonText, { color: colors.primary }]}>Mark All Present</Text>\r\n                                        </TouchableOpacity>\r\n                                    </View>\r\n                                    <FlatList\r\n                                        style={{ flex: 1 }}\r\n                                        data={localStudentAttendance}\r\n                                        keyExtractor={(item) => item.student._id}\r\n                                        renderItem={({ item, index }) => (\r\n                                            <TouchableOpacity\r\n                                                style={styles.studentRow}\r\n                                                onPress={() => toggleStudentStatus(index)}\r\n                                            >\r\n                                                <Text style={styles.studentName}>{item.student.name}</Text>\r\n                                                <View style={[styles.miniStatus, { backgroundColor: getStatusColor(item.status) }]}>\r\n                                                    <Text style={styles.miniStatusText}>{item.status ? item.status.toUpperCase() : 'MARK'}</Text>\r\n                                                </View>\r\n                                            </TouchableOpacity>\r\n                                        )}\r\n                                        ListEmptyComponent={<Text style={styles.emptyText}>No students found.</Text>}\r\n                                        contentContainerStyle={{ paddingHorizontal: 16, paddingBottom: 100 }}\r\n                                    />\r\n                                    <View style={styles.footer}>\r\n                                        <TouchableOpacity\r\n                                            style={[styles.saveButton, { backgroundColor: colors.primary }]}\r\n                                            onPress={saveStudentAttendance}\r\n                                            disabled={saveStudentAttendanceMutation.isPending}\r\n                                        >\r\n                                            {saveStudentAttendanceMutation.isPending ? (\r\n                                                <ActivityIndicator color=\"#fff\" />\r\n                                            ) : (\r\n                                                <Text style={styles.saveButtonText}>Save Student Attendance</Text>\r\n                                            )}\r\n                                        </TouchableOpacity>\r\n                                    </View>\r\n                                </>\r\n                            )}\r\n                        </View>\r\n                    )}\r\n\r\n                    {activeTab === 'staff' && (\r\n                        <View style={{ flex: 1 }}>\r\n                            <View style={styles.actionHeader}>\r\n                                <TouchableOpacity onPress={markAllStaffPresent} style={styles.textButton}>\r\n                                    <Text style={[styles.textButtonText, { color: colors.primary }]}>Mark All Present</Text>\r\n                                </TouchableOpacity>\r\n                            </View>\r\n                            <FlatList\r\n                                style={{ flex: 1 }}\r\n                                data={localStaffList}\r\n                                renderItem={renderStaffItem}\r\n                                keyExtractor={(item) => item.user._id}\r\n                                contentContainerStyle={styles.listContent}\r\n                                refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} />}\r\n                            />\r\n                            <View style={styles.footer}>\r\n                                <TouchableOpacity\r\n                                    style={[styles.saveButton, { backgroundColor: colors.primary }]}\r\n                                    onPress={saveStaffAttendance}\r\n                                    disabled={saveStaffAttendanceMutation.isPending}\r\n                                >\r\n                                    {saveStaffAttendanceMutation.isPending ? (\r\n                                        <ActivityIndicator color=\"#fff\" />\r\n                                    ) : (\r\n                                        <Text style={styles.saveButtonText}>Save Attendance</Text>\r\n                                    )}\r\n                                </TouchableOpacity>\r\n                            </View>\r\n                        </View>\r\n                    )}\r\n\r\n                    {activeTab === 'my_attendance' && (\r\n                        <AttendanceView\r\n                            attendanceHistory={myAttendance}\r\n                            summary={mySummary}\r\n                            loading={loading}\r\n                            refreshing={refreshing}\r\n                            onRefresh={onRefresh}\r\n                            title=\"My Attendance Log\"\r\n                            subtitle=\"Track your admin attendance\"\r\n                        />\r\n                    )}\r\n                </View>\r\n            )}\r\n        </View>\r\n    );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n    container: { flex: 1, backgroundColor: '#f5f5f5' },\r\n    header: { flexDirection: 'row', alignItems: 'center', justifyContent: 'space-between', padding: 16, backgroundColor: '#fff', elevation: 2 },\r\n    headerTitle: { fontSize: 18, fontWeight: 'bold', color: '#333' },\r\n    backButton: { padding: 4 },\r\n    tabContainer: { flexDirection: 'row', backgroundColor: '#fff', paddingHorizontal: 16, paddingBottom: 12, borderBottomWidth: 1, borderBottomColor: '#eee' },\r\n    tab: { flex: 1, paddingVertical: 10, alignItems: 'center', borderBottomWidth: 2, borderBottomColor: 'transparent' },\r\n    tabText: { fontSize: 16, color: '#666', fontWeight: '500' },\r\n    dateBar: { flexDirection: 'row', justifyContent: 'center', padding: 12, backgroundColor: '#fff', borderBottomWidth: 1, borderBottomColor: '#eee' },\r\n    dateSelector: { flexDirection: 'row', alignItems: 'center', paddingHorizontal: 16, paddingVertical: 8, borderRadius: 20 },\r\n    dateText: { marginLeft: 8, fontWeight: '600' },\r\n    loader: { marginTop: 20 },\r\n    listContent: { padding: 16, paddingBottom: 100 },\r\n    staffCard: { flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center', backgroundColor: '#fff', padding: 16, borderRadius: 12, marginBottom: 12, elevation: 1 },\r\n    staffInfo: { flex: 1 },\r\n    staffName: { fontSize: 16, fontWeight: 'bold', color: '#333' },\r\n    staffRole: { fontSize: 12, color: '#666' },\r\n    statusIndicator: { paddingHorizontal: 12, paddingVertical: 6, borderRadius: 12, minWidth: 80, alignItems: 'center' },\r\n    statusText: { color: '#fff', fontWeight: 'bold', fontSize: 12 },\r\n    footer: { padding: 16, paddingBottom: 110, backgroundColor: '#fff', borderTopWidth: 1, borderTopColor: '#eee' },\r\n    saveButton: { padding: 16, borderRadius: 12, alignItems: 'center' },\r\n    saveButtonText: { color: '#fff', fontWeight: 'bold', fontSize: 16 },\r\n    summaryCard: { flexDirection: 'row', justifyContent: 'space-around', backgroundColor: '#fff', margin: 16, padding: 16, borderRadius: 12, elevation: 2 },\r\n    summaryItem: { alignItems: 'center' },\r\n    summaryValue: { fontSize: 20, fontWeight: 'bold', color: '#333' },\r\n    summaryLabel: { fontSize: 12, color: '#666' },\r\n    historyCard: { flexDirection: 'row', alignItems: 'center', backgroundColor: '#fff', padding: 16, borderRadius: 12, marginBottom: 12, elevation: 1 },\r\n    historyStatus: { width: 40, height: 40, borderRadius: 20, justifyContent: 'center', alignItems: 'center', marginRight: 16 },\r\n    historyStatusText: { color: '#fff', fontWeight: 'bold', fontSize: 18 },\r\n    historyInfo: { flex: 1 },\r\n    historyDate: { fontSize: 16, fontWeight: '600', color: '#333' },\r\n    historyTime: { fontSize: 12, color: '#666' },\r\n    historyRemarks: { fontSize: 12, color: '#666', fontStyle: 'italic' },\r\n    sectionTitle: { fontSize: 16, fontWeight: 'bold', color: '#333', marginBottom: 12 },\r\n    classScroll: { maxHeight: 50, marginBottom: 16 },\r\n    classChip: { paddingHorizontal: 16, paddingVertical: 8, backgroundColor: '#fff', borderRadius: 20, marginRight: 8, borderWidth: 1, borderColor: '#ddd' },\r\n    classChipText: { color: '#666' },\r\n    activeClassChipText: { color: '#fff', fontWeight: 'bold' },\r\n    studentRow: { flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center', paddingVertical: 12, borderBottomWidth: 1, borderBottomColor: '#eee' },\r\n    studentName: { fontSize: 16, color: '#333' },\r\n    miniStatus: { paddingHorizontal: 8, paddingVertical: 4, borderRadius: 8 },\r\n    miniStatusText: { color: '#fff', fontSize: 10, fontWeight: 'bold' },\r\n    emptyText: { textAlign: 'center', marginTop: 20, color: '#666' },\r\n    summaryCardSmall: { flex: 1, padding: 16, borderRadius: 12, alignItems: 'center', justifyContent: 'center' },\r\n    absentRow: { flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center', paddingVertical: 12, borderBottomWidth: 1, borderBottomColor: '#eee' },\r\n    absentName: { fontSize: 16, fontWeight: 'bold', color: '#333' },\r\n    absentRole: { fontSize: 12, color: '#666' },\r\n    absentTag: { backgroundColor: '#FFEBEE', paddingHorizontal: 8, paddingVertical: 4, borderRadius: 4 },\r\n    absentTagText: { color: '#D32F2F', fontSize: 10, fontWeight: 'bold' },\r\n    actionHeader: { flexDirection: 'row', justifyContent: 'flex-end', paddingHorizontal: 16, paddingBottom: 8 },\r\n    textButton: { padding: 8 },\r\n    textButtonText: { fontWeight: 'bold' },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\admin\\classes.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":36},{"ruleId":"no-unused-vars","severity":1,"message":"'StyleSheet' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":15},{"ruleId":"no-unused-vars","severity":1,"message":"'AsyncStorage' is defined but never used. Allowed unused vars must match /^_/u.","line":15,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":26,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'loading' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":49,"column":40,"nodeType":"Identifier","messageId":"unusedVar","endLine":49,"endColumn":47}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    Pressable,\r\n    TextInput,\r\n    RefreshControl,\r\n    ActivityIndicator,\r\n    Modal,\r\n    StyleSheet,\r\n    Alert,\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useRouter } from \"expo-router\";\r\nimport { useTheme } from \"../../theme\";\r\nimport { useApiQuery, useApiMutation, createApiMutationFn } from \"../../hooks/useApi\";\r\nimport apiConfig from \"../../config/apiConfig\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport { useToast } from \"../../components/ToastProvider\";\r\nimport AppHeader from \"../../components/Header\";\r\n\r\nexport default function ClassesScreen() {\r\n    const router = useRouter();\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n    const queryClient = useQueryClient();\r\n    const [refreshing, setRefreshing] = useState(false);\r\n    const [showModal, setShowModal] = useState(false);\r\n    const [modalMode, setModalMode] = useState(\"create\"); // \"create\" or \"edit\"\r\n    const [editingClassId, setEditingClassId] = useState(null);\r\n    const [deletingId, setDeletingId] = useState(null);\r\n\r\n    const [form, setForm] = useState({\r\n        name: \"\",\r\n        section: \"\",\r\n        branch: \"Main\",\r\n        classTeacher: \"\"\r\n    });\r\n\r\n    // Fetch User\r\n    const { data: user } = useApiQuery(\r\n        ['currentUser'],\r\n        `${apiConfig.baseUrl}/auth/me`\r\n    );\r\n\r\n    // Fetch Data (Classes, Years, Teachers)\r\n    const { data: initData, isLoading: loading, refetch } = useApiQuery(\r\n        ['adminClassesInit'],\r\n        `${apiConfig.baseUrl}/classes/admin/init`\r\n    );\r\n\r\n    const classes = initData?.classes || [];\r\n    const teachers = initData?.teachers || [];\r\n\r\n    // Mutations\r\n    const createClassMutation = useApiMutation({\r\n        mutationFn: createApiMutationFn(`${apiConfig.baseUrl}/classes`, 'POST'),\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: ['adminClassesInit'] });\r\n            showToast(\"Class created\", \"success\");\r\n            setShowModal(false);\r\n            setForm({ ...form, name: \"\", section: \"\" });\r\n            setModalMode(\"create\");\r\n            setEditingClassId(null);\r\n        },\r\n        onError: (error) => showToast(error.message || \"Failed to create\", \"error\")\r\n    });\r\n\r\n    const updateClassMutation = useApiMutation({\r\n        mutationFn: (data) => createApiMutationFn(`${apiConfig.baseUrl}/classes/${data._id}`, 'PUT')(data),\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: ['adminClassesInit'] });\r\n            showToast(\"Class updated\", \"success\");\r\n            setShowModal(false);\r\n            setForm({ ...form, name: \"\", section: \"\" });\r\n            setModalMode(\"create\");\r\n            setEditingClassId(null);\r\n        },\r\n        onError: (error) => showToast(error.message || \"Failed to update\", \"error\")\r\n    });\r\n\r\n    const deleteClassMutation = useApiMutation({\r\n        mutationFn: (id) => createApiMutationFn(`${apiConfig.baseUrl}/classes/${id}`, 'DELETE')(),\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: ['adminClassesInit'] });\r\n            showToast(\"Class deleted\", \"success\");\r\n        },\r\n        onError: (error) => showToast(error.message || \"Failed to delete\", \"error\")\r\n    });\r\n\r\n    const handleSubmit = () => {\r\n        if (!form.name) {\r\n            showToast(\"Name is required\", \"error\");\r\n            return;\r\n        }\r\n\r\n        if (modalMode === \"create\") {\r\n            createClassMutation.mutate(form);\r\n        } else {\r\n            updateClassMutation.mutate({ ...form, _id: editingClassId });\r\n        }\r\n    };\r\n\r\n    const handleEdit = (cls) => {\r\n        setForm({\r\n            name: cls.name,\r\n            section: cls.section || \"\",\r\n            branch: cls.branch,\r\n            classTeacher: cls.classTeacher?._id || cls.classTeacher || \"\"\r\n        });\r\n        setModalMode(\"edit\");\r\n        setEditingClassId(cls._id);\r\n        setShowModal(true);\r\n    };\r\n\r\n    const handleDelete = (classId, className) => {\r\n        Alert.alert(\r\n            \"Delete Class\",\r\n            `Are you sure you want to delete ${className}?`,\r\n            [\r\n                { text: \"Cancel\", style: \"cancel\" },\r\n                {\r\n                    text: \"Delete\",\r\n                    style: \"destructive\",\r\n                    onPress: () => {\r\n                        setDeletingId(classId);\r\n                        deleteClassMutation.mutate(classId, {\r\n                            onSettled: () => setDeletingId(null)\r\n                        });\r\n                    }\r\n                }\r\n            ]\r\n        );\r\n    };\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        await refetch();\r\n        setRefreshing(false);\r\n    };\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <ScrollView\r\n                refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} />}\r\n                contentContainerStyle={{ paddingBottom: 100 }}\r\n            >\r\n                <View style={{ padding: 16, paddingTop: 24 }}>\r\n                    <AppHeader title=\"Classes\" subtitle=\"Manage classes and sections\" showBack />\r\n\r\n                    <View style={{ marginTop: 16 }}>\r\n                        {classes.map((cls) => (\r\n                            <Pressable\r\n                                key={cls._id}\r\n                                onPress={() => {\r\n                                    // Navigate to teacher's class view\r\n                                    router.push(`/teacher/class/${cls._id}`);\r\n                                }}\r\n                                style={({ pressed }) => ({\r\n                                    backgroundColor: colors.cardBackground,\r\n                                    borderRadius: 16,\r\n                                    padding: 16,\r\n                                    marginBottom: 12,\r\n                                    flexDirection: \"row\",\r\n                                    justifyContent: \"space-between\",\r\n                                    alignItems: \"center\",\r\n                                    opacity: pressed ? 0.9 : 1,\r\n                                    shadowColor: \"#000\",\r\n                                    shadowOffset: { width: 0, height: 1 },\r\n                                    shadowOpacity: 0.05,\r\n                                    shadowRadius: 4,\r\n                                    elevation: 1,\r\n                                })}\r\n                            >\r\n                                <View>\r\n                                    <Text style={{ fontSize: 18, fontWeight: \"700\", color: colors.textPrimary }}>\r\n                                        {cls.name} {cls.section ? `- ${cls.section}` : \"\"}\r\n                                    </Text>\r\n                                    <Text style={{ fontSize: 14, color: colors.textSecondary, marginTop: 4 }}>\r\n                                        {cls.branch}\r\n                                    </Text>\r\n                                    {cls.classTeacher && (\r\n                                        <Text style={{ fontSize: 13, color: colors.primary, marginTop: 4, fontWeight: \"500\" }}>\r\n                                            Teacher: {cls.classTeacher.name}\r\n                                        </Text>\r\n                                    )}\r\n                                </View>\r\n                                <View style={{ flexDirection: 'row', alignItems: 'center', gap: 8 }}>\r\n                                    {user?.role === 'super admin' && (\r\n                                        <>\r\n                                            <Pressable\r\n                                                onPress={(e) => {\r\n                                                    e.stopPropagation();\r\n                                                    handleEdit(cls);\r\n                                                }}\r\n                                                style={{ padding: 8 }}\r\n                                            >\r\n                                                <MaterialIcons name=\"edit\" size={20} color={colors.textSecondary} />\r\n                                            </Pressable>\r\n                                            {deletingId === cls._id ? (\r\n                                                <View style={{ padding: 8 }}>\r\n                                                    <ActivityIndicator size=\"small\" color={colors.error} />\r\n                                                </View>\r\n                                            ) : (\r\n                                                <Pressable\r\n                                                    onPress={(e) => {\r\n                                                        e.stopPropagation();\r\n                                                        handleDelete(cls._id, cls.name);\r\n                                                    }}\r\n                                                    style={{ padding: 8 }}\r\n                                                >\r\n                                                    <MaterialIcons name=\"delete\" size={20} color={colors.error} />\r\n                                                </Pressable>\r\n                                            )}\r\n                                        </>\r\n                                    )}\r\n                                    <MaterialIcons name=\"chevron-right\" size={24} color={colors.textSecondary} />\r\n                                </View>\r\n                            </Pressable>\r\n                        ))}\r\n                    </View>\r\n                </View>\r\n            </ScrollView>\r\n\r\n            {user?.role === 'super admin' && (\r\n                <Pressable\r\n                    onPress={() => {\r\n                        setModalMode(\"create\");\r\n                        setForm({ ...form, name: \"\", section: \"\" });\r\n                        setShowModal(true);\r\n                    }}\r\n                    style={{\r\n                        position: \"absolute\",\r\n                        bottom: 110,\r\n                        right: 24,\r\n                        backgroundColor: colors.primary,\r\n                        width: 56,\r\n                        height: 56,\r\n                        borderRadius: 28,\r\n                        justifyContent: \"center\",\r\n                        alignItems: \"center\",\r\n                        elevation: 6,\r\n                    }}\r\n                >\r\n                    <MaterialIcons name=\"add\" size={28} color=\"#fff\" />\r\n                </Pressable>\r\n            )}\r\n\r\n            <Modal visible={showModal} animationType=\"slide\" transparent>\r\n                <View style={{ flex: 1, justifyContent: \"center\", backgroundColor: \"rgba(0,0,0,0.5)\", padding: 20 }}>\r\n                    <View style={{ backgroundColor: colors.cardBackground, borderRadius: 16, padding: 24 }}>\r\n                        <Text style={{ fontSize: 20, fontWeight: \"700\", color: colors.textPrimary, marginBottom: 16 }}>\r\n                            {modalMode === \"create\" ? \"New Class\" : \"Edit Class\"}\r\n                        </Text>\r\n\r\n                        <TextInput\r\n                            placeholder=\"Class Name (e.g. 1st Standard)\"\r\n                            placeholderTextColor={colors.textSecondary}\r\n                            style={{\r\n                                backgroundColor: colors.background,\r\n                                padding: 12,\r\n                                borderRadius: 8,\r\n                                color: colors.textPrimary,\r\n                                marginBottom: 12\r\n                            }}\r\n                            value={form.name}\r\n                            onChangeText={(t) => setForm({ ...form, name: t })}\r\n                        />\r\n\r\n                        <TextInput\r\n                            placeholder=\"Section (Optional, e.g. A)\"\r\n                            placeholderTextColor={colors.textSecondary}\r\n                            style={{\r\n                                backgroundColor: colors.background,\r\n                                padding: 12,\r\n                                borderRadius: 8,\r\n                                color: colors.textPrimary,\r\n                                marginBottom: 12\r\n                            }}\r\n                            value={form.section}\r\n                            onChangeText={(t) => setForm({ ...form, section: t })}\r\n                        />\r\n\r\n\r\n\r\n                        {/* Simple Dropdown for Teacher */}\r\n                        <View style={{ marginBottom: 24 }}>\r\n                            <Text style={{ color: colors.textSecondary, marginBottom: 4, fontSize: 12 }}>Class Teacher (Optional)</Text>\r\n                            <ScrollView horizontal showsHorizontalScrollIndicator={false}>\r\n                                {teachers.map(teacher => (\r\n                                    <Pressable\r\n                                        key={teacher._id}\r\n                                        onPress={() => setForm({ ...form, classTeacher: teacher._id })}\r\n                                        style={{\r\n                                            paddingHorizontal: 12,\r\n                                            paddingVertical: 8,\r\n                                            backgroundColor: form.classTeacher === teacher._id ? colors.primary : colors.background,\r\n                                            borderRadius: 8,\r\n                                            marginRight: 8,\r\n                                            borderWidth: 1,\r\n                                            borderColor: form.classTeacher === teacher._id ? colors.primary : colors.border\r\n                                        }}\r\n                                    >\r\n                                        <Text style={{ color: form.classTeacher === teacher._id ? '#fff' : colors.textPrimary }}>\r\n                                            {teacher.name}\r\n                                        </Text>\r\n                                    </Pressable>\r\n                                ))}\r\n                            </ScrollView>\r\n                        </View>\r\n\r\n                        <View style={{ flexDirection: \"row\", justifyContent: \"flex-end\", gap: 12 }}>\r\n                            <Pressable onPress={() => setShowModal(false)} style={{ padding: 12 }}>\r\n                                <Text style={{ color: colors.textSecondary, fontWeight: \"600\" }}>Cancel</Text>\r\n                            </Pressable>\r\n                            <Pressable\r\n                                onPress={handleSubmit}\r\n                                disabled={createClassMutation.isPending || updateClassMutation.isPending}\r\n                                style={{\r\n                                    backgroundColor: colors.primary,\r\n                                    opacity: (createClassMutation.isPending || updateClassMutation.isPending) ? 0.5 : 1,\r\n                                    paddingHorizontal: 20,\r\n                                    paddingVertical: 12,\r\n                                    borderRadius: 8,\r\n                                    flexDirection: \"row\",\r\n                                    alignItems: \"center\",\r\n                                    gap: 8\r\n                                }}\r\n                            >\r\n                                {(createClassMutation.isPending || updateClassMutation.isPending) && <ActivityIndicator size=\"small\" color=\"#fff\" />}\r\n                                <Text style={{ color: \"#fff\", fontWeight: \"600\" }}>\r\n                                    {(createClassMutation.isPending || updateClassMutation.isPending) ? \"Saving...\" : (modalMode === \"create\" ? \"Create\" : \"Update\")}\r\n                                </Text>\r\n                            </Pressable>\r\n                        </View>\r\n                    </View >\r\n                </View >\r\n            </Modal >\r\n        </View >\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\admin\\complaints.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":36},{"ruleId":"no-unused-vars","severity":1,"message":"'AsyncStorage' is defined but never used. Allowed unused vars must match /^_/u.","line":15,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":25,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":26,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    RefreshControl,\r\n    ActivityIndicator,\r\n    Pressable,\r\n    Modal,\r\n    TextInput,\r\n    KeyboardAvoidingView,\r\n    Platform\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useRouter } from \"expo-router\";\r\nimport { useTheme } from \"../../theme\";\r\nimport { useApiQuery, useApiMutation, createApiMutationFn } from \"../../hooks/useApi\";\r\nimport apiConfig from \"../../config/apiConfig\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport Header from \"../../components/Header\";\r\nimport { useToast } from \"../../components/ToastProvider\";\r\n\r\nexport default function AdminComplaintsScreen() {\r\n    const router = useRouter();\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n\r\n    const queryClient = useQueryClient();\r\n    const [refreshing, setRefreshing] = useState(false);\r\n    const [filter, setFilter] = useState(\"All\");\r\n\r\n    // Resolve Modal\r\n    const [selectedComplaint, setSelectedComplaint] = useState(null);\r\n    const [response, setResponse] = useState(\"\");\r\n    const [status, setStatus] = useState(\"Resolved\");\r\n\r\n    // Fetch Complaints\r\n    const { data: complaints = [], isLoading: loading, refetch } = useApiQuery(\r\n        ['adminComplaints'],\r\n        `${apiConfig.baseUrl}/complaints/all`\r\n    );\r\n\r\n    // Update Status Mutation\r\n    const updateStatusMutation = useApiMutation({\r\n        mutationFn: (data) => createApiMutationFn(`${apiConfig.baseUrl}/complaints/${data.id}/status`, 'PUT')(data.body),\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: ['adminComplaints'] });\r\n            showToast(\"Complaint updated\", \"success\");\r\n            setSelectedComplaint(null);\r\n            setResponse(\"\");\r\n        },\r\n        onError: (error) => showToast(error.message || \"Failed to update status\", \"error\")\r\n    });\r\n\r\n    const handleUpdateStatus = () => {\r\n        if (!selectedComplaint) return;\r\n\r\n        updateStatusMutation.mutate({\r\n            id: selectedComplaint._id,\r\n            body: {\r\n                status,\r\n                adminResponse: response\r\n            }\r\n        });\r\n    };\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        await refetch();\r\n        setRefreshing(false);\r\n    };\r\n\r\n    const getStatusColor = (status) => {\r\n        switch (status) {\r\n            case 'Resolved': return '#4CAF50';\r\n            case 'In Progress': return '#FF9800';\r\n            case 'Rejected': return '#F44336';\r\n            default: return '#9E9E9E';\r\n        }\r\n    };\r\n\r\n    const filteredComplaints = filter === \"All\"\r\n        ? complaints\r\n        : complaints.filter(c => c.status === filter);\r\n\r\n    if (loading) {\r\n        return (\r\n            <View style={{ flex: 1, backgroundColor: colors.background, justifyContent: \"center\", alignItems: \"center\" }}>\r\n                <ActivityIndicator size=\"large\" color={colors.primary} />\r\n            </View>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <View style={{ padding: 16, paddingTop: 24 }}>\r\n                <Header title=\"Complaints\" subtitle=\"Manage Issues\" showBack />\r\n            </View>\r\n\r\n            <View style={{ paddingHorizontal: 16, marginBottom: 16 }}>\r\n                <ScrollView horizontal showsHorizontalScrollIndicator={false}>\r\n                    <View style={{ flexDirection: \"row\", gap: 8 }}>\r\n                        {['All', 'Pending', 'In Progress', 'Resolved'].map(f => (\r\n                            <Pressable\r\n                                key={f}\r\n                                onPress={() => setFilter(f)}\r\n                                style={{\r\n                                    paddingHorizontal: 16,\r\n                                    paddingVertical: 8,\r\n                                    backgroundColor: filter === f ? colors.primary : colors.cardBackground,\r\n                                    borderRadius: 20,\r\n                                    borderWidth: 1,\r\n                                    borderColor: filter === f ? colors.primary : colors.textSecondary + \"20\"\r\n                                }}\r\n                            >\r\n                                <Text style={{ color: filter === f ? \"#fff\" : colors.textPrimary }}>\r\n                                    {f}\r\n                                </Text>\r\n                            </Pressable>\r\n                        ))}\r\n                    </View>\r\n                </ScrollView>\r\n            </View>\r\n\r\n            <ScrollView\r\n                refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} />}\r\n                contentContainerStyle={{ padding: 16, paddingBottom: 100 }}\r\n            >\r\n                {filteredComplaints.length === 0 ? (\r\n                    <View style={{ alignItems: \"center\", marginTop: 40, opacity: 0.6 }}>\r\n                        <MaterialIcons name=\"check-circle\" size={48} color={colors.textSecondary} />\r\n                        <Text style={{ color: colors.textSecondary, marginTop: 16 }}>No complaints found</Text>\r\n                    </View>\r\n                ) : (\r\n                    filteredComplaints.map((complaint) => (\r\n                        <Pressable\r\n                            key={complaint._id}\r\n                            onPress={() => {\r\n                                setSelectedComplaint(complaint);\r\n                                setStatus(complaint.status);\r\n                                setResponse(complaint.adminResponse || \"\");\r\n                            }}\r\n                            style={{\r\n                                backgroundColor: colors.cardBackground,\r\n                                borderRadius: 16,\r\n                                padding: 16,\r\n                                marginBottom: 12,\r\n                                borderLeftWidth: 4,\r\n                                borderLeftColor: getStatusColor(complaint.status),\r\n                                shadowColor: \"#000\",\r\n                                shadowOffset: { width: 0, height: 1 },\r\n                                shadowOpacity: 0.05,\r\n                                shadowRadius: 2,\r\n                                elevation: 1,\r\n                            }}\r\n                        >\r\n                            <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", marginBottom: 8 }}>\r\n                                <Text style={{ fontSize: 16, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, flex: 1 }}>\r\n                                    {complaint.title}\r\n                                </Text>\r\n                                <Text style={{ fontSize: 12, color: getStatusColor(complaint.status), fontFamily: \"DMSans-Bold\" }}>\r\n                                    {complaint.status}\r\n                                </Text>\r\n                            </View>\r\n\r\n                            <Text style={{ color: colors.textSecondary, fontSize: 13, marginBottom: 8 }} numberOfLines={2}>\r\n                                {complaint.description}\r\n                            </Text>\r\n\r\n                            <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\" }}>\r\n                                <Text style={{ fontSize: 12, color: colors.textSecondary }}>\r\n                                    {complaint.student?.name}  {complaint.category}\r\n                                </Text>\r\n                                <Text style={{ fontSize: 12, color: colors.textSecondary }}>\r\n                                    {new Date(complaint.createdAt).toLocaleDateString()}\r\n                                </Text>\r\n                            </View>\r\n                        </Pressable>\r\n                    ))\r\n                )}\r\n            </ScrollView>\r\n\r\n            {/* Resolve Modal */}\r\n            <Modal\r\n                visible={!!selectedComplaint}\r\n                animationType=\"slide\"\r\n                transparent={true}\r\n                onRequestClose={() => setSelectedComplaint(null)}\r\n            >\r\n                <KeyboardAvoidingView\r\n                    behavior={Platform.OS === \"ios\" ? \"padding\" : \"height\"}\r\n                    style={{ flex: 1, backgroundColor: \"rgba(0,0,0,0.5)\", justifyContent: \"flex-end\" }}\r\n                >\r\n                    <View style={{ backgroundColor: colors.cardBackground, borderTopLeftRadius: 24, borderTopRightRadius: 24, padding: 24 }}>\r\n                        <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\", marginBottom: 20 }}>\r\n                            <Text style={{ fontSize: 20, fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>\r\n                                Update Status\r\n                            </Text>\r\n                            <Pressable onPress={() => setSelectedComplaint(null)}>\r\n                                <MaterialIcons name=\"close\" size={24} color={colors.textSecondary} />\r\n                            </Pressable>\r\n                        </View>\r\n\r\n                        {selectedComplaint && (\r\n                            <View style={{ marginBottom: 20 }}>\r\n                                <Text style={{ color: colors.textSecondary, fontSize: 13 }}>{selectedComplaint.student?.name} reported:</Text>\r\n                                <Text style={{ fontSize: 16, color: colors.textPrimary, fontFamily: \"DMSans-Medium\", marginTop: 4 }}>\r\n                                    {selectedComplaint.title}\r\n                                </Text>\r\n                                <Text style={{ color: colors.textSecondary, marginTop: 4 }}>\r\n                                    {selectedComplaint.description}\r\n                                </Text>\r\n                            </View>\r\n                        )}\r\n\r\n                        <Text style={{ color: colors.textSecondary, marginBottom: 8 }}>Set Status</Text>\r\n                        <View style={{ flexDirection: \"row\", gap: 8, marginBottom: 20 }}>\r\n                            {['In Progress', 'Resolved', 'Rejected'].map(s => (\r\n                                <Pressable\r\n                                    key={s}\r\n                                    onPress={() => setStatus(s)}\r\n                                    style={{\r\n                                        paddingHorizontal: 12,\r\n                                        paddingVertical: 8,\r\n                                        backgroundColor: status === s ? getStatusColor(s) : colors.background,\r\n                                        borderRadius: 8,\r\n                                        borderWidth: 1,\r\n                                        borderColor: status === s ? getStatusColor(s) : colors.textSecondary + \"20\"\r\n                                    }}\r\n                                >\r\n                                    <Text style={{ color: status === s ? \"#fff\" : colors.textPrimary, fontSize: 12, fontFamily: \"DMSans-Bold\" }}>\r\n                                        {s}\r\n                                    </Text>\r\n                                </Pressable>\r\n                            ))}\r\n                        </View>\r\n\r\n                        <Text style={{ color: colors.textSecondary, marginBottom: 8 }}>Response / Remarks</Text>\r\n                        <TextInput\r\n                            value={response}\r\n                            onChangeText={setResponse}\r\n                            placeholder=\"Add a response...\"\r\n                            placeholderTextColor={colors.textSecondary + \"80\"}\r\n                            multiline\r\n                            style={{\r\n                                borderWidth: 1,\r\n                                borderColor: colors.textSecondary + \"40\",\r\n                                borderRadius: 12,\r\n                                padding: 12,\r\n                                color: colors.textPrimary,\r\n                                fontSize: 16,\r\n                                marginBottom: 24,\r\n                                backgroundColor: colors.background,\r\n                                minHeight: 80,\r\n                                textAlignVertical: \"top\"\r\n                            }}\r\n                        />\r\n\r\n                        <Pressable\r\n                            onPress={handleUpdateStatus}\r\n                            disabled={updateStatusMutation.isPending}\r\n                            style={{\r\n                                backgroundColor: colors.primary,\r\n                                padding: 16,\r\n                                borderRadius: 16,\r\n                                alignItems: \"center\",\r\n                                opacity: updateStatusMutation.isPending ? 0.7 : 1\r\n                            }}\r\n                        >\r\n                            {updateStatusMutation.isPending ? (\r\n                                <ActivityIndicator color=\"#fff\" />\r\n                            ) : (\r\n                                <Text style={{ color: \"#fff\", fontSize: 16, fontFamily: \"DMSans-Bold\" }}>\r\n                                    Update Complaint\r\n                                </Text>\r\n                            )}\r\n                        </Pressable>\r\n                    </View>\r\n                </KeyboardAvoidingView>\r\n            </Modal>\r\n        </View>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\admin\\exam-schedule.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'AsyncStorage' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":24,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":25,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    Pressable,\r\n    ActivityIndicator,\r\n    TextInput,\r\n    Modal,\r\n    Platform,\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useRouter } from \"expo-router\";\r\nimport { useTheme } from \"../../theme\";\r\nimport { useApiQuery, useApiMutation, createApiMutationFn } from \"../../hooks/useApi\";\r\nimport apiConfig from \"../../config/apiConfig\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport Header from \"../../components/Header\";\r\nimport { useToast } from \"../../components/ToastProvider\";\r\nimport DateTimePicker from '@react-native-community/datetimepicker';\r\n\r\nexport default function AdminExamScheduleScreen() {\r\n    const router = useRouter();\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n\r\n    const queryClient = useQueryClient();\r\n    const [selectedClassId, setSelectedClassId] = useState(null);\r\n\r\n    // Edit Date State\r\n    const [editingExam, setEditingExam] = useState(null);\r\n    const [showDatePicker, setShowDatePicker] = useState(false);\r\n    const [newDate, setNewDate] = useState(new Date());\r\n    const [newRoom, setNewRoom] = useState(\"\");\r\n\r\n    // Fetch Classes\r\n    const { data: classesData, isLoading: classesLoading } = useApiQuery(\r\n        ['adminClassesInit'],\r\n        `${apiConfig.baseUrl}/classes/admin/init`\r\n    );\r\n    const classes = classesData?.classes || [];\r\n\r\n    // Set initial selected class\r\n    useEffect(() => {\r\n        if (classes.length > 0 && !selectedClassId) {\r\n            setSelectedClassId(classes[0]._id);\r\n        }\r\n    }, [classes, selectedClassId]);\r\n\r\n    // Fetch Exams for Selected Class\r\n    const { data: exams = [], isLoading: examsLoading } = useApiQuery(\r\n        ['adminExamSchedule', selectedClassId],\r\n        `${apiConfig.baseUrl}/exams/schedule/class/${selectedClassId}`,\r\n        { enabled: !!selectedClassId }\r\n    );\r\n\r\n    const loading = classesLoading || (!!selectedClassId && examsLoading);\r\n\r\n    // Update Exam Mutation\r\n    const updateExamMutation = useApiMutation({\r\n        mutationFn: (data) => createApiMutationFn(`${apiConfig.baseUrl}/exams/${data.id}`, 'PUT')(data.body),\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: ['adminExamSchedule', selectedClassId] });\r\n            showToast(\"Exam date updated\", \"success\");\r\n            setEditingExam(null);\r\n        },\r\n        onError: (error) => showToast(error.message || \"Failed to update date\", \"error\")\r\n    });\r\n\r\n    const handleDateChange = (event, selectedDate) => {\r\n        setShowDatePicker(Platform.OS === 'ios');\r\n        if (selectedDate) {\r\n            setNewDate(selectedDate);\r\n        }\r\n    };\r\n\r\n    const saveNewDate = () => {\r\n        if (!editingExam) return;\r\n\r\n        updateExamMutation.mutate({\r\n            id: editingExam._id,\r\n            body: {\r\n                date: newDate,\r\n                room: newRoom\r\n            }\r\n        });\r\n    };\r\n\r\n    if (loading && classes.length === 0) {\r\n        return (\r\n            <View style={{ flex: 1, backgroundColor: colors.background, justifyContent: \"center\", alignItems: \"center\" }}>\r\n                <ActivityIndicator size=\"large\" color={colors.primary} />\r\n            </View>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <View style={{ padding: 16, paddingTop: 24 }}>\r\n                <Header title=\"Exam Schedules\" subtitle=\"Manage Dates\" showBack />\r\n            </View>\r\n\r\n            <View style={{ paddingHorizontal: 16, marginBottom: 16 }}>\r\n                <Text style={{ color: colors.textSecondary, marginBottom: 8 }}>Select Class</Text>\r\n                <ScrollView horizontal showsHorizontalScrollIndicator={false}>\r\n                    <View style={{ flexDirection: \"row\", gap: 8 }}>\r\n                        {classes.map(cls => (\r\n                            <Pressable\r\n                                key={cls._id}\r\n                                onPress={() => setSelectedClassId(cls._id)}\r\n                                style={{\r\n                                    paddingHorizontal: 16,\r\n                                    paddingVertical: 8,\r\n                                    backgroundColor: selectedClassId === cls._id ? colors.primary : colors.cardBackground,\r\n                                    borderRadius: 20,\r\n                                    borderWidth: 1,\r\n                                    borderColor: selectedClassId === cls._id ? colors.primary : colors.textSecondary + \"20\"\r\n                                }}\r\n                            >\r\n                                <Text style={{ color: selectedClassId === cls._id ? \"#fff\" : colors.textPrimary }}>\r\n                                    {cls.name} {cls.section}\r\n                                </Text>\r\n                            </Pressable>\r\n                        ))}\r\n                    </View>\r\n                </ScrollView>\r\n            </View>\r\n\r\n            <ScrollView contentContainerStyle={{ padding: 16, paddingBottom: 100 }}>\r\n                {loading ? (\r\n                    <ActivityIndicator color={colors.primary} style={{ marginTop: 40 }} />\r\n                ) : exams.length === 0 ? (\r\n                    <View style={{ alignItems: \"center\", marginTop: 40, opacity: 0.6 }}>\r\n                        <MaterialIcons name=\"event-busy\" size={48} color={colors.textSecondary} />\r\n                        <Text style={{ color: colors.textSecondary, marginTop: 16 }}>No exams found for this class</Text>\r\n                    </View>\r\n                ) : (\r\n                    exams.map((exam) => (\r\n                        <View\r\n                            key={exam._id}\r\n                            style={{\r\n                                backgroundColor: colors.cardBackground,\r\n                                borderRadius: 16,\r\n                                padding: 16,\r\n                                marginBottom: 12,\r\n                                flexDirection: \"row\",\r\n                                justifyContent: \"space-between\",\r\n                                alignItems: \"center\"\r\n                            }}\r\n                        >\r\n                            <View style={{ flex: 1 }}>\r\n                                <Text style={{ fontSize: 16, fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>\r\n                                    {exam.subject?.name}\r\n                                </Text>\r\n                                <Text style={{ color: colors.textSecondary, fontSize: 13 }}>\r\n                                    {exam.name}  {exam.type}\r\n                                </Text>\r\n                                <View style={{ flexDirection: \"row\", alignItems: \"center\", marginTop: 6, gap: 6 }}>\r\n                                    <MaterialIcons name=\"calendar-today\" size={14} color={colors.primary} />\r\n                                    <Text style={{ color: colors.textPrimary, fontFamily: \"DMSans-Medium\" }}>\r\n                                        {new Date(exam.date).toLocaleDateString()}\r\n                                    </Text>\r\n                                </View>\r\n                                {exam.room && (\r\n                                    <View style={{ flexDirection: \"row\", alignItems: \"center\", marginTop: 4, gap: 6 }}>\r\n                                        <MaterialIcons name=\"meeting-room\" size={14} color={colors.textSecondary} />\r\n                                        <Text style={{ color: colors.textSecondary, fontSize: 13, fontFamily: \"DMSans-Medium\" }}>\r\n                                            {exam.room}\r\n                                        </Text>\r\n                                    </View>\r\n                                )}\r\n                            </View>\r\n\r\n                            <Pressable\r\n                                onPress={() => {\r\n                                    setEditingExam(exam);\r\n                                    setNewDate(new Date(exam.date));\r\n                                    setNewRoom(exam.room || \"\");\r\n                                    setShowDatePicker(true);\r\n                                }}\r\n                                style={{\r\n                                    padding: 8,\r\n                                    backgroundColor: colors.primary + \"15\",\r\n                                    borderRadius: 8\r\n                                }}\r\n                            >\r\n                                <MaterialIcons name=\"edit\" size={20} color={colors.primary} />\r\n                            </Pressable>\r\n                        </View>\r\n                    ))\r\n                )}\r\n            </ScrollView>\r\n\r\n            {/* Date Picker Modal */}\r\n            {editingExam && (\r\n                <Modal\r\n                    transparent={true}\r\n                    visible={!!editingExam}\r\n                    animationType=\"fade\"\r\n                    onRequestClose={() => setEditingExam(null)}\r\n                >\r\n                    <View style={{ flex: 1, backgroundColor: \"rgba(0,0,0,0.5)\", justifyContent: \"center\", alignItems: \"center\" }}>\r\n                        <View style={{ backgroundColor: colors.cardBackground, width: \"85%\", borderRadius: 16, padding: 20 }}>\r\n                            <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginBottom: 16 }}>\r\n                                Reschedule Exam\r\n                            </Text>\r\n                            <Text style={{ color: colors.textSecondary, marginBottom: 20 }}>\r\n                                {editingExam.subject?.name} - {editingExam.name}\r\n                            </Text>\r\n\r\n                            <View style={{ marginBottom: 20 }}>\r\n                                <Text style={{ color: colors.textSecondary, marginBottom: 8, fontSize: 14 }}>Date</Text>\r\n                                <View style={{ alignItems: \"center\" }}>\r\n                                    {showDatePicker && (\r\n                                        <DateTimePicker\r\n                                            value={newDate}\r\n                                            mode=\"date\"\r\n                                            display=\"default\"\r\n                                            onChange={handleDateChange}\r\n                                            minimumDate={new Date()}\r\n                                        />\r\n                                    )}\r\n                                    {Platform.OS === 'android' && (\r\n                                        <Pressable\r\n                                            onPress={() => setShowDatePicker(true)}\r\n                                            style={{\r\n                                                flexDirection: \"row\",\r\n                                                alignItems: \"center\",\r\n                                                padding: 12,\r\n                                                borderWidth: 1,\r\n                                                borderColor: colors.textSecondary + \"40\",\r\n                                                borderRadius: 8,\r\n                                                width: \"100%\",\r\n                                                justifyContent: \"center\"\r\n                                            }}\r\n                                        >\r\n                                            <MaterialIcons name=\"calendar-today\" size={20} color={colors.primary} style={{ marginRight: 8 }} />\r\n                                            <Text style={{ color: colors.textPrimary, fontSize: 16 }}>\r\n                                                {newDate.toLocaleDateString()}\r\n                                            </Text>\r\n                                        </Pressable>\r\n                                    )}\r\n                                </View>\r\n                            </View>\r\n\r\n                            <View style={{ marginBottom: 24 }}>\r\n                                <Text style={{ color: colors.textSecondary, marginBottom: 8, fontSize: 14 }}>Room Number</Text>\r\n                                <TextInput\r\n                                    value={newRoom}\r\n                                    onChangeText={setNewRoom}\r\n                                    placeholder=\"e.g. Room 101\"\r\n                                    placeholderTextColor={colors.textSecondary + \"80\"}\r\n                                    style={{\r\n                                        borderWidth: 1,\r\n                                        borderColor: colors.textSecondary + \"40\",\r\n                                        borderRadius: 8,\r\n                                        padding: 12,\r\n                                        color: colors.textPrimary,\r\n                                        fontSize: 16,\r\n                                        fontFamily: \"DMSans-Medium\"\r\n                                    }}\r\n                                />\r\n                            </View>\r\n\r\n                            <View style={{ flexDirection: \"row\", gap: 12 }}>\r\n                                <Pressable\r\n                                    onPress={() => setEditingExam(null)}\r\n                                    style={{ flex: 1, padding: 12, alignItems: \"center\", borderRadius: 10, backgroundColor: colors.background }}\r\n                                >\r\n                                    <Text style={{ color: colors.textPrimary, fontFamily: \"DMSans-Bold\" }}>Cancel</Text>\r\n                                </Pressable>\r\n                                <Pressable\r\n                                    onPress={saveNewDate}\r\n                                    disabled={updateExamMutation.isPending}\r\n                                    style={{ flex: 1, padding: 12, alignItems: \"center\", borderRadius: 10, backgroundColor: colors.primary }}\r\n                                >\r\n                                    {updateExamMutation.isPending ? (\r\n                                        <ActivityIndicator color=\"#fff\" size=\"small\" />\r\n                                    ) : (\r\n                                        <Text style={{ color: \"#fff\", fontFamily: \"DMSans-Bold\" }}>Save</Text>\r\n                                    )}\r\n                                </Pressable>\r\n                            </View>\r\n                        </View>\r\n                    </View>\r\n                </Modal>\r\n            )}\r\n        </View>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\admin\\fees.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Modal' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":10},{"ruleId":"no-unused-vars","severity":1,"message":"'Alert' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":10},{"ruleId":"no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":25,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":26,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'studentsLoading' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":75,"column":51,"nodeType":"Identifier","messageId":"unusedVar","endLine":75,"endColumn":66},{"ruleId":"no-unused-vars","severity":1,"message":"'refetchFeeDetails' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":83,"column":40,"nodeType":"Identifier","messageId":"unusedVar","endLine":83,"endColumn":57},{"ruleId":"no-undef","severity":2,"message":"'savingStructure' is not defined.","line":876,"column":51,"nodeType":"Identifier","messageId":"undef","endLine":876,"endColumn":66},{"ruleId":"no-undef","severity":2,"message":"'savingStructure' is not defined.","line":887,"column":54,"nodeType":"Identifier","messageId":"undef","endLine":887,"endColumn":69},{"ruleId":"no-undef","severity":2,"message":"'savingStructure' is not defined.","line":890,"column":42,"nodeType":"Identifier","messageId":"undef","endLine":890,"endColumn":57},{"ruleId":"no-undef","severity":2,"message":"'loadingStudents' is not defined.","line":938,"column":30,"nodeType":"Identifier","messageId":"undef","endLine":938,"endColumn":45}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    Pressable,\r\n    ActivityIndicator,\r\n    TextInput,\r\n    Modal,\r\n    Alert,\r\n    FlatList,\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useRouter } from \"expo-router\";\r\nimport { useTheme } from \"../../theme\";\r\nimport { useApiQuery, useApiMutation, createApiMutationFn } from \"../../hooks/useApi\";\r\nimport apiFetch from \"../../utils/apiFetch\";\r\nimport apiConfig from \"../../config/apiConfig\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport Header from \"../../components/Header\";\r\nimport { useToast } from \"../../components/ToastProvider\";\r\n\r\nexport default function AdminFeesScreen() {\r\n    const router = useRouter();\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n\r\n    const [activeTab, setActiveTab] = useState(\"dashboard\"); // dashboard, collect, structure, students\r\n    const queryClient = useQueryClient();\r\n\r\n\r\n    // Collect Fees State\r\n    const [searchQuery, setSearchQuery] = useState(\"\");\r\n    const [searchResults, setSearchResults] = useState([]);\r\n    const [selectedStudent, setSelectedStudent] = useState(null);\r\n    const [paymentAmount, setPaymentAmount] = useState(\"\");\r\n    const [bookNumber, setBookNumber] = useState(\"\");\r\n    const [manualReceiptNumber, setManualReceiptNumber] = useState(\"\");\r\n    const [paymentMethod, setPaymentMethod] = useState(\"cash\");\r\n    const [remarks, setRemarks] = useState(\"\");\r\n\r\n    // Fee Structure State\r\n    const [selectedClassId, setSelectedClassId] = useState(null);\r\n    const [selectedYearId, setSelectedYearId] = useState(null);\r\n    const [newComponent, setNewComponent] = useState({ name: \"\", amount: \"\" });\r\n\r\n    // Specific Student Fee State\r\n    const [structureType, setStructureType] = useState('class_default'); // 'class_default', 'student_specific'\r\n    const [studentSearchQuery, setStudentSearchQuery] = useState(\"\");\r\n    const [studentSearchResults, setStudentSearchResults] = useState([]);\r\n    const [selectedStudents, setSelectedStudents] = useState([]);\r\n\r\n    // Fetch Analytics\r\n    const { data: analytics = { collectedToday: 0, collectedThisMonth: 0, totalCollected: 0 }, isLoading: analyticsLoading } = useApiQuery(\r\n        ['feeAnalytics'],\r\n        `${apiConfig.baseUrl}/fees/analytics`\r\n    );\r\n\r\n    // Fetch Classes and Years\r\n    const { data: initData, isLoading: initLoading } = useApiQuery(\r\n        ['adminClassesInit'],\r\n        `${apiConfig.baseUrl}/classes/admin/init`\r\n    );\r\n    const classes = initData?.classes || [];\r\n    const academicYears = initData?.academicYears || [];\r\n\r\n    useEffect(() => {\r\n        if (academicYears.length > 0 && !selectedYearId) {\r\n            setSelectedYearId(academicYears[0]._id);\r\n        }\r\n    }, [academicYears, selectedYearId]);\r\n\r\n    // Fetch All Students\r\n    const { data: allStudentsResponse, isLoading: studentsLoading } = useApiQuery(\r\n        ['allStudents'],\r\n        `${apiConfig.baseUrl}/users?role=student&limit=100`,\r\n        { enabled: activeTab === 'students' }\r\n    );\r\n    const allStudents = allStudentsResponse?.data || [];\r\n\r\n    // Fetch Fee Details for Selected Student\r\n    const { data: feeDetails, refetch: refetchFeeDetails } = useApiQuery(\r\n        ['feeDetails', selectedStudent?._id],\r\n        `${apiConfig.baseUrl}/fees/student/${selectedStudent?._id}`,\r\n        { enabled: !!selectedStudent }\r\n    );\r\n\r\n    // Fetch Fee Structure for Selected Class\r\n    const { data: structureData } = useApiQuery(\r\n        ['feeStructure', selectedClassId],\r\n        `${apiConfig.baseUrl}/fees/structure/class/${selectedClassId}`,\r\n        { enabled: !!selectedClassId }\r\n    );\r\n    const [structureComponents, setStructureComponents] = useState([]);\r\n\r\n    useEffect(() => {\r\n        if (structureData?.components) {\r\n            setStructureComponents(structureData.components);\r\n        } else {\r\n            setStructureComponents([]);\r\n        }\r\n    }, [structureData]);\r\n\r\n    const loading = analyticsLoading || initLoading;\r\n\r\n    // Mutations\r\n    const paymentMutation = useApiMutation({\r\n        mutationFn: createApiMutationFn(`${apiConfig.baseUrl}/fees/payment`, 'POST'),\r\n        onSuccess: () => {\r\n            showToast(\"Payment recorded successfully\", \"success\");\r\n            setSelectedStudent(null);\r\n            setPaymentAmount(\"\");\r\n            setBookNumber(\"\");\r\n            setManualReceiptNumber(\"\");\r\n            setRemarks(\"\");\r\n            queryClient.invalidateQueries({ queryKey: ['feeAnalytics'] });\r\n            queryClient.invalidateQueries({ queryKey: ['feeDetails'] });\r\n        },\r\n        onError: (error) => showToast(error.message || \"Payment failed\", \"error\")\r\n    });\r\n\r\n    const saveStructureMutation = useApiMutation({\r\n        mutationFn: createApiMutationFn(`${apiConfig.baseUrl}/fees/structure`, 'POST'),\r\n        onSuccess: () => {\r\n            showToast(\"Fee structure saved\", \"success\");\r\n            queryClient.invalidateQueries({ queryKey: ['feeStructure'] });\r\n        },\r\n        onError: (error) => showToast(error.message || \"Failed to save structure\", \"error\")\r\n    });\r\n\r\n\r\n\r\n    const searchStudent = async (query, setResults, classId = null) => {\r\n        if (!query.trim()) return;\r\n        try {\r\n            const token = await AsyncStorage.getItem(\"@auth_token\");\r\n            let url = `${apiConfig.baseUrl}/users/search?query=${query}&role=student`;\r\n            if (classId) {\r\n                url += `&classId=${classId}`;\r\n            }\r\n            const response = await apiFetch(url, {\r\n                headers: { Authorization: `Bearer ${token}` }\r\n            });\r\n            if (response.ok) {\r\n                const data = await response.json();\r\n                setResults(data);\r\n            }\r\n        } catch (error) {\r\n            console.error(error);\r\n            showToast(\"Error searching student\", \"error\");\r\n        }\r\n    };\r\n\r\n    const selectStudent = (student) => {\r\n        setSelectedStudent(student);\r\n        setSearchResults([]);\r\n        setSearchQuery(\"\");\r\n    };\r\n\r\n    const handlePayment = () => {\r\n        if (!paymentAmount || isNaN(paymentAmount) || Number(paymentAmount) <= 0) {\r\n            showToast(\"Invalid amount\", \"error\");\r\n            return;\r\n        }\r\n\r\n        paymentMutation.mutate({\r\n            studentId: selectedStudent._id,\r\n            amount: Number(paymentAmount),\r\n            bookNumber,\r\n            manualReceiptNumber,\r\n            paymentMethod,\r\n            remarks\r\n        });\r\n    };\r\n\r\n\r\n\r\n    const addComponent = () => {\r\n        if (!newComponent.name || !newComponent.amount) {\r\n            showToast(\"Please fill name and amount\", \"error\");\r\n            return;\r\n        }\r\n        setStructureComponents([...structureComponents, { ...newComponent, amount: Number(newComponent.amount) }]);\r\n        setNewComponent({ name: \"\", amount: \"\" });\r\n    };\r\n\r\n    const removeComponent = (index) => {\r\n        const updated = [...structureComponents];\r\n        updated.splice(index, 1);\r\n        setStructureComponents(updated);\r\n    };\r\n\r\n    const saveStructure = () => {\r\n        if (!selectedClassId || !selectedYearId) {\r\n            showToast(\"Select class and academic year\", \"error\");\r\n            return;\r\n        }\r\n        if (structureComponents.length === 0) {\r\n            showToast(\"Add at least one fee component\", \"error\");\r\n            return;\r\n        }\r\n        if (structureType === 'student_specific' && selectedStudents.length === 0) {\r\n            showToast(\"Select at least one student\", \"error\");\r\n            return;\r\n        }\r\n\r\n        saveStructureMutation.mutate({\r\n            classId: selectedClassId,\r\n            academicYearId: selectedYearId,\r\n            components: structureComponents,\r\n            paymentSchedule: [], // Can be added later\r\n            type: structureType,\r\n            students: structureType === 'student_specific' ? selectedStudents.map(s => s._id) : []\r\n        });\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <View style={{ flex: 1, backgroundColor: colors.background, justifyContent: \"center\", alignItems: \"center\" }}>\r\n                <ActivityIndicator size=\"large\" color={colors.primary} />\r\n            </View>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <View style={{ padding: 16, paddingTop: 24 }}>\r\n                <Header title=\"Fees Management\" subtitle=\"Track and collect fees\" showBack />\r\n            </View>\r\n\r\n            {/* Tabs - Segmented Control */}\r\n            <View style={{ paddingHorizontal: 16, marginBottom: 24 }}>\r\n                <View style={{\r\n                    flexDirection: \"row\",\r\n                    backgroundColor: colors.cardBackground,\r\n                    borderRadius: 16,\r\n                    padding: 4\r\n                }}>\r\n                    {['dashboard', 'collect', 'structure', 'students'].map(tab => (\r\n                        <Pressable\r\n                            key={tab}\r\n                            onPress={() => setActiveTab(tab)}\r\n                            style={{\r\n                                flex: 1,\r\n                                paddingVertical: 10,\r\n                                alignItems: \"center\",\r\n                                backgroundColor: activeTab === tab ? colors.background : \"transparent\",\r\n                                borderRadius: 12,\r\n                                shadowColor: activeTab === tab ? \"#000\" : \"transparent\",\r\n                                shadowOffset: { width: 0, height: 2 },\r\n                                shadowOpacity: activeTab === tab ? 0.1 : 0,\r\n                                shadowRadius: 4,\r\n                                elevation: activeTab === tab ? 2 : 0\r\n                            }}\r\n                        >\r\n                            <Text style={{\r\n                                color: activeTab === tab ? colors.primary : colors.textSecondary,\r\n                                fontFamily: activeTab === tab ? \"DMSans-Bold\" : \"DMSans-Medium\",\r\n                                textTransform: \"capitalize\",\r\n                                fontSize: 13\r\n                            }}>\r\n                                {tab}\r\n                            </Text>\r\n                        </Pressable>\r\n                    ))}\r\n                </View>\r\n            </View>\r\n\r\n            <ScrollView contentContainerStyle={{ paddingBottom: 100 }}>\r\n                {activeTab === 'dashboard' && (\r\n                    <View style={{ padding: 16 }}>\r\n                        {/* Hero Card */}\r\n                        <View style={{\r\n                            backgroundColor: colors.primary,\r\n                            borderRadius: 24,\r\n                            padding: 24,\r\n                            marginBottom: 20,\r\n                            shadowColor: colors.primary,\r\n                            shadowOffset: { width: 0, height: 8 },\r\n                            shadowOpacity: 0.3,\r\n                            shadowRadius: 16,\r\n                            elevation: 8\r\n                        }}>\r\n                            <Text style={{ color: \"rgba(255,255,255,0.8)\", fontSize: 14, fontFamily: \"DMSans-Medium\", marginBottom: 8 }}>Total Collected (All Time)</Text>\r\n                            <Text style={{ fontSize: 36, fontFamily: \"DMSans-Bold\", color: \"#fff\" }}>\r\n                                {analytics.totalCollected.toLocaleString()}\r\n                            </Text>\r\n                            <View style={{ flexDirection: \"row\", alignItems: \"center\", marginTop: 16, backgroundColor: \"rgba(255,255,255,0.2)\", alignSelf: \"flex-start\", paddingHorizontal: 12, paddingVertical: 6, borderRadius: 20 }}>\r\n                                <MaterialIcons name=\"trending-up\" size={16} color=\"#fff\" style={{ marginRight: 6 }} />\r\n                                <Text style={{ color: \"#fff\", fontFamily: \"DMSans-Bold\", fontSize: 12 }}>Updated just now</Text>\r\n                            </View>\r\n                        </View>\r\n\r\n                        {/* Stats Grid */}\r\n                        <View style={{ flexDirection: \"row\", gap: 16 }}>\r\n                            <View style={{\r\n                                flex: 1,\r\n                                backgroundColor: colors.cardBackground,\r\n                                padding: 20,\r\n                                borderRadius: 20,\r\n                                shadowColor: \"#000\",\r\n                                shadowOffset: { width: 0, height: 2 },\r\n                                shadowOpacity: 0.05,\r\n                                shadowRadius: 8,\r\n                                elevation: 2\r\n                            }}>\r\n                                <View style={{ width: 40, height: 40, borderRadius: 12, backgroundColor: colors.success + \"15\", justifyContent: \"center\", alignItems: \"center\", marginBottom: 12 }}>\r\n                                    <MaterialIcons name=\"today\" size={20} color={colors.success} />\r\n                                </View>\r\n                                <Text style={{ color: colors.textSecondary, fontSize: 13, fontFamily: \"DMSans-Medium\" }}>Collected Today</Text>\r\n                                <Text style={{ fontSize: 22, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginTop: 4 }}>\r\n                                    {analytics.collectedToday.toLocaleString()}\r\n                                </Text>\r\n                            </View>\r\n                            <View style={{\r\n                                flex: 1,\r\n                                backgroundColor: colors.cardBackground,\r\n                                padding: 20,\r\n                                borderRadius: 20,\r\n                                shadowColor: \"#000\",\r\n                                shadowOffset: { width: 0, height: 2 },\r\n                                shadowOpacity: 0.05,\r\n                                shadowRadius: 8,\r\n                                elevation: 2\r\n                            }}>\r\n                                <View style={{ width: 40, height: 40, borderRadius: 12, backgroundColor: colors.secondary + \"15\", justifyContent: \"center\", alignItems: \"center\", marginBottom: 12 }}>\r\n                                    <MaterialIcons name=\"calendar-today\" size={20} color={colors.secondary} />\r\n                                </View>\r\n                                <Text style={{ color: colors.textSecondary, fontSize: 13, fontFamily: \"DMSans-Medium\" }}>This Month</Text>\r\n                                <Text style={{ fontSize: 22, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginTop: 4 }}>\r\n                                    {analytics.collectedThisMonth.toLocaleString()}\r\n                                </Text>\r\n                            </View>\r\n                        </View>\r\n                    </View>\r\n                )}\r\n\r\n                {activeTab === 'collect' && (\r\n                    <View style={{ padding: 16 }}>\r\n                        {!selectedStudent ? (\r\n                            <View style={{ marginTop: 20 }}>\r\n                                <View style={{ alignItems: \"center\", marginBottom: 32 }}>\r\n                                    <View style={{ width: 64, height: 64, backgroundColor: colors.primary + \"15\", borderRadius: 32, justifyContent: \"center\", alignItems: \"center\", marginBottom: 16 }}>\r\n                                        <MaterialIcons name=\"person-search\" size={32} color={colors.primary} />\r\n                                    </View>\r\n                                    <Text style={{ fontSize: 24, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginBottom: 8 }}>Find Student</Text>\r\n                                    <Text style={{ color: colors.textSecondary, textAlign: \"center\", maxWidth: \"80%\" }}>\r\n                                        Search by name or phone number to collect fees\r\n                                    </Text>\r\n                                </View>\r\n\r\n                                <View style={{ flexDirection: \"row\", gap: 12, marginBottom: 24 }}>\r\n                                    <TextInput\r\n                                        value={searchQuery}\r\n                                        onChangeText={setSearchQuery}\r\n                                        placeholder=\"Enter student name...\"\r\n                                        placeholderTextColor={colors.textSecondary}\r\n                                        style={{\r\n                                            flex: 1,\r\n                                            backgroundColor: colors.cardBackground,\r\n                                            padding: 16,\r\n                                            borderRadius: 16,\r\n                                            color: colors.textPrimary,\r\n                                            fontSize: 16,\r\n                                            fontFamily: \"DMSans-Medium\",\r\n                                            shadowColor: \"#000\",\r\n                                            shadowOffset: { width: 0, height: 2 },\r\n                                            shadowOpacity: 0.05,\r\n                                            shadowRadius: 8,\r\n                                            elevation: 2\r\n                                        }}\r\n                                    />\r\n                                    <Pressable\r\n                                        onPress={() => searchStudent(searchQuery, setSearchResults)}\r\n                                        style={{\r\n                                            backgroundColor: colors.primary,\r\n                                            width: 56,\r\n                                            borderRadius: 16,\r\n                                            justifyContent: \"center\",\r\n                                            alignItems: \"center\",\r\n                                            shadowColor: colors.primary,\r\n                                            shadowOffset: { width: 0, height: 4 },\r\n                                            shadowOpacity: 0.3,\r\n                                            shadowRadius: 8,\r\n                                            elevation: 4\r\n                                        }}\r\n                                    >\r\n                                        <MaterialIcons name=\"search\" size={28} color=\"#fff\" />\r\n                                    </Pressable>\r\n                                </View>\r\n\r\n                                {searchResults.length > 0 && (\r\n                                    <View style={{ backgroundColor: colors.cardBackground, borderRadius: 20, padding: 8 }}>\r\n                                        {searchResults.map((student, index) => (\r\n                                            <Pressable\r\n                                                key={student._id}\r\n                                                onPress={() => selectStudent(student)}\r\n                                                style={{\r\n                                                    padding: 16,\r\n                                                    borderRadius: 12,\r\n                                                    marginBottom: index === searchResults.length - 1 ? 0 : 8,\r\n                                                    flexDirection: \"row\",\r\n                                                    alignItems: \"center\",\r\n                                                    justifyContent: \"space-between\",\r\n                                                    backgroundColor: colors.background\r\n                                                }}\r\n                                            >\r\n                                                <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 12 }}>\r\n                                                    <View style={{ width: 40, height: 40, borderRadius: 20, backgroundColor: colors.primary + \"10\", justifyContent: \"center\", alignItems: \"center\" }}>\r\n                                                        <Text style={{ fontFamily: \"DMSans-Bold\", color: colors.primary, fontSize: 16 }}>\r\n                                                            {student.name.charAt(0)}\r\n                                                        </Text>\r\n                                                    </View>\r\n                                                    <View>\r\n                                                        <Text style={{ fontFamily: \"DMSans-Bold\", color: colors.textPrimary, fontSize: 16 }}>{student.name}</Text>\r\n                                                        <Text style={{ color: colors.textSecondary, fontSize: 13 }}>{student.phone}</Text>\r\n                                                    </View>\r\n                                                </View>\r\n                                                <MaterialIcons name=\"chevron-right\" size={24} color={colors.textSecondary} />\r\n                                            </Pressable>\r\n                                        ))}\r\n                                    </View>\r\n                                )}\r\n                            </View>\r\n                        ) : (\r\n                            <View>\r\n                                <Pressable\r\n                                    onPress={() => setSelectedStudent(null)}\r\n                                    style={{ flexDirection: \"row\", alignItems: \"center\", marginBottom: 20, alignSelf: \"flex-start\" }}\r\n                                >\r\n                                    <View style={{ width: 32, height: 32, borderRadius: 10, backgroundColor: colors.cardBackground, justifyContent: \"center\", alignItems: \"center\", marginRight: 8 }}>\r\n                                        <MaterialIcons name=\"arrow-back\" size={20} color={colors.textPrimary} />\r\n                                    </View>\r\n                                    <Text style={{ color: colors.textSecondary, fontFamily: \"DMSans-Medium\" }}>Back to Search</Text>\r\n                                </Pressable>\r\n\r\n                                {/* Student Profile Card */}\r\n                                <View style={{\r\n                                    backgroundColor: colors.cardBackground,\r\n                                    padding: 24,\r\n                                    borderRadius: 24,\r\n                                    marginBottom: 24,\r\n                                    alignItems: \"center\"\r\n                                }}>\r\n                                    <View style={{ width: 80, height: 80, borderRadius: 40, backgroundColor: colors.primary + \"15\", justifyContent: \"center\", alignItems: \"center\", marginBottom: 16 }}>\r\n                                        <Text style={{ fontSize: 32, fontFamily: \"DMSans-Bold\", color: colors.primary }}>{selectedStudent.name.charAt(0)}</Text>\r\n                                    </View>\r\n                                    <Text style={{ fontSize: 22, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginBottom: 4 }}>{selectedStudent.name}</Text>\r\n                                    <View style={{ flexDirection: \"row\", alignItems: \"center\", marginBottom: 24 }}>\r\n                                        <View style={{ paddingHorizontal: 10, paddingVertical: 4, backgroundColor: colors.background, borderRadius: 8, marginRight: 8 }}>\r\n                                            <Text style={{ color: colors.textSecondary, fontSize: 13, fontFamily: \"DMSans-Medium\" }}>\r\n                                                {feeDetails?.feeStructure ? \"Fee Structure Assigned\" : \"No Structure\"}\r\n                                            </Text>\r\n                                        </View>\r\n                                        <Text style={{ color: colors.textSecondary }}> {selectedStudent.phone}</Text>\r\n                                    </View>\r\n\r\n                                    <View style={{ flexDirection: \"row\", width: \"100%\", gap: 12 }}>\r\n                                        <View style={{ flex: 1, backgroundColor: colors.background, padding: 16, borderRadius: 16, alignItems: \"center\" }}>\r\n                                            <Text style={{ color: colors.textSecondary, fontSize: 12, marginBottom: 4 }}>Total Fees</Text>\r\n                                            <Text style={{ fontFamily: \"DMSans-Bold\", color: colors.textPrimary, fontSize: 18 }}>{feeDetails?.totalFees || 0}</Text>\r\n                                        </View>\r\n                                        <View style={{ flex: 1, backgroundColor: colors.success + \"10\", padding: 16, borderRadius: 16, alignItems: \"center\" }}>\r\n                                            <Text style={{ color: colors.success, fontSize: 12, marginBottom: 4 }}>Paid</Text>\r\n                                            <Text style={{ fontFamily: \"DMSans-Bold\", color: colors.success, fontSize: 18 }}>{feeDetails?.paidAmount || 0}</Text>\r\n                                        </View>\r\n                                        <View style={{ flex: 1, backgroundColor: colors.error + \"10\", padding: 16, borderRadius: 16, alignItems: \"center\" }}>\r\n                                            <Text style={{ color: colors.error, fontSize: 12, marginBottom: 4 }}>Pending</Text>\r\n                                            <Text style={{ fontFamily: \"DMSans-Bold\", color: colors.error, fontSize: 18 }}>{feeDetails?.pendingAmount || 0}</Text>\r\n                                        </View>\r\n                                    </View>\r\n                                </View>\r\n\r\n                                <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginBottom: 16 }}>Record New Payment</Text>\r\n\r\n                                <View style={{ backgroundColor: colors.cardBackground, padding: 20, borderRadius: 24 }}>\r\n                                    <View style={{ marginBottom: 20 }}>\r\n                                        <Text style={{ color: colors.textSecondary, marginBottom: 8, fontFamily: \"DMSans-Medium\" }}>Amount</Text>\r\n                                        <View style={{ flexDirection: \"row\", alignItems: \"center\", backgroundColor: colors.background, borderRadius: 16, paddingHorizontal: 16 }}>\r\n                                            <Text style={{ fontSize: 20, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginRight: 8 }}></Text>\r\n                                            <TextInput\r\n                                                value={paymentAmount}\r\n                                                onChangeText={setPaymentAmount}\r\n                                                keyboardType=\"numeric\"\r\n                                                placeholder=\"0\"\r\n                                                placeholderTextColor={colors.textSecondary}\r\n                                                style={{\r\n                                                    flex: 1,\r\n                                                    paddingVertical: 16,\r\n                                                    fontSize: 20,\r\n                                                    fontFamily: \"DMSans-Bold\",\r\n                                                    color: colors.textPrimary\r\n                                                }}\r\n                                            />\r\n                                        </View>\r\n                                    </View>\r\n\r\n                                    <View style={{ flexDirection: \"row\", gap: 12, marginBottom: 20 }}>\r\n                                        <View style={{ flex: 1 }}>\r\n                                            <Text style={{ color: colors.textSecondary, marginBottom: 8, fontFamily: \"DMSans-Medium\" }}>Receipt No.</Text>\r\n                                            <TextInput\r\n                                                value={manualReceiptNumber}\r\n                                                onChangeText={setManualReceiptNumber}\r\n                                                placeholder=\"Optional\"\r\n                                                placeholderTextColor={colors.textSecondary}\r\n                                                style={{\r\n                                                    backgroundColor: colors.background,\r\n                                                    padding: 14,\r\n                                                    borderRadius: 12,\r\n                                                    color: colors.textPrimary,\r\n                                                    fontFamily: \"DMSans-Medium\"\r\n                                                }}\r\n                                            />\r\n                                        </View>\r\n                                        <View style={{ flex: 1 }}>\r\n                                            <Text style={{ color: colors.textSecondary, marginBottom: 8, fontFamily: \"DMSans-Medium\" }}>Book No.</Text>\r\n                                            <TextInput\r\n                                                value={bookNumber}\r\n                                                onChangeText={setBookNumber}\r\n                                                placeholder=\"Optional\"\r\n                                                placeholderTextColor={colors.textSecondary}\r\n                                                style={{\r\n                                                    backgroundColor: colors.background,\r\n                                                    padding: 14,\r\n                                                    borderRadius: 12,\r\n                                                    color: colors.textPrimary,\r\n                                                    fontFamily: \"DMSans-Medium\"\r\n                                                }}\r\n                                            />\r\n                                        </View>\r\n                                    </View>\r\n\r\n                                    <View style={{ marginBottom: 24 }}>\r\n                                        <Text style={{ color: colors.textSecondary, marginBottom: 12, fontFamily: \"DMSans-Medium\" }}>Payment Method</Text>\r\n                                        <ScrollView horizontal showsHorizontalScrollIndicator={false}>\r\n                                            <View style={{ flexDirection: \"row\", gap: 10 }}>\r\n                                                {['cash', 'online', 'cheque', 'card'].map(method => (\r\n                                                    <Pressable\r\n                                                        key={method}\r\n                                                        onPress={() => setPaymentMethod(method)}\r\n                                                        style={{\r\n                                                            paddingHorizontal: 16,\r\n                                                            paddingVertical: 10,\r\n                                                            backgroundColor: paymentMethod === method ? colors.primary : colors.background,\r\n                                                            borderRadius: 12,\r\n                                                            borderWidth: 1,\r\n                                                            borderColor: paymentMethod === method ? colors.primary : colors.textSecondary + \"10\"\r\n                                                        }}\r\n                                                    >\r\n                                                        <Text style={{\r\n                                                            color: paymentMethod === method ? \"#fff\" : colors.textPrimary,\r\n                                                            textTransform: \"capitalize\",\r\n                                                            fontFamily: \"DMSans-Medium\"\r\n                                                        }}>\r\n                                                            {method}\r\n                                                        </Text>\r\n                                                    </Pressable>\r\n                                                ))}\r\n                                            </View>\r\n                                        </ScrollView>\r\n                                    </View>\r\n\r\n                                    <View style={{ marginBottom: 32 }}>\r\n                                        <Text style={{ color: colors.textSecondary, marginBottom: 8, fontFamily: \"DMSans-Medium\" }}>Remarks</Text>\r\n                                        <TextInput\r\n                                            value={remarks}\r\n                                            onChangeText={setRemarks}\r\n                                            placeholder=\"Add a note (optional)\"\r\n                                            placeholderTextColor={colors.textSecondary}\r\n                                            style={{\r\n                                                backgroundColor: colors.background,\r\n                                                padding: 14,\r\n                                                borderRadius: 12,\r\n                                                color: colors.textPrimary,\r\n                                                fontFamily: \"DMSans-Medium\"\r\n                                            }}\r\n                                        />\r\n                                    </View>\r\n\r\n                                    <Pressable\r\n                                        onPress={handlePayment}\r\n                                        disabled={paymentMutation.isPending}\r\n                                        style={{\r\n                                            backgroundColor: colors.primary,\r\n                                            padding: 18,\r\n                                            borderRadius: 16,\r\n                                            alignItems: \"center\",\r\n                                            shadowColor: colors.primary,\r\n                                            shadowOffset: { width: 0, height: 4 },\r\n                                            shadowOpacity: 0.3,\r\n                                            shadowRadius: 8,\r\n                                            elevation: 4,\r\n                                            opacity: paymentMutation.isPending ? 0.7 : 1\r\n                                        }}\r\n                                    >\r\n                                        {paymentMutation.isPending ? (\r\n                                            <ActivityIndicator color=\"#fff\" />\r\n                                        ) : (\r\n                                            <Text style={{ color: \"#fff\", fontSize: 18, fontFamily: \"DMSans-Bold\" }}>\r\n                                                Pay {paymentAmount || \"0\"}\r\n                                            </Text>\r\n                                        )}\r\n                                    </Pressable>\r\n                                </View>\r\n                            </View>\r\n                        )}\r\n                    </View>\r\n                )}\r\n\r\n                {\r\n                    activeTab === 'structure' && (\r\n                        <View style={{ padding: 16 }}>\r\n                            {/* 1. Context Header (Sticky-like) */}\r\n                            <View style={{ marginBottom: 24 }}>\r\n                                <Text style={{ color: colors.textSecondary, marginBottom: 8, fontFamily: \"DMSans-Medium\" }}>Select Class & Year</Text>\r\n                                <ScrollView horizontal showsHorizontalScrollIndicator={false}>\r\n                                    <View style={{ flexDirection: \"row\", gap: 8 }}>\r\n                                        {classes.map(cls => (\r\n                                            <Pressable\r\n                                                key={cls._id}\r\n                                                onPress={() => setSelectedClassId(cls._id)}\r\n                                                style={{\r\n                                                    paddingHorizontal: 16,\r\n                                                    paddingVertical: 8,\r\n                                                    backgroundColor: selectedClassId === cls._id ? colors.primary : colors.cardBackground,\r\n                                                    borderRadius: 20,\r\n                                                    borderWidth: 1,\r\n                                                    borderColor: selectedClassId === cls._id ? colors.primary : colors.textSecondary + \"20\"\r\n                                                }}\r\n                                            >\r\n                                                <Text style={{ color: selectedClassId === cls._id ? \"#fff\" : colors.textPrimary, fontFamily: \"DMSans-Medium\" }}>\r\n                                                    {cls.name} {cls.section}\r\n                                                </Text>\r\n                                            </Pressable>\r\n                                        ))}\r\n                                    </View>\r\n                                </ScrollView>\r\n                            </View>\r\n\r\n                            {selectedClassId ? (\r\n                                <View>\r\n                                    {/* 2. Target Selection (Segmented Control) */}\r\n                                    <View style={{\r\n                                        flexDirection: \"row\",\r\n                                        backgroundColor: colors.cardBackground,\r\n                                        borderRadius: 12,\r\n                                        padding: 4,\r\n                                        marginBottom: 24\r\n                                    }}>\r\n                                        <Pressable\r\n                                            onPress={() => setStructureType('class_default')}\r\n                                            style={{\r\n                                                flex: 1,\r\n                                                paddingVertical: 10,\r\n                                                alignItems: \"center\",\r\n                                                backgroundColor: structureType === 'class_default' ? colors.background : \"transparent\",\r\n                                                borderRadius: 10,\r\n                                                shadowColor: structureType === 'class_default' ? \"#000\" : \"transparent\",\r\n                                                shadowOffset: { width: 0, height: 2 },\r\n                                                shadowOpacity: structureType === 'class_default' ? 0.1 : 0,\r\n                                                shadowRadius: 4,\r\n                                                elevation: structureType === 'class_default' ? 2 : 0\r\n                                            }}\r\n                                        >\r\n                                            <Text style={{\r\n                                                color: structureType === 'class_default' ? colors.primary : colors.textSecondary,\r\n                                                fontFamily: \"DMSans-Bold\"\r\n                                            }}>Class Default</Text>\r\n                                        </Pressable>\r\n                                        <Pressable\r\n                                            onPress={() => setStructureType('student_specific')}\r\n                                            style={{\r\n                                                flex: 1,\r\n                                                paddingVertical: 10,\r\n                                                alignItems: \"center\",\r\n                                                backgroundColor: structureType === 'student_specific' ? colors.background : \"transparent\",\r\n                                                borderRadius: 10,\r\n                                                shadowColor: structureType === 'student_specific' ? \"#000\" : \"transparent\",\r\n                                                shadowOffset: { width: 0, height: 2 },\r\n                                                shadowOpacity: structureType === 'student_specific' ? 0.1 : 0,\r\n                                                shadowRadius: 4,\r\n                                                elevation: structureType === 'student_specific' ? 2 : 0\r\n                                            }}\r\n                                        >\r\n                                            <Text style={{\r\n                                                color: structureType === 'student_specific' ? colors.primary : colors.textSecondary,\r\n                                                fontFamily: \"DMSans-Bold\"\r\n                                            }}>Specific Student</Text>\r\n                                        </Pressable>\r\n                                    </View>\r\n\r\n                                    {/* 3. Student Selection (Conditional) */}\r\n                                    {structureType === 'student_specific' && (\r\n                                        <View style={{ marginBottom: 24 }}>\r\n                                            <View style={{ flexDirection: \"row\", gap: 10, marginBottom: 12 }}>\r\n                                                <TextInput\r\n                                                    value={studentSearchQuery}\r\n                                                    onChangeText={setStudentSearchQuery}\r\n                                                    placeholder=\"Search student...\"\r\n                                                    placeholderTextColor={colors.textSecondary}\r\n                                                    style={{\r\n                                                        flex: 1,\r\n                                                        backgroundColor: colors.cardBackground,\r\n                                                        padding: 12,\r\n                                                        borderRadius: 12,\r\n                                                        color: colors.textPrimary,\r\n                                                        fontFamily: \"DMSans-Medium\"\r\n                                                    }}\r\n                                                />\r\n                                                <Pressable\r\n                                                    onPress={() => searchStudent(studentSearchQuery, setStudentSearchResults, selectedClassId)}\r\n                                                    style={{\r\n                                                        backgroundColor: colors.primary,\r\n                                                        width: 48,\r\n                                                        height: 48,\r\n                                                        borderRadius: 12,\r\n                                                        justifyContent: \"center\",\r\n                                                        alignItems: \"center\"\r\n                                                    }}\r\n                                                >\r\n                                                    <MaterialIcons name=\"search\" size={24} color=\"#fff\" />\r\n                                                </Pressable>\r\n                                            </View>\r\n\r\n                                            {/* Search Results */}\r\n                                            {studentSearchResults.length > 0 && (\r\n                                                <View style={{ maxHeight: 150, backgroundColor: colors.cardBackground, borderRadius: 12, marginBottom: 12, padding: 8 }}>\r\n                                                    <ScrollView nestedScrollEnabled>\r\n                                                        {studentSearchResults.map(student => (\r\n                                                            <Pressable\r\n                                                                key={student._id}\r\n                                                                onPress={() => {\r\n                                                                    if (!selectedStudents.find(s => s._id === student._id)) {\r\n                                                                        setSelectedStudents([...selectedStudents, student]);\r\n                                                                    }\r\n                                                                    setStudentSearchResults([]);\r\n                                                                    setStudentSearchQuery(\"\");\r\n                                                                }}\r\n                                                                style={{ padding: 12, borderBottomWidth: 1, borderBottomColor: colors.textSecondary + \"10\" }}\r\n                                                            >\r\n                                                                <Text style={{ color: colors.textPrimary, fontFamily: \"DMSans-Medium\" }}>{student.name}</Text>\r\n                                                                <Text style={{ color: colors.textSecondary, fontSize: 12 }}>{student.phone}</Text>\r\n                                                            </Pressable>\r\n                                                        ))}\r\n                                                    </ScrollView>\r\n                                                </View>\r\n                                            )}\r\n\r\n                                            {/* Selected Students Chips */}\r\n                                            {selectedStudents.length > 0 && (\r\n                                                <View style={{ flexDirection: \"row\", flexWrap: \"wrap\", gap: 8 }}>\r\n                                                    {selectedStudents.map((student, index) => (\r\n                                                        <View key={student._id} style={{\r\n                                                            flexDirection: \"row\",\r\n                                                            alignItems: \"center\",\r\n                                                            backgroundColor: colors.primary + \"15\",\r\n                                                            paddingHorizontal: 12,\r\n                                                            paddingVertical: 8,\r\n                                                            borderRadius: 20,\r\n                                                            borderWidth: 1,\r\n                                                            borderColor: colors.primary + \"30\"\r\n                                                        }}>\r\n                                                            <Text style={{ color: colors.primary, marginRight: 6, fontFamily: \"DMSans-Medium\" }}>{student.name}</Text>\r\n                                                            <Pressable onPress={() => {\r\n                                                                const newSelected = [...selectedStudents];\r\n                                                                newSelected.splice(index, 1);\r\n                                                                setSelectedStudents(newSelected);\r\n                                                            }}>\r\n                                                                <MaterialIcons name=\"close\" size={16} color={colors.primary} />\r\n                                                            </Pressable>\r\n                                                        </View>\r\n                                                    ))}\r\n                                                </View>\r\n                                            )}\r\n                                        </View>\r\n                                    )}\r\n\r\n                                    {/* 4. Fee Components (The Core) */}\r\n                                    <View style={{ backgroundColor: colors.cardBackground, borderRadius: 16, padding: 20, marginBottom: 24 }}>\r\n                                        <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\", marginBottom: 16 }}>\r\n                                            <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>Fee Breakdown</Text>\r\n                                            <View style={{ backgroundColor: colors.success + \"20\", paddingHorizontal: 10, paddingVertical: 4, borderRadius: 8 }}>\r\n                                                <Text style={{ color: colors.success, fontFamily: \"DMSans-Bold\", fontSize: 12 }}>\r\n                                                    {structureComponents.length} Items\r\n                                                </Text>\r\n                                            </View>\r\n                                        </View>\r\n\r\n                                        {structureComponents.length === 0 ? (\r\n                                            <View style={{ alignItems: \"center\", paddingVertical: 20 }}>\r\n                                                <Text style={{ color: colors.textSecondary, fontFamily: \"DMSans-Medium\" }}>No fee components added yet.</Text>\r\n                                            </View>\r\n                                        ) : (\r\n                                            <View>\r\n                                                {structureComponents.map((comp, index) => (\r\n                                                    <View key={index} style={{\r\n                                                        flexDirection: \"row\",\r\n                                                        justifyContent: \"space-between\",\r\n                                                        alignItems: \"center\",\r\n                                                        paddingVertical: 12,\r\n                                                        borderBottomWidth: index === structureComponents.length - 1 ? 0 : 1,\r\n                                                        borderBottomColor: colors.textSecondary + \"10\"\r\n                                                    }}>\r\n                                                        <Text style={{ color: colors.textPrimary, fontFamily: \"DMSans-Medium\", fontSize: 16 }}>{comp.name}</Text>\r\n                                                        <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 12 }}>\r\n                                                            <Text style={{ color: colors.textPrimary, fontFamily: \"DMSans-Bold\", fontSize: 16 }}>{comp.amount}</Text>\r\n                                                            <Pressable onPress={() => removeComponent(index)} hitSlop={10}>\r\n                                                                <MaterialIcons name=\"remove-circle-outline\" size={20} color={colors.error} />\r\n                                                            </Pressable>\r\n                                                        </View>\r\n                                                    </View>\r\n                                                ))}\r\n\r\n                                                <View style={{ marginTop: 16, paddingTop: 16, borderTopWidth: 1, borderTopColor: colors.textSecondary + \"20\", flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\" }}>\r\n                                                    <Text style={{ color: colors.textSecondary, fontFamily: \"DMSans-Medium\" }}>Total Amount</Text>\r\n                                                    <Text style={{ color: colors.primary, fontFamily: \"DMSans-Bold\", fontSize: 20 }}>\r\n                                                        {structureComponents.reduce((sum, item) => sum + Number(item.amount), 0)}\r\n                                                    </Text>\r\n                                                </View>\r\n                                            </View>\r\n                                        )}\r\n                                    </View>\r\n\r\n                                    {/* 5. Adding Components (Action) */}\r\n                                    <View style={{ marginBottom: 32 }}>\r\n                                        <Text style={{ color: colors.textSecondary, marginBottom: 12, fontFamily: \"DMSans-Medium\" }}>Add New Component</Text>\r\n                                        <View style={{ flexDirection: \"row\", gap: 12 }}>\r\n                                            <TextInput\r\n                                                value={newComponent.name}\r\n                                                onChangeText={(t) => setNewComponent({ ...newComponent, name: t })}\r\n                                                placeholder=\"Name (e.g. Tuition)\"\r\n                                                placeholderTextColor={colors.textSecondary}\r\n                                                style={{\r\n                                                    flex: 2,\r\n                                                    backgroundColor: colors.cardBackground,\r\n                                                    padding: 16,\r\n                                                    borderRadius: 12,\r\n                                                    color: colors.textPrimary,\r\n                                                    fontFamily: \"DMSans-Medium\"\r\n                                                }}\r\n                                            />\r\n                                            <TextInput\r\n                                                value={newComponent.amount}\r\n                                                onChangeText={(t) => setNewComponent({ ...newComponent, amount: t })}\r\n                                                placeholder=\"Amount\"\r\n                                                keyboardType=\"numeric\"\r\n                                                placeholderTextColor={colors.textSecondary}\r\n                                                style={{\r\n                                                    flex: 1,\r\n                                                    backgroundColor: colors.cardBackground,\r\n                                                    padding: 16,\r\n                                                    borderRadius: 12,\r\n                                                    color: colors.textPrimary,\r\n                                                    fontFamily: \"DMSans-Medium\"\r\n                                                }}\r\n                                            />\r\n                                            <Pressable\r\n                                                onPress={addComponent}\r\n                                                style={{\r\n                                                    backgroundColor: colors.secondary,\r\n                                                    width: 56,\r\n                                                    borderRadius: 12,\r\n                                                    justifyContent: \"center\",\r\n                                                    alignItems: \"center\"\r\n                                                }}\r\n                                            >\r\n                                                <MaterialIcons name=\"add\" size={28} color=\"#fff\" />\r\n                                            </Pressable>\r\n                                        </View>\r\n                                    </View>\r\n\r\n                                    {/* 6. Save Action */}\r\n                                    <Pressable\r\n                                        onPress={saveStructure}\r\n                                        disabled={savingStructure}\r\n                                        style={{\r\n                                            backgroundColor: colors.primary,\r\n                                            padding: 18,\r\n                                            borderRadius: 16,\r\n                                            alignItems: \"center\",\r\n                                            shadowColor: colors.primary,\r\n                                            shadowOffset: { width: 0, height: 4 },\r\n                                            shadowOpacity: 0.3,\r\n                                            shadowRadius: 8,\r\n                                            elevation: 4,\r\n                                            opacity: savingStructure ? 0.7 : 1\r\n                                        }}\r\n                                    >\r\n                                        {savingStructure ? (\r\n                                            <ActivityIndicator color=\"#fff\" />\r\n                                        ) : (\r\n                                            <Text style={{ color: \"#fff\", fontFamily: \"DMSans-Bold\", fontSize: 18 }}>Save Fee Structure</Text>\r\n                                        )}\r\n                                    </Pressable>\r\n                                </View>\r\n                            ) : (\r\n                                <View style={{ alignItems: \"center\", marginTop: 40 }}>\r\n                                    <MaterialIcons name=\"class\" size={48} color={colors.textSecondary + \"40\"} />\r\n                                    <Text style={{ color: colors.textSecondary, marginTop: 16, fontFamily: \"DMSans-Medium\" }}>Select a class to manage fees</Text>\r\n                                </View>\r\n                            )}\r\n                        </View>\r\n                    )\r\n                }\r\n\r\n                {\r\n                    activeTab === 'students' && (\r\n                        <View style={{ padding: 16 }}>\r\n                            {/* Search Header */}\r\n                            <View style={{ flexDirection: \"row\", gap: 12, marginBottom: 16 }}>\r\n                                <TextInput\r\n                                    value={studentSearchQuery}\r\n                                    onChangeText={setStudentSearchQuery}\r\n                                    placeholder=\"Search students...\"\r\n                                    placeholderTextColor={colors.textSecondary}\r\n                                    style={{\r\n                                        flex: 1,\r\n                                        backgroundColor: colors.cardBackground,\r\n                                        padding: 12,\r\n                                        borderRadius: 12,\r\n                                        color: colors.textPrimary,\r\n                                        fontFamily: \"DMSans-Medium\"\r\n                                    }}\r\n                                />\r\n                                <View style={{\r\n                                    backgroundColor: colors.primary,\r\n                                    width: 48,\r\n                                    height: 48,\r\n                                    borderRadius: 12,\r\n                                    justifyContent: \"center\",\r\n                                    alignItems: \"center\"\r\n                                }}>\r\n                                    <MaterialIcons name=\"search\" size={24} color=\"#fff\" />\r\n                                </View>\r\n                            </View>\r\n\r\n                            {loadingStudents ? (\r\n                                <ActivityIndicator size=\"large\" color={colors.primary} style={{ marginTop: 40 }} />\r\n                            ) : (\r\n                                <FlatList\r\n                                    data={allStudents.filter(s => s.name.toLowerCase().includes(studentSearchQuery.toLowerCase()))}\r\n                                    scrollEnabled={false}\r\n                                    keyExtractor={(item) => item._id}\r\n                                    contentContainerStyle={{ paddingBottom: 20 }}\r\n                                    renderItem={({ item }) => (\r\n                                        <Pressable\r\n                                            onPress={() => {\r\n                                                setSelectedStudent(item);\r\n                                                setActiveTab('collect');\r\n                                            }}\r\n                                            style={{\r\n                                                backgroundColor: colors.cardBackground,\r\n                                                padding: 16,\r\n                                                borderRadius: 16,\r\n                                                marginBottom: 12,\r\n                                                flexDirection: \"row\",\r\n                                                alignItems: \"center\",\r\n                                                justifyContent: \"space-between\",\r\n                                                shadowColor: \"#000\",\r\n                                                shadowOffset: { width: 0, height: 2 },\r\n                                                shadowOpacity: 0.05,\r\n                                                shadowRadius: 8,\r\n                                                elevation: 2\r\n                                            }}\r\n                                        >\r\n                                            <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 12 }}>\r\n                                                <View style={{ width: 48, height: 48, borderRadius: 24, backgroundColor: colors.primary + \"10\", justifyContent: \"center\", alignItems: \"center\" }}>\r\n                                                    <Text style={{ fontFamily: \"DMSans-Bold\", color: colors.primary, fontSize: 18 }}>\r\n                                                        {item.name.charAt(0)}\r\n                                                    </Text>\r\n                                                </View>\r\n                                                <View>\r\n                                                    <Text style={{ fontFamily: \"DMSans-Bold\", color: colors.textPrimary, fontSize: 16 }}>{item.name}</Text>\r\n                                                    <Text style={{ color: colors.textSecondary, fontSize: 13 }}>{item.phone}</Text>\r\n                                                </View>\r\n                                            </View>\r\n                                            <MaterialIcons name=\"chevron-right\" size={24} color={colors.textSecondary} />\r\n                                        </Pressable>\r\n                                    )}\r\n                                    ListEmptyComponent={() => (\r\n                                        <View style={{ alignItems: \"center\", marginTop: 40 }}>\r\n                                            <MaterialIcons name=\"person-off\" size={48} color={colors.textSecondary + \"40\"} />\r\n                                            <Text style={{ color: colors.textSecondary, marginTop: 16, fontFamily: \"DMSans-Medium\" }}>No students found</Text>\r\n                                        </View>\r\n                                    )}\r\n                                />\r\n                            )}\r\n                        </View>\r\n                    )\r\n                }\r\n\r\n            </ScrollView >\r\n        </View >\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\admin\\leaves.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":36},{"ruleId":"no-unused-vars","severity":1,"message":"'useCallback' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":49},{"ruleId":"no-dupe-keys","severity":2,"message":"Duplicate key 'dateText'.","line":627,"column":5,"nodeType":"ObjectExpression","messageId":"unexpected","endLine":627,"endColumn":13}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport { View, Text, StyleSheet, FlatList, TouchableOpacity, Modal, TextInput, RefreshControl, ActivityIndicator, ScrollView, Switch, SectionList } from 'react-native';\r\nimport { useRouter } from 'expo-router';\r\nimport { Ionicons } from '@expo/vector-icons';\r\nimport DateTimePicker from '@react-native-community/datetimepicker';\r\nimport { useApiQuery, useApiMutation, createApiMutationFn } from '../../hooks/useApi';\r\nimport apiConfig from '../../config/apiConfig';\r\nimport { useQueryClient } from '@tanstack/react-query';\r\nimport { useToast } from '../../components/ToastProvider';\r\n\r\nexport default function AdminLeaves() {\r\n    const router = useRouter();\r\n    const { showToast } = useToast();\r\n    const queryClient = useQueryClient();\r\n    const [activeTab, setActiveTab] = useState('requests'); // 'requests', 'my_leaves', 'daily'\r\n    const [refreshing, setRefreshing] = useState(false);\r\n\r\n    // Action Modal State\r\n    const [actionModalVisible, setActionModalVisible] = useState(false);\r\n    const [selectedRequest, setSelectedRequest] = useState(null);\r\n    const [actionType, setActionType] = useState(''); // 'approved' or 'rejected'\r\n    const [actionReason, setActionReason] = useState('');\r\n    const [rejectionReason, setRejectionReason] = useState('');\r\n    const [rejectionComments, setRejectionComments] = useState('');\r\n\r\n    // Apply Leave Modal State\r\n    const [applyModalVisible, setApplyModalVisible] = useState(false);\r\n    const [startDate, setStartDate] = useState(new Date());\r\n    const [endDate, setEndDate] = useState(new Date());\r\n    const [reason, setReason] = useState('');\r\n    const [showStartPicker, setShowStartPicker] = useState(false);\r\n    const [showEndPicker, setShowEndPicker] = useState(false);\r\n    const [isHalfDay, setIsHalfDay] = useState(false);\r\n    const [halfDaySlot, setHalfDaySlot] = useState('morning');\r\n\r\n    // Fetch Requests\r\n    const { data: requestsData, isLoading: requestsLoading, refetch: refetchRequests } = useApiQuery(\r\n        ['adminLeaveRequests'],\r\n        `${apiConfig.baseUrl}/leaves/pending`,\r\n        { enabled: activeTab === 'requests' }\r\n    );\r\n\r\n    const requests = React.useMemo(() => {\r\n        if (!requestsData?.data) return [];\r\n        const data = requestsData.data;\r\n        const studentRequests = data.filter(r => r.applicantRole === 'student');\r\n        const teacherRequests = data.filter(r => r.applicantRole === 'teacher');\r\n        const adminRequests = data.filter(r => r.applicantRole === 'admin');\r\n\r\n        const sections = [];\r\n        if (studentRequests.length > 0) sections.push({ title: 'Student Requests', data: studentRequests });\r\n        if (teacherRequests.length > 0) sections.push({ title: 'Teacher Requests', data: teacherRequests });\r\n        if (adminRequests.length > 0) sections.push({ title: 'Admin Requests', data: adminRequests });\r\n        return sections;\r\n    }, [requestsData]);\r\n\r\n    // Fetch My Leaves\r\n    const { data: myLeavesData, isLoading: myLeavesLoading, refetch: refetchMyLeaves } = useApiQuery(\r\n        ['myLeaves'],\r\n        `${apiConfig.baseUrl}/leaves/my-leaves`,\r\n        { enabled: activeTab === 'my_leaves' }\r\n    );\r\n    const myLeaves = myLeavesData?.data || [];\r\n\r\n    // Fetch Leave Balance\r\n    const { data: balanceData, refetch: refetchBalance } = useApiQuery(\r\n        ['leaveBalance'],\r\n        `${apiConfig.baseUrl}/leaves/balance`,\r\n        { enabled: activeTab === 'my_leaves' }\r\n    );\r\n    const leaveBalance = balanceData?.data;\r\n\r\n    // Fetch Daily Stats\r\n    const { data: dailyStatsData, isLoading: dailyStatsLoading, refetch: refetchDailyStats } = useApiQuery(\r\n        ['dailyLeaveStats'],\r\n        `${apiConfig.baseUrl}/leaves/daily-stats`,\r\n        { enabled: activeTab === 'daily' }\r\n    );\r\n    const dailyStats = dailyStatsData?.data || [];\r\n\r\n    const loading = (activeTab === 'requests' && requestsLoading) ||\r\n        (activeTab === 'my_leaves' && myLeavesLoading) ||\r\n        (activeTab === 'daily' && dailyStatsLoading);\r\n\r\n    // Mutations\r\n    const actionMutation = useApiMutation({\r\n        mutationFn: (data) => createApiMutationFn(`${apiConfig.baseUrl}/leaves/${data.id}/action`, 'PUT')(data.body),\r\n        onSuccess: () => {\r\n            showToast(`Leave ${actionType} successfully`, 'success');\r\n            setActionModalVisible(false);\r\n            queryClient.invalidateQueries({ queryKey: ['adminLeaveRequests'] });\r\n            queryClient.invalidateQueries({ queryKey: ['dailyLeaveStats'] }); // Status change might affect daily stats\r\n        },\r\n        onError: (error) => showToast(error.message || 'Error updating status', 'error')\r\n    });\r\n\r\n    const applyLeaveMutation = useApiMutation({\r\n        mutationFn: createApiMutationFn(`${apiConfig.baseUrl}/leaves/apply`, 'POST'),\r\n        onSuccess: () => {\r\n            showToast('Leave applied successfully', 'success');\r\n            setApplyModalVisible(false);\r\n            setReason('');\r\n            setIsHalfDay(false);\r\n            queryClient.invalidateQueries({ queryKey: ['myLeaves'] });\r\n            queryClient.invalidateQueries({ queryKey: ['leaveBalance'] });\r\n            queryClient.invalidateQueries({ queryKey: ['adminLeaveRequests'] }); // If admin applies, it might show up in requests depending on logic, but good to invalidate\r\n        },\r\n        onError: (error) => showToast(error.message || 'Error applying leave', 'error')\r\n    });\r\n\r\n\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        if (activeTab === 'requests') await refetchRequests();\r\n        else if (activeTab === 'my_leaves') {\r\n            await Promise.all([refetchMyLeaves(), refetchBalance()]);\r\n        } else if (activeTab === 'daily') await refetchDailyStats();\r\n        setRefreshing(false);\r\n    };\r\n\r\n    // --- Action Handlers ---\r\n\r\n    const openActionModal = (request, type) => {\r\n        setSelectedRequest(request);\r\n        setActionType(type);\r\n        setActionReason('');\r\n        setRejectionReason('');\r\n        setRejectionComments('');\r\n        setActionModalVisible(true);\r\n    };\r\n\r\n    const handleAction = () => {\r\n        if (actionType === 'rejected' && (!rejectionReason || !rejectionComments)) {\r\n            showToast('Rejection reason and comments are required', 'error');\r\n            return;\r\n        }\r\n\r\n        actionMutation.mutate({\r\n            id: selectedRequest._id,\r\n            body: {\r\n                status: actionType,\r\n                reason: actionReason,\r\n                rejectionReason: actionType === 'rejected' ? rejectionReason : undefined,\r\n                rejectionComments: actionType === 'rejected' ? rejectionComments : undefined\r\n            }\r\n        });\r\n    };\r\n\r\n    // --- Apply Leave Handlers ---\r\n\r\n    const handleApplyLeave = () => {\r\n        if (!reason.trim()) {\r\n            showToast('Please enter a reason', 'error');\r\n            return;\r\n        }\r\n\r\n        if (!isHalfDay && endDate < startDate) {\r\n            showToast('End date cannot be before start date', 'error');\r\n            return;\r\n        }\r\n\r\n        let finalEndDate = endDate;\r\n        if (isHalfDay) finalEndDate = startDate;\r\n\r\n        applyLeaveMutation.mutate({\r\n            startDate: startDate.toISOString().split('T')[0],\r\n            endDate: finalEndDate.toISOString().split('T')[0],\r\n            reason,\r\n            leaveType: isHalfDay ? 'half' : 'full',\r\n            halfDaySlot: isHalfDay ? halfDaySlot : undefined\r\n        });\r\n    };\r\n\r\n    // --- Render Items ---\r\n\r\n    const formatDate = (dateString) => {\r\n        if (!dateString) return '';\r\n        return new Date(dateString).toLocaleDateString('en-GB', { day: '2-digit', month: 'short' });\r\n    };\r\n\r\n    const getStatusColor = (status) => {\r\n        switch (status) {\r\n            case 'approved': return '#4CAF50';\r\n            case 'rejected': return '#F44336';\r\n            default: return '#FF9800';\r\n        }\r\n    };\r\n\r\n    const renderRequestItem = ({ item }) => (\r\n        <View style={styles.card}>\r\n            <View style={styles.cardHeader}>\r\n                <View>\r\n                    <Text style={styles.studentName}>{item.applicant?.name || 'Unknown'}</Text>\r\n                    <Text style={styles.classInfo}>\r\n                        {item.applicantRole === 'student' ? `Class: ${item.class?.name || ''} ${item.class?.section || ''}` : (item.applicantRole || 'Unknown').toUpperCase()}\r\n                    </Text>\r\n                </View>\r\n                <View style={styles.dateContainer}>\r\n                    <Text style={styles.dateText}>\r\n                        {formatDate(item.startDate)}\r\n                        {item.leaveType === 'full' && item.startDate !== item.endDate && ` - ${formatDate(item.endDate)}`}\r\n                    </Text>\r\n                    <Text style={styles.leaveTypeBadge}>\r\n                        {item.leaveType === 'half' ? `Half Day (${item.halfDaySlot})` : 'Full Day'}\r\n                    </Text>\r\n                </View>\r\n            </View>\r\n\r\n            <Text style={styles.reasonLabel}>Reason:</Text>\r\n            <Text style={styles.reasonText}>{item.reason}</Text>\r\n\r\n            <View style={styles.actionButtons}>\r\n                <TouchableOpacity\r\n                    style={[styles.actionButton, styles.rejectButton]}\r\n                    onPress={() => openActionModal(item, 'rejected')}\r\n                >\r\n                    <Text style={styles.actionButtonText}>Reject</Text>\r\n                </TouchableOpacity>\r\n                <TouchableOpacity\r\n                    style={[styles.actionButton, styles.approveButton]}\r\n                    onPress={() => openActionModal(item, 'approved')}\r\n                >\r\n                    <Text style={styles.actionButtonText}>Approve</Text>\r\n                </TouchableOpacity>\r\n            </View>\r\n        </View>\r\n    );\r\n\r\n    const renderMyLeaveItem = ({ item }) => (\r\n        <View style={styles.card}>\r\n            <View style={styles.cardHeader}>\r\n                <View>\r\n                    <Text style={styles.dateText}>\r\n                        {formatDate(item.startDate)}\r\n                        {item.leaveType === 'full' && item.startDate !== item.endDate && ` - ${formatDate(item.endDate)}`}\r\n                    </Text>\r\n                    <Text style={styles.leaveTypeBadge}>\r\n                        {item.leaveType === 'half' ? `Half Day (${item.halfDaySlot})` : 'Full Day'}\r\n                    </Text>\r\n                </View>\r\n                <View style={[styles.statusBadge, { backgroundColor: getStatusColor(item.status) }]}>\r\n                    <Text style={styles.statusText}>{item.status.toUpperCase()}</Text>\r\n                </View>\r\n            </View>\r\n            <Text style={styles.reasonLabel}>Reason:</Text>\r\n            <Text style={styles.reasonText}>{item.reason}</Text>\r\n            {item.status === 'rejected' && (\r\n                <View style={styles.rejectionBox}>\r\n                    <Text style={styles.rejectionTitle}>Rejection Details:</Text>\r\n                    <Text style={styles.rejectionText}><Text style={{ fontWeight: 'bold' }}>Reason:</Text> {item.rejectionReason}</Text>\r\n                    <Text style={styles.rejectionText}><Text style={{ fontWeight: 'bold' }}>Comments:</Text> {item.rejectionComments}</Text>\r\n                </View>\r\n            )}\r\n        </View>\r\n    );\r\n\r\n    const renderDailyItem = ({ item }) => (\r\n        <View style={styles.card}>\r\n            <View style={styles.cardHeader}>\r\n                <View>\r\n                    <Text style={styles.studentName}>{item.applicant?.name || 'Unknown'}</Text>\r\n                    <Text style={styles.classInfo}>\r\n                        {item.applicantRole === 'student' ? `Class: ${item.class?.name || ''} ${item.class?.section || ''}` : (item.applicantRole || 'Unknown').toUpperCase()}\r\n                    </Text>\r\n                </View>\r\n                <View style={[styles.statusBadge, { backgroundColor: '#4CAF50' }]}>\r\n                    <Text style={styles.statusText}>ON LEAVE</Text>\r\n                </View>\r\n            </View>\r\n            <Text style={styles.dateText}>\r\n                Until: {formatDate(item.endDate)} ({item.leaveType === 'half' ? 'Half Day' : 'Full Day'})\r\n            </Text>\r\n            <Text style={styles.reasonLabel}>Reason:</Text>\r\n            <Text style={styles.reasonText}>{item.reason}</Text>\r\n        </View>\r\n    );\r\n\r\n    return (\r\n        <View style={styles.container}>\r\n            <View style={styles.header}>\r\n                <TouchableOpacity onPress={() => router.back()} style={styles.backButton}>\r\n                    <Ionicons name=\"arrow-back\" size={24} color=\"#333\" />\r\n                </TouchableOpacity>\r\n                <Text style={styles.headerTitle}>Leave Management</Text>\r\n                <View style={{ width: 24 }} />\r\n            </View>\r\n\r\n            <View style={styles.tabContainer}>\r\n                <TouchableOpacity\r\n                    style={[styles.tab, activeTab === 'requests' && styles.activeTab]}\r\n                    onPress={() => setActiveTab('requests')}\r\n                >\r\n                    <Text style={[styles.tabText, activeTab === 'requests' && styles.activeTabText]}>Requests</Text>\r\n                </TouchableOpacity>\r\n                <TouchableOpacity\r\n                    style={[styles.tab, activeTab === 'my_leaves' && styles.activeTab]}\r\n                    onPress={() => setActiveTab('my_leaves')}\r\n                >\r\n                    <Text style={[styles.tabText, activeTab === 'my_leaves' && styles.activeTabText]}>My Leaves</Text>\r\n                </TouchableOpacity>\r\n                <TouchableOpacity\r\n                    style={[styles.tab, activeTab === 'daily' && styles.activeTab]}\r\n                    onPress={() => setActiveTab('daily')}\r\n                >\r\n                    <Text style={[styles.tabText, activeTab === 'daily' && styles.activeTabText]}>Daily Stats</Text>\r\n                </TouchableOpacity>\r\n            </View>\r\n\r\n            {activeTab === 'my_leaves' && leaveBalance && (\r\n                <View style={styles.balanceCard}>\r\n                    <View style={styles.balanceItem}>\r\n                        <Text style={styles.balanceLabel}>Total</Text>\r\n                        <Text style={styles.balanceValue}>{leaveBalance.total}</Text>\r\n                    </View>\r\n                    <View style={styles.balanceDivider} />\r\n                    <View style={styles.balanceItem}>\r\n                        <Text style={styles.balanceLabel}>Used</Text>\r\n                        <Text style={styles.balanceValue}>{leaveBalance.used}</Text>\r\n                    </View>\r\n                    <View style={styles.balanceDivider} />\r\n                    <View style={styles.balanceItem}>\r\n                        <Text style={styles.balanceLabel}>Remaining</Text>\r\n                        <Text style={[styles.balanceValue, { color: '#4CAF50' }]}>{leaveBalance.remaining}</Text>\r\n                    </View>\r\n                </View>\r\n            )}\r\n\r\n            {loading ? (\r\n                <ActivityIndicator size=\"large\" color=\"#2F6CD4\" style={styles.loader} />\r\n            ) : (\r\n                <>\r\n                    {activeTab === 'requests' ? (\r\n                        <SectionList\r\n                            sections={requests}\r\n                            renderItem={renderRequestItem}\r\n                            renderSectionHeader={({ section: { title } }) => (\r\n                                <Text style={styles.sectionHeader}>{title}</Text>\r\n                            )}\r\n                            keyExtractor={(item) => item._id}\r\n                            contentContainerStyle={styles.listContent}\r\n                            refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} />}\r\n                            ListEmptyComponent={<Text style={styles.emptyText}>No pending requests.</Text>}\r\n                        />\r\n                    ) : (\r\n                        <FlatList\r\n                            data={activeTab === 'my_leaves' ? myLeaves : dailyStats}\r\n                            renderItem={activeTab === 'my_leaves' ? renderMyLeaveItem : renderDailyItem}\r\n                            keyExtractor={(item) => item._id}\r\n                            contentContainerStyle={styles.listContent}\r\n                            refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} />}\r\n                            ListEmptyComponent={<Text style={styles.emptyText}>No records found.</Text>}\r\n                        />\r\n                    )}\r\n                </>\r\n            )}\r\n\r\n            {activeTab === 'my_leaves' && (\r\n                <TouchableOpacity style={styles.fab} onPress={() => setApplyModalVisible(true)}>\r\n                    <Ionicons name=\"add\" size={24} color=\"#fff\" />\r\n                    <Text style={styles.fabText}>Apply Leave</Text>\r\n                </TouchableOpacity>\r\n            )}\r\n\r\n            {/* Action Modal */}\r\n            <Modal\r\n                visible={actionModalVisible}\r\n                animationType=\"fade\"\r\n                transparent={true}\r\n                onRequestClose={() => setActionModalVisible(false)}\r\n            >\r\n                <View style={styles.modalContainer}>\r\n                    <View style={styles.modalContent}>\r\n                        <Text style={styles.modalTitle}>\r\n                            {actionType === 'approved' ? 'Approve Leave' : 'Reject Leave'}\r\n                        </Text>\r\n\r\n                        {actionType === 'rejected' && (\r\n                            <>\r\n                                <Text style={styles.label}>Rejection Reason *</Text>\r\n                                <TextInput\r\n                                    style={styles.input}\r\n                                    placeholder=\"e.g., Exam Period, Staff Shortage\"\r\n                                    value={rejectionReason}\r\n                                    onChangeText={setRejectionReason}\r\n                                />\r\n                                <Text style={styles.label}>Comments *</Text>\r\n                                <TextInput\r\n                                    style={[styles.input, styles.textArea]}\r\n                                    placeholder=\"Add detailed comments...\"\r\n                                    value={rejectionComments}\r\n                                    onChangeText={setRejectionComments}\r\n                                    multiline\r\n                                    numberOfLines={3}\r\n                                />\r\n                            </>\r\n                        )}\r\n\r\n                        {actionType === 'approved' && (\r\n                            <>\r\n                                <Text style={styles.label}>Note (Optional)</Text>\r\n                                <TextInput\r\n                                    style={[styles.input, styles.textArea]}\r\n                                    placeholder=\"Add a note...\"\r\n                                    value={actionReason}\r\n                                    onChangeText={setActionReason}\r\n                                    multiline\r\n                                    numberOfLines={3}\r\n                                />\r\n                            </>\r\n                        )}\r\n\r\n                        <View style={styles.modalButtons}>\r\n                            <TouchableOpacity\r\n                                style={[styles.button, styles.cancelButton]}\r\n                                onPress={() => setActionModalVisible(false)}\r\n                            >\r\n                                <Text style={styles.cancelButtonText}>Cancel</Text>\r\n                            </TouchableOpacity>\r\n                            <TouchableOpacity\r\n                                style={[styles.button, actionType === 'approved' ? styles.approveButton : styles.rejectButton]}\r\n                                onPress={handleAction}\r\n                                disabled={actionMutation.isPending}\r\n                            >\r\n                                {actionMutation.isPending ? (\r\n                                    <ActivityIndicator color=\"#fff\" size=\"small\" />\r\n                                ) : (\r\n                                    <Text style={styles.submitButtonText}>\r\n                                        {actionType === 'approved' ? 'Approve' : 'Reject'}\r\n                                    </Text>\r\n                                )}\r\n                            </TouchableOpacity>\r\n                        </View>\r\n                    </View>\r\n                </View>\r\n            </Modal>\r\n\r\n            {/* Apply Leave Modal */}\r\n            <Modal\r\n                visible={applyModalVisible}\r\n                animationType=\"slide\"\r\n                transparent={true}\r\n                onRequestClose={() => setApplyModalVisible(false)}\r\n            >\r\n                <View style={styles.modalContainer}>\r\n                    <View style={styles.modalContent}>\r\n                        <View style={styles.modalHeader}>\r\n                            <Text style={styles.modalTitle}>Apply for Leave</Text>\r\n                            <TouchableOpacity onPress={() => setApplyModalVisible(false)}>\r\n                                <Ionicons name=\"close\" size={24} color=\"#333\" />\r\n                            </TouchableOpacity>\r\n                        </View>\r\n\r\n                        <ScrollView>\r\n                            <View style={styles.inputGroup}>\r\n                                <Text style={styles.label}>Leave Type</Text>\r\n                                <View style={styles.row}>\r\n                                    <Text style={styles.valueText}>{isHalfDay ? 'Half Day' : 'Full Day'}</Text>\r\n                                    <Switch\r\n                                        value={isHalfDay}\r\n                                        onValueChange={setIsHalfDay}\r\n                                        trackColor={{ false: \"#767577\", true: \"#81b0ff\" }}\r\n                                        thumbColor={isHalfDay ? \"#2F6CD4\" : \"#f4f3f4\"}\r\n                                    />\r\n                                </View>\r\n                            </View>\r\n\r\n                            {isHalfDay && (\r\n                                <View style={styles.inputGroup}>\r\n                                    <Text style={styles.label}>Slot</Text>\r\n                                    <View style={styles.slotContainer}>\r\n                                        <TouchableOpacity\r\n                                            style={[styles.slotButton, halfDaySlot === 'morning' && styles.activeSlot]}\r\n                                            onPress={() => setHalfDaySlot('morning')}\r\n                                        >\r\n                                            <Text style={[styles.slotText, halfDaySlot === 'morning' && styles.activeSlotText]}>Morning</Text>\r\n                                        </TouchableOpacity>\r\n                                        <TouchableOpacity\r\n                                            style={[styles.slotButton, halfDaySlot === 'afternoon' && styles.activeSlot]}\r\n                                            onPress={() => setHalfDaySlot('afternoon')}\r\n                                        >\r\n                                            <Text style={[styles.slotText, halfDaySlot === 'afternoon' && styles.activeSlotText]}>Afternoon</Text>\r\n                                        </TouchableOpacity>\r\n                                    </View>\r\n                                </View>\r\n                            )}\r\n\r\n                            <View style={styles.inputGroup}>\r\n                                <Text style={styles.label}>Start Date</Text>\r\n                                <TouchableOpacity\r\n                                    style={styles.dateButton}\r\n                                    onPress={() => setShowStartPicker(true)}\r\n                                >\r\n                                    <Text style={styles.dateText}>{formatDate(startDate.toISOString())}</Text>\r\n                                    <Ionicons name=\"calendar-outline\" size={20} color=\"#666\" />\r\n                                </TouchableOpacity>\r\n                                {showStartPicker && (\r\n                                    <DateTimePicker\r\n                                        value={startDate}\r\n                                        mode=\"date\"\r\n                                        display=\"default\"\r\n                                        minimumDate={new Date()}\r\n                                        onChange={(event, selectedDate) => {\r\n                                            setShowStartPicker(false);\r\n                                            if (selectedDate) {\r\n                                                setStartDate(selectedDate);\r\n                                                if (selectedDate > endDate) setEndDate(selectedDate);\r\n                                            }\r\n                                        }}\r\n                                    />\r\n                                )}\r\n                            </View>\r\n\r\n                            {!isHalfDay && (\r\n                                <View style={styles.inputGroup}>\r\n                                    <Text style={styles.label}>End Date</Text>\r\n                                    <TouchableOpacity\r\n                                        style={styles.dateButton}\r\n                                        onPress={() => setShowEndPicker(true)}\r\n                                    >\r\n                                        <Text style={styles.dateText}>{formatDate(endDate.toISOString())}</Text>\r\n                                        <Ionicons name=\"calendar-outline\" size={20} color=\"#666\" />\r\n                                    </TouchableOpacity>\r\n                                    {showEndPicker && (\r\n                                        <DateTimePicker\r\n                                            value={endDate}\r\n                                            mode=\"date\"\r\n                                            display=\"default\"\r\n                                            minimumDate={startDate}\r\n                                            onChange={(event, selectedDate) => {\r\n                                                setShowEndPicker(false);\r\n                                                if (selectedDate) setEndDate(selectedDate);\r\n                                            }}\r\n                                        />\r\n                                    )}\r\n                                </View>\r\n                            )}\r\n\r\n                            <View style={styles.inputGroup}>\r\n                                <Text style={styles.label}>Reason</Text>\r\n                                <TextInput\r\n                                    style={[styles.input, styles.textArea]}\r\n                                    placeholder=\"Enter reason for leave...\"\r\n                                    value={reason}\r\n                                    onChangeText={setReason}\r\n                                    multiline\r\n                                    numberOfLines={4}\r\n                                />\r\n                            </View>\r\n\r\n                            <TouchableOpacity\r\n                                style={styles.submitButton}\r\n                                onPress={handleApplyLeave}\r\n                                disabled={applyLeaveMutation.isPending}\r\n                            >\r\n                                {applyLeaveMutation.isPending ? (\r\n                                    <ActivityIndicator color=\"#fff\" />\r\n                                ) : (\r\n                                    <Text style={styles.submitButtonText}>Submit Application</Text>\r\n                                )}\r\n                            </TouchableOpacity>\r\n                        </ScrollView>\r\n                    </View>\r\n                </View>\r\n            </Modal>\r\n        </View>\r\n    );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n    container: { flex: 1, backgroundColor: '#f5f5f5' },\r\n    header: { flexDirection: 'row', alignItems: 'center', justifyContent: 'space-between', padding: 16, backgroundColor: '#fff', elevation: 2 },\r\n    headerTitle: { fontSize: 18, fontWeight: 'bold', color: '#333' },\r\n    backButton: { padding: 4 },\r\n    tabContainer: { flexDirection: 'row', backgroundColor: '#fff', paddingHorizontal: 16, paddingBottom: 12, borderBottomWidth: 1, borderBottomColor: '#eee' },\r\n    tab: { flex: 1, paddingVertical: 10, alignItems: 'center', borderBottomWidth: 2, borderBottomColor: 'transparent' },\r\n    activeTab: { borderBottomColor: '#2F6CD4' },\r\n    tabText: { fontSize: 16, color: '#666', fontWeight: '500' },\r\n    activeTabText: { color: '#2F6CD4', fontWeight: 'bold' },\r\n    loader: { marginTop: 20 },\r\n    listContent: { padding: 16, paddingBottom: 80 },\r\n    card: { backgroundColor: '#fff', borderRadius: 12, padding: 16, marginBottom: 12, elevation: 2 },\r\n    cardHeader: { flexDirection: 'row', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: 8 },\r\n    studentName: { fontSize: 16, fontWeight: 'bold', color: '#333' },\r\n    classInfo: { fontSize: 14, color: '#666' },\r\n    dateContainer: { alignItems: 'flex-end' },\r\n    dateText: { fontSize: 14, color: '#333', fontWeight: '500' },\r\n    leaveTypeBadge: { fontSize: 12, color: '#666', marginTop: 2, fontStyle: 'italic' },\r\n    statusBadge: { paddingHorizontal: 8, paddingVertical: 4, borderRadius: 12 },\r\n    statusText: { color: '#fff', fontSize: 12, fontWeight: 'bold' },\r\n    reasonLabel: { fontSize: 14, color: '#666', marginTop: 8, marginBottom: 2 },\r\n    reasonText: { fontSize: 14, color: '#333', marginBottom: 12 },\r\n    actionButtons: { flexDirection: 'row', justifyContent: 'flex-end', marginTop: 8, borderTopWidth: 1, borderTopColor: '#eee', paddingTop: 12 },\r\n    actionButton: { paddingHorizontal: 16, paddingVertical: 8, borderRadius: 20, marginLeft: 12 },\r\n    approveButton: { backgroundColor: '#4CAF50' },\r\n    rejectButton: { backgroundColor: '#F44336' },\r\n    actionButtonText: { color: '#fff', fontWeight: '600', fontSize: 14 },\r\n    emptyText: { textAlign: 'center', marginTop: 40, color: '#666', fontSize: 16 },\r\n    fab: { position: 'absolute', bottom: 100, right: 20, backgroundColor: '#2F6CD4', flexDirection: 'row', alignItems: 'center', paddingVertical: 12, paddingHorizontal: 20, borderRadius: 30, elevation: 4 },\r\n    fabText: { color: '#fff', fontWeight: 'bold', marginLeft: 8 },\r\n    balanceCard: { flexDirection: 'row', backgroundColor: '#fff', margin: 16, marginBottom: 0, padding: 16, borderRadius: 12, elevation: 2, justifyContent: 'space-around' },\r\n    balanceItem: { alignItems: 'center' },\r\n    balanceLabel: { fontSize: 12, color: '#666', marginBottom: 4 },\r\n    balanceValue: { fontSize: 20, fontWeight: 'bold', color: '#333' },\r\n    balanceDivider: { width: 1, backgroundColor: '#eee' },\r\n    modalContainer: { flex: 1, backgroundColor: 'rgba(0,0,0,0.5)', justifyContent: 'center', padding: 20 },\r\n    modalContent: { backgroundColor: '#fff', borderRadius: 16, padding: 20, maxHeight: '90%' },\r\n    modalHeader: { flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center', marginBottom: 20 },\r\n    modalTitle: { fontSize: 20, fontWeight: 'bold', color: '#333', marginBottom: 10 },\r\n    label: { fontSize: 14, color: '#666', marginBottom: 6, fontWeight: '500', marginTop: 10 },\r\n    input: { backgroundColor: '#f9f9f9', borderWidth: 1, borderColor: '#ddd', borderRadius: 8, padding: 12, fontSize: 16 },\r\n    textArea: { height: 80, textAlignVertical: 'top' },\r\n    modalButtons: { flexDirection: 'row', justifyContent: 'space-between', marginTop: 20 },\r\n    button: { flex: 1, padding: 14, borderRadius: 8, alignItems: 'center' },\r\n    cancelButton: { backgroundColor: '#f5f5f5', marginRight: 10 },\r\n    cancelButtonText: { color: '#666', fontWeight: '600', fontSize: 16 },\r\n    submitButtonText: { color: '#fff', fontWeight: '600', fontSize: 16 },\r\n    inputGroup: { marginBottom: 20 },\r\n    row: { flexDirection: 'row', alignItems: 'center', justifyContent: 'space-between', backgroundColor: '#f9f9f9', padding: 12, borderRadius: 8, borderWidth: 1, borderColor: '#ddd' },\r\n    valueText: { fontSize: 16, color: '#333' },\r\n    slotContainer: { flexDirection: 'row', gap: 12 },\r\n    slotButton: { flex: 1, padding: 12, borderRadius: 8, borderWidth: 1, borderColor: '#ddd', alignItems: 'center', backgroundColor: '#f9f9f9' },\r\n    activeSlot: { borderColor: '#2F6CD4', backgroundColor: '#EDE7F6' },\r\n    slotText: { color: '#666', fontWeight: '500' },\r\n    activeSlotText: { color: '#2F6CD4', fontWeight: 'bold' },\r\n    dateButton: { flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center', backgroundColor: '#f9f9f9', borderWidth: 1, borderColor: '#ddd', borderRadius: 8, padding: 12 },\r\n    dateText: { fontSize: 16, color: '#333' },\r\n    submitButton: { backgroundColor: '#2F6CD4', padding: 16, borderRadius: 12, alignItems: 'center', marginTop: 10, marginBottom: 20 },\r\n    sectionHeader: { fontSize: 14, fontWeight: 'bold', color: '#666', backgroundColor: '#f5f5f5', paddingVertical: 8, paddingHorizontal: 4, marginTop: 10, textTransform: 'uppercase' },\r\n    rejectionBox: { marginTop: 12, padding: 10, backgroundColor: '#FFEBEE', borderRadius: 8, borderLeftWidth: 3, borderLeftColor: '#F44336' },\r\n    rejectionTitle: { fontSize: 12, fontWeight: 'bold', color: '#D32F2F', marginBottom: 4 },\r\n    rejectionText: { fontSize: 12, color: '#D32F2F', marginBottom: 2 },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\admin\\performance.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'BarChart' is defined but never used. Allowed unused vars must match /^_/u.","line":17,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":18},{"ruleId":"no-unused-vars","severity":1,"message":"'PieChart' is defined but never used. Allowed unused vars must match /^_/u.","line":17,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":28},{"ruleId":"no-unused-vars","severity":1,"message":"'width' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":19,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":14},{"ruleId":"no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":31,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":31,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    RefreshControl,\r\n    ActivityIndicator,\r\n    Dimensions,\r\n    TouchableOpacity,\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport { useRouter } from \"expo-router\";\r\nimport { useTheme } from \"../../theme\";\r\nimport { useApiQuery } from \"../../hooks/useApi\";\r\nimport AppHeader from \"../../components/Header\";\r\nimport apiConfig from \"../../config/apiConfig\";\r\nimport { BarChart, PieChart } from \"react-native-chart-kit\";\r\n\r\nconst { width } = Dimensions.get('window');\r\n\r\nconst EXAM_COLORS = {\r\n    'FA1': '#4CAF50',\r\n    'FA2': '#2196F3',\r\n    'SA1': '#FF9800',\r\n    'FA3': '#9C27B0',\r\n    'FA4': '#E91E63',\r\n    'SA2': '#F44336'\r\n};\r\n\r\nexport default function AdminPerformanceScreen() {\r\n    const router = useRouter();\r\n    const { colors } = useTheme();\r\n\r\n    const [refreshing, setRefreshing] = useState(false);\r\n    const [activeTab, setActiveTab] = useState('overview'); // 'overview' | 'classes' | 'subjects'\r\n\r\n    // Fetch school-wide performance data\r\n    const { data: performanceData, isLoading, refetch } = useApiQuery(\r\n        ['schoolPerformance'],\r\n        `${apiConfig.baseUrl}/exams/performance/school`\r\n    );\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        await refetch();\r\n        setRefreshing(false);\r\n    };\r\n\r\n    const getGradeColor = (percentage) => {\r\n        if (percentage >= 90) return colors.success;\r\n        if (percentage >= 75) return '#2196F3';\r\n        if (percentage >= 60) return '#FF9800';\r\n        if (percentage >= 40) return '#FF5722';\r\n        return colors.error;\r\n    };\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <View style={{ flex: 1, backgroundColor: colors.background, justifyContent: 'center', alignItems: 'center' }}>\r\n                <ActivityIndicator size=\"large\" color={colors.primary} />\r\n            </View>\r\n        );\r\n    }\r\n\r\n    if (!performanceData) {\r\n        return (\r\n            <View style={{ flex: 1, backgroundColor: colors.background, justifyContent: 'center', alignItems: 'center', padding: 20 }}>\r\n                <MaterialIcons name=\"info-outline\" size={64} color={colors.textSecondary} />\r\n                <Text style={{ color: colors.textSecondary, marginTop: 16, fontSize: 16, textAlign: 'center' }}>\r\n                    No performance data available\r\n                </Text>\r\n            </View>\r\n        );\r\n    }\r\n\r\n    const { examwisePerformance = [], classwiseSummary = [], subjectwiseSummary = [] } = performanceData;\r\n\r\n    // Calculate school average\r\n    const completedExams = examwisePerformance.filter(e => e.marksEntered > 0);\r\n    const schoolAvg = completedExams.length > 0\r\n        ? (completedExams.reduce((sum, e) => sum + e.avgPercentage, 0) / completedExams.length).toFixed(1)\r\n        : 0;\r\n\r\n    const renderOverview = () => (\r\n        <View>\r\n            {/* School Average Card */}\r\n            <View style={{\r\n                backgroundColor: colors.primary,\r\n                borderRadius: 20,\r\n                padding: 28,\r\n                marginTop: 20,\r\n                elevation: 4\r\n            }}>\r\n                <Text style={{ fontSize: 16, color: \"#fff\", opacity: 0.9, fontFamily: \"DMSans-Medium\", textAlign: \"center\" }}>\r\n                    School-wide Average\r\n                </Text>\r\n                <Text style={{ fontSize: 64, fontFamily: \"DMSans-Bold\", color: \"#fff\", marginTop: 12, textAlign: \"center\" }}>\r\n                    {schoolAvg}%\r\n                </Text>\r\n                <Text style={{ fontSize: 14, fontFamily: \"DMSans-Regular\", color: \"#fff\", marginTop: 4, textAlign: \"center\", opacity: 0.8 }}>\r\n                    Across all assessments\r\n                </Text>\r\n            </View>\r\n\r\n            {/* Quick Stats */}\r\n            <View style={{\r\n                flexDirection: \"row\",\r\n                gap: 12,\r\n                marginTop: 20\r\n            }}>\r\n                <View style={{\r\n                    flex: 1,\r\n                    backgroundColor: colors.cardBackground,\r\n                    borderRadius: 16,\r\n                    padding: 16,\r\n                    alignItems: \"center\"\r\n                }}>\r\n                    <MaterialIcons name=\"school\" size={32} color={colors.primary} />\r\n                    <Text style={{ fontSize: 24, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginTop: 8 }}>\r\n                        {classwiseSummary.length}\r\n                    </Text>\r\n                    <Text style={{ fontSize: 12, color: colors.textSecondary, fontFamily: \"DMSans-Regular\" }}>\r\n                        Classes\r\n                    </Text>\r\n                </View>\r\n                <View style={{\r\n                    flex: 1,\r\n                    backgroundColor: colors.cardBackground,\r\n                    borderRadius: 16,\r\n                    padding: 16,\r\n                    alignItems: \"center\"\r\n                }}>\r\n                    <MaterialIcons name=\"book\" size={32} color={colors.success} />\r\n                    <Text style={{ fontSize: 24, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginTop: 8 }}>\r\n                        {subjectwiseSummary.length}\r\n                    </Text>\r\n                    <Text style={{ fontSize: 12, color: colors.textSecondary, fontFamily: \"DMSans-Regular\" }}>\r\n                        Subjects\r\n                    </Text>\r\n                </View>\r\n                <View style={{\r\n                    flex: 1,\r\n                    backgroundColor: colors.cardBackground,\r\n                    borderRadius: 16,\r\n                    padding: 16,\r\n                    alignItems: \"center\"\r\n                }}>\r\n                    <MaterialIcons name=\"assessment\" size={32} color={EXAM_COLORS.FA1} />\r\n                    <Text style={{ fontSize: 24, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginTop: 8 }}>\r\n                        {completedExams.length}\r\n                    </Text>\r\n                    <Text style={{ fontSize: 12, color: colors.textSecondary, fontFamily: \"DMSans-Regular\" }}>\r\n                        Completed\r\n                    </Text>\r\n                </View>\r\n            </View>\r\n\r\n            {/* Exam-wise Performance */}\r\n            <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginTop: 28, marginBottom: 12 }}>\r\n                Assessment Performance\r\n            </Text>\r\n\r\n            {examwisePerformance.map((exam) => (\r\n                <View\r\n                    key={exam.examType}\r\n                    style={{\r\n                        backgroundColor: colors.cardBackground,\r\n                        borderRadius: 16,\r\n                        padding: 18,\r\n                        marginBottom: 12,\r\n                        borderLeftWidth: 5,\r\n                        borderLeftColor: EXAM_COLORS[exam.examType]\r\n                    }}\r\n                >\r\n                    <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\" }}>\r\n                        <View style={{ flex: 1 }}>\r\n                            <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>\r\n                                {exam.examType}\r\n                            </Text>\r\n                            <Text style={{ fontSize: 12, color: colors.textSecondary, fontFamily: \"DMSans-Regular\", marginTop: 2 }}>\r\n                                {exam.examsCount} exam{exam.examsCount !== 1 ? 's' : ''}  {exam.marksEntered} mark entries\r\n                            </Text>\r\n                        </View>\r\n                        <Text style={{\r\n                            fontSize: 28,\r\n                            fontFamily: \"DMSans-Bold\",\r\n                            color: getGradeColor(exam.avgPercentage)\r\n                        }}>\r\n                            {exam.avgPercentage.toFixed(1)}%\r\n                        </Text>\r\n                    </View>\r\n                </View>\r\n            ))}\r\n        </View>\r\n    );\r\n\r\n    const renderClasses = () => (\r\n        <View>\r\n            <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginTop: 20, marginBottom: 12 }}>\r\n                Class-wise Performance\r\n            </Text>\r\n\r\n            {classwiseSummary\r\n                .sort((a, b) => b.avgPercentage - a.avgPercentage)\r\n                .map((cls, idx) => (\r\n                    <View\r\n                        key={cls.classId}\r\n                        style={{\r\n                            backgroundColor: colors.cardBackground,\r\n                            borderRadius: 16,\r\n                            padding: 18,\r\n                            marginBottom: 12,\r\n                            flexDirection: \"row\",\r\n                            justifyContent: \"space-between\",\r\n                            alignItems: \"center\"\r\n                        }}\r\n                    >\r\n                        <View style={{ flexDirection: \"row\", alignItems: \"center\", flex: 1 }}>\r\n                            <View style={{\r\n                                width: 40,\r\n                                height: 40,\r\n                                borderRadius: 20,\r\n                                backgroundColor: idx < 3 ? colors.primary + '20' : colors.textSecondary + '10',\r\n                                alignItems: 'center',\r\n                                justifyContent: 'center',\r\n                                marginRight: 12\r\n                            }}>\r\n                                <Text style={{\r\n                                    fontSize: 16,\r\n                                    fontFamily: \"DMSans-Bold\",\r\n                                    color: idx < 3 ? colors.primary : colors.textSecondary\r\n                                }}>\r\n                                    #{idx + 1}\r\n                                </Text>\r\n                            </View>\r\n                            <View style={{ flex: 1 }}>\r\n                                <Text style={{ fontSize: 16, fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>\r\n                                    {cls.className}\r\n                                </Text>\r\n                                <Text style={{ fontSize: 12, color: colors.textSecondary, fontFamily: \"DMSans-Regular\" }}>\r\n                                    {cls.examsCount} exam{cls.examsCount !== 1 ? 's' : ''} completed\r\n                                </Text>\r\n                            </View>\r\n                        </View>\r\n                        <Text style={{\r\n                            fontSize: 24,\r\n                            fontFamily: \"DMSans-Bold\",\r\n                            color: getGradeColor(cls.avgPercentage)\r\n                        }}>\r\n                            {cls.avgPercentage}%\r\n                        </Text>\r\n                    </View>\r\n                ))}\r\n\r\n            {classwiseSummary.length === 0 && (\r\n                <View style={{ alignItems: \"center\", marginTop: 40, opacity: 0.6 }}>\r\n                    <MaterialIcons name=\"school\" size={64} color={colors.textSecondary} />\r\n                    <Text style={{ color: colors.textSecondary, marginTop: 16, fontSize: 16 }}>\r\n                        No class data available\r\n                    </Text>\r\n                </View>\r\n            )}\r\n        </View>\r\n    );\r\n\r\n    const renderSubjects = () => (\r\n        <View>\r\n            <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginTop: 20, marginBottom: 12 }}>\r\n                Subject-wise Performance\r\n            </Text>\r\n\r\n            {subjectwiseSummary\r\n                .sort((a, b) => b.avgPercentage - a.avgPercentage)\r\n                .map((subj, idx) => (\r\n                    <View\r\n                        key={subj.subjectId}\r\n                        style={{\r\n                            backgroundColor: colors.cardBackground,\r\n                            borderRadius: 16,\r\n                            padding: 18,\r\n                            marginBottom: 12,\r\n                            flexDirection: \"row\",\r\n                            justifyContent: \"space-between\",\r\n                            alignItems: \"center\"\r\n                        }}\r\n                    >\r\n                        <View style={{ flexDirection: \"row\", alignItems: \"center\", flex: 1 }}>\r\n                            <View style={{\r\n                                width: 40,\r\n                                height: 40,\r\n                                borderRadius: 20,\r\n                                backgroundColor: idx < 3 ? colors.success + '20' : colors.textSecondary + '10',\r\n                                alignItems: 'center',\r\n                                justifyContent: 'center',\r\n                                marginRight: 12\r\n                            }}>\r\n                                <Text style={{\r\n                                    fontSize: 16,\r\n                                    fontFamily: \"DMSans-Bold\",\r\n                                    color: idx < 3 ? colors.success : colors.textSecondary\r\n                                }}>\r\n                                    #{idx + 1}\r\n                                </Text>\r\n                            </View>\r\n                            <View style={{ flex: 1 }}>\r\n                                <Text style={{ fontSize: 16, fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>\r\n                                    {subj.subjectName}\r\n                                </Text>\r\n                                <Text style={{ fontSize: 12, color: colors.textSecondary, fontFamily: \"DMSans-Regular\" }}>\r\n                                    {subj.examsCount} exam{subj.examsCount !== 1 ? 's' : ''} completed\r\n                                </Text>\r\n                            </View>\r\n                        </View>\r\n                        <Text style={{\r\n                            fontSize: 24,\r\n                            fontFamily: \"DMSans-Bold\",\r\n                            color: getGradeColor(subj.avgPercentage)\r\n                        }}>\r\n                            {subj.avgPercentage}%\r\n                        </Text>\r\n                    </View>\r\n                ))}\r\n\r\n            {subjectwiseSummary.length === 0 && (\r\n                <View style={{ alignItems: \"center\", marginTop: 40, opacity: 0.6 }}>\r\n                    <MaterialIcons name=\"book\" size={64} color={colors.textSecondary} />\r\n                    <Text style={{ color: colors.textSecondary, marginTop: 16, fontSize: 16 }}>\r\n                        No subject data available\r\n                    </Text>\r\n                </View>\r\n            )}\r\n        </View>\r\n    );\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <ScrollView\r\n                refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} />}\r\n                contentContainerStyle={{ paddingBottom: 100 }}\r\n            >\r\n                <View style={{ padding: 16, paddingTop: 24 }}>\r\n                    <AppHeader\r\n                        title=\"School Performance\"\r\n                        subtitle=\"Comprehensive analytics dashboard\"\r\n                        showBack\r\n                    />\r\n\r\n                    {/* Tabs */}\r\n                    <View style={{\r\n                        flexDirection: \"row\",\r\n                        backgroundColor: colors.cardBackground,\r\n                        borderRadius: 12,\r\n                        padding: 4,\r\n                        marginTop: 20\r\n                    }}>\r\n                        <TouchableOpacity\r\n                            style={{\r\n                                flex: 1,\r\n                                paddingVertical: 10,\r\n                                alignItems: \"center\",\r\n                                backgroundColor: activeTab === 'overview' ? colors.primary : 'transparent',\r\n                                borderRadius: 10\r\n                            }}\r\n                            onPress={() => setActiveTab('overview')}\r\n                        >\r\n                            <Text style={{\r\n                                fontFamily: \"DMSans-Bold\",\r\n                                fontSize: 13,\r\n                                color: activeTab === 'overview' ? \"#fff\" : colors.textSecondary\r\n                            }}>\r\n                                Overview\r\n                            </Text>\r\n                        </TouchableOpacity>\r\n                        <TouchableOpacity\r\n                            style={{\r\n                                flex: 1,\r\n                                paddingVertical: 10,\r\n                                alignItems: \"center\",\r\n                                backgroundColor: activeTab === 'classes' ? colors.primary : 'transparent',\r\n                                borderRadius: 10\r\n                            }}\r\n                            onPress={() => setActiveTab('classes')}\r\n                        >\r\n                            <Text style={{\r\n                                fontFamily: \"DMSans-Bold\",\r\n                                fontSize: 13,\r\n                                color: activeTab === 'classes' ? \"#fff\" : colors.textSecondary\r\n                            }}>\r\n                                Classes\r\n                            </Text>\r\n                        </TouchableOpacity>\r\n                        <TouchableOpacity\r\n                            style={{\r\n                                flex: 1,\r\n                                paddingVertical: 10,\r\n                                alignItems: \"center\",\r\n                                backgroundColor: activeTab === 'subjects' ? colors.primary : 'transparent',\r\n                                borderRadius: 10\r\n                            }}\r\n                            onPress={() => setActiveTab('subjects')}\r\n                        >\r\n                            <Text style={{\r\n                                fontFamily: \"DMSans-Bold\",\r\n                                fontSize: 13,\r\n                                color: activeTab === 'subjects' ? \"#fff\" : colors.textSecondary\r\n                            }}>\r\n                                Subjects\r\n                            </Text>\r\n                        </TouchableOpacity>\r\n                    </View>\r\n\r\n                    {/* Tab Content */}\r\n                    {activeTab === 'overview' && renderOverview()}\r\n                    {activeTab === 'classes' && renderClasses()}\r\n                    {activeTab === 'subjects' && renderSubjects()}\r\n                </View>\r\n            </ScrollView>\r\n        </View>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\admin\\send-notification.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":36},{"ruleId":"no-unused-vars","severity":1,"message":"'Alert' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":10},{"ruleId":"no-unused-vars","severity":1,"message":"'AsyncStorage' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":21,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":19},{"ruleId":"no-undef","severity":2,"message":"'useToast' is not defined.","line":22,"column":27,"nodeType":"Identifier","messageId":"undef","endLine":22,"endColumn":35}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    TextInput,\r\n    Pressable,\r\n    ActivityIndicator,\r\n    Alert\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useRouter } from \"expo-router\";\r\nimport { useTheme } from \"../../theme\";\r\nimport { useApiQuery, useApiMutation, createApiMutationFn } from \"../../hooks/useApi\";\r\nimport apiConfig from \"../../config/apiConfig\";\r\nimport Header from \"../../components/Header\";\r\n\r\nexport default function SendNotificationScreen() {\r\n    const router = useRouter();\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n\r\n    const [title, setTitle] = useState(\"\");\r\n    const [message, setMessage] = useState(\"\");\r\n    const [type, setType] = useState(\"General\");\r\n    const [target, setTarget] = useState(\"all\"); // 'all', 'class', 'user'\r\n    const [selectedClass, setSelectedClass] = useState(null);\r\n\r\n    // Fetch Classes\r\n    const { data: classes = [] } = useApiQuery(\r\n        ['adminClasses'],\r\n        `${apiConfig.baseUrl}/classes`,\r\n        { enabled: target === 'class' }\r\n    );\r\n\r\n    // Send Notification Mutation\r\n    const sendNotificationMutation = useApiMutation({\r\n        mutationFn: createApiMutationFn(`${apiConfig.baseUrl}/notifications/send`, 'POST'),\r\n        onSuccess: () => {\r\n            showToast(\"Notification sent successfully\", \"success\");\r\n            router.back();\r\n        },\r\n        onError: (error) => showToast(error.message || \"Failed to send notification\", \"error\")\r\n    });\r\n\r\n    const handleSend = () => {\r\n        if (!title.trim() || !message.trim()) {\r\n            showToast(\"Please enter title and message\", \"error\");\r\n            return;\r\n        }\r\n\r\n        if (target === 'class' && !selectedClass) {\r\n            showToast(\"Please select a class\", \"error\");\r\n            return;\r\n        }\r\n\r\n        sendNotificationMutation.mutate({\r\n            title,\r\n            message,\r\n            type,\r\n            target,\r\n            targetId: target === 'class' ? selectedClass : null\r\n        });\r\n    };\r\n\r\n    const notificationTypes = ['General', 'Homework', 'Exam', 'Fee', 'Emergency', 'Event'];\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <View style={{ padding: 16, paddingTop: 24 }}>\r\n                <Header title=\"Send Notification\" subtitle=\"Broadcast updates\" showBack />\r\n            </View>\r\n\r\n            <ScrollView contentContainerStyle={{ padding: 16, paddingBottom: 100 }}>\r\n\r\n                {/* Title */}\r\n                <View style={{ marginBottom: 20 }}>\r\n                    <Text style={{ color: colors.textSecondary, marginBottom: 8 }}>Title</Text>\r\n                    <TextInput\r\n                        value={title}\r\n                        onChangeText={setTitle}\r\n                        placeholder=\"e.g. School Closed Tomorrow\"\r\n                        placeholderTextColor={colors.textSecondary + \"80\"}\r\n                        style={{\r\n                            borderWidth: 1,\r\n                            borderColor: colors.textSecondary + \"40\",\r\n                            borderRadius: 12,\r\n                            padding: 16,\r\n                            color: colors.textPrimary,\r\n                            fontSize: 16,\r\n                            backgroundColor: colors.cardBackground\r\n                        }}\r\n                    />\r\n                </View>\r\n\r\n                {/* Message */}\r\n                <View style={{ marginBottom: 20 }}>\r\n                    <Text style={{ color: colors.textSecondary, marginBottom: 8 }}>Message</Text>\r\n                    <TextInput\r\n                        value={message}\r\n                        onChangeText={setMessage}\r\n                        placeholder=\"Type your message here...\"\r\n                        placeholderTextColor={colors.textSecondary + \"80\"}\r\n                        multiline\r\n                        style={{\r\n                            borderWidth: 1,\r\n                            borderColor: colors.textSecondary + \"40\",\r\n                            borderRadius: 12,\r\n                            padding: 16,\r\n                            color: colors.textPrimary,\r\n                            fontSize: 16,\r\n                            backgroundColor: colors.cardBackground,\r\n                            minHeight: 100,\r\n                            textAlignVertical: \"top\"\r\n                        }}\r\n                    />\r\n                </View>\r\n\r\n                {/* Type Selection */}\r\n                <View style={{ marginBottom: 24 }}>\r\n                    <Text style={{ color: colors.textSecondary, marginBottom: 12 }}>Type</Text>\r\n                    <ScrollView horizontal showsHorizontalScrollIndicator={false}>\r\n                        <View style={{ flexDirection: \"row\", gap: 8 }}>\r\n                            {notificationTypes.map(t => (\r\n                                <Pressable\r\n                                    key={t}\r\n                                    onPress={() => setType(t)}\r\n                                    style={{\r\n                                        paddingHorizontal: 16,\r\n                                        paddingVertical: 10,\r\n                                        backgroundColor: type === t ? colors.primary : colors.cardBackground,\r\n                                        borderRadius: 20,\r\n                                        borderWidth: 1,\r\n                                        borderColor: type === t ? colors.primary : colors.textSecondary + \"20\"\r\n                                    }}\r\n                                >\r\n                                    <Text style={{ color: type === t ? \"#fff\" : colors.textPrimary, fontWeight: \"600\" }}>\r\n                                        {t}\r\n                                    </Text>\r\n                                </Pressable>\r\n                            ))}\r\n                        </View>\r\n                    </ScrollView>\r\n                </View>\r\n\r\n                {/* Target Selection */}\r\n                <View style={{ marginBottom: 24 }}>\r\n                    <Text style={{ color: colors.textSecondary, marginBottom: 12 }}>Target Audience</Text>\r\n                    <View style={{ flexDirection: \"row\", gap: 12 }}>\r\n                        <Pressable\r\n                            onPress={() => setTarget('all')}\r\n                            style={{\r\n                                flex: 1,\r\n                                padding: 16,\r\n                                backgroundColor: target === 'all' ? colors.primary + \"15\" : colors.cardBackground,\r\n                                borderWidth: 1,\r\n                                borderColor: target === 'all' ? colors.primary : colors.textSecondary + \"20\",\r\n                                borderRadius: 12,\r\n                                alignItems: \"center\"\r\n                            }}\r\n                        >\r\n                            <MaterialIcons name=\"public\" size={24} color={target === 'all' ? colors.primary : colors.textSecondary} />\r\n                            <Text style={{ marginTop: 8, color: target === 'all' ? colors.primary : colors.textPrimary, fontWeight: \"600\" }}>\r\n                                Everyone\r\n                            </Text>\r\n                        </Pressable>\r\n\r\n                        <Pressable\r\n                            onPress={() => setTarget('class')}\r\n                            style={{\r\n                                flex: 1,\r\n                                padding: 16,\r\n                                backgroundColor: target === 'class' ? colors.primary + \"15\" : colors.cardBackground,\r\n                                borderWidth: 1,\r\n                                borderColor: target === 'class' ? colors.primary : colors.textSecondary + \"20\",\r\n                                borderRadius: 12,\r\n                                alignItems: \"center\"\r\n                            }}\r\n                        >\r\n                            <MaterialIcons name=\"class\" size={24} color={target === 'class' ? colors.primary : colors.textSecondary} />\r\n                            <Text style={{ marginTop: 8, color: target === 'class' ? colors.primary : colors.textPrimary, fontWeight: \"600\" }}>\r\n                                Specific Class\r\n                            </Text>\r\n                        </Pressable>\r\n                        <Pressable\r\n                            onPress={() => setTarget('teacher')}\r\n                            style={{\r\n                                flex: 1,\r\n                                padding: 16,\r\n                                backgroundColor: target === 'teacher' ? colors.primary + \"15\" : colors.cardBackground,\r\n                                borderWidth: 1,\r\n                                borderColor: target === 'teacher' ? colors.primary : colors.textSecondary + \"20\",\r\n                                borderRadius: 12,\r\n                                alignItems: \"center\"\r\n                            }}\r\n                        >\r\n                            <MaterialIcons name=\"school\" size={24} color={target === 'teacher' ? colors.primary : colors.textSecondary} />\r\n                            <Text style={{ marginTop: 8, color: target === 'teacher' ? colors.primary : colors.textPrimary, fontWeight: \"600\" }}>\r\n                                Teachers\r\n                            </Text>\r\n                        </Pressable>\r\n\r\n                        <Pressable\r\n                            onPress={() => setTarget('staff')}\r\n                            style={{\r\n                                flex: 1,\r\n                                padding: 16,\r\n                                backgroundColor: target === 'staff' ? colors.primary + \"15\" : colors.cardBackground,\r\n                                borderWidth: 1,\r\n                                borderColor: target === 'staff' ? colors.primary : colors.textSecondary + \"20\",\r\n                                borderRadius: 12,\r\n                                alignItems: \"center\"\r\n                            }}\r\n                        >\r\n                            <MaterialIcons name=\"badge\" size={24} color={target === 'staff' ? colors.primary : colors.textSecondary} />\r\n                            <Text style={{ marginTop: 8, color: target === 'staff' ? colors.primary : colors.textPrimary, fontWeight: \"600\" }}>\r\n                                Staff\r\n                            </Text>\r\n                        </Pressable>\r\n                    </View>\r\n                </View>\r\n\r\n                {/* Class Dropdown (if target is class) */}\r\n                {target === 'class' && (\r\n                    <View style={{ marginBottom: 24 }}>\r\n                        <Text style={{ color: colors.textSecondary, marginBottom: 8 }}>Select Class</Text>\r\n                        <ScrollView horizontal showsHorizontalScrollIndicator={false}>\r\n                            <View style={{ flexDirection: \"row\", gap: 8 }}>\r\n                                {classes.map(cls => (\r\n                                    <Pressable\r\n                                        key={cls._id}\r\n                                        onPress={() => setSelectedClass(cls._id)}\r\n                                        style={{\r\n                                            paddingHorizontal: 16,\r\n                                            paddingVertical: 10,\r\n                                            backgroundColor: selectedClass === cls._id ? colors.primary : colors.cardBackground,\r\n                                            borderRadius: 12,\r\n                                            borderWidth: 1,\r\n                                            borderColor: selectedClass === cls._id ? colors.primary : colors.textSecondary + \"20\"\r\n                                        }}\r\n                                    >\r\n                                        <Text style={{ color: selectedClass === cls._id ? \"#fff\" : colors.textPrimary }}>\r\n                                            {cls.name}\r\n                                        </Text>\r\n                                    </Pressable>\r\n                                ))}\r\n                            </View>\r\n                        </ScrollView>\r\n                    </View>\r\n                )}\r\n\r\n                {/* Send Button */}\r\n                <Pressable\r\n                    onPress={handleSend}\r\n                    disabled={sendNotificationMutation.isPending}\r\n                    style={{\r\n                        backgroundColor: colors.primary,\r\n                        padding: 18,\r\n                        borderRadius: 16,\r\n                        alignItems: \"center\",\r\n                        marginTop: 12,\r\n                        opacity: sendNotificationMutation.isPending ? 0.7 : 1,\r\n                        shadowColor: colors.primary,\r\n                        shadowOffset: { width: 0, height: 4 },\r\n                        shadowOpacity: 0.2,\r\n                        shadowRadius: 8,\r\n                        elevation: 4\r\n                    }}\r\n                >\r\n                    {sendNotificationMutation.isPending ? (\r\n                        <ActivityIndicator color=\"#fff\" />\r\n                    ) : (\r\n                        <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 8 }}>\r\n                            <MaterialIcons name=\"send\" size={20} color=\"#fff\" />\r\n                            <Text style={{ color: \"#fff\", fontSize: 18, fontFamily: \"DMSans-Bold\" }}>\r\n                                Send Notification\r\n                            </Text>\r\n                        </View>\r\n                    )}\r\n                </Pressable>\r\n\r\n            </ScrollView>\r\n        </View>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\admin\\subjects.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":36},{"ruleId":"no-unused-vars","severity":1,"message":"'AsyncStorage' is defined but never used. Allowed unused vars must match /^_/u.","line":16,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":25,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":26,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":19},{"ruleId":"no-undef","severity":2,"message":"'useToast' is not defined.","line":27,"column":27,"nodeType":"Identifier","messageId":"undef","endLine":27,"endColumn":35}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    Pressable,\r\n    TextInput,\r\n    Alert,\r\n    RefreshControl,\r\n    ActivityIndicator,\r\n    Modal,\r\n    KeyboardAvoidingView,\r\n    Platform\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useRouter } from \"expo-router\";\r\nimport { useTheme } from \"../../theme\";\r\nimport { useApiQuery, useApiMutation, createApiMutationFn } from \"../../hooks/useApi\";\r\nimport apiConfig from \"../../config/apiConfig\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport AppHeader from \"../../components/Header\";\r\n\r\nexport default function ManageSubjectsScreen() {\r\n    const router = useRouter();\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n\r\n    const queryClient = useQueryClient();\r\n    const [searchQuery, setSearchQuery] = useState(\"\");\r\n    const [refreshing, setRefreshing] = useState(false);\r\n\r\n    // Create/Edit Modal\r\n    const [showModal, setShowModal] = useState(false);\r\n    const [modalMode, setModalMode] = useState(\"add\"); // \"add\" | \"edit\"\r\n    const [editingSubject, setEditingSubject] = useState(null);\r\n    const [form, setForm] = useState({ name: \"\", code: \"\", type: \"Theory\" });\r\n\r\n    // Details Modal\r\n    const [showDetailsModal, setShowDetailsModal] = useState(false);\r\n    const [selectedSubject, setSelectedSubject] = useState(null);\r\n\r\n    // Fetch Subjects\r\n    const { data: subjects = [], isLoading: loading, refetch: refetchSubjects } = useApiQuery(\r\n        ['adminSubjects'],\r\n        `${apiConfig.baseUrl}/subjects`\r\n    );\r\n\r\n    // Fetch Usage Details\r\n    const { data: usageDetails = [], isLoading: loadingDetails } = useApiQuery(\r\n        ['subjectUsage', selectedSubject?._id],\r\n        `${apiConfig.baseUrl}/subjects/${selectedSubject?._id}/usage`,\r\n        { enabled: !!selectedSubject && showDetailsModal }\r\n    );\r\n\r\n    // Mutations\r\n    const saveSubjectMutation = useApiMutation({\r\n        mutationFn: (data) => {\r\n            const url = modalMode === \"add\"\r\n                ? `${apiConfig.baseUrl}/subjects`\r\n                : `${apiConfig.baseUrl}/subjects/${editingSubject._id}`;\r\n            const method = modalMode === \"add\" ? \"POST\" : \"PUT\";\r\n            return createApiMutationFn(url, method)(data);\r\n        },\r\n        onSuccess: () => {\r\n            showToast(`Subject ${modalMode === \"add\" ? \"created\" : \"updated\"}`, \"success\");\r\n            setShowModal(false);\r\n            setForm({ name: \"\", code: \"\", type: \"Theory\" });\r\n            queryClient.invalidateQueries({ queryKey: ['adminSubjects'] });\r\n        },\r\n        onError: (error) => showToast(error.message || \"Failed to save\", \"error\")\r\n    });\r\n\r\n    const deleteSubjectMutation = useApiMutation({\r\n        mutationFn: (id) => createApiMutationFn(`${apiConfig.baseUrl}/subjects/${id}`, 'DELETE')(),\r\n        onSuccess: () => {\r\n            showToast(\"Subject deleted\", \"success\");\r\n            queryClient.invalidateQueries({ queryKey: ['adminSubjects'] });\r\n        },\r\n        onError: (error) => showToast(error.message || \"Failed to delete\", \"error\")\r\n    });\r\n\r\n    const handleSave = () => {\r\n        if (!form.name) {\r\n            showToast(\"Subject name is required\", \"error\");\r\n            return;\r\n        }\r\n        saveSubjectMutation.mutate(form);\r\n    };\r\n\r\n    const handleDelete = (id, name) => {\r\n        Alert.alert(\r\n            \"Delete Subject\",\r\n            `Are you sure you want to delete ${name}?`,\r\n            [\r\n                { text: \"Cancel\", style: \"cancel\" },\r\n                {\r\n                    text: \"Delete\",\r\n                    style: \"destructive\",\r\n                    onPress: () => deleteSubjectMutation.mutate(id)\r\n                }\r\n            ]\r\n        );\r\n    };\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        await refetchSubjects();\r\n        setRefreshing(false);\r\n    };\r\n\r\n    const filteredSubjects = subjects.filter(s =>\r\n        s.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        (s.code && s.code.toLowerCase().includes(searchQuery.toLowerCase()))\r\n    );\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <View style={{ padding: 16, paddingTop: 24 }}>\r\n                <AppHeader title=\"Manage Subjects\" subtitle=\"Master List\" showBack />\r\n\r\n                {/* Search */}\r\n                <View style={{\r\n                    flexDirection: \"row\",\r\n                    alignItems: \"center\",\r\n                    backgroundColor: colors.cardBackground,\r\n                    borderRadius: 12,\r\n                    paddingHorizontal: 16,\r\n                    height: 50,\r\n                    marginTop: 16,\r\n                    borderWidth: 1,\r\n                    borderColor: colors.border\r\n                }}>\r\n                    <MaterialIcons name=\"search\" size={22} color={colors.textSecondary} />\r\n                    <TextInput\r\n                        style={{ flex: 1, marginLeft: 12, fontSize: 16, color: colors.textPrimary }}\r\n                        placeholder=\"Search subjects...\"\r\n                        placeholderTextColor={colors.textSecondary}\r\n                        value={searchQuery}\r\n                        onChangeText={setSearchQuery}\r\n                    />\r\n                </View>\r\n            </View>\r\n\r\n            <ScrollView\r\n                refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} />}\r\n                contentContainerStyle={{ padding: 16, paddingBottom: 100 }}\r\n            >\r\n                {loading ? (\r\n                    <ActivityIndicator size=\"large\" color={colors.primary} style={{ marginTop: 40 }} />\r\n                ) : filteredSubjects.length === 0 ? (\r\n                    <View style={{ alignItems: \"center\", marginTop: 40, opacity: 0.6 }}>\r\n                        <MaterialIcons name=\"menu-book\" size={48} color={colors.textSecondary} />\r\n                        <Text style={{ color: colors.textSecondary, marginTop: 16 }}>No subjects found</Text>\r\n                    </View>\r\n                ) : (\r\n                    filteredSubjects.map((subject) => (\r\n                        <Pressable\r\n                            key={subject._id}\r\n                            onPress={() => {\r\n                                setSelectedSubject(subject);\r\n                                setShowDetailsModal(true);\r\n                            }}\r\n                            style={({ pressed }) => ({\r\n                                backgroundColor: colors.cardBackground,\r\n                                borderRadius: 16,\r\n                                padding: 16,\r\n                                marginBottom: 12,\r\n                                flexDirection: \"row\",\r\n                                justifyContent: \"space-between\",\r\n                                alignItems: \"center\",\r\n                                opacity: pressed ? 0.9 : 1,\r\n                                shadowColor: \"#000\",\r\n                                shadowOffset: { width: 0, height: 1 },\r\n                                shadowOpacity: 0.05,\r\n                                shadowRadius: 2,\r\n                                elevation: 1\r\n                            })}\r\n                        >\r\n                            <View>\r\n                                <Text style={{ fontSize: 16, fontWeight: \"600\", color: colors.textPrimary }}>\r\n                                    {subject.name}\r\n                                </Text>\r\n                                <View style={{ flexDirection: \"row\", gap: 8, marginTop: 4 }}>\r\n                                    {subject.code && (\r\n                                        <Text style={{ fontSize: 12, color: colors.textSecondary, backgroundColor: colors.background, paddingHorizontal: 6, paddingVertical: 2, borderRadius: 4 }}>\r\n                                            {subject.code}\r\n                                        </Text>\r\n                                    )}\r\n                                    <Text style={{ fontSize: 12, color: colors.textSecondary, backgroundColor: colors.background, paddingHorizontal: 6, paddingVertical: 2, borderRadius: 4 }}>\r\n                                        {subject.type}\r\n                                    </Text>\r\n                                </View>\r\n                            </View>\r\n\r\n                            <View style={{ flexDirection: \"row\", gap: 8 }}>\r\n                                <Pressable\r\n                                    onPress={(e) => {\r\n                                        e.stopPropagation();\r\n                                        setModalMode(\"edit\");\r\n                                        setEditingSubject(subject);\r\n                                        setForm({ name: subject.name, code: subject.code || \"\", type: subject.type });\r\n                                        setShowModal(true);\r\n                                    }}\r\n                                    style={{ padding: 8, backgroundColor: colors.background, borderRadius: 8 }}\r\n                                >\r\n                                    <MaterialIcons name=\"edit\" size={18} color={colors.textSecondary} />\r\n                                </Pressable>\r\n                                <Pressable\r\n                                    onPress={(e) => {\r\n                                        e.stopPropagation();\r\n                                        handleDelete(subject._id, subject.name);\r\n                                    }}\r\n                                    style={{ padding: 8, backgroundColor: colors.error + \"15\", borderRadius: 8 }}\r\n                                >\r\n                                    <MaterialIcons name=\"delete-outline\" size={18} color={colors.error} />\r\n                                </Pressable>\r\n                            </View>\r\n                        </Pressable>\r\n                    ))\r\n                )}\r\n            </ScrollView>\r\n\r\n            {/* FAB */}\r\n            <Pressable\r\n                onPress={() => {\r\n                    setModalMode(\"add\");\r\n                    setForm({ name: \"\", code: \"\", type: \"Theory\" });\r\n                    setShowModal(true);\r\n                }}\r\n                style={{\r\n                    position: \"absolute\",\r\n                    bottom: 110,\r\n                    right: 24,\r\n                    backgroundColor: colors.primary,\r\n                    width: 56,\r\n                    height: 56,\r\n                    borderRadius: 28,\r\n                    justifyContent: \"center\",\r\n                    alignItems: \"center\",\r\n                    elevation: 6,\r\n                    shadowColor: colors.primary,\r\n                    shadowOffset: { width: 0, height: 4 },\r\n                    shadowOpacity: 0.3,\r\n                    shadowRadius: 8\r\n                }}\r\n            >\r\n                <MaterialIcons name=\"add\" size={28} color=\"#fff\" />\r\n            </Pressable>\r\n\r\n            {/* Create/Edit Modal */}\r\n            <Modal visible={showModal} animationType=\"slide\" transparent onRequestClose={() => setShowModal(false)}>\r\n                <KeyboardAvoidingView behavior={Platform.OS === \"ios\" ? \"padding\" : \"height\"} style={{ flex: 1, justifyContent: \"flex-end\", backgroundColor: \"rgba(0,0,0,0.5)\" }}>\r\n                    <View style={{ backgroundColor: colors.cardBackground, borderTopLeftRadius: 24, borderTopRightRadius: 24, padding: 24 }}>\r\n                        <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\", marginBottom: 24 }}>\r\n                            <Text style={{ fontSize: 20, fontWeight: \"700\", color: colors.textPrimary }}>\r\n                                {modalMode === \"add\" ? \"New Subject\" : \"Edit Subject\"}\r\n                            </Text>\r\n                            <Pressable onPress={() => setShowModal(false)}>\r\n                                <MaterialIcons name=\"close\" size={24} color={colors.textSecondary} />\r\n                            </Pressable>\r\n                        </View>\r\n\r\n                        <Text style={{ fontSize: 13, fontWeight: \"600\", color: colors.textSecondary, marginBottom: 8 }}>NAME</Text>\r\n                        <TextInput\r\n                            style={{\r\n                                backgroundColor: colors.background,\r\n                                borderRadius: 12,\r\n                                padding: 12,\r\n                                fontSize: 16,\r\n                                color: colors.textPrimary,\r\n                                marginBottom: 16\r\n                            }}\r\n                            placeholder=\"e.g. Mathematics\"\r\n                            placeholderTextColor={colors.textSecondary}\r\n                            value={form.name}\r\n                            onChangeText={(t) => setForm({ ...form, name: t })}\r\n                        />\r\n\r\n                        <Text style={{ fontSize: 13, fontWeight: \"600\", color: colors.textSecondary, marginBottom: 8 }}>CODE (Optional)</Text>\r\n                        <TextInput\r\n                            style={{\r\n                                backgroundColor: colors.background,\r\n                                borderRadius: 12,\r\n                                padding: 12,\r\n                                fontSize: 16,\r\n                                color: colors.textPrimary,\r\n                                marginBottom: 16\r\n                            }}\r\n                            placeholder=\"e.g. MATH101\"\r\n                            placeholderTextColor={colors.textSecondary}\r\n                            value={form.code}\r\n                            onChangeText={(t) => setForm({ ...form, code: t })}\r\n                            autoCapitalize=\"characters\"\r\n                        />\r\n\r\n                        <Text style={{ fontSize: 13, fontWeight: \"600\", color: colors.textSecondary, marginBottom: 8 }}>TYPE</Text>\r\n                        <View style={{ flexDirection: \"row\", gap: 8, marginBottom: 24 }}>\r\n                            {[\"Theory\", \"Practical\", \"Other\"].map((type) => (\r\n                                <Pressable\r\n                                    key={type}\r\n                                    onPress={() => setForm({ ...form, type })}\r\n                                    style={{\r\n                                        paddingHorizontal: 16,\r\n                                        paddingVertical: 8,\r\n                                        backgroundColor: form.type === type ? colors.primary : colors.background,\r\n                                        borderRadius: 20,\r\n                                        borderWidth: 1,\r\n                                        borderColor: form.type === type ? colors.primary : colors.border\r\n                                    }}\r\n                                >\r\n                                    <Text style={{ color: form.type === type ? \"#fff\" : colors.textSecondary, fontWeight: \"600\" }}>{type}</Text>\r\n                                </Pressable>\r\n                            ))}\r\n                        </View>\r\n\r\n                        <Pressable\r\n                            onPress={handleSave}\r\n                            disabled={saveSubjectMutation.isPending}\r\n                            style={{\r\n                                backgroundColor: colors.primary,\r\n                                padding: 16,\r\n                                borderRadius: 16,\r\n                                alignItems: \"center\",\r\n                                opacity: saveSubjectMutation.isPending ? 0.7 : 1\r\n                            }}\r\n                        >\r\n                            {saveSubjectMutation.isPending ? (\r\n                                <ActivityIndicator color=\"#fff\" />\r\n                            ) : (\r\n                                <Text style={{ color: \"#fff\", fontSize: 16, fontWeight: \"600\" }}>\r\n                                    {modalMode === \"add\" ? \"Create Subject\" : \"Save Changes\"}\r\n                                </Text>\r\n                            )}\r\n                        </Pressable>\r\n                    </View >\r\n                </KeyboardAvoidingView >\r\n            </Modal >\r\n\r\n            {/* Details Modal */}\r\n            < Modal visible={showDetailsModal} animationType=\"slide\" transparent onRequestClose={() => setShowDetailsModal(false)\r\n            }>\r\n                <View style={{ flex: 1, justifyContent: \"flex-end\", backgroundColor: \"rgba(0,0,0,0.5)\" }}>\r\n                    <View style={{ backgroundColor: colors.cardBackground, borderTopLeftRadius: 24, borderTopRightRadius: 24, padding: 24, maxHeight: \"80%\" }}>\r\n                        <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\", marginBottom: 16 }}>\r\n                            <View>\r\n                                <Text style={{ fontSize: 20, fontWeight: \"700\", color: colors.textPrimary }}>\r\n                                    {selectedSubject?.name}\r\n                                </Text>\r\n                                <Text style={{ color: colors.textSecondary, fontSize: 14 }}>Usage Details</Text>\r\n                            </View>\r\n                            <Pressable onPress={() => setShowDetailsModal(false)}>\r\n                                <MaterialIcons name=\"close\" size={24} color={colors.textSecondary} />\r\n                            </Pressable>\r\n                        </View>\r\n\r\n                        {loadingDetails ? (\r\n                            <ActivityIndicator size=\"large\" color={colors.primary} style={{ marginVertical: 40 }} />\r\n                        ) : usageDetails.length === 0 ? (\r\n                            <View style={{ padding: 20, alignItems: \"center\" }}>\r\n                                <Text style={{ color: colors.textSecondary }}>Not used in any classes yet.</Text>\r\n                            </View>\r\n                        ) : (\r\n                            <ScrollView>\r\n                                {usageDetails.map((usage, index) => (\r\n                                    <View key={index} style={{ marginBottom: 16, padding: 12, backgroundColor: colors.background, borderRadius: 12 }}>\r\n                                        <Text style={{ fontSize: 16, fontWeight: \"600\", color: colors.textPrimary }}>\r\n                                            {usage.class?.name} {usage.class?.section ? `(${usage.class.section})` : \"\"}\r\n                                        </Text>\r\n                                        <Text style={{ fontSize: 12, color: colors.textSecondary, marginBottom: 8 }}>\r\n                                            {usage.class?.branch}\r\n                                        </Text>\r\n\r\n                                        <Text style={{ fontSize: 13, fontWeight: \"600\", color: colors.textSecondary, marginBottom: 4 }}>TEACHERS</Text>\r\n                                        <View style={{ flexDirection: \"row\", flexWrap: \"wrap\", gap: 6 }}>\r\n                                            {usage.teachers && usage.teachers.length > 0 ? (\r\n                                                usage.teachers.map(t => (\r\n                                                    <View key={t._id} style={{ backgroundColor: colors.cardBackground, paddingHorizontal: 8, paddingVertical: 4, borderRadius: 6, borderWidth: 1, borderColor: colors.border }}>\r\n                                                        <Text style={{ fontSize: 12, color: colors.textPrimary }}>{t.name}</Text>\r\n                                                    </View>\r\n                                                ))\r\n                                            ) : (\r\n                                                <Text style={{ fontSize: 12, color: colors.textSecondary, fontStyle: \"italic\" }}>No teachers assigned</Text>\r\n                                            )}\r\n                                        </View>\r\n                                    </View>\r\n                                ))}\r\n                            </ScrollView>\r\n                        )}\r\n                    </View>\r\n                </View>\r\n            </Modal >\r\n        </View >\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\admin\\teacher-subjects.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":36},{"ruleId":"no-unused-vars","severity":1,"message":"'AsyncStorage' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":22,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":23,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":19},{"ruleId":"no-undef","severity":2,"message":"'useToast' is not defined.","line":24,"column":27,"nodeType":"Identifier","messageId":"undef","endLine":24,"endColumn":35},{"ruleId":"no-unused-vars","severity":1,"message":"'variables' is defined but never used. Allowed unused args must match /^_/u.","line":62,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":62,"endColumn":39},{"ruleId":"no-unused-vars","severity":1,"message":"'error' is defined but never used. Allowed unused args must match /^_/u.","line":70,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":70,"endColumn":24},{"ruleId":"no-unused-vars","severity":1,"message":"'error' is defined but never used. Allowed unused args must match /^_/u.","line":88,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":88,"endColumn":24}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    Pressable,\r\n    TextInput,\r\n    RefreshControl,\r\n    ActivityIndicator,\r\n    Modal,\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useRouter } from \"expo-router\";\r\nimport { useTheme } from \"../../theme\";\r\nimport { useApiQuery, useApiMutation, createApiMutationFn } from \"../../hooks/useApi\";\r\nimport apiConfig from \"../../config/apiConfig\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport AppHeader from \"../../components/Header\";\r\n\r\nexport default function TeacherSubjectsScreen() {\r\n    const router = useRouter();\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n\r\n    const queryClient = useQueryClient();\r\n    const [refreshing, setRefreshing] = useState(false);\r\n    const [searchQuery, setSearchQuery] = useState(\"\");\r\n    const [selectedTeacher, setSelectedTeacher] = useState(null);\r\n    const [showModal, setShowModal] = useState(false);\r\n    const [selectedSubjects, setSelectedSubjects] = useState([]);\r\n\r\n    // Auth check is handled by _layout.jsx generally, but we can keep role check if needed or rely on backend\r\n    // For now assuming auth is fine as per other refactors\r\n\r\n    // Fetch Data\r\n    const { data, isLoading: loading, refetch: refetchData } = useApiQuery(\r\n        ['teacherSubjectMatrix'],\r\n        `${apiConfig.baseUrl}/teachers/admin/teacher-subject-matrix`\r\n    );\r\n\r\n    const teachers = data?.teachers || [];\r\n    const subjects = data?.subjects || [];\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        await refetchData();\r\n        setRefreshing(false);\r\n    };\r\n\r\n    // Mutations\r\n    const assignSubjectsMutation = useApiMutation({\r\n        mutationFn: async ({ teacherId, subjectIds }) => {\r\n            // We need to handle multiple assignments. The backend seems to take one at a time based on original code loop.\r\n            // Or we can check if there is a bulk endpoint. The original code looped.\r\n            // Let's loop here in the mutation function or use Promise.all\r\n            const promises = subjectIds.map(subjectId =>\r\n                createApiMutationFn(`${apiConfig.baseUrl}/teachers/subjects/${subjectId}/assign`, 'POST')({ teacherId })\r\n            );\r\n            return Promise.all(promises);\r\n        },\r\n        onSuccess: (results, variables) => {\r\n            const successCount = results.length; // Assuming all promises resolved if we are here (Promise.all rejects on first error, maybe use allSettled if we want partial success)\r\n            // Actually createApiMutationFn throws on error, so if we get here, all succeeded.\r\n            showToast(`Successfully assigned ${successCount} subject(s) to ${selectedTeacher.name}`, \"success\");\r\n            queryClient.invalidateQueries({ queryKey: ['teacherSubjectMatrix'] });\r\n            setSelectedSubjects([]);\r\n            setShowModal(false);\r\n        },\r\n        onError: (error) => showToast(\"Error assigning subjects\", \"error\")\r\n    });\r\n\r\n    const removeSubjectMutation = useApiMutation({\r\n        mutationFn: ({ subjectId, teacherId }) =>\r\n            createApiMutationFn(`${apiConfig.baseUrl}/teachers/subjects/${subjectId}/teachers/${teacherId}`, 'DELETE')(),\r\n        onSuccess: (data, variables) => {\r\n            // Find teacher name for the message\r\n            const teacher = teachers.find(t => t._id === variables.teacherId);\r\n            const teacherName = teacher ? teacher.name : \"Teacher\";\r\n\r\n            // Find subject name\r\n            const subject = subjects.find(s => s._id === variables.subjectId);\r\n            const subjectName = subject ? subject.name : \"Subject\";\r\n\r\n            showToast(`Removed ${teacherName} from ${subjectName}`, \"success\");\r\n            queryClient.invalidateQueries({ queryKey: ['teacherSubjectMatrix'] });\r\n        },\r\n        onError: (error) => showToast(\"Failed to remove teacher from subject\", \"error\")\r\n    });\r\n\r\n    const filteredTeachers = teachers.filter(teacher =>\r\n        teacher.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        teacher.email?.toLowerCase().includes(searchQuery.toLowerCase())\r\n    );\r\n\r\n    const handleAssignMultipleSubjects = () => {\r\n        if (selectedSubjects.length === 0) {\r\n            showToast(\"Please select at least one subject\", \"error\");\r\n            return;\r\n        }\r\n\r\n        assignSubjectsMutation.mutate({\r\n            teacherId: selectedTeacher._id,\r\n            subjectIds: selectedSubjects\r\n        });\r\n    };\r\n\r\n    const handleRemoveSubject = (subjectId, teacherId) => {\r\n        removeSubjectMutation.mutate({ subjectId, teacherId });\r\n    };\r\n\r\n    const toggleSubjectSelection = (subjectId) => {\r\n        setSelectedSubjects(prev => {\r\n            if (prev.includes(subjectId)) {\r\n                return prev.filter(id => id !== subjectId);\r\n            } else {\r\n                return [...prev, subjectId];\r\n            }\r\n        });\r\n    };\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <ScrollView\r\n                refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} />}\r\n                contentContainerStyle={{ paddingBottom: 100 }}\r\n            >\r\n                <View style={{ padding: 16, paddingTop: 24 }}>\r\n                    <AppHeader\r\n                        title=\"Teacher-Subject Assignments\"\r\n                        subtitle=\"Manage which teachers teach which subjects\"\r\n                    />\r\n\r\n                    {/* Search Bar */}\r\n                    <View style={{\r\n                        flexDirection: \"row\",\r\n                        alignItems: \"center\",\r\n                        backgroundColor: colors.cardBackground,\r\n                        borderRadius: 12,\r\n                        paddingHorizontal: 16,\r\n                        height: 50,\r\n                        marginTop: 16,\r\n                        marginBottom: 20,\r\n                        shadowColor: \"#000\",\r\n                        shadowOffset: { width: 0, height: 2 },\r\n                        shadowOpacity: 0.05,\r\n                        shadowRadius: 8,\r\n                        elevation: 2,\r\n                    }}>\r\n                        <MaterialIcons name=\"search\" size={22} color={colors.textSecondary} />\r\n                        <TextInput\r\n                            style={{\r\n                                flex: 1,\r\n                                marginLeft: 12,\r\n                                fontSize: 16,\r\n                                color: colors.textPrimary,\r\n                                height: \"100%\",\r\n                            }}\r\n                            placeholder=\"Search teachers...\"\r\n                            placeholderTextColor={colors.textSecondary}\r\n                            value={searchQuery}\r\n                            onChangeText={setSearchQuery}\r\n                        />\r\n                        {searchQuery.length > 0 && (\r\n                            <Pressable onPress={() => setSearchQuery(\"\")}>\r\n                                <MaterialIcons name=\"close\" size={20} color={colors.textSecondary} />\r\n                            </Pressable>\r\n                        )}\r\n                    </View>\r\n\r\n                    {loading ? (\r\n                        <View style={{ flex: 1, justifyContent: \"center\", alignItems: \"center\", marginTop: 100 }}>\r\n                            <ActivityIndicator size=\"large\" color={colors.primary} />\r\n                        </View>\r\n                    ) : (\r\n                        <>\r\n                            {/* Teachers List */}\r\n                            {filteredTeachers.length === 0 ? (\r\n                                <View style={{ alignItems: \"center\", marginTop: 60, opacity: 0.6 }}>\r\n                                    <MaterialIcons name=\"search-off\" size={56} color={colors.textSecondary} />\r\n                                    <Text style={{\r\n                                        color: colors.textSecondary,\r\n                                        marginTop: 20,\r\n                                        fontSize: 16,\r\n                                        fontFamily: \"DMSans-Medium\"\r\n                                    }}>\r\n                                        No teachers found\r\n                                    </Text>\r\n                                </View>\r\n                            ) : (\r\n                                filteredTeachers.map((teacher) => (\r\n                                    <View\r\n                                        key={teacher._id}\r\n                                        style={{\r\n                                            backgroundColor: colors.cardBackground,\r\n                                            borderRadius: 16,\r\n                                            padding: 16,\r\n                                            marginBottom: 16,\r\n                                            shadowColor: \"#000\",\r\n                                            shadowOffset: { width: 0, height: 2 },\r\n                                            shadowOpacity: 0.05,\r\n                                            shadowRadius: 6,\r\n                                            elevation: 2,\r\n                                        }}\r\n                                    >\r\n                                        {/* Teacher Header */}\r\n                                        <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"flex-start\", marginBottom: 12 }}>\r\n                                            <View style={{ flex: 1 }}>\r\n                                                <Text style={{\r\n                                                    fontSize: 18,\r\n                                                    fontFamily: \"DMSans-Bold\",\r\n                                                    color: colors.textPrimary\r\n                                                }}>\r\n                                                    {teacher.name}\r\n                                                </Text>\r\n                                                {teacher.email && (\r\n                                                    <Text style={{\r\n                                                        fontSize: 13,\r\n                                                        color: colors.textSecondary,\r\n                                                        fontFamily: \"DMSans-Regular\",\r\n                                                        marginTop: 2\r\n                                                    }}>\r\n                                                        {teacher.email}\r\n                                                    </Text>\r\n                                                )}\r\n                                                <View style={{\r\n                                                    backgroundColor: colors.primary + \"15\",\r\n                                                    alignSelf: \"flex-start\",\r\n                                                    paddingHorizontal: 8,\r\n                                                    paddingVertical: 2,\r\n                                                    borderRadius: 4,\r\n                                                    marginTop: 6\r\n                                                }}>\r\n                                                    <Text style={{\r\n                                                        fontSize: 11,\r\n                                                        color: colors.primary,\r\n                                                        fontFamily: \"DMSans-Bold\",\r\n                                                        textTransform: \"uppercase\"\r\n                                                    }}>\r\n                                                        {teacher.role}\r\n                                                    </Text>\r\n                                                </View>\r\n                                            </View>\r\n\r\n                                            <Pressable\r\n                                                onPress={() => {\r\n                                                    setSelectedTeacher(teacher);\r\n                                                    setSelectedSubjects([]);\r\n                                                    setShowModal(true);\r\n                                                }}\r\n                                                style={({ pressed }) => ({\r\n                                                    backgroundColor: colors.primary,\r\n                                                    paddingHorizontal: 14,\r\n                                                    paddingVertical: 8,\r\n                                                    borderRadius: 8,\r\n                                                    opacity: pressed ? 0.8 : 1\r\n                                                })}\r\n                                            >\r\n                                                <Text style={{\r\n                                                    color: \"#fff\",\r\n                                                    fontSize: 13,\r\n                                                    fontFamily: \"DMSans-Bold\"\r\n                                                }}>\r\n                                                    Assign\r\n                                                </Text>\r\n                                            </Pressable>\r\n                                        </View>\r\n\r\n                                        {/* Assigned Subjects */}\r\n                                        {teacher.subjects && teacher.subjects.length > 0 ? (\r\n                                            <>\r\n                                                <Text style={{\r\n                                                    fontSize: 12,\r\n                                                    fontFamily: \"DMSans-Bold\",\r\n                                                    color: colors.textSecondary,\r\n                                                    marginBottom: 8,\r\n                                                    textTransform: \"uppercase\"\r\n                                                }}>\r\n                                                    Assigned Subjects ({teacher.subjects.length})\r\n                                                </Text>\r\n                                                {teacher.subjects.map((subject) => (\r\n                                                    <View\r\n                                                        key={subject._id}\r\n                                                        style={{\r\n                                                            flexDirection: \"row\",\r\n                                                            justifyContent: \"space-between\",\r\n                                                            alignItems: \"center\",\r\n                                                            backgroundColor: colors.background,\r\n                                                            borderRadius: 8,\r\n                                                            padding: 10,\r\n                                                            marginBottom: 6\r\n                                                        }}\r\n                                                    >\r\n                                                        <View style={{ flex: 1 }}>\r\n                                                            <Text style={{\r\n                                                                fontSize: 15,\r\n                                                                fontFamily: \"DMSans-SemiBold\",\r\n                                                                color: colors.textPrimary\r\n                                                            }}>\r\n                                                                {subject.name}\r\n                                                            </Text>\r\n                                                            <Text style={{\r\n                                                                fontSize: 12,\r\n                                                                color: colors.textSecondary,\r\n                                                                fontFamily: \"DMSans-Regular\",\r\n                                                                marginTop: 2\r\n                                                            }}>\r\n                                                                {subject.class.name} {subject.class.section ? `- ${subject.class.section}` : \"\"}\r\n                                                            </Text>\r\n                                                        </View>\r\n                                                        <Pressable\r\n                                                            onPress={() => handleRemoveSubject(subject._id, teacher._id)}\r\n                                                            style={({ pressed }) => ({\r\n                                                                padding: 6,\r\n                                                                backgroundColor: colors.error + \"15\",\r\n                                                                borderRadius: 6,\r\n                                                                opacity: pressed ? 0.7 : 1\r\n                                                            })}\r\n                                                        >\r\n                                                            <MaterialIcons name=\"close\" size={18} color={colors.error} />\r\n                                                        </Pressable>\r\n                                                    </View>\r\n                                                ))}\r\n                                            </>\r\n                                        ) : (\r\n                                            <Text style={{\r\n                                                fontSize: 13,\r\n                                                color: colors.textSecondary,\r\n                                                fontStyle: \"italic\",\r\n                                                fontFamily: \"DMSans-Regular\"\r\n                                            }}>\r\n                                                No subjects assigned yet\r\n                                            </Text>\r\n                                        )}\r\n                                    </View>\r\n                                ))\r\n                            )}\r\n                        </>\r\n                    )}\r\n                </View>\r\n            </ScrollView>\r\n\r\n            {/* Assign Subject Modal */}\r\n            <Modal\r\n                visible={showModal}\r\n                animationType=\"fade\"\r\n                transparent={true}\r\n                onRequestClose={() => {\r\n                    setShowModal(false);\r\n                    setSelectedSubjects([]);\r\n                }}\r\n            >\r\n                <View style={{ flex: 1, justifyContent: \"center\", alignItems: \"center\", backgroundColor: \"rgba(0,0,0,0.6)\" }}>\r\n                    <View style={{\r\n                        backgroundColor: colors.cardBackground,\r\n                        borderRadius: 20,\r\n                        padding: 24,\r\n                        width: \"90%\",\r\n                        maxWidth: 500,\r\n                        maxHeight: \"80%\",\r\n                    }}>\r\n                        <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\", marginBottom: 12 }}>\r\n                            <View style={{ flex: 1 }}>\r\n                                <Text style={{ fontSize: 20, fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>\r\n                                    Assign Subjects\r\n                                </Text>\r\n                                <Text style={{ fontSize: 14, color: colors.textSecondary, fontFamily: \"DMSans-Regular\", marginTop: 2 }}>\r\n                                    {selectedTeacher?.name}\r\n                                </Text>\r\n                            </View>\r\n                            <Pressable onPress={() => {\r\n                                setShowModal(false);\r\n                                setSelectedSubjects([]);\r\n                            }}>\r\n                                <MaterialIcons name=\"close\" size={24} color={colors.textSecondary} />\r\n                            </Pressable>\r\n                        </View>\r\n\r\n                        {/* Selection Counter */}\r\n                        {selectedSubjects.length > 0 && (\r\n                            <View style={{\r\n                                backgroundColor: colors.primary + \"15\",\r\n                                padding: 10,\r\n                                borderRadius: 8,\r\n                                marginBottom: 12,\r\n                                flexDirection: \"row\",\r\n                                alignItems: \"center\",\r\n                                justifyContent: \"space-between\"\r\n                            }}>\r\n                                <Text style={{ fontSize: 14, fontFamily: \"DMSans-SemiBold\", color: colors.primary }}>\r\n                                    {selectedSubjects.length} subject{selectedSubjects.length !== 1 ? 's' : ''} selected\r\n                                </Text>\r\n                                <Pressable onPress={() => setSelectedSubjects([])}>\r\n                                    <Text style={{ fontSize: 13, fontFamily: \"DMSans-Bold\", color: colors.primary }}>\r\n                                        Clear All\r\n                                    </Text>\r\n                                </Pressable>\r\n                            </View>\r\n                        )}\r\n\r\n                        <ScrollView showsVerticalScrollIndicator={false} style={{ maxHeight: \"70%\" }}>\r\n                            {subjects.map((subject) => {\r\n                                const isAssigned = subject.teachers.some(t => t._id === selectedTeacher?._id);\r\n                                const isSelected = selectedSubjects.includes(subject._id);\r\n\r\n                                return (\r\n                                    <Pressable\r\n                                        key={subject._id}\r\n                                        onPress={() => {\r\n                                            if (!isAssigned) {\r\n                                                toggleSubjectSelection(subject._id);\r\n                                            }\r\n                                        }}\r\n                                        disabled={isAssigned || assignSubjectsMutation.isPending}\r\n                                        style={({ pressed }) => ({\r\n                                            backgroundColor: isAssigned ? colors.success + \"10\" : isSelected ? colors.primary + \"15\" : colors.background,\r\n                                            borderRadius: 12,\r\n                                            padding: 14,\r\n                                            marginBottom: 10,\r\n                                            opacity: (isAssigned || assignSubjectsMutation.isPending) ? 0.6 : (pressed ? 0.9 : 1),\r\n                                            borderWidth: isAssigned ? 1 : isSelected ? 2 : 0,\r\n                                            borderColor: isAssigned ? colors.success : isSelected ? colors.primary : \"transparent\"\r\n                                        })}\r\n                                    >\r\n                                        <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\" }}>\r\n                                            <View style={{ flex: 1, marginRight: 12 }}>\r\n                                                <Text style={{\r\n                                                    fontSize: 16,\r\n                                                    fontFamily: \"DMSans-SemiBold\",\r\n                                                    color: colors.textPrimary\r\n                                                }}>\r\n                                                    {subject.name}\r\n                                                </Text>\r\n                                                <Text style={{\r\n                                                    fontSize: 13,\r\n                                                    color: colors.textSecondary,\r\n                                                    fontFamily: \"DMSans-Regular\",\r\n                                                    marginTop: 2\r\n                                                }}>\r\n                                                    {subject.class.name} {subject.class.section ? `- ${subject.class.section}` : \"\"}\r\n                                                </Text>\r\n                                            </View>\r\n                                            {isAssigned ? (\r\n                                                <View style={{\r\n                                                    backgroundColor: colors.success + \"20\",\r\n                                                    padding: 6,\r\n                                                    borderRadius: 20,\r\n                                                    flexDirection: \"row\",\r\n                                                    alignItems: \"center\",\r\n                                                    paddingHorizontal: 10\r\n                                                }}>\r\n                                                    <MaterialIcons name=\"check-circle\" size={18} color={colors.success} />\r\n                                                    <Text style={{\r\n                                                        fontSize: 11,\r\n                                                        fontFamily: \"DMSans-Bold\",\r\n                                                        color: colors.success,\r\n                                                        marginLeft: 4\r\n                                                    }}>\r\n                                                        Assigned\r\n                                                    </Text>\r\n                                                </View>\r\n                                            ) : (\r\n                                                <View style={{\r\n                                                    width: 24,\r\n                                                    height: 24,\r\n                                                    borderRadius: 6,\r\n                                                    borderWidth: 2,\r\n                                                    borderColor: isSelected ? colors.primary : colors.textSecondary + \"40\",\r\n                                                    backgroundColor: isSelected ? colors.primary : \"transparent\",\r\n                                                    justifyContent: \"center\",\r\n                                                    alignItems: \"center\"\r\n                                                }}>\r\n                                                    {isSelected && (\r\n                                                        <MaterialIcons name=\"check\" size={18} color=\"#fff\" />\r\n                                                    )}\r\n                                                </View>\r\n                                            )}\r\n                                        </View>\r\n                                    </Pressable>\r\n                                );\r\n                            })}\r\n                        </ScrollView>\r\n\r\n                        {/* Assign Button */}\r\n                        <Pressable\r\n                            onPress={handleAssignMultipleSubjects}\r\n                            disabled={assignSubjectsMutation.isPending || selectedSubjects.length === 0}\r\n                            style={({ pressed }) => ({\r\n                                backgroundColor: selectedSubjects.length > 0 ? colors.primary : colors.textSecondary + \"30\",\r\n                                padding: 16,\r\n                                borderRadius: 12,\r\n                                marginTop: 16,\r\n                                opacity: pressed ? 0.8 : 1,\r\n                                flexDirection: \"row\",\r\n                                justifyContent: \"center\",\r\n                                alignItems: \"center\"\r\n                            })}\r\n                        >\r\n                            {assignSubjectsMutation.isPending ? (\r\n                                <ActivityIndicator size=\"small\" color=\"#fff\" />\r\n                            ) : (\r\n                                <>\r\n                                    <MaterialIcons name=\"check\" size={20} color=\"#fff\" style={{ marginRight: 8 }} />\r\n                                    <Text style={{\r\n                                        color: \"#fff\",\r\n                                        fontSize: 16,\r\n                                        fontFamily: \"DMSans-Bold\"\r\n                                    }}>\r\n                                        Assign {selectedSubjects.length > 0 ? `(${selectedSubjects.length})` : 'Selected'}\r\n                                    </Text>\r\n                                </>\r\n                            )}\r\n                        </Pressable>\r\n                    </View>\r\n                </View>\r\n            </Modal>\r\n        </View>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\admin\\timetable.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'AsyncStorage' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":26,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":27,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'loadingClasses' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":50,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":50,"endColumn":57},{"ruleId":"no-unused-vars","severity":1,"message":"'error' is defined but never used. Allowed unused args must match /^_/u.","line":104,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":104,"endColumn":24},{"ruleId":"no-dupe-keys","severity":2,"message":"Duplicate key 'startTime'.","line":163,"column":13,"nodeType":"ObjectExpression","messageId":"unexpected","endLine":163,"endColumn":22},{"ruleId":"no-dupe-keys","severity":2,"message":"Duplicate key 'endTime'.","line":164,"column":13,"nodeType":"ObjectExpression","messageId":"unexpected","endLine":164,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'index' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":171,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":171,"endColumn":24},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":281,"column":62,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[12968,13025],"text":"&apos;s Schedule\r\n                                            "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[12968,13025],"text":"&lsquo;s Schedule\r\n                                            "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[12968,13025],"text":"&#39;s Schedule\r\n                                            "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[12968,13025],"text":"&rsquo;s Schedule\r\n                                            "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    Pressable,\r\n    ActivityIndicator,\r\n    TextInput,\r\n    Modal,\r\n    Alert,\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useRouter } from \"expo-router\";\r\nimport { useTheme } from \"../../theme\";\r\nimport { useApiQuery, useApiMutation, createApiMutationFn } from \"../../hooks/useApi\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport Header from \"../../components/Header\";\r\nimport ModernTimePicker from \"../../components/ModernTimePicker\";\r\nimport { useToast } from \"../../components/ToastProvider\";\r\nimport apiConfig from \"../../config/apiConfig\";\r\n\r\nconst DAYS = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\r\n\r\nexport default function AdminTimetableScreen() {\r\n    const router = useRouter();\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n\r\n    const queryClient = useQueryClient();\r\n    const [selectedClassId, setSelectedClassId] = useState(null);\r\n\r\n    // Timetable State\r\n    const [schedule, setSchedule] = useState({}); // { Monday: [periods], ... }\r\n    const [selectedDay, setSelectedDay] = useState('Monday');\r\n\r\n    // Modal State\r\n    const [modalVisible, setModalVisible] = useState(false);\r\n    const [editingPeriod, setEditingPeriod] = useState(null); // null = new, obj = edit\r\n    const [tempPeriod, setTempPeriod] = useState({\r\n        periodNumber: \"\",\r\n        startTime: new Date(),\r\n        endTime: new Date(),\r\n        subject: \"\",\r\n        teacher: \"\"\r\n    });\r\n    const [showTimePicker, setShowTimePicker] = useState({ show: false, mode: 'start' }); // mode: 'start' | 'end'\r\n\r\n    // Fetch Classes\r\n    const { data: classesData, isLoading: loadingClasses } = useApiQuery(\r\n        ['adminClassesInit'],\r\n        `${apiConfig.baseUrl}/classes/admin/init`\r\n    );\r\n    const classes = classesData?.classes || [];\r\n\r\n    // Fetch Class Details (Subjects & Teachers)\r\n    const { data: classDetails } = useApiQuery(\r\n        ['classDetails', selectedClassId],\r\n        `${apiConfig.baseUrl}/classes/${selectedClassId}/full-details`,\r\n        { enabled: !!selectedClassId }\r\n    );\r\n    const subjects = classDetails?.subjects || [];\r\n\r\n    // Fetch Existing Timetable\r\n    const { data: timetableData, isLoading: loadingTimetable } = useApiQuery(\r\n        ['timetable', selectedClassId],\r\n        `${apiConfig.baseUrl}/timetable/class/${selectedClassId}`,\r\n        {\r\n            enabled: !!selectedClassId,\r\n            // When data is fetched, update local schedule state\r\n            // Note: React Query's data is immutable, so we should use it directly or copy it to state if we need to edit it locally before saving.\r\n            // Since we are editing locally and then saving, we'll sync state in useEffect when data changes.\r\n        }\r\n    );\r\n\r\n    useEffect(() => {\r\n        if (timetableData) {\r\n            const scheduleMap = {};\r\n            DAYS.forEach(day => scheduleMap[day] = []);\r\n\r\n            timetableData.schedule.forEach(daySchedule => {\r\n                scheduleMap[daySchedule.day] = daySchedule.periods.map(p => ({\r\n                    ...p,\r\n                    subject: p.subject?._id || p.subject, // Handle populated vs unpopulated\r\n                    teacher: p.teacher?._id || p.teacher\r\n                }));\r\n            });\r\n            setSchedule(scheduleMap);\r\n        } else if (selectedClassId && !loadingTimetable) {\r\n            // Initialize empty schedule if no data found or just switched class\r\n            const emptySchedule = {};\r\n            DAYS.forEach(day => emptySchedule[day] = []);\r\n            setSchedule(emptySchedule);\r\n        }\r\n    }, [timetableData, selectedClassId, loadingTimetable]);\r\n\r\n    // Save Timetable Mutation\r\n    const saveTimetableMutation = useApiMutation({\r\n        mutationFn: createApiMutationFn(`${apiConfig.baseUrl}/timetable`, 'POST'),\r\n        onSuccess: () => {\r\n            showToast(\"Timetable saved successfully\", \"success\");\r\n            queryClient.invalidateQueries({ queryKey: ['timetable', selectedClassId] });\r\n        },\r\n        onError: (error) => showToast(\"Failed to save timetable\", \"error\")\r\n    });\r\n\r\n    const handleSaveTimetable = () => {\r\n        if (!selectedClassId) return;\r\n\r\n        // Convert schedule object back to array format\r\n        const scheduleArray = Object.keys(schedule).map(day => ({\r\n            day,\r\n            periods: schedule[day]\r\n        })).filter(day => day.periods.length > 0);\r\n\r\n        saveTimetableMutation.mutate({\r\n            classId: selectedClassId,\r\n            schedule: scheduleArray,\r\n            breaks: [] // Can add breaks later\r\n        });\r\n    };\r\n\r\n    const openPeriodModal = (period = null) => {\r\n        if (period) {\r\n            setEditingPeriod(period);\r\n            // Parse times for picker\r\n            // Assuming time format \"HH:mm AM/PM\" or similar, need to parse to Date object\r\n            // For simplicity, let's just use current date with parsed time or default\r\n            setTempPeriod({\r\n                ...period,\r\n                startTime: new Date(), // TODO: Parse actual time string\r\n                endTime: new Date()\r\n            });\r\n        } else {\r\n            setEditingPeriod(null);\r\n            setTempPeriod({\r\n                periodNumber: (schedule[selectedDay]?.length || 0) + 1,\r\n                startTime: new Date(),\r\n                endTime: new Date(),\r\n                subject: \"\",\r\n                teacher: \"\"\r\n            });\r\n        }\r\n        setModalVisible(true);\r\n    };\r\n\r\n    const savePeriod = () => {\r\n        if (!tempPeriod.subject || !tempPeriod.teacher) {\r\n            Alert.alert(\"Error\", \"Please select a subject and teacher\");\r\n            return;\r\n        }\r\n\r\n        const formatTime = (date) => {\r\n            return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\r\n        };\r\n\r\n        const newPeriod = {\r\n            periodNumber: Number(tempPeriod.periodNumber),\r\n            subject: tempPeriod.subject,\r\n            teacher: tempPeriod.teacher,\r\n            startTime: formatTime(tempPeriod.startTime),\r\n            endTime: formatTime(tempPeriod.endTime),\r\n            startTime: formatTime(tempPeriod.startTime),\r\n            endTime: formatTime(tempPeriod.endTime)\r\n        };\r\n\r\n        const updatedDaySchedule = [...(schedule[selectedDay] || [])];\r\n\r\n        if (editingPeriod) {\r\n            // Update existing\r\n            const index = updatedDaySchedule.findIndex(p => p.periodNumber === editingPeriod.periodNumber); // Identify by period number? Or index?\r\n            // Better to use index from map, but for now let's just push/replace\r\n            // Actually, let's just replace based on periodNumber if unique, or just use array index if passed\r\n            // Simplified: Remove old, add new, sort\r\n            const filtered = updatedDaySchedule.filter(p => p !== editingPeriod);\r\n            filtered.push(newPeriod);\r\n            filtered.sort((a, b) => a.periodNumber - b.periodNumber);\r\n            setSchedule({ ...schedule, [selectedDay]: filtered });\r\n        } else {\r\n            // Add new\r\n            updatedDaySchedule.push(newPeriod);\r\n            updatedDaySchedule.sort((a, b) => a.periodNumber - b.periodNumber);\r\n            setSchedule({ ...schedule, [selectedDay]: updatedDaySchedule });\r\n        }\r\n\r\n        setModalVisible(false);\r\n    };\r\n\r\n    const deletePeriod = (period) => {\r\n        const updatedDaySchedule = schedule[selectedDay].filter(p => p !== period);\r\n        setSchedule({ ...schedule, [selectedDay]: updatedDaySchedule });\r\n    };\r\n\r\n    const onTimeConfirm = (selectedDate) => {\r\n        const mode = showTimePicker.mode;\r\n\r\n        if (selectedDate) {\r\n            if (mode === 'start') {\r\n                setTempPeriod({ ...tempPeriod, startTime: selectedDate });\r\n            } else {\r\n                setTempPeriod({ ...tempPeriod, endTime: selectedDate });\r\n            }\r\n        }\r\n    };\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <ScrollView contentContainerStyle={{ paddingBottom: 100 }}>\r\n                <View style={{ padding: 16, paddingTop: 24 }}>\r\n                    <Header title=\"Manage Timetable\" subtitle=\"Set class schedules\" showBack />\r\n\r\n                    {/* Class Selector */}\r\n                    <View style={{ marginTop: 20 }}>\r\n                        <Text style={{ fontSize: 14, color: colors.textSecondary, marginBottom: 8, fontFamily: \"DMSans-Medium\" }}>\r\n                            Select Class\r\n                        </Text>\r\n                        <ScrollView horizontal showsHorizontalScrollIndicator={false}>\r\n                            <View style={{ flexDirection: \"row\", gap: 10 }}>\r\n                                {classes.map((cls) => (\r\n                                    <Pressable\r\n                                        key={cls._id}\r\n                                        onPress={() => setSelectedClassId(cls._id)}\r\n                                        style={{\r\n                                            paddingHorizontal: 20,\r\n                                            paddingVertical: 10,\r\n                                            backgroundColor: selectedClassId === cls._id ? colors.primary : colors.cardBackground,\r\n                                            borderRadius: 20,\r\n                                            borderWidth: 1,\r\n                                            borderColor: selectedClassId === cls._id ? colors.primary : colors.textSecondary + \"20\"\r\n                                        }}\r\n                                    >\r\n                                        <Text style={{\r\n                                            color: selectedClassId === cls._id ? \"#fff\" : colors.textPrimary,\r\n                                            fontFamily: selectedClassId === cls._id ? \"DMSans-Bold\" : \"DMSans-Medium\"\r\n                                        }}>\r\n                                            {cls.name} {cls.section}\r\n                                        </Text>\r\n                                    </Pressable>\r\n                                ))}\r\n                            </View>\r\n                        </ScrollView>\r\n                    </View>\r\n\r\n                    {selectedClassId && (\r\n                        <>\r\n                            {/* Day Tabs */}\r\n                            <View style={{ marginTop: 24 }}>\r\n                                <ScrollView horizontal showsHorizontalScrollIndicator={false}>\r\n                                    <View style={{ flexDirection: \"row\", gap: 8 }}>\r\n                                        {DAYS.map((day) => (\r\n                                            <Pressable\r\n                                                key={day}\r\n                                                onPress={() => setSelectedDay(day)}\r\n                                                style={{\r\n                                                    paddingHorizontal: 16,\r\n                                                    paddingVertical: 8,\r\n                                                    backgroundColor: selectedDay === day ? colors.secondary : \"transparent\",\r\n                                                    borderRadius: 12,\r\n                                                }}\r\n                                            >\r\n                                                <Text style={{\r\n                                                    color: selectedDay === day ? \"#fff\" : colors.textSecondary,\r\n                                                    fontFamily: \"DMSans-Bold\"\r\n                                                }}>\r\n                                                    {day.slice(0, 3)}\r\n                                                </Text>\r\n                                            </Pressable>\r\n                                        ))}\r\n                                    </View>\r\n                                </ScrollView>\r\n                            </View>\r\n\r\n                            {/* Schedule Editor */}\r\n                            <View style={{ marginTop: 20 }}>\r\n                                {loadingTimetable ? (\r\n                                    <ActivityIndicator size=\"large\" color={colors.primary} />\r\n                                ) : (\r\n                                    <View>\r\n                                        <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\", marginBottom: 16 }}>\r\n                                            <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>\r\n                                                {selectedDay}'s Schedule\r\n                                            </Text>\r\n                                            <Pressable\r\n                                                onPress={() => openPeriodModal()}\r\n                                                style={{ flexDirection: \"row\", alignItems: \"center\", gap: 4 }}\r\n                                            >\r\n                                                <MaterialIcons name=\"add\" size={20} color={colors.primary} />\r\n                                                <Text style={{ color: colors.primary, fontFamily: \"DMSans-Bold\" }}>Add Period</Text>\r\n                                            </Pressable>\r\n                                        </View>\r\n\r\n                                        {(!schedule[selectedDay] || schedule[selectedDay].length === 0) ? (\r\n                                            <View style={{ padding: 20, alignItems: \"center\", backgroundColor: colors.cardBackground, borderRadius: 12 }}>\r\n                                                <Text style={{ color: colors.textSecondary }}>No periods added for this day</Text>\r\n                                            </View>\r\n                                        ) : (\r\n                                            schedule[selectedDay].map((period, index) => {\r\n                                                const subject = subjects.find(s => s._id === period.subject);\r\n                                                const teacher = subject?.teachers?.find(t => t._id === period.teacher);\r\n\r\n                                                return (\r\n                                                    <View\r\n                                                        key={index}\r\n                                                        style={{\r\n                                                            backgroundColor: colors.cardBackground,\r\n                                                            padding: 16,\r\n                                                            borderRadius: 12,\r\n                                                            marginBottom: 12,\r\n                                                            flexDirection: \"row\",\r\n                                                            alignItems: \"center\",\r\n                                                            gap: 12\r\n                                                        }}\r\n                                                    >\r\n                                                        <View style={{\r\n                                                            width: 40, height: 40,\r\n                                                            borderRadius: 20,\r\n                                                            backgroundColor: colors.background,\r\n                                                            alignItems: \"center\",\r\n                                                            justifyContent: \"center\"\r\n                                                        }}>\r\n                                                            <Text style={{ fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>{period.periodNumber}</Text>\r\n                                                        </View>\r\n\r\n                                                        <View style={{ flex: 1 }}>\r\n                                                            <Text style={{ fontFamily: \"DMSans-Bold\", color: colors.textPrimary, fontSize: 16 }}>\r\n                                                                {subject?.name || \"Unknown Subject\"}\r\n                                                            </Text>\r\n                                                            <Text style={{ color: colors.textSecondary, fontSize: 12 }}>\r\n                                                                {period.startTime} - {period.endTime}  {teacher?.name || \"No Teacher\"}\r\n                                                            </Text>\r\n                                                        </View>\r\n\r\n                                                        <Pressable onPress={() => deletePeriod(period)}>\r\n                                                            <MaterialIcons name=\"delete-outline\" size={24} color={colors.error} />\r\n                                                        </Pressable>\r\n                                                    </View>\r\n                                                );\r\n                                            })\r\n                                        )}\r\n                                    </View>\r\n                                )}\r\n                            </View>\r\n\r\n                            {/* Save Button */}\r\n                            <Pressable\r\n                                onPress={handleSaveTimetable}\r\n                                disabled={saveTimetableMutation.isPending}\r\n                                style={{\r\n                                    backgroundColor: colors.primary,\r\n                                    borderRadius: 12,\r\n                                    padding: 16,\r\n                                    marginTop: 32,\r\n                                    alignItems: \"center\",\r\n                                    opacity: saveTimetableMutation.isPending ? 0.7 : 1\r\n                                }}\r\n                            >\r\n                                {saveTimetableMutation.isPending ? (\r\n                                    <ActivityIndicator color=\"#fff\" />\r\n                                ) : (\r\n                                    <Text style={{ color: \"#fff\", fontFamily: \"DMSans-Bold\", fontSize: 16 }}>\r\n                                        Save Timetable\r\n                                    </Text>\r\n                                )}\r\n                            </Pressable>\r\n                        </>\r\n                    )}\r\n                </View>\r\n            </ScrollView>\r\n\r\n            {/* Add/Edit Period Modal */}\r\n            <Modal\r\n                visible={modalVisible}\r\n                transparent={true}\r\n                animationType=\"slide\"\r\n                onRequestClose={() => setModalVisible(false)}\r\n            >\r\n                <Pressable\r\n                    style={{ flex: 1, backgroundColor: \"rgba(0,0,0,0.5)\", justifyContent: \"flex-end\" }}\r\n                    onPress={() => setModalVisible(false)}\r\n                >\r\n                    <Pressable\r\n                        style={{ backgroundColor: colors.cardBackground, borderTopLeftRadius: 24, borderTopRightRadius: 24, padding: 24, maxHeight: \"80%\" }}\r\n                        onPress={(e) => e.stopPropagation()}\r\n                    >\r\n                        <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\", marginBottom: 20 }}>\r\n                            <Text style={{ fontSize: 20, fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>\r\n                                {editingPeriod ? \"Edit Period\" : \"Add Period\"}\r\n                            </Text>\r\n                            <Pressable onPress={() => setModalVisible(false)} hitSlop={10}>\r\n                                <MaterialIcons name=\"close\" size={24} color={colors.textSecondary} />\r\n                            </Pressable>\r\n                        </View>\r\n\r\n                        <ScrollView>\r\n                            {/* Period Number */}\r\n                            <Text style={{ color: colors.textSecondary, marginBottom: 8 }}>Period Number</Text>\r\n                            <TextInput\r\n                                value={String(tempPeriod.periodNumber)}\r\n                                onChangeText={(t) => setTempPeriod({ ...tempPeriod, periodNumber: t })}\r\n                                keyboardType=\"numeric\"\r\n                                style={{\r\n                                    backgroundColor: colors.background,\r\n                                    padding: 12,\r\n                                    borderRadius: 10,\r\n                                    color: colors.textPrimary,\r\n                                    marginBottom: 16\r\n                                }}\r\n                            />\r\n\r\n                            {/* Time */}\r\n                            <View style={{ flexDirection: \"row\", gap: 16, marginBottom: 16 }}>\r\n                                <View style={{ flex: 1 }}>\r\n                                    <Text style={{ color: colors.textSecondary, marginBottom: 8 }}>Start Time</Text>\r\n                                    <Pressable\r\n                                        onPress={() => setShowTimePicker({ show: true, mode: 'start' })}\r\n                                        style={{ backgroundColor: colors.background, padding: 12, borderRadius: 10 }}\r\n                                    >\r\n                                        <Text style={{ color: colors.textPrimary }}>\r\n                                            {tempPeriod.startTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                                        </Text>\r\n                                    </Pressable>\r\n                                </View>\r\n                                <View style={{ flex: 1 }}>\r\n                                    <Text style={{ color: colors.textSecondary, marginBottom: 8 }}>End Time</Text>\r\n                                    <Pressable\r\n                                        onPress={() => setShowTimePicker({ show: true, mode: 'end' })}\r\n                                        style={{ backgroundColor: colors.background, padding: 12, borderRadius: 10 }}\r\n                                    >\r\n                                        <Text style={{ color: colors.textPrimary }}>\r\n                                            {tempPeriod.endTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                                        </Text>\r\n                                    </Pressable>\r\n                                </View>\r\n                            </View>\r\n\r\n                            {/* Subject */}\r\n                            <Text style={{ color: colors.textSecondary, marginBottom: 8 }}>Subject</Text>\r\n                            <ScrollView horizontal showsHorizontalScrollIndicator={false} style={{ marginBottom: 16 }}>\r\n                                <View style={{ flexDirection: \"row\", gap: 8 }}>\r\n                                    {subjects.map(sub => (\r\n                                        <Pressable\r\n                                            key={sub._id}\r\n                                            onPress={() => setTempPeriod({ ...tempPeriod, subject: sub._id, teacher: \"\" })} // Reset teacher on subject change\r\n                                            style={{\r\n                                                paddingHorizontal: 16,\r\n                                                paddingVertical: 8,\r\n                                                backgroundColor: tempPeriod.subject === sub._id ? colors.primary : colors.background,\r\n                                                borderRadius: 20,\r\n                                                borderWidth: 1,\r\n                                                borderColor: tempPeriod.subject === sub._id ? colors.primary : colors.textSecondary + \"20\"\r\n                                            }}\r\n                                        >\r\n                                            <Text style={{ color: tempPeriod.subject === sub._id ? \"#fff\" : colors.textPrimary }}>\r\n                                                {sub.name}\r\n                                            </Text>\r\n                                        </Pressable>\r\n                                    ))}\r\n                                </View>\r\n                            </ScrollView>\r\n\r\n                            {/* Teacher */}\r\n                            {tempPeriod.subject && (\r\n                                <>\r\n                                    <Text style={{ color: colors.textSecondary, marginBottom: 8 }}>Teacher</Text>\r\n                                    <ScrollView horizontal showsHorizontalScrollIndicator={false} style={{ marginBottom: 16 }}>\r\n                                        <View style={{ flexDirection: \"row\", gap: 8 }}>\r\n                                            {subjects.find(s => s._id === tempPeriod.subject)?.teachers?.map(t => (\r\n                                                <Pressable\r\n                                                    key={t._id}\r\n                                                    onPress={() => setTempPeriod({ ...tempPeriod, teacher: t._id })}\r\n                                                    style={{\r\n                                                        paddingHorizontal: 16,\r\n                                                        paddingVertical: 8,\r\n                                                        backgroundColor: tempPeriod.teacher === t._id ? colors.secondary : colors.background,\r\n                                                        borderRadius: 20,\r\n                                                        borderWidth: 1,\r\n                                                        borderColor: tempPeriod.teacher === t._id ? colors.secondary : colors.textSecondary + \"20\"\r\n                                                    }}\r\n                                                >\r\n                                                    <Text style={{ color: tempPeriod.teacher === t._id ? \"#fff\" : colors.textPrimary }}>\r\n                                                        {t.name}\r\n                                                    </Text>\r\n                                                </Pressable>\r\n                                            ))}\r\n                                        </View>\r\n                                    </ScrollView>\r\n                                </>\r\n                            )}\r\n\r\n\r\n\r\n                            <Pressable\r\n                                onPress={savePeriod}\r\n                                style={{\r\n                                    backgroundColor: colors.primary,\r\n                                    padding: 16,\r\n                                    borderRadius: 12,\r\n                                    alignItems: \"center\",\r\n                                    marginBottom: 20\r\n                                }}\r\n                            >\r\n                                <Text style={{ color: \"#fff\", fontFamily: \"DMSans-Bold\", fontSize: 16 }}>\r\n                                    {editingPeriod ? \"Update Period\" : \"Add Period\"}\r\n                                </Text>\r\n                            </Pressable>\r\n                        </ScrollView>\r\n                    </Pressable>\r\n                </Pressable>\r\n            </Modal>\r\n\r\n            <ModernTimePicker\r\n                visible={showTimePicker.show}\r\n                onClose={() => setShowTimePicker({ ...showTimePicker, show: false })}\r\n                onConfirm={onTimeConfirm}\r\n                value={showTimePicker.mode === 'start' ? tempPeriod.startTime : tempPeriod.endTime}\r\n                title={showTimePicker.mode === 'start' ? \"Select Start Time\" : \"Select End Time\"}\r\n            />\r\n        </View>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\complaints\\index.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'StyleSheet' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":15},{"ruleId":"no-unused-vars","severity":1,"message":"'showToast' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":23,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    FlatList,\r\n    Pressable,\r\n    ActivityIndicator,\r\n    StyleSheet,\r\n    RefreshControl\r\n} from \"react-native\";\r\nimport { useRouter } from \"expo-router\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useTheme } from \"../../theme\";\r\nimport apiConfig from \"../../config/apiConfig\";\r\nimport { useApiQuery } from \"../../hooks/useApi\";\r\nimport Header from \"../../components/Header\";\r\nimport { useToast } from \"../../components/ToastProvider\";\r\n\r\nexport default function ComplaintsScreen() {\r\n    const router = useRouter();\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n\r\n    const [activeTab, setActiveTab] = useState(\"my_complaints\"); // 'my_complaints', 'inbox'\r\n\r\n    const [refreshing, setRefreshing] = useState(false);\r\n    const [userRole, setUserRole] = useState(null);\r\n\r\n    useEffect(() => {\r\n        checkUserRole();\r\n    }, []);\r\n\r\n\r\n\r\n    const checkUserRole = async () => {\r\n        const role = await AsyncStorage.getItem(\"userRole\");\r\n        setUserRole(role);\r\n        // If student, force 'my_complaints'\r\n        if (role === 'student') {\r\n            setActiveTab('my_complaints');\r\n        } else {\r\n            // Default to inbox for teachers/admins as that's their primary work\r\n            setActiveTab('inbox');\r\n        }\r\n    };\r\n\r\n    const { data: complaintsData, isLoading: loading, refetch } = useApiQuery(\r\n        ['complaints', activeTab],\r\n        `${apiConfig.baseUrl}${activeTab === 'inbox' ? '/complaints/inbox' : '/complaints/my-complaints'}`,\r\n        { enabled: !!userRole }\r\n    );\r\n\r\n    const complaints = complaintsData || [];\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        await refetch();\r\n        setRefreshing(false);\r\n    };\r\n\r\n    const getStatusColor = (status) => {\r\n        switch (status) {\r\n            case 'Resolved': return colors.success;\r\n            case 'Rejected': return colors.error;\r\n            case 'In Progress': return colors.warning;\r\n            default: return colors.textSecondary;\r\n        }\r\n    };\r\n\r\n    const renderComplaintItem = ({ item }) => (\r\n        <Pressable\r\n            style={({ pressed }) => [\r\n                styles.cardMinimal,\r\n                {\r\n                    marginBottom: 12,\r\n                    opacity: pressed ? 0.9 : 1,\r\n                }\r\n            ]}\r\n            onPress={() => {\r\n                // Navigate to details (to be implemented or just expand)\r\n                // For now, maybe just show alert or expand\r\n                // router.push(`/complaints/${item._id}`);\r\n            }}\r\n        >\r\n            <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", marginBottom: 12 }}>\r\n                <View style={{ flexDirection: \"row\", gap: 8 }}>\r\n                    <View style={{\r\n                        paddingHorizontal: 10,\r\n                        paddingVertical: 4,\r\n                        backgroundColor: colors.primary + \"15\",\r\n                        borderRadius: 8\r\n                    }}>\r\n                        <Text style={{ color: colors.primary, fontSize: 11, fontFamily: \"DMSans-Bold\" }}>\r\n                            {item.category}\r\n                        </Text>\r\n                    </View>\r\n                    <View style={{\r\n                        paddingHorizontal: 10,\r\n                        paddingVertical: 4,\r\n                        backgroundColor: getStatusColor(item.status) + \"15\",\r\n                        borderRadius: 8\r\n                    }}>\r\n                        <Text style={{ color: getStatusColor(item.status), fontSize: 11, fontFamily: \"DMSans-Bold\" }}>\r\n                            {item.status}\r\n                        </Text>\r\n                    </View>\r\n                </View>\r\n                <Text style={{ color: colors.textSecondary, fontSize: 12, fontFamily: \"DMSans-Medium\" }}>\r\n                    {new Date(item.createdAt).toLocaleDateString()}\r\n                </Text>\r\n            </View>\r\n\r\n            <Text style={{ fontSize: 16, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginBottom: 6 }}>\r\n                {item.title}\r\n            </Text>\r\n            <Text style={{ color: colors.textSecondary, fontFamily: \"DMSans-Regular\", fontSize: 14, lineHeight: 20 }} numberOfLines={2}>\r\n                {item.description}\r\n            </Text>\r\n\r\n            {activeTab === 'inbox' && item.raisedBy && (\r\n                <View style={{ marginTop: 12, paddingTop: 12, borderTopWidth: 1, borderTopColor: colors.border }}>\r\n                    <Text style={{ color: colors.textSecondary, fontSize: 12, fontFamily: \"DMSans-Regular\" }}>\r\n                        Raised by: <Text style={{ fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>{item.raisedBy.name}</Text> ({item.raisedBy.role})\r\n                    </Text>\r\n                </View>\r\n            )}\r\n            {activeTab === 'my_complaints' && item.visibility && (\r\n                <View style={{ marginTop: 12, paddingTop: 12, borderTopWidth: 1, borderTopColor: colors.border }}>\r\n                    <Text style={{ color: colors.textSecondary, fontSize: 12, fontFamily: \"DMSans-Regular\" }}>\r\n                        Sent to: <Text style={{ fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>\r\n                            {item.visibility === 'teacher' ? 'Class Teacher' : item.visibility === 'super_admin' ? 'Management' : 'Headmaster'}\r\n                        </Text>\r\n                    </Text>\r\n                </View>\r\n            )}\r\n        </Pressable>\r\n    );\r\n\r\n    return (\r\n        <View style={styles.container}>\r\n            <View style={{ paddingHorizontal: 20, paddingTop: 20, paddingBottom: 10 }}>\r\n                <Header title=\"Complaints\" subtitle=\"Feedback & Issues\" showBack />\r\n            </View>\r\n\r\n            {/* Tabs (Only for Teachers/Admins) */}\r\n            {userRole !== 'student' && (\r\n                <View style={{ paddingHorizontal: 20, marginBottom: 16 }}>\r\n                    <View style={{ flexDirection: \"row\", backgroundColor: colors.cardBackground, borderRadius: 16, padding: 4, borderWidth: 1, borderColor: colors.border }}>\r\n                        <Pressable\r\n                            onPress={() => setActiveTab('inbox')}\r\n                            style={{\r\n                                flex: 1,\r\n                                paddingVertical: 12,\r\n                                alignItems: \"center\",\r\n                                backgroundColor: activeTab === 'inbox' ? colors.primary + \"15\" : \"transparent\",\r\n                                borderRadius: 12,\r\n                            }}\r\n                        >\r\n                            <Text style={{\r\n                                fontFamily: \"DMSans-Bold\",\r\n                                color: activeTab === 'inbox' ? colors.primary : colors.textSecondary,\r\n                                fontSize: 14\r\n                            }}>Inbox</Text>\r\n                        </Pressable>\r\n                        <Pressable\r\n                            onPress={() => setActiveTab('my_complaints')}\r\n                            style={{\r\n                                flex: 1,\r\n                                paddingVertical: 12,\r\n                                alignItems: \"center\",\r\n                                backgroundColor: activeTab === 'my_complaints' ? colors.primary + \"15\" : \"transparent\",\r\n                                borderRadius: 12,\r\n                            }}\r\n                        >\r\n                            <Text style={{\r\n                                fontFamily: \"DMSans-Bold\",\r\n                                color: activeTab === 'my_complaints' ? colors.primary : colors.textSecondary,\r\n                                fontSize: 14\r\n                            }}>My Complaints</Text>\r\n                        </Pressable>\r\n                    </View>\r\n                </View>\r\n            )}\r\n\r\n            {loading ? (\r\n                <ActivityIndicator size=\"large\" color={colors.primary} style={{ marginTop: 40 }} />\r\n            ) : (\r\n                <FlatList\r\n                    data={complaints}\r\n                    renderItem={renderComplaintItem}\r\n                    keyExtractor={item => item._id}\r\n                    contentContainerStyle={{ paddingHorizontal: 20, paddingBottom: 100 }}\r\n                    refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} tintColor={colors.primary} />}\r\n                    showsVerticalScrollIndicator={false}\r\n                    ListEmptyComponent={() => (\r\n                        <View style={{ alignItems: \"center\", marginTop: 40, opacity: 0.6 }}>\r\n                            <MaterialIcons name=\"inbox\" size={48} color={colors.textSecondary} />\r\n                            <Text style={{ color: colors.textSecondary, marginTop: 16, fontFamily: \"DMSans-Medium\", fontSize: 16 }}>\r\n                                No complaints found\r\n                            </Text>\r\n                        </View>\r\n                    )}\r\n                />\r\n            )}\r\n\r\n            {/* FAB to Raise Complaint */}\r\n            <Pressable\r\n                onPress={() => router.push(\"/complaints/raise\")}\r\n                style={({ pressed }) => [\r\n                    styles.fab,\r\n                    { opacity: pressed ? 0.9 : 1 }\r\n                ]}\r\n            >\r\n                <MaterialIcons name=\"add\" size={24} color=\"#fff\" />\r\n            </Pressable>\r\n        </View>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\complaints\\raise.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Alert' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":10},{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":22,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'setPriority' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":28,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":28,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    TextInput,\r\n    Pressable,\r\n    ScrollView,\r\n    ActivityIndicator,\r\n    Alert\r\n} from \"react-native\";\r\nimport { useRouter } from \"expo-router\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport { useTheme } from \"../../theme\";\r\nimport apiConfig from \"../../config/apiConfig\";\r\nimport { useApiMutation, createApiMutationFn } from \"../../hooks/useApi\";\r\nimport Header from \"../../components/Header\";\r\nimport { useToast } from \"../../components/ToastProvider\";\r\n\r\nexport default function RaiseComplaintScreen() {\r\n    const router = useRouter();\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n\r\n    const [title, setTitle] = useState(\"\");\r\n    const [description, setDescription] = useState(\"\");\r\n    const [category, setCategory] = useState(\"Academic\");\r\n    const [priority, setPriority] = useState(\"Medium\");\r\n    const [visibility, setVisibility] = useState(\"teacher\"); // 'teacher', 'admin' (for students)\r\n    const [userRole, setUserRole] = useState(null);\r\n\r\n\r\n    useEffect(() => {\r\n        checkUserRole();\r\n    }, []);\r\n\r\n    const checkUserRole = async () => {\r\n        const role = await AsyncStorage.getItem(\"userRole\");\r\n        setUserRole(role);\r\n        if (role === 'teacher') {\r\n            setCategory(\"Management\"); // Default for teachers\r\n            setVisibility(\"super_admin\");\r\n        }\r\n    };\r\n\r\n    const raiseComplaintMutation = useApiMutation({\r\n        mutationFn: createApiMutationFn(`${apiConfig.baseUrl}/complaints`, 'POST'),\r\n        onSuccess: () => {\r\n            showToast(\"Complaint raised successfully\", \"success\");\r\n            router.back();\r\n            // Invalidate queries if needed, but we don't have easy access to queryClient here unless we import it\r\n            // Assuming the list page will refetch on focus or we can rely on stale time\r\n        },\r\n        onError: (error) => showToast(error.message || \"Failed to raise complaint\", \"error\")\r\n    });\r\n\r\n    const handleSubmit = () => {\r\n        if (!title.trim() || !description.trim()) {\r\n            showToast(\"Please fill all fields\", \"error\");\r\n            return;\r\n        }\r\n\r\n        raiseComplaintMutation.mutate({\r\n            title,\r\n            description,\r\n            category,\r\n            priority,\r\n            visibility\r\n        });\r\n    };\r\n\r\n    const categories = userRole === 'teacher'\r\n        ? ['Management', 'Facility', 'Other']\r\n        : ['Academic', 'Facility', 'Transport', 'Discipline', 'Other'];\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <View style={{ padding: 16, paddingTop: 24 }}>\r\n                <Header title=\"Raise Complaint\" showBack />\r\n            </View>\r\n\r\n            <ScrollView contentContainerStyle={{ padding: 16 }}>\r\n                {/* Visibility Selection (For Students) */}\r\n                {userRole === 'student' && (\r\n                    <View style={{ marginBottom: 24 }}>\r\n                        <Text style={{ color: colors.textSecondary, marginBottom: 8, fontFamily: \"DMSans-Medium\" }}>To</Text>\r\n                        <View style={{ flexDirection: \"row\", gap: 12 }}>\r\n                            <Pressable\r\n                                onPress={() => setVisibility('teacher')}\r\n                                style={{\r\n                                    flex: 1,\r\n                                    padding: 16,\r\n                                    backgroundColor: visibility === 'teacher' ? colors.primary + \"15\" : colors.cardBackground,\r\n                                    borderRadius: 12,\r\n                                    borderWidth: 1,\r\n                                    borderColor: visibility === 'teacher' ? colors.primary : \"transparent\",\r\n                                    alignItems: \"center\"\r\n                                }}\r\n                            >\r\n                                <MaterialIcons name=\"person\" size={24} color={visibility === 'teacher' ? colors.primary : colors.textSecondary} />\r\n                                <Text style={{\r\n                                    marginTop: 8,\r\n                                    fontFamily: \"DMSans-Bold\",\r\n                                    color: visibility === 'teacher' ? colors.primary : colors.textSecondary\r\n                                }}>Class Teacher</Text>\r\n                            </Pressable>\r\n\r\n                            <Pressable\r\n                                onPress={() => setVisibility('admin')}\r\n                                style={{\r\n                                    flex: 1,\r\n                                    padding: 16,\r\n                                    backgroundColor: visibility === 'admin' ? colors.primary + \"15\" : colors.cardBackground,\r\n                                    borderRadius: 12,\r\n                                    borderWidth: 1,\r\n                                    borderColor: visibility === 'admin' ? colors.primary : \"transparent\",\r\n                                    alignItems: \"center\"\r\n                                }}\r\n                            >\r\n                                <MaterialIcons name=\"admin-panel-settings\" size={24} color={visibility === 'admin' ? colors.primary : colors.textSecondary} />\r\n                                <Text style={{\r\n                                    marginTop: 8,\r\n                                    fontFamily: \"DMSans-Bold\",\r\n                                    color: visibility === 'admin' ? colors.primary : colors.textSecondary\r\n                                }}>Headmaster</Text>\r\n                            </Pressable>\r\n                        </View>\r\n                    </View>\r\n                )}\r\n\r\n                {/* For Teachers (Read Only) */}\r\n                {userRole === 'teacher' && (\r\n                    <View style={{ marginBottom: 24 }}>\r\n                        <Text style={{ color: colors.textSecondary, marginBottom: 8, fontFamily: \"DMSans-Medium\" }}>To</Text>\r\n                        <View style={{\r\n                            padding: 16,\r\n                            backgroundColor: colors.cardBackground,\r\n                            borderRadius: 12,\r\n                            flexDirection: \"row\",\r\n                            alignItems: \"center\",\r\n                            gap: 12\r\n                        }}>\r\n                            <MaterialIcons name=\"business\" size={24} color={colors.primary} />\r\n                            <Text style={{ fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>Management (Super Admin)</Text>\r\n                        </View>\r\n                    </View>\r\n                )}\r\n\r\n                {/* Category */}\r\n                <View style={{ marginBottom: 24 }}>\r\n                    <Text style={{ color: colors.textSecondary, marginBottom: 8, fontFamily: \"DMSans-Medium\" }}>Category</Text>\r\n                    <ScrollView horizontal showsHorizontalScrollIndicator={false}>\r\n                        <View style={{ flexDirection: \"row\", gap: 8 }}>\r\n                            {categories.map(cat => (\r\n                                <Pressable\r\n                                    key={cat}\r\n                                    onPress={() => setCategory(cat)}\r\n                                    style={{\r\n                                        paddingHorizontal: 16,\r\n                                        paddingVertical: 8,\r\n                                        backgroundColor: category === cat ? colors.primary : colors.cardBackground,\r\n                                        borderRadius: 20\r\n                                    }}\r\n                                >\r\n                                    <Text style={{\r\n                                        color: category === cat ? \"#fff\" : colors.textPrimary,\r\n                                        fontFamily: \"DMSans-Medium\"\r\n                                    }}>{cat}</Text>\r\n                                </Pressable>\r\n                            ))}\r\n                        </View>\r\n                    </ScrollView>\r\n                </View>\r\n\r\n                {/* Title */}\r\n                <View style={{ marginBottom: 24 }}>\r\n                    <Text style={{ color: colors.textSecondary, marginBottom: 8, fontFamily: \"DMSans-Medium\" }}>Subject</Text>\r\n                    <TextInput\r\n                        value={title}\r\n                        onChangeText={setTitle}\r\n                        placeholder=\"Brief subject of the complaint\"\r\n                        placeholderTextColor={colors.textSecondary}\r\n                        style={{\r\n                            backgroundColor: colors.cardBackground,\r\n                            padding: 16,\r\n                            borderRadius: 12,\r\n                            color: colors.textPrimary,\r\n                            fontFamily: \"DMSans-Medium\",\r\n                            fontSize: 16\r\n                        }}\r\n                    />\r\n                </View>\r\n\r\n                {/* Description */}\r\n                <View style={{ marginBottom: 32 }}>\r\n                    <Text style={{ color: colors.textSecondary, marginBottom: 8, fontFamily: \"DMSans-Medium\" }}>Description</Text>\r\n                    <TextInput\r\n                        value={description}\r\n                        onChangeText={setDescription}\r\n                        placeholder=\"Detailed description...\"\r\n                        placeholderTextColor={colors.textSecondary}\r\n                        multiline\r\n                        numberOfLines={6}\r\n                        textAlignVertical=\"top\"\r\n                        style={{\r\n                            backgroundColor: colors.cardBackground,\r\n                            padding: 16,\r\n                            borderRadius: 12,\r\n                            color: colors.textPrimary,\r\n                            fontFamily: \"DMSans-Medium\",\r\n                            fontSize: 16,\r\n                            minHeight: 120\r\n                        }}\r\n                    />\r\n                </View>\r\n\r\n                {/* Submit Button */}\r\n                <Pressable\r\n                    onPress={handleSubmit}\r\n                    disabled={raiseComplaintMutation.isPending}\r\n                    style={{\r\n                        backgroundColor: colors.primary,\r\n                        padding: 18,\r\n                        borderRadius: 16,\r\n                        alignItems: \"center\",\r\n                        shadowColor: colors.primary,\r\n                        shadowOffset: { width: 0, height: 4 },\r\n                        shadowOpacity: 0.3,\r\n                        shadowRadius: 8,\r\n                        elevation: 4,\r\n                        opacity: raiseComplaintMutation.isPending ? 0.7 : 1\r\n                    }}\r\n                >\r\n                    {raiseComplaintMutation.isPending ? (\r\n                        <ActivityIndicator color=\"#fff\" />\r\n                    ) : (\r\n                        <Text style={{ color: \"#fff\", fontFamily: \"DMSans-Bold\", fontSize: 18 }}>Submit Complaint</Text>\r\n                    )}\r\n                </Pressable>\r\n\r\n            </ScrollView>\r\n        </View>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\events.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":36,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":45},{"ruleId":"no-unused-vars","severity":1,"message":"'useCallback' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":47,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":58},{"ruleId":"no-unused-vars","severity":1,"message":"'StyleSheet' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":68,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":78},{"ruleId":"no-unused-vars","severity":1,"message":"'AsyncStorage' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'useTheme' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":18},{"ruleId":"no-unused-vars","severity":1,"message":"'useToast' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":18},{"ruleId":"react/display-name","severity":2,"message":"Component definition is missing display name","line":17,"column":21,"nodeType":"CallExpression","messageId":"noDisplayName","endLine":97,"endColumn":3},{"ruleId":"react/display-name","severity":2,"message":"Component definition is missing display name","line":108,"column":19,"nodeType":"CallExpression","messageId":"noDisplayName","endLine":179,"endColumn":3},{"ruleId":"no-unused-vars","severity":1,"message":"'navigation' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":182,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":182,"endColumn":19},{"ruleId":"no-undef","severity":2,"message":"'apiConfig' is not defined.","line":190,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":190,"endColumn":14},{"ruleId":"no-undef","severity":2,"message":"'apiConfig' is not defined.","line":190,"column":19,"nodeType":"Identifier","messageId":"undef","endLine":190,"endColumn":28},{"ruleId":"no-undef","severity":2,"message":"'apiConfig' is not defined.","line":198,"column":8,"nodeType":"Identifier","messageId":"undef","endLine":198,"endColumn":17},{"ruleId":"no-undef","severity":2,"message":"'apiConfig' is not defined.","line":204,"column":37,"nodeType":"Identifier","messageId":"undef","endLine":204,"endColumn":46},{"ruleId":"no-undef","severity":2,"message":"'apiConfig' is not defined.","line":204,"column":51,"nodeType":"Identifier","messageId":"undef","endLine":204,"endColumn":60},{"ruleId":"no-undef","severity":2,"message":"'showToast' is not defined.","line":207,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":207,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'showToast' is not defined.","line":210,"column":25,"nodeType":"Identifier","messageId":"undef","endLine":210,"endColumn":34},{"ruleId":"no-undef","severity":2,"message":"'apiConfig' is not defined.","line":214,"column":47,"nodeType":"Identifier","messageId":"undef","endLine":214,"endColumn":56},{"ruleId":"no-undef","severity":2,"message":"'apiConfig' is not defined.","line":214,"column":61,"nodeType":"Identifier","messageId":"undef","endLine":214,"endColumn":70},{"ruleId":"no-undef","severity":2,"message":"'showToast' is not defined.","line":217,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":217,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'showToast' is not defined.","line":221,"column":25,"nodeType":"Identifier","messageId":"undef","endLine":221,"endColumn":34},{"ruleId":"no-undef","severity":2,"message":"'apiConfig' is not defined.","line":225,"column":45,"nodeType":"Identifier","messageId":"undef","endLine":225,"endColumn":54},{"ruleId":"no-undef","severity":2,"message":"'apiConfig' is not defined.","line":225,"column":59,"nodeType":"Identifier","messageId":"undef","endLine":225,"endColumn":68},{"ruleId":"no-undef","severity":2,"message":"'showToast' is not defined.","line":228,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":228,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'showToast' is not defined.","line":230,"column":25,"nodeType":"Identifier","messageId":"undef","endLine":230,"endColumn":34},{"ruleId":"no-unused-vars","severity":1,"message":"'setRefreshFlag' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":233,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":233,"endColumn":37},{"ruleId":"no-unused-vars","severity":1,"message":"'eventTitle' is defined but never used. Allowed unused args must match /^_/u.","line":253,"column":39,"nodeType":"Identifier","messageId":"unusedVar","endLine":253,"endColumn":49},{"ruleId":"no-undef","severity":2,"message":"'setRefreshing' is not defined.","line":258,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":258,"endColumn":18},{"ruleId":"no-undef","severity":2,"message":"'setRefreshing' is not defined.","line":260,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":260,"endColumn":18},{"ruleId":"no-undef","severity":2,"message":"'styles' is not defined.","line":317,"column":18,"nodeType":"Identifier","messageId":"undef","endLine":317,"endColumn":24},{"ruleId":"no-undef","severity":2,"message":"'refreshing' is not defined.","line":322,"column":39,"nodeType":"Identifier","messageId":"undef","endLine":322,"endColumn":49},{"ruleId":"no-undef","severity":2,"message":"'colors' is not defined.","line":322,"column":82,"nodeType":"Identifier","messageId":"undef","endLine":322,"endColumn":88},{"ruleId":"no-undef","severity":2,"message":"'colors' is not defined.","line":322,"column":110,"nodeType":"Identifier","messageId":"undef","endLine":322,"endColumn":116},{"ruleId":"no-undef","severity":2,"message":"'styles' is not defined.","line":329,"column":25,"nodeType":"Identifier","messageId":"undef","endLine":329,"endColumn":31},{"ruleId":"no-unused-vars","severity":1,"message":"'month' is defined but never used. Allowed unused args must match /^_/u.","line":333,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":333,"endColumn":36},{"ruleId":"no-undef","severity":2,"message":"'colors' is not defined.","line":344,"column":27,"nodeType":"Identifier","messageId":"undef","endLine":344,"endColumn":33},{"ruleId":"no-undef","severity":2,"message":"'styles' is not defined.","line":366,"column":29,"nodeType":"Identifier","messageId":"undef","endLine":366,"endColumn":35},{"ruleId":"no-undef","severity":2,"message":"'colors' is not defined.","line":372,"column":58,"nodeType":"Identifier","messageId":"undef","endLine":372,"endColumn":64},{"ruleId":"no-undef","severity":2,"message":"'colors' is not defined.","line":373,"column":41,"nodeType":"Identifier","messageId":"undef","endLine":373,"endColumn":47},{"ruleId":"no-undef","severity":2,"message":"'colors' is not defined.","line":377,"column":69,"nodeType":"Identifier","messageId":"undef","endLine":377,"endColumn":75},{"ruleId":"no-undef","severity":2,"message":"'colors' is not defined.","line":378,"column":41,"nodeType":"Identifier","messageId":"undef","endLine":378,"endColumn":47},{"ruleId":"no-undef","severity":2,"message":"'styles' is not defined.","line":388,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":388,"endColumn":37},{"ruleId":"no-undef","severity":2,"message":"'colors' is not defined.","line":389,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":389,"endColumn":37},{"ruleId":"no-undef","severity":2,"message":"'styles' is not defined.","line":429,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":429,"endColumn":19},{"ruleId":"no-undef","severity":2,"message":"'colors' is not defined.","line":433,"column":54,"nodeType":"Identifier","messageId":"undef","endLine":433,"endColumn":60}],"suppressedMessages":[],"errorCount":34,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useMemo, useEffect, useCallback } from \"react\";\r\nimport { ScrollView, View, Text, Pressable, Alert, RefreshControl, StyleSheet, ActivityIndicator } from \"react-native\";\r\nimport { useNavigation } from \"@react-navigation/native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\n\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\n\r\nimport { useTheme } from \"../theme\";\r\nimport { useToast } from \"../components/ToastProvider\";\r\nimport Header from \"../components/Header\";\r\nimport EventFormModal from \"../components/EventFormModal\";\r\nimport ModernCalendar from \"../components/ModernCalendar\";\r\nimport { useApiQuery, useApiMutation, createApiMutationFn } from \"../hooks/useApi\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\n\r\n// Memoized day renderer component for performance\r\nconst DayRenderer = React.memo(({ date, state, marking, onDayPress, colors }) => {\r\n  const hasSchoolEvent = marking?.hasSchoolEvent;\r\n  const hasEvent = marking?.marked;\r\n  const isSelected = marking?.selected;\r\n  const isToday = state === 'today';\r\n\r\n  return (\r\n    <Pressable\r\n      onPress={() => onDayPress({ dateString: date.dateString })}\r\n      style={{\r\n        width: 40,\r\n        height: 40, // Reduced height for vertical compactness\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n        position: 'relative',\r\n      }}\r\n    >\r\n      {/* Circle border for school events */}\r\n      {hasSchoolEvent && (\r\n        <View\r\n          style={{\r\n            position: 'absolute',\r\n            width: 42,\r\n            height: 42,\r\n            borderRadius: 20,\r\n            borderWidth: 2,\r\n            borderColor: '#FFD700',\r\n          }}\r\n        />\r\n      )}\r\n\r\n      {/* Selected background */}\r\n      {isSelected && (\r\n        <View\r\n          style={{\r\n            position: 'absolute',\r\n            width: 40,\r\n            height: 40,\r\n            borderRadius: 20,\r\n            backgroundColor: colors.primary,\r\n          }}\r\n        />\r\n      )}\r\n\r\n      {/* Date text */}\r\n      <Text\r\n        style={{\r\n          fontSize: 16,\r\n          fontWeight: isSelected ? '600' : isToday ? '600' : '400',\r\n          color: isSelected ? colors.white : state === 'disabled' ? colors.textSecondary : colors.textPrimary,\r\n          zIndex: 1,\r\n        }}\r\n      >\r\n        {date.day}\r\n      </Text>\r\n\r\n      {/* Dots for events */}\r\n      {hasEvent && !isSelected && !hasSchoolEvent && (\r\n        <View\r\n          style={{\r\n            position: 'absolute',\r\n            bottom: 2,\r\n            width: 4,\r\n            height: 4,\r\n            borderRadius: 2,\r\n            backgroundColor: colors.primary,\r\n          }}\r\n        />\r\n      )}\r\n    </Pressable>\r\n  );\r\n}, (prevProps, nextProps) => {\r\n  // Custom comparison for memoization - only re-render if these props change\r\n  return (\r\n    prevProps.marking?.hasSchoolEvent === nextProps.marking?.hasSchoolEvent &&\r\n    prevProps.marking?.marked === nextProps.marking?.marked &&\r\n    prevProps.marking?.selected === nextProps.marking?.selected &&\r\n    prevProps.state === nextProps.state &&\r\n    prevProps.date?.dateString === nextProps.date?.dateString\r\n  );\r\n});\r\n\r\nimport { formatDate } from \"../utils/date\";\r\n\r\n// ... inside component\r\n// Helper to format dates for display in Indian format (DD-MM-YYYY)\r\nconst formatIndianDate = (dateInput) => {\r\n  return formatDate(dateInput);\r\n};\r\n\r\n// Memoized EventCard component with custom comparison for optimal performance\r\nconst EventCard = React.memo(({ event, styles, colors, isAdmin, onEdit, onDelete }) => {\r\n  // Sanitize event data to prevent rendering issues\r\n  const title = event.title?.trim() || 'Untitled Event';\r\n  const description = event.description?.trim();\r\n  const hasValidDescription = description && description.length > 1;\r\n\r\n  return (\r\n    <View style={styles.cardMinimal}>\r\n      <View style={{ flexDirection: 'row', justifyContent: 'space-between', alignItems: 'flex-start' }}>\r\n        <View style={{ flex: 1, marginRight: 12 }}>\r\n          <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginBottom: 8 }} numberOfLines={2}>\r\n            {title}\r\n          </Text>\r\n          {hasValidDescription && (\r\n            <Text style={{ fontSize: 14, fontFamily: \"DMSans-Regular\", color: colors.textSecondary, lineHeight: 20, marginBottom: 12 }} numberOfLines={2}>\r\n              {description}\r\n            </Text>\r\n          )}\r\n          {event.isSchoolEvent && (\r\n            <View style={{\r\n              backgroundColor: '#FFD700' + '20',\r\n              paddingVertical: 4,\r\n              paddingHorizontal: 12,\r\n              borderRadius: 20,\r\n              alignSelf: 'flex-start',\r\n              flexDirection: 'row',\r\n              alignItems: 'center'\r\n            }}>\r\n              <MaterialIcons name=\"school\" size={14} color=\"#F59E0B\" style={{ marginRight: 4 }} />\r\n              <Text style={{ fontSize: 12, fontFamily: \"DMSans-Bold\", color: \"#F59E0B\" }}>School Event</Text>\r\n            </View>\r\n          )}\r\n        </View>\r\n        {isAdmin && (\r\n          <View style={{ flexDirection: 'row', gap: 8 }}>\r\n            <Pressable\r\n              onPress={onEdit}\r\n              style={({ pressed }) => ({\r\n                padding: 8,\r\n                backgroundColor: colors.background,\r\n                borderRadius: 8,\r\n                opacity: pressed ? 0.7 : 1,\r\n              })}\r\n            >\r\n              <MaterialIcons name=\"edit\" size={18} color={colors.textSecondary} />\r\n            </Pressable>\r\n            <Pressable\r\n              onPress={onDelete}\r\n              style={({ pressed }) => ({\r\n                padding: 8,\r\n                backgroundColor: colors.error + '15',\r\n                borderRadius: 8,\r\n                opacity: pressed ? 0.7 : 1,\r\n              })}\r\n            >\r\n              <MaterialIcons name=\"delete-outline\" size={18} color={colors.error} />\r\n            </Pressable>\r\n          </View>\r\n        )}\r\n      </View>\r\n    </View>\r\n  );\r\n}, (prevProps, nextProps) => {\r\n  // Custom comparison - only re-render if these props change\r\n  return (\r\n    prevProps.event._id === nextProps.event._id &&\r\n    prevProps.event.title === nextProps.event.title &&\r\n    prevProps.event.description === nextProps.event.description &&\r\n    prevProps.event.isSchoolEvent === nextProps.event.isSchoolEvent &&\r\n    prevProps.isAdmin === nextProps.isAdmin\r\n  );\r\n});\r\n\r\nexport default function EventsScreen() {\r\n  const navigation = useNavigation();\r\n  const today = new Date().toISOString().split('T')[0];\r\n  const [selectedDate, setSelectedDate] = useState(today);\r\n  const [isEventFormVisible, setIsEventFormVisible] = useState(false);\r\n  const [editingEvent, setEditingEvent] = useState(null);\r\n  const queryClient = useQueryClient();\r\n  const { events: allEvents, isLoading: loading, refetch } = useApiQuery(\r\n    ['events'],\r\n    apiConfig.url(apiConfig.endpoints.events.list),\r\n    {\r\n      select: (data) => data.events || [],\r\n    }\r\n  );\r\n\r\n  const { data: userData } = useApiQuery(\r\n    ['currentUser'],\r\n    `${apiConfig.baseUrl}/auth/me`\r\n  );\r\n  const isAuthenticated = userData?.role === 'admin' || userData?.role === 'super admin';\r\n\r\n  // Mutations\r\n  const createEventMutation = useApiMutation({\r\n    mutationFn: createApiMutationFn(apiConfig.url(apiConfig.endpoints.events.create), 'POST'),\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['events'] });\r\n      showToast('Event created successfully');\r\n      setIsEventFormVisible(false);\r\n    },\r\n    onError: (error) => showToast(error.message || 'Failed to create event')\r\n  });\r\n\r\n  const updateEventMutation = useApiMutation({\r\n    mutationFn: (data) => createApiMutationFn(apiConfig.url(apiConfig.endpoints.events.update(data._id)), 'PUT')(data),\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['events'] });\r\n      showToast('Event updated successfully');\r\n      setIsEventFormVisible(false);\r\n      setEditingEvent(null);\r\n    },\r\n    onError: (error) => showToast(error.message || 'Failed to update event')\r\n  });\r\n\r\n  const deleteEventMutation = useApiMutation({\r\n    mutationFn: (id) => createApiMutationFn(apiConfig.url(apiConfig.endpoints.events.delete(id)), 'DELETE')(),\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['events'] });\r\n      showToast('Event deleted successfully');\r\n    },\r\n    onError: (error) => showToast(error.message || 'Failed to delete event')\r\n  });\r\n\r\n  const [refreshFlag, setRefreshFlag] = useState(false);\r\n\r\n  const handleDateSelect = (day) => {\r\n    setSelectedDate(day.dateString);\r\n  };\r\n\r\n  // Modified handleEventCreated to toggle refreshFlag to trigger re-render\r\n  const handleEventSubmit = (eventData) => {\r\n    if (eventData._id) {\r\n      updateEventMutation.mutate(eventData);\r\n    } else {\r\n      createEventMutation.mutate(eventData);\r\n    }\r\n  };\r\n\r\n  const handleEditEvent = (eventItem) => {\r\n    setEditingEvent(eventItem);\r\n    setIsEventFormVisible(true);\r\n  };\r\n\r\n  const handleDeleteEvent = (eventId, eventTitle) => {\r\n    deleteEventMutation.mutate(eventId);\r\n  };\r\n\r\n  const onRefresh = async () => {\r\n    setRefreshing(true);\r\n    await refetch();\r\n    setRefreshing(false);\r\n  };\r\n\r\n  const filteredEvents = useMemo(\r\n    () =>\r\n      selectedDate\r\n        ? allEvents\r\n          .filter((event) => {\r\n            if (!event || !event.date) return false;\r\n            try {\r\n              return new Date(event.date).toISOString().split('T')[0] === selectedDate;\r\n            } catch (e) {\r\n              return false;\r\n            }\r\n          })\r\n          .sort((a, b) => {\r\n            // School events first (true comes before false in descending order)\r\n            if (a.isSchoolEvent && !b.isSchoolEvent) return -1;\r\n            if (!a.isSchoolEvent && b.isSchoolEvent) return 1;\r\n            return 0;\r\n          })\r\n        : [],\r\n    [selectedDate, allEvents, refreshFlag]\r\n  );\r\n\r\n  const markedDates = useMemo(() => {\r\n    const dates = allEvents.reduce((acc, curr) => {\r\n      if (!curr || !curr.date) return acc;\r\n      try {\r\n        const date = new Date(curr.date).toISOString().split('T')[0];\r\n        if (!acc[date]) {\r\n          acc[date] = {\r\n            marked: true,\r\n            hasSchoolEvent: false,\r\n          };\r\n        }\r\n        // If any event on this date is a school event, flag it\r\n        if (curr.isSchoolEvent) {\r\n          acc[date].hasSchoolEvent = true;\r\n        }\r\n      } catch (e) {\r\n        // Ignore invalid dates\r\n      }\r\n      return acc;\r\n    }, {});\r\n\r\n    if (selectedDate) {\r\n      dates[selectedDate] = {\r\n        ...dates[selectedDate],\r\n        selected: true,\r\n      };\r\n    }\r\n\r\n    return dates;\r\n  }, [selectedDate, allEvents, refreshFlag]);\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      <ScrollView\r\n        style={{ flex: 1 }}\r\n        contentContainerStyle={{ paddingBottom: 100 }}\r\n        refreshControl={\r\n          <RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} tintColor={colors.primary} />\r\n        }\r\n        showsVerticalScrollIndicator={false}\r\n      >\r\n        <View style={{ paddingHorizontal: 20, paddingTop: 20 }}>\r\n          <Header title=\"Events\" subtitle=\"View and manage events\" />\r\n\r\n          <View style={[styles.card, { padding: 0, overflow: 'hidden', marginBottom: 24 }]}>\r\n            <ModernCalendar\r\n              current={selectedDate}\r\n              onDayPress={handleDateSelect}\r\n              onMonthChange={(month) => {\r\n                // React Query handles caching automatically, no need to manually fetch range\r\n                // But if we want to prefetch, we could do it here\r\n              }}\r\n              markedDates={markedDates}\r\n              dayComponent={({ date, state, marking }) => (\r\n                <DayRenderer\r\n                  date={date}\r\n                  state={state}\r\n                  marking={marking}\r\n                  onDayPress={handleDateSelect}\r\n                  colors={colors}\r\n                />\r\n              )}\r\n              style={{\r\n                borderRadius: 24,\r\n              }}\r\n              theme={{\r\n                calendarBackground: 'transparent',\r\n                'stylesheet.day.basic': {\r\n                  base: {\r\n                    width: 40,\r\n                    height: 40,\r\n                    alignItems: 'center',\r\n                    justifyContent: 'center'\r\n                  }\r\n                }\r\n              }}\r\n            />\r\n          </View>\r\n\r\n          {selectedDate && (\r\n            <View>\r\n              <Text style={[styles.sectionTitle, { marginBottom: 16 }]}>\r\n                Events on {formatIndianDate(selectedDate)}\r\n              </Text>\r\n\r\n              {loading && filteredEvents.length === 0 ? (\r\n                <View style={{ alignItems: 'center', padding: 20 }}>\r\n                  <ActivityIndicator size=\"small\" color={colors.primary} />\r\n                  <Text style={{ color: colors.textSecondary, marginTop: 8, fontFamily: \"DMSans-Regular\" }}>Loading events...</Text>\r\n                </View>\r\n              ) : filteredEvents.length === 0 ? (\r\n                <View style={{ alignItems: 'center', padding: 40, opacity: 0.6 }}>\r\n                  <MaterialIcons name=\"event-busy\" size={48} color={colors.textSecondary} />\r\n                  <Text style={{ color: colors.textSecondary, marginTop: 16, fontSize: 16, fontFamily: \"DMSans-Medium\" }}>\r\n                    No events on this day\r\n                  </Text>\r\n                </View>\r\n              ) : (\r\n                <View style={{ gap: 12 }}>\r\n                  {filteredEvents.map((item) => (\r\n                    <EventCard\r\n                      key={item._id ?? item.id}\r\n                      event={{ ...item, date: formatIndianDate(item.date) }}\r\n                      styles={styles}\r\n                      colors={colors}\r\n                      isAdmin={isAuthenticated}\r\n                      onEdit={() => handleEditEvent(item)}\r\n                      onDelete={() => {\r\n                        Alert.alert(\r\n                          \"Delete Event\",\r\n                          `Are you sure you want to delete \"${item.title}\"? This action cannot be undone.`,\r\n                          [\r\n                            { text: \"Cancel\", style: \"cancel\" },\r\n                            { text: \"Delete\", style: \"destructive\", onPress: () => handleDeleteEvent(item._id, item.title) },\r\n                          ]\r\n                        );\r\n                      }}\r\n                    />\r\n                  ))}\r\n                </View>\r\n              )}\r\n            </View>\r\n          )}\r\n        </View>\r\n\r\n        <EventFormModal\r\n          isVisible={isEventFormVisible}\r\n          onClose={() => {\r\n            setIsEventFormVisible(false);\r\n            setEditingEvent(null);\r\n          }}\r\n          selectedDate={selectedDate}\r\n          onSuccess={(eventData) => {\r\n            handleEventSubmit(eventData);\r\n          }}\r\n          editItem={editingEvent}\r\n        />\r\n      </ScrollView>\r\n\r\n      {/* FAB for Add Event - Outside ScrollView to stay fixed */}\r\n      {isAuthenticated && (\r\n        <Pressable\r\n          onPress={() => setIsEventFormVisible(true)}\r\n          style={({ pressed }) => ([\r\n            styles.fab,\r\n            { opacity: pressed ? 0.9 : 1 }\r\n          ])}\r\n        >\r\n          <MaterialIcons name=\"add\" size={24} color={colors.white} />\r\n        </Pressable>\r\n      )}\r\n    </View>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\history.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":36},{"ruleId":"no-unused-vars","severity":1,"message":"'AsyncStorage' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":22,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'showToast' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":23,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    RefreshControl,\r\n    ActivityIndicator,\r\n    Pressable,\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useRouter } from \"expo-router\";\r\nimport { useTheme } from \"../theme\";\r\nimport { useApiQuery } from \"../hooks/useApi\";\r\nimport apiConfig from \"../config/apiConfig\";\r\nimport { useToast } from \"../components/ToastProvider\";\r\nimport AppHeader from \"../components/Header\";\r\nimport { formatDate } from \"../utils/date\";\r\n\r\nexport default function HistoryScreen() {\r\n    const router = useRouter();\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n\r\n    const [refreshing, setRefreshing] = useState(false);\r\n\r\n    // Fetch User Role\r\n    const { data: userData } = useApiQuery(\r\n        ['currentUser'],\r\n        `${apiConfig.baseUrl}/auth/me`\r\n    );\r\n    const userRole = userData?.role;\r\n\r\n    // Fetch Exams (Only for students)\r\n    const { data: examsData, isLoading: loading, refetch } = useApiQuery(\r\n        ['studentExamHistory'],\r\n        `${apiConfig.baseUrl}/exams/schedule/student`,\r\n        { enabled: userRole === 'student' }\r\n    );\r\n\r\n    const exams = (examsData || []).filter(exam => new Date(exam.date) < new Date());\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        if (userRole === 'student') {\r\n            await refetch();\r\n        }\r\n        setRefreshing(false);\r\n    };\r\n\r\n    const renderExams = () => {\r\n        if (userRole !== 'student') {\r\n            return (\r\n                <View style={{ alignItems: \"center\", marginTop: 60, paddingHorizontal: 20 }}>\r\n                    <MaterialIcons name=\"info-outline\" size={64} color={colors.textSecondary} />\r\n                    <Text style={{ color: colors.textSecondary, marginTop: 16, fontSize: 16, textAlign: \"center\" }}>\r\n                        Exam history is available in the Reports section of Academic Year or per class in Exam Schedule.\r\n                    </Text>\r\n                    <Pressable\r\n                        onPress={() => router.push(\"/admin/academic-year\")}\r\n                        style={{\r\n                            marginTop: 20,\r\n                            backgroundColor: colors.primary,\r\n                            paddingHorizontal: 20,\r\n                            paddingVertical: 10,\r\n                            borderRadius: 8\r\n                        }}\r\n                    >\r\n                        <Text style={{ color: \"#fff\", fontWeight: \"600\" }}>Go to Academic Year</Text>\r\n                    </Pressable>\r\n                </View>\r\n            );\r\n        }\r\n\r\n        return (\r\n            <View>\r\n                {exams.length === 0 ? (\r\n                    <View style={{ alignItems: \"center\", marginTop: 60, opacity: 0.6 }}>\r\n                        <MaterialIcons name=\"event-note\" size={64} color={colors.textSecondary} />\r\n                        <Text style={{ color: colors.textSecondary, marginTop: 16, fontSize: 16 }}>\r\n                            No past exams found\r\n                        </Text>\r\n                    </View>\r\n                ) : (\r\n                    exams.map((item) => (\r\n                        <View\r\n                            key={item._id}\r\n                            style={{\r\n                                backgroundColor: colors.cardBackground,\r\n                                borderRadius: 16,\r\n                                padding: 16,\r\n                                marginBottom: 12,\r\n                                shadowColor: \"#000\",\r\n                                shadowOffset: { width: 0, height: 1 },\r\n                                shadowOpacity: 0.05,\r\n                                shadowRadius: 4,\r\n                                elevation: 1,\r\n                                borderLeftWidth: 4,\r\n                                borderLeftColor: colors.secondary\r\n                            }}\r\n                        >\r\n                            <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", marginBottom: 8 }}>\r\n                                <Text style={{ fontSize: 16, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, flex: 1 }}>\r\n                                    {item.name}\r\n                                </Text>\r\n                                <View style={{ backgroundColor: colors.secondary + \"15\", paddingHorizontal: 8, paddingVertical: 4, borderRadius: 6 }}>\r\n                                    <Text style={{ fontSize: 12, color: colors.secondary, fontFamily: \"DMSans-Bold\" }}>\r\n                                        {item.subject?.name}\r\n                                    </Text>\r\n                                </View>\r\n                            </View>\r\n\r\n                            <View style={{ flexDirection: \"row\", gap: 12, marginBottom: 12 }}>\r\n                                <View style={{ backgroundColor: colors.background, paddingHorizontal: 8, paddingVertical: 4, borderRadius: 4 }}>\r\n                                    <Text style={{ fontSize: 12, color: colors.textSecondary, textTransform: \"capitalize\" }}>\r\n                                        {item.type}\r\n                                    </Text>\r\n                                </View>\r\n                                {item.room && (\r\n                                    <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 4 }}>\r\n                                        <MaterialIcons name=\"meeting-room\" size={14} color={colors.textSecondary} />\r\n                                        <Text style={{ fontSize: 12, color: colors.textSecondary }}>\r\n                                            Room: {item.room}\r\n                                        </Text>\r\n                                    </View>\r\n                                )}\r\n                            </View>\r\n\r\n                            <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\", borderTopWidth: 1, borderTopColor: colors.border, paddingTop: 12 }}>\r\n                                <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 6 }}>\r\n                                    <MaterialIcons name=\"class\" size={16} color={colors.textSecondary} />\r\n                                    <Text style={{ fontSize: 13, color: colors.textSecondary }}>\r\n                                        {item.class?.name} {item.class?.section}\r\n                                    </Text>\r\n                                </View>\r\n                                <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 6 }}>\r\n                                    <MaterialIcons name=\"event\" size={16} color={colors.textSecondary} />\r\n                                    <Text style={{ fontSize: 13, color: colors.textSecondary }}>\r\n                                        {formatDate(item.date)}\r\n                                    </Text>\r\n                                </View>\r\n                            </View>\r\n                        </View>\r\n                    ))\r\n                )}\r\n            </View>\r\n        );\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <View style={{ flex: 1, backgroundColor: colors.background, justifyContent: \"center\", alignItems: \"center\" }}>\r\n                <ActivityIndicator size=\"large\" color={colors.primary} />\r\n            </View>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <View style={{ padding: 16, paddingTop: 24 }}>\r\n                <AppHeader title=\"History\" subtitle={userRole === 'student' ? \"Past exams\" : \"Reports\"} showBack />\r\n            </View>\r\n\r\n            <ScrollView\r\n                refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} />}\r\n                contentContainerStyle={{ padding: 16, paddingTop: 0, paddingBottom: 100 }}\r\n            >\r\n                {renderExams()}\r\n            </ScrollView>\r\n        </View>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\index.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'StyleSheet' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":71,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":81}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { MaterialIcons } from \"@expo/vector-icons\";\r\nimport { View, Text, ScrollView, Animated, StatusBar, RefreshControl, StyleSheet } from \"react-native\";\r\nimport { useState, useEffect } from \"react\";\r\nimport useFade from \"../hooks/useFade\";\r\nimport { useTheme } from \"../theme\";\r\nimport useSchoolInfo from \"../hooks/useSchoolInfo\";\r\nimport Header from \"../components/Header\";\r\n\r\nimport SchoolPhotoCarousel from \"../components/SchoolPhotoCarousel\";\r\n\r\nimport { useToast } from \"../components/ToastProvider\";\r\n\r\nimport apiConfig from \"../config/apiConfig\";\r\nimport { useApiQuery } from \"../hooks/useApi\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\n\r\n// Global variable to track if welcome/latest notification has been shown in this session\r\nlet hasShownNotification = false;\r\n\r\nexport default function HomeScreen() {\r\n  const fadeAnim = useFade();\r\n  const { styles, colors, mode } = useTheme();\r\n  const { schoolInfo: SCHOOL, refresh } = useSchoolInfo();\r\n  const [refreshing, setRefreshing] = useState(false);\r\n  const { showToast } = useToast();\r\n\r\n  const onRefresh = async () => {\r\n    setRefreshing(true);\r\n    try {\r\n      await refresh(true);\r\n    } catch (err) {\r\n      // Suppress error\r\n    } finally {\r\n      setRefreshing(false);\r\n    }\r\n  };\r\n\r\n  const { data: userData, isError } = useApiQuery(\r\n    ['currentUser'],\r\n    `${apiConfig.baseUrl}/auth/me`,\r\n    {\r\n      enabled: true,\r\n      staleTime: Infinity,\r\n      retry: false,\r\n    }\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (isError) {\r\n      // If we can't fetch user details (likely 401/403), clear session and redirect\r\n      const handleLogout = async () => {\r\n        await AsyncStorage.multiRemove(['@auth_token', '@auth_user']);\r\n        // Optional: router.replace('/login'); \r\n        // For now, we just clear storage so the UI reflects logged out state\r\n        // or let the user manually log in again.\r\n      };\r\n      handleLogout();\r\n    }\r\n  }, [isError]);\r\n\r\n  const { data: notificationsData } = useApiQuery(\r\n    ['notifications', 'latest'],\r\n    `${apiConfig.baseUrl}/notifications`\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (notificationsData && !hasShownNotification && notificationsData.notifications && notificationsData.notifications.length > 0) {\r\n      const latest = notificationsData.notifications[0];\r\n      showToast(latest.message || latest.title || \"Welcome back!\", \"info\");\r\n      hasShownNotification = true;\r\n    }\r\n  }, [notificationsData]);\r\n\r\n  return (\r\n    <ScrollView\r\n      style={styles.container}\r\n      contentContainerStyle={styles.contentPaddingBottom}\r\n      refreshControl={\r\n        <RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} />\r\n      }\r\n    >\r\n      <StatusBar\r\n        barStyle={mode === \"dark\" ? \"light-content\" : \"dark-content\"}\r\n        backgroundColor={colors.background}\r\n      />\r\n\r\n      {/* Minimalist Header */}\r\n      <Header title={SCHOOL.name} subtitle={userData?.name ? `Welcome, ${userData.name.split(' ')[0]}` : \"Welcome\"} variant=\"welcome\" />\r\n\r\n      {/* School Photo Carousel */}\r\n      <SchoolPhotoCarousel photos={SCHOOL.photoUrl} />\r\n\r\n      {/* About Us Section */}\r\n      <Animated.View style={[styles.cardMinimal, { opacity: fadeAnim }]}>\r\n        <View style={{ flexDirection: 'row', alignItems: 'center', marginBottom: 16 }}>\r\n          <View style={{\r\n            width: 40,\r\n            height: 40,\r\n            borderRadius: 12,\r\n            backgroundColor: colors.primary + '15',\r\n            justifyContent: 'center',\r\n            alignItems: 'center',\r\n            marginRight: 12\r\n          }}>\r\n            <MaterialIcons name=\"apartment\" size={24} color={colors.primary} />\r\n          </View>\r\n          <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>About Us</Text>\r\n        </View>\r\n        <Text style={[styles.text, { marginBottom: 0 }]}>{SCHOOL.about}</Text>\r\n      </Animated.View>\r\n\r\n      {/* Branches Section */}\r\n      <Animated.View style={[styles.cardMinimal, { opacity: fadeAnim }]}>\r\n        <View style={{ flexDirection: 'row', alignItems: 'center', marginBottom: 16 }}>\r\n          <View style={{\r\n            width: 40,\r\n            height: 40,\r\n            borderRadius: 12,\r\n            backgroundColor: colors.secondary + '15',\r\n            justifyContent: 'center',\r\n            alignItems: 'center',\r\n            marginRight: 12\r\n          }}>\r\n            <MaterialIcons name=\"school\" size={24} color={colors.secondary} />\r\n          </View>\r\n          <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>Branches</Text>\r\n        </View>\r\n\r\n        <View style={{ gap: 12 }}>\r\n          <View style={{ flexDirection: 'row', alignItems: 'flex-start' }}>\r\n            <View style={{\r\n              width: 6,\r\n              height: 6,\r\n              borderRadius: 3,\r\n              backgroundColor: colors.secondary,\r\n              marginTop: 8,\r\n              marginRight: 10\r\n            }} />\r\n            <Text style={[styles.text, { flex: 1, marginBottom: 0 }]}>\r\n              <Text style={{ fontFamily: \"DMSans-Bold\" }}>Renuka Nagar, Mangasuli</Text>\r\n              {\"\\n\"}Kindergarten to 8th Standard (9th and 10th opening soon).\r\n            </Text>\r\n          </View>\r\n\r\n          <View style={{ flexDirection: 'row', alignItems: 'flex-start' }}>\r\n            <View style={{\r\n              width: 6,\r\n              height: 6,\r\n              borderRadius: 3,\r\n              backgroundColor: colors.secondary,\r\n              marginTop: 8,\r\n              marginRight: 10\r\n            }} />\r\n            <Text style={[styles.text, { flex: 1, marginBottom: 0 }]}>\r\n              <Text style={{ fontFamily: \"DMSans-Bold\" }}>Ugar Khurd</Text>\r\n              {\"\\n\"}Only Kindergarten.\r\n            </Text>\r\n          </View>\r\n        </View>\r\n      </Animated.View>\r\n\r\n      {/* Mission Section */}\r\n      <Animated.View style={[styles.cardMinimal, { opacity: fadeAnim }]}>\r\n        <View style={{ flexDirection: 'row', alignItems: 'center', marginBottom: 16 }}>\r\n          <View style={{\r\n            width: 40,\r\n            height: 40,\r\n            borderRadius: 12,\r\n            backgroundColor: '#FFD700' + '20',\r\n            justifyContent: 'center',\r\n            alignItems: 'center',\r\n            marginRight: 12\r\n          }}>\r\n            <MaterialIcons name=\"flag\" size={24} color=\"#F59E0B\" />\r\n          </View>\r\n          <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>Our Mission</Text>\r\n        </View>\r\n        <Text style={[styles.text, { marginBottom: 0 }]}>{SCHOOL.mission}</Text>\r\n      </Animated.View>\r\n    </ScrollView>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\login.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Image' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":118,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":123},{"ruleId":"no-unused-vars","severity":1,"message":"'mode' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":15,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { View, Text, TextInput, Pressable, ScrollView, StatusBar, ActivityIndicator, KeyboardAvoidingView, Platform, Image } from 'react-native';\r\nimport { MaterialIcons } from '@expo/vector-icons';\r\nimport { useTheme } from '../theme';\r\nimport AsyncStorage from '@react-native-async-storage/async-storage';\r\nimport { useRouter } from 'expo-router';\r\nimport apiConfig from \"../config/apiConfig\";\r\nimport { useApiMutation, createApiMutationFn } from \"../hooks/useApi\";\r\nimport { LinearGradient } from 'expo-linear-gradient';\r\n\r\nexport default function Login() {\r\n  const [phone, setPhone] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const { styles, colors, mode, gradients } = useTheme();\r\n  const router = useRouter();\r\n\r\n  const loginMutation = useApiMutation({\r\n    mutationFn: createApiMutationFn(apiConfig.url(apiConfig.endpoints.auth.login), 'POST'),\r\n    onSuccess: async (data) => {\r\n      if (data.token) {\r\n        await AsyncStorage.setItem('@auth_token', data.token);\r\n        await AsyncStorage.setItem('@auth_user', JSON.stringify(data.user));\r\n        router.replace('/');\r\n      } else {\r\n        alert(data.message || 'Login failed');\r\n      }\r\n    },\r\n    onError: (error) => {\r\n      console.error('Login error:', error);\r\n      alert(error.message || 'Network error. Please try again.');\r\n    }\r\n  });\r\n\r\n  const handleLogin = () => {\r\n    if (!phone || !password) {\r\n      alert('Please enter both phone number and password.');\r\n      return;\r\n    }\r\n\r\n    loginMutation.mutate({ phone, password });\r\n  };\r\n\r\n  const loading = loginMutation.isPending;\r\n\r\n  return (\r\n    <KeyboardAvoidingView\r\n      behavior={Platform.OS === \"ios\" ? \"padding\" : \"height\"}\r\n      style={{ flex: 1 }}\r\n    >\r\n      <StatusBar\r\n        barStyle=\"light-content\"\r\n        backgroundColor=\"transparent\"\r\n        translucent\r\n      />\r\n\r\n      <LinearGradient\r\n        colors={gradients.primary}\r\n        style={{ flex: 1 }}\r\n        start={{ x: 0, y: 0 }}\r\n        end={{ x: 1, y: 1 }}\r\n      >\r\n        <ScrollView\r\n          contentContainerStyle={{ flexGrow: 1, justifyContent: 'center', padding: 24 }}\r\n          showsVerticalScrollIndicator={false}\r\n        >\r\n          <View style={{ alignItems: 'center', marginBottom: 40 }}>\r\n            <View style={{\r\n              width: 80,\r\n              height: 80,\r\n              backgroundColor: 'rgba(255,255,255,0.2)',\r\n              borderRadius: 24,\r\n              justifyContent: 'center',\r\n              alignItems: 'center',\r\n              marginBottom: 24,\r\n              borderWidth: 1,\r\n              borderColor: 'rgba(255,255,255,0.3)'\r\n            }}>\r\n              <MaterialIcons name=\"school\" size={40} color=\"#fff\" />\r\n            </View>\r\n            <Text style={{\r\n              fontSize: 32,\r\n              fontFamily: \"DMSans-Bold\",\r\n              color: \"#fff\",\r\n              marginBottom: 8,\r\n              textAlign: 'center'\r\n            }}>\r\n              Welcome Back\r\n            </Text>\r\n            <Text style={{\r\n              fontSize: 16,\r\n              fontFamily: \"DMSans-Regular\",\r\n              color: \"rgba(255,255,255,0.8)\",\r\n              textAlign: 'center'\r\n            }}>\r\n              Sign in to continue to your account\r\n            </Text>\r\n          </View>\r\n\r\n          <View style={[styles.card, { padding: 32, borderRadius: 32 }]}>\r\n            <View style={{ marginBottom: 20 }}>\r\n              <Text style={[styles.label, { marginLeft: 4, marginBottom: 8 }]}>Phone Number</Text>\r\n              <View style={[styles.input, { flexDirection: 'row', alignItems: 'center', paddingHorizontal: 16, height: 56 }]}>\r\n                <MaterialIcons name=\"phone\" size={20} color={colors.textSecondary} style={{ marginRight: 12 }} />\r\n                <TextInput\r\n                  style={{ flex: 1, fontSize: 16, color: colors.textPrimary, fontFamily: \"DMSans-Regular\", height: '100%' }}\r\n                  value={phone}\r\n                  onChangeText={setPhone}\r\n                  placeholder=\"Enter phone number\"\r\n                  placeholderTextColor={colors.textSecondary}\r\n                  keyboardType=\"number-pad\"\r\n                  maxLength={10}\r\n                  editable={!loading}\r\n                  autoComplete=\"tel\"\r\n                />\r\n              </View>\r\n            </View>\r\n\r\n            <View style={{ marginBottom: 32 }}>\r\n              <Text style={[styles.label, { marginLeft: 4, marginBottom: 8 }]}>Password</Text>\r\n              <View style={[styles.input, { flexDirection: 'row', alignItems: 'center', paddingHorizontal: 16, height: 56 }]}>\r\n                <MaterialIcons name=\"lock\" size={20} color={colors.textSecondary} style={{ marginRight: 12 }} />\r\n                <TextInput\r\n                  style={{ flex: 1, fontSize: 16, color: colors.textPrimary, fontFamily: \"DMSans-Regular\", height: '100%' }}\r\n                  value={password}\r\n                  onChangeText={setPassword}\r\n                  placeholder=\"Enter password\"\r\n                  secureTextEntry={!showPassword}\r\n                  placeholderTextColor={colors.textSecondary}\r\n                  editable={!loading}\r\n                  autoCapitalize=\"none\"\r\n                  autoComplete=\"password\"\r\n                />\r\n                <Pressable onPress={() => setShowPassword(!showPassword)} style={{ padding: 4 }}>\r\n                  <MaterialIcons name={showPassword ? \"visibility\" : \"visibility-off\"} size={20} color={colors.textSecondary} />\r\n                </Pressable>\r\n              </View>\r\n            </View>\r\n\r\n            <Pressable\r\n              style={({ pressed }) => [\r\n                styles.buttonLarge,\r\n                {\r\n                  width: \"100%\",\r\n                  opacity: pressed || loading ? 0.8 : 1,\r\n                  transform: [{ scale: pressed ? 0.98 : 1 }]\r\n                }\r\n              ]}\r\n              onPress={handleLogin}\r\n              disabled={loading}\r\n            >\r\n              {loading ? (\r\n                <ActivityIndicator color=\"#fff\" />\r\n              ) : (\r\n                <Text style={[styles.buttonText, { fontSize: 18 }]}>Sign In</Text>\r\n              )}\r\n            </Pressable>\r\n          </View>\r\n\r\n          <View style={{ marginTop: 24, alignItems: 'center' }}>\r\n            <Text style={{ color: 'rgba(255,255,255,0.6)', fontSize: 14 }}>\r\n              Protected by School Management System\r\n            </Text>\r\n          </View>\r\n        </ScrollView>\r\n      </LinearGradient>\r\n    </KeyboardAvoidingView>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\menu.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Image' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":62,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":67},{"ruleId":"no-unused-vars","severity":1,"message":"'Ionicons' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":46},{"ruleId":"no-unused-vars","severity":1,"message":"'LinearGradient' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":24},{"ruleId":"no-unused-vars","severity":1,"message":"'gradients' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":14,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":52},{"ruleId":"no-unused-vars","severity":1,"message":"'showToast' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":15,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { View, Text, ScrollView, Pressable, Switch, Linking, Image } from 'react-native';\r\nimport { useRouter } from 'expo-router';\r\nimport { MaterialIcons, FontAwesome, Ionicons } from '@expo/vector-icons';\r\nimport { useTheme } from '../theme';\r\nimport { useToast } from '../components/ToastProvider';\r\nimport Header from '../components/Header';\r\nimport AsyncStorage from '@react-native-async-storage/async-storage';\r\nimport { SCHOOL } from '../constants/basic-info';\r\nimport { LinearGradient } from 'expo-linear-gradient';\r\n\r\nexport default function MenuScreen() {\r\n    const router = useRouter();\r\n    const { styles, colors, mode, toggle, gradients } = useTheme();\r\n    const { showToast } = useToast();\r\n\r\n    const handleLogout = async () => {\r\n        try {\r\n            await AsyncStorage.removeItem('@auth_token');\r\n            await AsyncStorage.removeItem('@auth_user');\r\n            router.replace('/login');\r\n        } catch (error) {\r\n            console.error('Logout failed:', error);\r\n        }\r\n    };\r\n\r\n    const handlePress = async (appUrl, fallbackUrl) => {\r\n        try {\r\n            const supported = await Linking.canOpenURL(appUrl);\r\n            if (supported) {\r\n                await Linking.openURL(appUrl);\r\n            } else {\r\n                await Linking.openURL(fallbackUrl);\r\n            }\r\n        } catch (err) {\r\n            console.error(\"Failed to open link:\", err);\r\n        }\r\n    };\r\n\r\n    const [user, setUser] = useState(null);\r\n\r\n    React.useEffect(() => {\r\n        loadUser();\r\n    }, []);\r\n\r\n    const loadUser = async () => {\r\n        try {\r\n            const storedUser = await AsyncStorage.getItem('@auth_user');\r\n            if (storedUser) {\r\n                setUser(JSON.parse(storedUser));\r\n            }\r\n        } catch (e) {\r\n            console.warn('Failed to load user', e);\r\n        }\r\n    };\r\n\r\n    const navigateToComplaints = () => {\r\n        router.push('/complaints');\r\n    };\r\n\r\n    const menuItems = [\r\n        {\r\n            title: \"Profile\",\r\n            subtitle: \"View & edit your profile\",\r\n            icon: \"person\",\r\n            route: \"/profile\",\r\n            color: \"#673AB7\"\r\n        },\r\n        {\r\n            title: \"Events\",\r\n            subtitle: \"School calendar & upcoming events\",\r\n            icon: \"event\",\r\n            route: \"/events\",\r\n            color: \"#4CAF50\"\r\n        },\r\n        {\r\n            title: \"News\",\r\n            subtitle: \"Latest announcements & updates\",\r\n            icon: \"article\",\r\n            route: \"/news\",\r\n            color: \"#2196F3\"\r\n        },\r\n        // Only show Complaints if user is logged in\r\n        ...(user ? [{\r\n            title: \"Complaints & Feedback\",\r\n            subtitle: \"Raise issues or share feedback\",\r\n            icon: \"feedback\",\r\n            action: navigateToComplaints,\r\n            color: \"#FF5722\"\r\n        }] : []),\r\n\r\n    ];\r\n\r\n    return (\r\n        <View style={styles.container}>\r\n            <Header title=\"Menu\" subtitle=\"Settings & More\" />\r\n\r\n            <ScrollView showsVerticalScrollIndicator={false} contentContainerStyle={{ paddingBottom: 100 }}>\r\n\r\n                {/* Quick Actions Grid */}\r\n                <View style={{ flexDirection: 'row', flexWrap: 'wrap', gap: 12, marginTop: 10 }}>\r\n                    {menuItems.map((item, index) => (\r\n                        <Pressable\r\n                            key={index}\r\n                            onPress={() => item.route ? router.push(item.route) : item.action()}\r\n                            style={({ pressed }) => ({\r\n                                width: '48%',\r\n                                backgroundColor: colors.cardBackground,\r\n                                borderRadius: 20,\r\n                                padding: 16,\r\n                                marginBottom: 4,\r\n                                borderWidth: 1,\r\n                                borderColor: mode === 'dark' ? 'rgba(255,255,255,0.05)' : 'rgba(0,0,0,0.02)',\r\n                                shadowColor: colors.shadow,\r\n                                shadowOffset: { width: 0, height: 4 },\r\n                                shadowOpacity: mode === 'dark' ? 0.2 : 0.04,\r\n                                shadowRadius: 8,\r\n                                elevation: 2,\r\n                                opacity: pressed ? 0.9 : 1,\r\n                                transform: [{ scale: pressed ? 0.98 : 1 }]\r\n                            })}\r\n                        >\r\n                            <View style={{\r\n                                width: 48,\r\n                                height: 48,\r\n                                borderRadius: 14,\r\n                                backgroundColor: item.color + '15',\r\n                                alignItems: 'center',\r\n                                justifyContent: 'center',\r\n                                marginBottom: 12\r\n                            }}>\r\n                                <MaterialIcons name={item.icon} size={24} color={item.color} />\r\n                            </View>\r\n                            <Text style={{ fontSize: 16, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginBottom: 4 }}>\r\n                                {item.title}\r\n                            </Text>\r\n                            <Text style={{ fontSize: 12, color: colors.textSecondary, fontFamily: \"DMSans-Medium\", lineHeight: 16 }}>\r\n                                {item.subtitle}\r\n                            </Text>\r\n                        </Pressable>\r\n                    ))}\r\n                </View>\r\n\r\n                {/* Settings Section */}\r\n                <Text style={[styles.sectionTitle, { marginTop: 24, marginLeft: 4 }]}>Preferences</Text>\r\n\r\n                <View style={[styles.card, { padding: 0, overflow: 'hidden' }]}>\r\n                    <View style={{\r\n                        flexDirection: 'row',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'space-between',\r\n                        padding: 20,\r\n                    }}>\r\n                        <View style={{ flexDirection: 'row', alignItems: 'center', gap: 16 }}>\r\n                            <View style={{\r\n                                width: 40,\r\n                                height: 40,\r\n                                borderRadius: 12,\r\n                                backgroundColor: colors.primary + '15',\r\n                                alignItems: 'center',\r\n                                justifyContent: 'center'\r\n                            }}>\r\n                                <MaterialIcons name={mode === 'dark' ? \"dark-mode\" : \"light-mode\"} size={22} color={colors.primary} />\r\n                            </View>\r\n                            <View>\r\n                                <Text style={{ fontSize: 16, fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>\r\n                                    Dark Mode\r\n                                </Text>\r\n                                <Text style={{ fontSize: 13, color: colors.textSecondary, fontFamily: \"DMSans-Regular\" }}>\r\n                                    {mode === 'dark' ? 'Easy on the eyes' : 'Bright and clear'}\r\n                                </Text>\r\n                            </View>\r\n                        </View>\r\n                        <Switch\r\n                            value={mode === 'dark'}\r\n                            onValueChange={toggle}\r\n                            trackColor={{ false: \"#e0e0e0\", true: colors.primary + '60' }}\r\n                            thumbColor={mode === 'dark' ? colors.primary : \"#f4f3f4\"}\r\n                        />\r\n                    </View>\r\n                </View>\r\n\r\n                {/* Socials Section */}\r\n                <Text style={[styles.sectionTitle, { marginTop: 24, marginLeft: 4 }]}>Follow Us</Text>\r\n                <View style={[styles.card, { flexDirection: 'row', justifyContent: 'space-around', paddingVertical: 24 }]}>\r\n                    <Pressable\r\n                        onPress={() => handlePress(SCHOOL.socials.youtubeAppUrl, SCHOOL.socials.youtube)}\r\n                        style={({ pressed }) => ({ alignItems: 'center', opacity: pressed ? 0.7 : 1 })}\r\n                    >\r\n                        <View style={{ width: 56, height: 56, borderRadius: 18, backgroundColor: '#FF000015', alignItems: 'center', justifyContent: 'center', marginBottom: 8 }}>\r\n                            <FontAwesome name=\"youtube-play\" size={28} color=\"#FF0000\" />\r\n                        </View>\r\n                        <Text style={{ fontSize: 12, fontFamily: \"DMSans-Medium\", color: colors.textSecondary }}>YouTube</Text>\r\n                    </Pressable>\r\n\r\n                    <Pressable\r\n                        onPress={() => handlePress(SCHOOL.socials.instagramAppUrl, SCHOOL.socials.instagram)}\r\n                        style={({ pressed }) => ({ alignItems: 'center', opacity: pressed ? 0.7 : 1 })}\r\n                    >\r\n                        <View style={{ width: 56, height: 56, borderRadius: 18, backgroundColor: '#C1358415', alignItems: 'center', justifyContent: 'center', marginBottom: 8 }}>\r\n                            <FontAwesome name=\"instagram\" size={28} color=\"#C13584\" />\r\n                        </View>\r\n                        <Text style={{ fontSize: 12, fontFamily: \"DMSans-Medium\", color: colors.textSecondary }}>Instagram</Text>\r\n                    </Pressable>\r\n\r\n                    <Pressable\r\n                        onPress={() => handlePress(SCHOOL.mapAppUrl, SCHOOL.mapUrl)}\r\n                        style={({ pressed }) => ({ alignItems: 'center', opacity: pressed ? 0.7 : 1 })}\r\n                    >\r\n                        <View style={{ width: 56, height: 56, borderRadius: 18, backgroundColor: colors.primary + '15', alignItems: 'center', justifyContent: 'center', marginBottom: 8 }}>\r\n                            <MaterialIcons name=\"location-on\" size={28} color={colors.primary} />\r\n                        </View>\r\n                        <Text style={{ fontSize: 12, fontFamily: \"DMSans-Medium\", color: colors.textSecondary }}>Location</Text>\r\n                    </Pressable>\r\n                </View>\r\n\r\n                {/* Logout / Login Button */}\r\n                {user ? (\r\n                    <Pressable\r\n                        onPress={handleLogout}\r\n                        style={({ pressed }) => ({\r\n                            marginTop: 24,\r\n                            backgroundColor: colors.error + '10',\r\n                            borderRadius: 16,\r\n                            padding: 18,\r\n                            flexDirection: 'row',\r\n                            alignItems: 'center',\r\n                            justifyContent: 'center',\r\n                            gap: 10,\r\n                            borderWidth: 1,\r\n                            borderColor: colors.error + '20',\r\n                            opacity: pressed ? 0.8 : 1\r\n                        })}\r\n                    >\r\n                        <MaterialIcons name=\"logout\" size={22} color={colors.error} />\r\n                        <Text style={{ fontSize: 16, fontFamily: \"DMSans-Bold\", color: colors.error }}>\r\n                            Log Out\r\n                        </Text>\r\n                    </Pressable>\r\n                ) : (\r\n                    <Pressable\r\n                        onPress={() => router.replace('/login')}\r\n                        style={({ pressed }) => ({\r\n                            marginTop: 24,\r\n                            backgroundColor: colors.primary,\r\n                            borderRadius: 16,\r\n                            padding: 18,\r\n                            flexDirection: 'row',\r\n                            alignItems: 'center',\r\n                            justifyContent: 'center',\r\n                            gap: 10,\r\n                            opacity: pressed ? 0.9 : 1,\r\n                            shadowColor: colors.primary,\r\n                            shadowOffset: { width: 0, height: 4 },\r\n                            shadowOpacity: 0.3,\r\n                            shadowRadius: 8,\r\n                            elevation: 4,\r\n                        })}\r\n                    >\r\n                        <MaterialIcons name=\"login\" size={22} color=\"#fff\" />\r\n                        <Text style={{ fontSize: 16, fontFamily: \"DMSans-Bold\", color: \"#fff\" }}>\r\n                            Log In\r\n                        </Text>\r\n                    </Pressable>\r\n                )}\r\n\r\n                <Text style={{ textAlign: 'center', marginTop: 24, color: colors.textSecondary, fontSize: 12, fontFamily: \"DMSans-Regular\" }}>\r\n                    App Version 1.0.0  Build 2024\r\n                </Text>\r\n\r\n            </ScrollView>\r\n        </View>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\news.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useFocusEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":39},{"ruleId":"no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":29},{"ruleId":"no-unused-vars","severity":1,"message":"'AsyncStorage' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'apiFetch' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":16},{"ruleId":"no-unused-vars","severity":1,"message":"'navigation' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":16,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":19},{"ruleId":"no-undef","severity":2,"message":"'formatDate' is not defined.","line":86,"column":14,"nodeType":"Identifier","messageId":"undef","endLine":86,"endColumn":24},{"ruleId":"no-unused-vars","severity":1,"message":"'newsTitle' is defined but never used. Allowed unused args must match /^_/u.","line":163,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":163,"endColumn":46}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { View, Text, FlatList, Pressable, Alert, RefreshControl, Linking } from \"react-native\";\r\nimport { useNavigation, useFocusEffect } from \"@react-navigation/native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport { useTheme } from \"../theme\";\r\nimport Header from \"../components/Header\";\r\nimport NewsFormModal from \"../components/NewsFormModal\";\r\nimport { useState, useEffect, useCallback } from \"react\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport apiConfig from \"../config/apiConfig\";\r\nimport apiFetch from \"../utils/apiFetch\";\r\nimport { useToast } from \"../components/ToastProvider\";\r\nimport { useApiQuery, useApiMutation, createApiMutationFn } from \"../hooks/useApi\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\n\r\nexport default function NewsScreen() {\r\n  const navigation = useNavigation();\r\n  const { styles, colors } = useTheme();\r\n  const { showToast } = useToast();\r\n  const queryClient = useQueryClient();\r\n  const [isModalVisible, setIsModalVisible] = useState(false);\r\n  const [editingNews, setEditingNews] = useState(null);\r\n  const [refreshing, setRefreshing] = useState(false);\r\n\r\n  // Fetch News\r\n  const { data: newsData, refetch } = useApiQuery(\r\n    ['news'],\r\n    apiConfig.url(apiConfig.endpoints.news.list)\r\n  );\r\n  const news = newsData?.news || [];\r\n\r\n  // Check Auth & Admin\r\n  const { data: userData } = useApiQuery(\r\n    ['currentUser'],\r\n    `${apiConfig.baseUrl}/auth/me`\r\n  );\r\n  const isAdmin = userData?.role === 'admin' || userData?.role === 'super admin';\r\n\r\n  // Mutations\r\n  const createNewsMutation = useApiMutation({\r\n    mutationFn: createApiMutationFn(apiConfig.url(apiConfig.endpoints.news.create), 'POST'),\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['news'] });\r\n      showToast('News created successfully');\r\n      setIsModalVisible(false);\r\n    },\r\n    onError: (error) => showToast(error.message || 'Failed to create news')\r\n  });\r\n\r\n  const updateNewsMutation = useApiMutation({\r\n    mutationFn: (data) => createApiMutationFn(apiConfig.url(apiConfig.endpoints.news.update(data._id)), 'PUT')(data),\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['news'] });\r\n      showToast('News updated successfully');\r\n      setIsModalVisible(false);\r\n      setEditingNews(null);\r\n    },\r\n    onError: (error) => showToast(error.message || 'Failed to update news')\r\n  });\r\n\r\n  const deleteNewsMutation = useApiMutation({\r\n    mutationFn: (id) => createApiMutationFn(apiConfig.url(apiConfig.endpoints.news.delete(id)), 'DELETE')(),\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['news'] });\r\n      showToast('News deleted successfully');\r\n    },\r\n    onError: (error) => showToast(error.message || 'Failed to delete news')\r\n  });\r\n\r\n  // Memoize renderItem BEFORE early returns to maintain hooks order\r\n  const renderNewsItem = useCallback(({ item }) => (\r\n    <View style={styles.cardMinimal}>\r\n      <View style={{ flexDirection: 'row', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: 12 }}>\r\n        <View style={{ flex: 1, marginRight: 12 }}>\r\n          {item.url ? (\r\n            <Pressable onPress={() => Linking.openURL(item.url)}>\r\n              <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.primary, marginBottom: 8, textDecorationLine: 'underline' }} numberOfLines={2}>\r\n                {item.title}\r\n              </Text>\r\n            </Pressable>\r\n          ) : (\r\n            <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginBottom: 8 }} numberOfLines={2}>\r\n              {item.title}\r\n            </Text>\r\n          )}\r\n          <Text style={{ fontSize: 13, fontFamily: \"DMSans-Medium\", color: colors.textSecondary }}>\r\n            {formatDate(item.creationDate)}\r\n          </Text>\r\n        </View>\r\n        {item.isPrivate && (\r\n          <View style={{ backgroundColor: colors.background, paddingHorizontal: 8, paddingVertical: 4, borderRadius: 4 }}>\r\n            <Text style={{ fontSize: 10, fontFamily: \"DMSans-Bold\", color: colors.textSecondary, textTransform: \"uppercase\" }}>\r\n              Private\r\n            </Text>\r\n          </View>\r\n        )}\r\n      </View>\r\n\r\n      <Text style={{ fontSize: 15, fontFamily: \"DMSans-Regular\", color: colors.textSecondary, lineHeight: 22 }} numberOfLines={3}>\r\n        {item.description}\r\n      </Text>\r\n\r\n      {item.url && (\r\n        <Pressable onPress={() => {\r\n          Linking.openURL(item.url).catch(err => {\r\n            console.error(\"Failed to open URL:\", err);\r\n            showToast('Failed to open link');\r\n          });\r\n        }} style={{ marginTop: 12 }}>\r\n          <Text style={{ fontSize: 14, fontFamily: \"DMSans-SemiBold\", color: colors.primary }}> Open Link</Text>\r\n        </Pressable>\r\n      )}\r\n\r\n      {isAdmin && (\r\n        <View style={{ flexDirection: 'row', justifyContent: 'flex-end', marginTop: 12, gap: 8, borderTopWidth: 1, borderTopColor: colors.border, paddingTop: 12 }}>\r\n          <Pressable\r\n            onPress={() => handleEditNews(item)}\r\n            style={({ pressed }) => ({\r\n              padding: 8,\r\n              backgroundColor: colors.background,\r\n              borderRadius: 8,\r\n              opacity: pressed ? 0.7 : 1,\r\n            })}\r\n          >\r\n            <MaterialIcons name=\"edit\" size={18} color={colors.textSecondary} />\r\n          </Pressable>\r\n          <Pressable\r\n            onPress={() => {\r\n              Alert.alert(\r\n                \"Delete News\",\r\n                `Are you sure you want to delete \"${item.title}\"? This action cannot be undone.`,\r\n                [\r\n                  { text: \"Cancel\", style: \"cancel\" },\r\n                  { text: \"Delete\", style: \"destructive\", onPress: () => handleDeleteNews(item._id, item.title) },\r\n                ]\r\n              );\r\n            }}\r\n            style={({ pressed }) => ({\r\n              padding: 8,\r\n              backgroundColor: colors.error + '15',\r\n              borderRadius: 8,\r\n              opacity: pressed ? 0.7 : 1,\r\n            })}\r\n          >\r\n            <MaterialIcons name=\"delete-outline\" size={18} color={colors.error} />\r\n          </Pressable>\r\n        </View>\r\n      )}\r\n    </View>\r\n  ), [styles.cardMinimal, colors, isAdmin, showToast]); // Removed handleEditNews, handleDeleteNews from deps\r\n\r\n  // NO LOADING STATE - just show empty state if no data\r\n  // Removed: if (loading && news.length === 0) return <LoadingView />;\r\n  // Removed: if (error && news.length === 0) return <ErrorView />;\r\n\r\n  const handleNewsSubmit = (newsData) => {\r\n    if (newsData._id) {\r\n      updateNewsMutation.mutate(newsData);\r\n    } else {\r\n      createNewsMutation.mutate(newsData);\r\n    }\r\n  };\r\n\r\n  const handleDeleteNews = (newsId, newsTitle) => {\r\n    deleteNewsMutation.mutate(newsId);\r\n  };\r\n\r\n  const handleEditNews = (newsItem) => {\r\n    setEditingNews(newsItem);\r\n    setIsModalVisible(true);\r\n  };\r\n\r\n  const onRefresh = async () => {\r\n    setRefreshing(true);\r\n    await refetch();\r\n    setRefreshing(false);\r\n  };\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      <View style={{ paddingHorizontal: 20, paddingTop: 20, paddingBottom: 10 }}>\r\n        <Header title=\"Latest News\" subtitle=\"Stay updated with announcements\" />\r\n      </View>\r\n\r\n      <FlatList\r\n        data={news}\r\n        keyExtractor={(item) => item._id || item.id || Math.random().toString()}\r\n        refreshControl={\r\n          <RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} tintColor={colors.primary} />\r\n        }\r\n        ListEmptyComponent={\r\n          <View style={{ alignItems: \"center\", marginTop: 40, opacity: 0.6 }}>\r\n            <MaterialIcons name=\"article\" size={48} color={colors.textSecondary} />\r\n            <Text style={{ color: colors.textSecondary, marginTop: 16, fontSize: 16, fontFamily: \"DMSans-Medium\" }}>\r\n              No news available right now\r\n            </Text>\r\n          </View>\r\n        }\r\n        renderItem={renderNewsItem}\r\n        contentContainerStyle={{ paddingHorizontal: 20, paddingBottom: 100 }}\r\n        showsVerticalScrollIndicator={false}\r\n        // Performance optimizations\r\n        removeClippedSubviews={true}\r\n        maxToRenderPerBatch={10}\r\n        updateCellsBatchingPeriod={50}\r\n        windowSize={10}\r\n      />\r\n\r\n      {/* FAB for Add News */}\r\n      {isAdmin && (\r\n        <Pressable\r\n          onPress={() => setIsModalVisible(true)}\r\n          style={({ pressed }) => ([\r\n            styles.fab,\r\n            { opacity: pressed ? 0.9 : 1 }\r\n          ])}\r\n        >\r\n          <MaterialIcons name=\"add\" size={24} color={colors.white} />\r\n        </Pressable>\r\n      )}\r\n\r\n      <NewsFormModal\r\n        isVisible={isModalVisible}\r\n        onClose={() => {\r\n          setIsModalVisible(false);\r\n          setEditingNews(null);\r\n        }}\r\n        onSubmit={handleNewsSubmit}\r\n        editItem={editingNews}\r\n      />\r\n    </View>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\notifications.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":36},{"ruleId":"no-unused-vars","severity":1,"message":"'AsyncStorage' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":23,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":24,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":19},{"ruleId":"no-undef","severity":2,"message":"'setRefreshing' is not defined.","line":79,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":79,"endColumn":22},{"ruleId":"no-undef","severity":2,"message":"'setRefreshing' is not defined.","line":81,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":81,"endColumn":22},{"ruleId":"no-undef","severity":2,"message":"'refreshing' is not defined.","line":126,"column":61,"nodeType":"Identifier","messageId":"undef","endLine":126,"endColumn":71}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    RefreshControl,\r\n    ActivityIndicator,\r\n    Pressable,\r\n    Switch,\r\n    Modal\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useRouter } from \"expo-router\";\r\nimport { useTheme } from \"../theme\";\r\nimport apiConfig from \"../config/apiConfig\";\r\nimport { useApiQuery, useApiMutation, createApiMutationFn } from \"../hooks/useApi\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport { useToast } from \"../components/ToastProvider\";\r\nimport Header from \"../components/Header\";\r\n\r\nexport default function NotificationsScreen() {\r\n    const router = useRouter();\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n\r\n    const [showSettings, setShowSettings] = useState(false);\r\n    const queryClient = useQueryClient();\r\n\r\n    // Fetch Notifications\r\n    const { data: notificationsData, isLoading: loadingNotifications, refetch: refetchNotifications } = useApiQuery(\r\n        ['notifications'],\r\n        `${apiConfig.baseUrl}/notifications`\r\n    );\r\n    const notifications = notificationsData?.notifications || [];\r\n\r\n    // Fetch Preferences\r\n    const { data: userData } = useApiQuery(\r\n        ['currentUser'],\r\n        `${apiConfig.baseUrl}/auth/me`\r\n    );\r\n    const preferences = userData?.notificationPreferences || {\r\n        homework: true,\r\n        exam: true,\r\n        fee: true,\r\n        event: true,\r\n        general: true\r\n    };\r\n\r\n    // Mark as read mutation\r\n    const markReadMutation = useApiMutation({\r\n        mutationFn: (id) => createApiMutationFn(`${apiConfig.baseUrl}/notifications/${id}/read`, 'PUT')(),\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: ['notifications'] });\r\n        }\r\n    });\r\n\r\n    // Update preferences mutation\r\n    const updatePreferencesMutation = useApiMutation({\r\n        mutationFn: createApiMutationFn(`${apiConfig.baseUrl}/notifications/preferences`, 'PUT'),\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: ['currentUser'] });\r\n        },\r\n        onError: () => {\r\n            showToast(\"Failed to update settings\", \"error\");\r\n        }\r\n    });\r\n\r\n    const markAsRead = (id) => {\r\n        markReadMutation.mutate(id);\r\n    };\r\n\r\n    const togglePreference = (key) => {\r\n        const newPreferences = { ...preferences, [key]: !preferences[key] };\r\n        updatePreferencesMutation.mutate({ preferences: newPreferences });\r\n    };\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        await Promise.all([refetchNotifications(), queryClient.invalidateQueries({ queryKey: ['currentUser'] })]);\r\n        setRefreshing(false);\r\n    };\r\n\r\n    const loading = loadingNotifications && !notifications.length;\r\n\r\n\r\n\r\n    const getIcon = (type) => {\r\n        switch (type) {\r\n            case 'Homework': return 'assignment';\r\n            case 'Exam': return 'event-note';\r\n            case 'Fee': return 'attach-money';\r\n            case 'Emergency': return 'warning';\r\n            default: return 'notifications';\r\n        }\r\n    };\r\n\r\n    const getColor = (type) => {\r\n        switch (type) {\r\n            case 'Homework': return '#9C27B0';\r\n            case 'Exam': return '#E91E63';\r\n            case 'Fee': return '#FF5722';\r\n            case 'Emergency': return '#F44336';\r\n            default: return colors.primary;\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <View style={{ flex: 1, backgroundColor: colors.background, justifyContent: \"center\", alignItems: \"center\" }}>\r\n                <ActivityIndicator size=\"large\" color={colors.primary} />\r\n            </View>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <View style={{ padding: 16, paddingTop: 24, flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\" }}>\r\n                <Header title=\"Notifications\" showBack />\r\n                <Pressable onPress={() => setShowSettings(true)} style={{ padding: 8 }}>\r\n                    <MaterialIcons name=\"settings\" size={24} color={colors.textPrimary} />\r\n                </Pressable>\r\n            </View>\r\n\r\n            <ScrollView\r\n                refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} />}\r\n                contentContainerStyle={{ padding: 16, paddingBottom: 100 }}\r\n            >\r\n                {notifications.length === 0 ? (\r\n                    <View style={{ alignItems: \"center\", marginTop: 60, opacity: 0.6 }}>\r\n                        <MaterialIcons name=\"notifications-none\" size={64} color={colors.textSecondary} />\r\n                        <Text style={{ color: colors.textSecondary, marginTop: 16, fontSize: 16 }}>\r\n                            No notifications yet\r\n                        </Text>\r\n                    </View>\r\n                ) : (\r\n                    notifications.map((notif) => (\r\n                        <Pressable\r\n                            key={notif._id}\r\n                            onPress={() => !notif.read && markAsRead(notif._id)}\r\n                            style={{\r\n                                backgroundColor: notif.read ? colors.background : colors.cardBackground,\r\n                                borderRadius: 16,\r\n                                padding: 16,\r\n                                marginBottom: 12,\r\n                                flexDirection: \"row\",\r\n                                gap: 16,\r\n                                borderLeftWidth: 4,\r\n                                borderLeftColor: getColor(notif.type),\r\n                                opacity: notif.read ? 0.7 : 1,\r\n                                shadowColor: \"#000\",\r\n                                shadowOffset: { width: 0, height: 1 },\r\n                                shadowOpacity: notif.read ? 0 : 0.05,\r\n                                shadowRadius: 2,\r\n                                elevation: notif.read ? 0 : 1,\r\n                            }}\r\n                        >\r\n                            <View style={{\r\n                                backgroundColor: getColor(notif.type) + \"15\",\r\n                                padding: 10,\r\n                                borderRadius: 50,\r\n                                height: 44,\r\n                                width: 44,\r\n                                justifyContent: \"center\",\r\n                                alignItems: \"center\"\r\n                            }}>\r\n                                <MaterialIcons name={getIcon(notif.type)} size={24} color={getColor(notif.type)} />\r\n                            </View>\r\n                            <View style={{ flex: 1 }}>\r\n                                <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", marginBottom: 4 }}>\r\n                                    <Text style={{ fontSize: 16, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, flex: 1 }}>\r\n                                        {notif.title || \"Notification\"}\r\n                                    </Text>\r\n                                    {!notif.read && (\r\n                                        <View style={{ height: 8, width: 8, borderRadius: 4, backgroundColor: colors.primary }} />\r\n                                    )}\r\n                                </View>\r\n                                <Text style={{ color: colors.textSecondary, fontSize: 14, marginBottom: 8 }}>\r\n                                    {notif.message}\r\n                                </Text>\r\n                                <Text style={{ fontSize: 12, color: colors.textSecondary }}>\r\n                                    {new Date(notif.createdAt).toLocaleDateString()}  {new Date(notif.createdAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                                </Text>\r\n                            </View>\r\n                        </Pressable>\r\n                    ))\r\n                )}\r\n            </ScrollView>\r\n\r\n            {/* Settings Modal */}\r\n            <Modal\r\n                visible={showSettings}\r\n                animationType=\"slide\"\r\n                transparent={true}\r\n                onRequestClose={() => setShowSettings(false)}\r\n            >\r\n                <View style={{ flex: 1, backgroundColor: \"rgba(0,0,0,0.5)\", justifyContent: \"flex-end\" }}>\r\n                    <View style={{ backgroundColor: colors.cardBackground, borderTopLeftRadius: 24, borderTopRightRadius: 24, padding: 24 }}>\r\n                        <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\", marginBottom: 24 }}>\r\n                            <Text style={{ fontSize: 20, fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>\r\n                                Notification Settings\r\n                            </Text>\r\n                            <Pressable onPress={() => setShowSettings(false)}>\r\n                                <MaterialIcons name=\"close\" size={24} color={colors.textSecondary} />\r\n                            </Pressable>\r\n                        </View>\r\n\r\n                        <Text style={{ color: colors.textSecondary, marginBottom: 16 }}>\r\n                            Customize which notifications you want to receive.\r\n                        </Text>\r\n\r\n                        {Object.keys(preferences).map((key) => (\r\n                            <View key={key} style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\", marginBottom: 20 }}>\r\n                                <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 12 }}>\r\n                                    <MaterialIcons name={getIcon(key.charAt(0).toUpperCase() + key.slice(1))} size={24} color={colors.textSecondary} />\r\n                                    <Text style={{ fontSize: 16, color: colors.textPrimary, textTransform: \"capitalize\" }}>\r\n                                        {key} Alerts\r\n                                    </Text>\r\n                                </View>\r\n                                <Switch\r\n                                    value={preferences[key]}\r\n                                    onValueChange={() => togglePreference(key)}\r\n                                    trackColor={{ false: \"#767577\", true: colors.primary + \"80\" }}\r\n                                    thumbColor={preferences[key] ? colors.primary : \"#f4f3f4\"}\r\n                                />\r\n                            </View>\r\n                        ))}\r\n\r\n                        <View style={{ height: 20 }} />\r\n                    </View>\r\n                </View>\r\n            </Modal>\r\n        </View>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\profile.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport { View, Text, ScrollView, RefreshControl, Pressable } from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useTheme } from \"../theme\";\r\nimport { useToast } from \"../components/ToastProvider\";\r\nimport { formatDate } from \"../utils/date\";\r\n\r\nimport { useApiQuery } from \"../hooks/useApi\";\r\nimport apiConfig from \"../config/apiConfig\";\r\n\r\nexport default function ProfileScreen() {\r\n  const { styles, colors } = useTheme();\r\n  const { showToast } = useToast();\r\n  const [refreshing, setRefreshing] = useState(false);\r\n\r\n  const { data: user, refetch } = useApiQuery(\r\n    ['currentUser'],\r\n    `${apiConfig.baseUrl}/auth/me`,\r\n    {\r\n      staleTime: Infinity,\r\n    }\r\n  );\r\n\r\n  const onRefresh = async () => {\r\n    setRefreshing(true);\r\n    await refetch();\r\n    setRefreshing(false);\r\n  };\r\n\r\n  const handleLogout = async () => {\r\n    try {\r\n      await AsyncStorage.removeItem('@auth_token');\r\n      await AsyncStorage.removeItem('@auth_user');\r\n      // Invalidate queries to clear cache\r\n      const { queryClient } = require('../utils/queryClient');\r\n      queryClient.clear();\r\n      const { router } = require('expo-router');\r\n      router.replace('/login');\r\n    } catch (error) {\r\n      console.error('Logout failed:', error);\r\n      showToast('Failed to logout. Please try again.', 'error');\r\n    }\r\n  };\r\n\r\n  const handleLogin = () => {\r\n    const { router } = require('expo-router');\r\n    router.replace('/login');\r\n  };\r\n\r\n  return (\r\n    <ScrollView\r\n      style={styles.container}\r\n      contentContainerStyle={styles.contentPaddingBottom}\r\n      refreshControl={\r\n        <RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} />\r\n      }\r\n    >\r\n      <View style={{ alignItems: \"center\", marginTop: 20, marginBottom: 40 }}>\r\n        <View style={{\r\n          width: 100,\r\n          height: 100,\r\n          borderRadius: 50,\r\n          backgroundColor: colors.cardBackground,\r\n          alignItems: \"center\",\r\n          justifyContent: \"center\",\r\n          marginBottom: 16,\r\n          shadowColor: colors.shadow,\r\n          shadowOffset: { width: 0, height: 4 },\r\n          shadowOpacity: 0.1,\r\n          shadowRadius: 12,\r\n          elevation: 5,\r\n        }}>\r\n          <MaterialIcons name=\"person\" size={50} color={colors.primary} />\r\n        </View>\r\n\r\n        {user ? (\r\n          <>\r\n            <Text style={{ fontSize: 24, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginBottom: 8 }}>\r\n              {user.name}\r\n            </Text>\r\n\r\n            {user.role && (\r\n              <View style={{\r\n                backgroundColor: colors.primary + '15',\r\n                paddingVertical: 6,\r\n                paddingHorizontal: 16,\r\n                borderRadius: 20,\r\n                marginTop: 4,\r\n                marginBottom: 16\r\n              }}>\r\n                <Text style={{ color: colors.primary, fontFamily: \"DMSans-Bold\", fontSize: 12, textTransform: 'uppercase' }}>\r\n                  {user.role}\r\n                </Text>\r\n              </View>\r\n            )}\r\n\r\n            <View style={{ width: '100%', paddingHorizontal: 20 }}>\r\n              <View style={{ backgroundColor: colors.cardBackground, borderRadius: 16, padding: 16, marginBottom: 16 }}>\r\n                <Text style={{ fontSize: 14, fontFamily: \"DMSans-Bold\", color: colors.textSecondary, marginBottom: 12 }}>CONTACT INFO</Text>\r\n\r\n                {user.phone && (\r\n                  <View style={{ flexDirection: 'row', alignItems: 'center', marginBottom: 12 }}>\r\n                    <View style={{ width: 32, alignItems: 'center' }}><MaterialIcons name=\"phone\" size={20} color={colors.primary} /></View>\r\n                    <Text style={{ fontSize: 16, fontFamily: \"DMSans-Medium\", color: colors.textPrimary, marginLeft: 8 }}>{user.phone}</Text>\r\n                  </View>\r\n                )}\r\n\r\n                {user.email && (\r\n                  <View style={{ flexDirection: 'row', alignItems: 'center' }}>\r\n                    <View style={{ width: 32, alignItems: 'center' }}><MaterialIcons name=\"email\" size={20} color={colors.primary} /></View>\r\n                    <Text style={{ fontSize: 16, fontFamily: \"DMSans-Medium\", color: colors.textPrimary, marginLeft: 8 }}>{user.email}</Text>\r\n                  </View>\r\n                )}\r\n              </View>\r\n\r\n              {(user.role === 'student' || user.role === 'class teacher' || user.role === 'staff') && (\r\n                <View style={{ backgroundColor: colors.cardBackground, borderRadius: 16, padding: 16, marginBottom: 16 }}>\r\n                  <Text style={{ fontSize: 14, fontFamily: \"DMSans-Bold\", color: colors.textSecondary, marginBottom: 12 }}>\r\n                    {user.role === 'student' ? 'STUDENT DETAILS' : 'STAFF DETAILS'}\r\n                  </Text>\r\n\r\n                  {user.role === 'student' && (\r\n                    <>\r\n                      {user.guardianName && (\r\n                        <View style={{ marginBottom: 12 }}>\r\n                          <Text style={{ fontSize: 12, color: colors.textSecondary }}>Guardian Name</Text>\r\n                          <Text style={{ fontSize: 16, fontFamily: \"DMSans-Medium\", color: colors.textPrimary }}>{user.guardianName}</Text>\r\n                        </View>\r\n                      )}\r\n                      {user.guardianPhone && (\r\n                        <View style={{ marginBottom: 12 }}>\r\n                          <Text style={{ fontSize: 12, color: colors.textSecondary }}>Guardian Phone</Text>\r\n                          <Text style={{ fontSize: 16, fontFamily: \"DMSans-Medium\", color: colors.textPrimary }}>{user.guardianPhone}</Text>\r\n                        </View>\r\n                      )}\r\n                      {user.admissionDate && (\r\n                        <View>\r\n                          <Text style={{ fontSize: 12, color: colors.textSecondary }}>Admission Date</Text>\r\n                          <Text style={{ fontSize: 16, fontFamily: \"DMSans-Medium\", color: colors.textPrimary }}>{formatDate(user.admissionDate)}</Text>\r\n                        </View>\r\n                      )}\r\n                    </>\r\n                  )}\r\n\r\n                  {(user.role === 'class teacher' || user.role === 'staff') && (\r\n                    <>\r\n                      {user.designation && (\r\n                        <View style={{ marginBottom: 12 }}>\r\n                          <Text style={{ fontSize: 12, color: colors.textSecondary }}>Designation</Text>\r\n                          <Text style={{ fontSize: 16, fontFamily: \"DMSans-Medium\", color: colors.textPrimary }}>{user.designation}</Text>\r\n                        </View>\r\n                      )}\r\n                      {user.joiningDate && (\r\n                        <View>\r\n                          <Text style={{ fontSize: 12, color: colors.textSecondary }}>Joining Date</Text>\r\n                          <Text style={{ fontSize: 16, fontFamily: \"DMSans-Medium\", color: colors.textPrimary }}>{formatDate(user.joiningDate)}</Text>\r\n                        </View>\r\n                      )}\r\n                    </>\r\n                  )}\r\n                </View>\r\n              )}\r\n            </View>\r\n          </>\r\n        ) : (\r\n          <>\r\n            <Text style={{ fontSize: 24, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginBottom: 4 }}>\r\n              Guest User\r\n            </Text>\r\n            <Text style={{ fontSize: 14, fontFamily: \"DMSans-Regular\", color: colors.textSecondary }}>\r\n              Login to access all features\r\n            </Text>\r\n          </>\r\n        )}\r\n      </View>\r\n\r\n      <View style={{ paddingHorizontal: 20 }}>\r\n        <Pressable\r\n          onPress={user ? handleLogout : handleLogin}\r\n          style={({ pressed }) => ({\r\n            backgroundColor: user ? colors.error + '15' : colors.primary,\r\n            borderRadius: 16,\r\n            paddingVertical: 16,\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            flexDirection: 'row',\r\n            opacity: pressed ? 0.9 : 1,\r\n            marginBottom: 16,\r\n          })}\r\n        >\r\n          <MaterialIcons\r\n            name={user ? \"logout\" : \"login\"}\r\n            size={20}\r\n            color={user ? colors.error : colors.white}\r\n            style={{ marginRight: 8 }}\r\n          />\r\n          <Text style={{\r\n            fontSize: 16,\r\n            fontFamily: \"DMSans-Bold\",\r\n            color: user ? colors.error : colors.white\r\n          }}>\r\n            {user ? \"Log Out\" : \"Log In\"}\r\n          </Text>\r\n        </Pressable>\r\n      </View>\r\n    </ScrollView>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\requests.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":13,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport { View, Text, ScrollView, RefreshControl, Pressable } from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useRouter } from \"expo-router\";\r\nimport { useTheme } from \"../theme\";\r\nimport Header from \"../components/Header\";\r\nimport apiConfig from \"../config/apiConfig\";\r\nimport { useApiQuery } from \"../hooks/useApi\";\r\n\r\nexport default function RequestsScreen() {\r\n    const router = useRouter();\r\n    const { styles, colors } = useTheme();\r\n    const [user, setUser] = useState(null);\r\n    const [refreshing, setRefreshing] = useState(false);\r\n\r\n\r\n\r\n    useEffect(() => {\r\n        loadUser();\r\n    }, []);\r\n\r\n\r\n\r\n    const loadUser = async () => {\r\n        try {\r\n            const storedUser = await AsyncStorage.getItem('@auth_user');\r\n            if (storedUser) {\r\n                setUser(JSON.parse(storedUser));\r\n            } else {\r\n                router.replace('/login');\r\n            }\r\n        } catch (e) {\r\n            console.warn('Failed to load user', e);\r\n            router.replace('/login');\r\n        }\r\n    };\r\n\r\n    // Fetch Teacher Classes (for teachers/class teachers)\r\n    const { data: teacherClassesData, refetch: refetchClasses } = useApiQuery(\r\n        ['teacherClasses'],\r\n        `${apiConfig.baseUrl}/classes/my-classes`,\r\n        {\r\n            enabled: !!(user && (user.role === 'teacher' || user.role === 'class teacher'))\r\n        }\r\n    );\r\n\r\n    const teacherClasses = teacherClassesData || [];\r\n\r\n\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        await loadUser();\r\n        if (user && (user.role === 'teacher' || user.role === 'class teacher')) {\r\n            await refetchClasses();\r\n        }\r\n        setRefreshing(false);\r\n    };\r\n\r\n    const navigateToLeaves = () => {\r\n        if (user?.role === 'student') {\r\n            router.push('/student/leaves');\r\n        } else if (user?.role === 'class teacher' || user?.role === 'staff' || user?.role === 'teacher') {\r\n            router.push('/teacher/leaves');\r\n        } else if (user?.role === 'admin' || user?.role === 'super admin') {\r\n            router.push('/admin/leaves');\r\n        }\r\n    };\r\n\r\n    const navigateToMyAttendance = () => {\r\n        if (user?.role === 'student') {\r\n            router.push(`/student/attendance`);\r\n        } else if (user?.role === 'teacher' || user?.role === 'class teacher' || user?.role === 'staff') {\r\n            router.push('/teacher/attendance');\r\n        } else if (user?.role === 'admin' || user?.role === 'super admin') {\r\n            router.push('/admin/attendance?tab=my_attendance');\r\n        }\r\n    };\r\n\r\n    const navigateToMarkAttendance = () => {\r\n        if (user?.role === 'teacher' || user?.role === 'class teacher') {\r\n            if (teacherClasses.length === 1) {\r\n                // If only one class, go directly to attendance marking\r\n                router.push({\r\n                    pathname: \"/teacher/class/attendance\",\r\n                    params: { classId: teacherClasses[0]._id }\r\n                });\r\n            } else {\r\n                // If multiple classes or 0 (let them see empty list), go to class list\r\n                router.push('/teacher/classes?action=attendance');\r\n            }\r\n        } else if (user?.role === 'admin' || user?.role === 'super admin') {\r\n            router.push('/admin/attendance');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <ScrollView\r\n                refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} />}\r\n                contentContainerStyle={{ paddingBottom: 100 }}\r\n            >\r\n                <View style={{ padding: 16, paddingTop: 24 }}>\r\n                    <Header\r\n                        title=\"Attendance\"\r\n                        subtitle=\"Manage attendance and requests\"\r\n                    />\r\n\r\n                    <View style={{ marginTop: 24 }}>\r\n                        {/* My Attendance Card - For All */}\r\n                        <Pressable\r\n                            onPress={navigateToMyAttendance}\r\n                            style={({ pressed }) => ({\r\n                                backgroundColor: colors.cardBackground,\r\n                                borderRadius: 16,\r\n                                padding: 20,\r\n                                marginBottom: 16,\r\n                                shadowColor: \"#000\",\r\n                                shadowOffset: { width: 0, height: 2 },\r\n                                shadowOpacity: 0.05,\r\n                                shadowRadius: 8,\r\n                                elevation: 2,\r\n                                opacity: pressed ? 0.9 : 1,\r\n                                flexDirection: \"row\",\r\n                                justifyContent: \"space-between\",\r\n                                alignItems: \"center\"\r\n                            })}\r\n                        >\r\n                            <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 16, flex: 1 }}>\r\n                                <View style={{\r\n                                    backgroundColor: \"#4CAF50\" + \"20\",\r\n                                    padding: 14,\r\n                                    borderRadius: 12\r\n                                }}>\r\n                                    <MaterialIcons name=\"person\" size={28} color=\"#4CAF50\" />\r\n                                </View>\r\n                                <View style={{ flex: 1 }}>\r\n                                    <Text style={{\r\n                                        fontSize: 17,\r\n                                        fontFamily: \"DMSans-Bold\",\r\n                                        color: colors.textPrimary,\r\n                                        marginBottom: 4\r\n                                    }}>\r\n                                        My Attendance\r\n                                    </Text>\r\n                                    <Text style={{\r\n                                        fontSize: 13,\r\n                                        color: colors.textSecondary,\r\n                                        fontFamily: \"DMSans-Regular\"\r\n                                    }}>\r\n                                        View your attendance history\r\n                                    </Text>\r\n                                </View>\r\n                            </View>\r\n                            <MaterialIcons name=\"chevron-right\" size={24} color={colors.textSecondary} />\r\n                        </Pressable>\r\n\r\n                        {/* Mark Attendance Card - For Teachers & Admins */}\r\n                        {['teacher', 'class teacher', 'admin', 'super admin'].includes(user?.role) && (\r\n                            <Pressable\r\n                                onPress={navigateToMarkAttendance}\r\n                                style={({ pressed }) => ({\r\n                                    backgroundColor: colors.cardBackground,\r\n                                    borderRadius: 16,\r\n                                    padding: 20,\r\n                                    marginBottom: 16,\r\n                                    shadowColor: \"#000\",\r\n                                    shadowOffset: { width: 0, height: 2 },\r\n                                    shadowOpacity: 0.05,\r\n                                    shadowRadius: 8,\r\n                                    elevation: 2,\r\n                                    opacity: pressed ? 0.9 : 1,\r\n                                    flexDirection: \"row\",\r\n                                    justifyContent: \"space-between\",\r\n                                    alignItems: \"center\"\r\n                                })}\r\n                            >\r\n                                <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 16, flex: 1 }}>\r\n                                    <View style={{\r\n                                        backgroundColor: \"#2196F3\" + \"20\",\r\n                                        padding: 14,\r\n                                        borderRadius: 12\r\n                                    }}>\r\n                                        <MaterialIcons name=\"edit-calendar\" size={28} color=\"#2196F3\" />\r\n                                    </View>\r\n                                    <View style={{ flex: 1 }}>\r\n                                        <Text style={{\r\n                                            fontSize: 17,\r\n                                            fontFamily: \"DMSans-Bold\",\r\n                                            color: colors.textPrimary,\r\n                                            marginBottom: 4\r\n                                        }}>\r\n                                            Mark Attendance\r\n                                        </Text>\r\n                                        <Text style={{\r\n                                            fontSize: 13,\r\n                                            color: colors.textSecondary,\r\n                                            fontFamily: \"DMSans-Regular\"\r\n                                        }}>\r\n                                            {user?.role === 'admin' || user?.role === 'super admin'\r\n                                                ? 'Mark staff and student attendance'\r\n                                                : 'Mark student attendance'}\r\n                                        </Text>\r\n                                    </View>\r\n                                </View>\r\n                                <MaterialIcons name=\"chevron-right\" size={24} color={colors.textSecondary} />\r\n                            </Pressable>\r\n                        )}\r\n\r\n                        {/* Leave Requests Card */}\r\n                        <Pressable\r\n                            onPress={navigateToLeaves}\r\n                            style={({ pressed }) => ({\r\n                                backgroundColor: colors.cardBackground,\r\n                                borderRadius: 16,\r\n                                padding: 20,\r\n                                marginBottom: 16,\r\n                                shadowColor: \"#000\",\r\n                                shadowOffset: { width: 0, height: 2 },\r\n                                shadowOpacity: 0.05,\r\n                                shadowRadius: 8,\r\n                                elevation: 2,\r\n                                opacity: pressed ? 0.9 : 1,\r\n                                flexDirection: \"row\",\r\n                                justifyContent: \"space-between\",\r\n                                alignItems: \"center\"\r\n                            })}\r\n                        >\r\n                            <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 16, flex: 1 }}>\r\n                                <View style={{\r\n                                    backgroundColor: \"#FF9800\" + \"20\",\r\n                                    padding: 14,\r\n                                    borderRadius: 12\r\n                                }}>\r\n                                    <MaterialIcons name=\"event-note\" size={28} color=\"#FF9800\" />\r\n                                </View>\r\n                                <View style={{ flex: 1 }}>\r\n                                    <Text style={{\r\n                                        fontSize: 17,\r\n                                        fontFamily: \"DMSans-Bold\",\r\n                                        color: colors.textPrimary,\r\n                                        marginBottom: 4\r\n                                    }}>\r\n                                        Leave Requests\r\n                                    </Text>\r\n                                    <Text style={{\r\n                                        fontSize: 13,\r\n                                        color: colors.textSecondary,\r\n                                        fontFamily: \"DMSans-Regular\"\r\n                                    }}>\r\n                                        {user?.role === 'student'\r\n                                            ? 'Apply for leave and track status'\r\n                                            : 'Approve or reject leave requests'}\r\n                                    </Text>\r\n                                </View>\r\n                            </View>\r\n                            <MaterialIcons name=\"chevron-right\" size={24} color={colors.textSecondary} />\r\n                        </Pressable>\r\n                    </View>\r\n                </View>\r\n            </ScrollView>\r\n        </View>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\student\\attendance.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Pressable' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":14},{"ruleId":"no-unused-vars","severity":1,"message":"'MaterialIcons' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'cellSize' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":22,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":15},{"ruleId":"no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":25,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":26,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'showToast' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":27,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useMemo } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    Pressable,\r\n    ActivityIndicator,\r\n    RefreshControl,\r\n    Dimensions,\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useRouter } from \"expo-router\";\r\nimport { useTheme } from \"../../theme\";\r\nimport { useApiQuery } from \"../../hooks/useApi\";\r\nimport Header from \"../../components/Header\";\r\nimport ModernCalendar from \"../../components/ModernCalendar\";\r\nimport apiConfig from \"../../config/apiConfig\";\r\nimport { useToast } from \"../../components/ToastProvider\";\r\n\r\nconst { width } = Dimensions.get('window');\r\nconst cellSize = (width - 80) / 7; // 7 days in a week, accounting for padding\r\n\r\nexport default function StudentAttendanceScreen() {\r\n    const router = useRouter();\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n\r\n    const [refreshing, setRefreshing] = useState(false);\r\n    const [user, setUser] = useState(null);\r\n    const [selectedMonth, setSelectedMonth] = useState(new Date().toISOString().split('T')[0]);\r\n\r\n    useEffect(() => {\r\n        const loadUser = async () => {\r\n            const storedUser = await AsyncStorage.getItem(\"@auth_user\");\r\n            if (storedUser) {\r\n                setUser(JSON.parse(storedUser));\r\n            }\r\n        };\r\n        loadUser();\r\n    }, []);\r\n\r\n    const userId = user?.id || user?._id;\r\n\r\n    // Fetch Attendance Summary\r\n    const { data: summary, isLoading: loadingSummary, refetch: refetchSummary } = useApiQuery(\r\n        ['studentAttendanceSummary', userId],\r\n        `${apiConfig.baseUrl}/attendance/student/${userId}/summary`,\r\n        { enabled: !!userId }\r\n    );\r\n\r\n    // Fetch Attendance History\r\n    const { data: historyData, isLoading: loadingHistory, refetch: refetchHistory } = useApiQuery(\r\n        ['studentAttendanceHistory', userId],\r\n        `${apiConfig.baseUrl}/attendance/student/${userId}`,\r\n        { enabled: !!userId }\r\n    );\r\n\r\n    const attendanceHistory = historyData?.attendance || [];\r\n    const loading = loadingSummary || loadingHistory;\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        await Promise.all([refetchSummary(), refetchHistory()]);\r\n        setRefreshing(false);\r\n    };\r\n\r\n    const getStatusColor = (status) => {\r\n        switch (status) {\r\n            case 'present': return colors.success;\r\n            case 'absent': return colors.error;\r\n            case 'late': return '#FF9800';\r\n            case 'excused': return '#2196F3';\r\n            default: return colors.textSecondary;\r\n        }\r\n    };\r\n\r\n    const markedDates = useMemo(() => {\r\n        const marks = {};\r\n        attendanceHistory.forEach(record => {\r\n            const dateStr = new Date(record.date).toISOString().split('T')[0];\r\n            const color = getStatusColor(record.status);\r\n            marks[dateStr] = {\r\n                customStyles: {\r\n                    container: {\r\n                        backgroundColor: color + '20',\r\n                        borderWidth: 1,\r\n                        borderColor: color,\r\n                        borderRadius: 8,\r\n                    },\r\n                    text: {\r\n                        color: color,\r\n                        fontFamily: 'DMSans-Bold',\r\n                    }\r\n                }\r\n            };\r\n        });\r\n        return marks;\r\n    }, [attendanceHistory, colors]);\r\n\r\n    if (loading) {\r\n        return (\r\n            <View style={{ flex: 1, backgroundColor: colors.background, justifyContent: \"center\", alignItems: \"center\" }}>\r\n                <ActivityIndicator size=\"large\" color={colors.primary} />\r\n            </View>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <ScrollView\r\n                refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} />}\r\n                contentContainerStyle={{ paddingBottom: 100 }}\r\n            >\r\n                <View style={{ padding: 16, paddingTop: 24 }}>\r\n                    <Header\r\n                        title=\"My Attendance\"\r\n                        subtitle=\"Track your attendance record\"\r\n                    />\r\n\r\n                    {/* Overall Percentage - Big Display */}\r\n                    <View style={{\r\n                        backgroundColor: colors.primary,\r\n                        borderRadius: 20,\r\n                        padding: 24,\r\n                        marginTop: 20,\r\n                        alignItems: \"center\",\r\n                        elevation: 4\r\n                    }}>\r\n                        <Text style={{ fontSize: 16, color: \"#fff\", opacity: 0.9, fontFamily: \"DMSans-Medium\" }}>\r\n                            Overall Attendance\r\n                        </Text>\r\n                        <Text style={{ fontSize: 64, fontFamily: \"DMSans-Bold\", color: \"#fff\", marginTop: 8 }}>\r\n                            {summary?.overall?.percentage || 0}%\r\n                        </Text>\r\n                        <View style={{ flexDirection: \"row\", gap: 24, marginTop: 16 }}>\r\n                            <View style={{ alignItems: \"center\" }}>\r\n                                <Text style={{ fontSize: 28, fontFamily: \"DMSans-Bold\", color: \"#fff\" }}>\r\n                                    {summary?.overall?.present || 0}\r\n                                </Text>\r\n                                <Text style={{ fontSize: 12, color: \"#fff\", opacity: 0.8, fontFamily: \"DMSans-Regular\" }}>\r\n                                    Present\r\n                                </Text>\r\n                            </View>\r\n                            <View style={{ alignItems: \"center\" }}>\r\n                                <Text style={{ fontSize: 28, fontFamily: \"DMSans-Bold\", color: \"#fff\" }}>\r\n                                    {summary?.overall?.total || 0}\r\n                                </Text>\r\n                                <Text style={{ fontSize: 12, color: \"#fff\", opacity: 0.8, fontFamily: \"DMSans-Regular\" }}>\r\n                                    Total Days\r\n                                </Text>\r\n                            </View>\r\n                        </View>\r\n                    </View>\r\n\r\n                    {/* Subject-wise Breakdown */}\r\n                    {summary?.subjectWise && summary.subjectWise.length > 0 && (\r\n                        <View style={{ marginTop: 24 }}>\r\n                            <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginBottom: 12 }}>\r\n                                Subject-wise Attendance\r\n                            </Text>\r\n                            {summary.subjectWise.map((subject) => (\r\n                                <View\r\n                                    key={subject.subjectId}\r\n                                    style={{\r\n                                        backgroundColor: colors.cardBackground,\r\n                                        borderRadius: 12,\r\n                                        padding: 16,\r\n                                        marginBottom: 10,\r\n                                        elevation: 1\r\n                                    }}\r\n                                >\r\n                                    <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\" }}>\r\n                                        <View style={{ flex: 1 }}>\r\n                                            <Text style={{ fontSize: 16, fontFamily: \"DMSans-SemiBold\", color: colors.textPrimary }}>\r\n                                                {subject.name}\r\n                                            </Text>\r\n                                            <Text style={{ fontSize: 13, color: colors.textSecondary, marginTop: 4, fontFamily: \"DMSans-Regular\" }}>\r\n                                                {subject.present} / {subject.total} classes\r\n                                            </Text>\r\n                                        </View>\r\n                                        <View style={{ alignItems: \"flex-end\" }}>\r\n                                            <Text style={{\r\n                                                fontSize: 24,\r\n                                                fontFamily: \"DMSans-Bold\",\r\n                                                color: parseFloat(subject.percentage) >= 75 ? colors.success : colors.error\r\n                                            }}>\r\n                                                {subject.percentage}%\r\n                                            </Text>\r\n                                            {parseFloat(subject.percentage) < 75 && (\r\n                                                <View style={{ backgroundColor: colors.error + \"20\", paddingHorizontal: 8, paddingVertical: 2, borderRadius: 4, marginTop: 4 }}>\r\n                                                    <Text style={{ fontSize: 10, color: colors.error, fontFamily: \"DMSans-Bold\" }}>\r\n                                                        LOW\r\n                                                    </Text>\r\n                                                </View>\r\n                                            )}\r\n                                        </View>\r\n                                    </View>\r\n                                </View>\r\n                            ))}\r\n                        </View>\r\n                    )}\r\n\r\n                    {/* Calendar View */}\r\n                    <View style={{\r\n                        backgroundColor: colors.cardBackground,\r\n                        borderRadius: 16,\r\n                        padding: 16,\r\n                        marginTop: 24,\r\n                        elevation: 2\r\n                    }}>\r\n                        <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginBottom: 4 }}>\r\n                            Attendance Calendar\r\n                        </Text>\r\n                        <ModernCalendar\r\n                            current={selectedMonth}\r\n                            markedDates={markedDates}\r\n                            onMonthChange={(month) => setSelectedMonth(month.dateString)}\r\n                            markingType={'custom'}\r\n                            theme={{\r\n                                calendarBackground: 'transparent',\r\n                            }}\r\n                        />\r\n\r\n                        {/* Legend */}\r\n                        <View style={{ flexDirection: \"row\", flexWrap: \"wrap\", gap: 12, marginTop: 16, justifyContent: \"center\" }}>\r\n                            <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 6 }}>\r\n                                <View style={{ width: 16, height: 16, borderRadius: 4, backgroundColor: colors.success + \"40\" }} />\r\n                                <Text style={{ fontSize: 11, color: colors.textSecondary, fontFamily: \"DMSans-Medium\" }}>Present</Text>\r\n                            </View>\r\n                            <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 6 }}>\r\n                                <View style={{ width: 16, height: 16, borderRadius: 4, backgroundColor: colors.error + \"40\" }} />\r\n                                <Text style={{ fontSize: 11, color: colors.textSecondary, fontFamily: \"DMSans-Medium\" }}>Absent</Text>\r\n                            </View>\r\n                            <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 6 }}>\r\n                                <View style={{ width: 16, height: 16, borderRadius: 4, backgroundColor: \"#FF9800\" + \"40\" }} />\r\n                                <Text style={{ fontSize: 11, color: colors.textSecondary, fontFamily: \"DMSans-Medium\" }}>Late</Text>\r\n                            </View>\r\n                            <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 6 }}>\r\n                                <View style={{ width: 16, height: 16, borderRadius: 4, backgroundColor: \"#2196F3\" + \"40\" }} />\r\n                                <Text style={{ fontSize: 11, color: colors.textSecondary, fontFamily: \"DMSans-Medium\" }}>Excused</Text>\r\n                            </View>\r\n                        </View>\r\n                    </View>\r\n\r\n                    {/* Monthly Summary */}\r\n                    {summary?.monthlyBreakdown && summary.monthlyBreakdown.length > 0 && (\r\n                        <View style={{ marginTop: 24 }}>\r\n                            <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginBottom: 12 }}>\r\n                                Monthly Summary\r\n                            </Text>\r\n                            {summary.monthlyBreakdown.slice(0, 6).map((month) => (\r\n                                <View\r\n                                    key={month.month}\r\n                                    style={{\r\n                                        backgroundColor: colors.cardBackground,\r\n                                        borderRadius: 12,\r\n                                        padding: 16,\r\n                                        marginBottom: 8,\r\n                                        flexDirection: \"row\",\r\n                                        justifyContent: \"space-between\",\r\n                                        alignItems: \"center\",\r\n                                        elevation: 1\r\n                                    }}\r\n                                >\r\n                                    <View>\r\n                                        <Text style={{ fontSize: 15, fontFamily: \"DMSans-SemiBold\", color: colors.textPrimary }}>\r\n                                            {month.month}\r\n                                        </Text>\r\n                                        <Text style={{ fontSize: 12, color: colors.textSecondary, marginTop: 2, fontFamily: \"DMSans-Regular\" }}>\r\n                                            {month.present} / {month.total} days\r\n                                        </Text>\r\n                                    </View>\r\n                                    <Text style={{\r\n                                        fontSize: 20,\r\n                                        fontFamily: \"DMSans-Bold\",\r\n                                        color: parseFloat(month.percentage) >= 75 ? colors.success : colors.error\r\n                                    }}>\r\n                                        {month.percentage}%\r\n                                    </Text>\r\n                                </View>\r\n                            ))}\r\n                        </View>\r\n                    )}\r\n                </View>\r\n            </ScrollView>\r\n        </View>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\student\\class.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'showToast' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":22,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    RefreshControl,\r\n    ActivityIndicator,\r\n    Pressable,\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useRouter } from \"expo-router\";\r\nimport { useTheme } from \"../../theme\";\r\nimport apiConfig from \"../../config/apiConfig\";\r\nimport { useToast } from \"../../components/ToastProvider\";\r\nimport Header from \"../../components/Header\";\r\nimport { useApiQuery } from \"../../hooks/useApi\";\r\n\r\nexport default function StudentClassScreen() {\r\n    const router = useRouter();\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n    const [refreshing, setRefreshing] = useState(false);\r\n    const [user, setUser] = useState(null);\r\n\r\n    useEffect(() => {\r\n        const loadUser = async () => {\r\n            const storedUser = await AsyncStorage.getItem(\"@auth_user\");\r\n            if (storedUser) {\r\n                setUser(JSON.parse(storedUser));\r\n            }\r\n        };\r\n        loadUser();\r\n    }, []);\r\n\r\n    const classId = user?.currentClass?._id || user?.currentClass;\r\n\r\n    // Fetch Class Details\r\n    const { data, isLoading: loading, refetch } = useApiQuery(\r\n        ['studentClassDetails', classId],\r\n        `${apiConfig.baseUrl}/classes/${classId}/full-details`,\r\n        { enabled: !!classId }\r\n    );\r\n\r\n    const classData = data?.classData;\r\n    const subjects = data?.subjects || [];\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        await refetch();\r\n        setRefreshing(false);\r\n    };\r\n\r\n    if (!classData) {\r\n        return (\r\n            <ScrollView\r\n                contentContainerStyle={{ flex: 1, justifyContent: \"center\", alignItems: \"center\", padding: 20 }}\r\n                refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} tintColor={colors.primary} />}\r\n            >\r\n                <MaterialIcons name=\"school\" size={64} color={colors.textSecondary} />\r\n                <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginTop: 16, textAlign: \"center\" }}>\r\n                    No Class Assigned\r\n                </Text>\r\n                <Text style={{ fontSize: 14, color: colors.textSecondary, marginTop: 8, textAlign: \"center\", fontFamily: \"DMSans-Regular\" }}>\r\n                    Please contact your administrator to be assigned to a class.\r\n                </Text>\r\n            </ScrollView>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <View style={styles.container}>\r\n            <ScrollView\r\n                refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} tintColor={colors.primary} />}\r\n                contentContainerStyle={{ paddingBottom: 100 }}\r\n                showsVerticalScrollIndicator={false}\r\n            >\r\n                <View style={{ paddingHorizontal: 20, paddingTop: 20 }}>\r\n                    <Header\r\n                        title={classData.name}\r\n                        subtitle={`Section ${classData.section || 'N/A'}  ${classData.academicYear?.name || ''}`}\r\n                    />\r\n\r\n                    {loading ? (\r\n                        <View style={{ flex: 1, justifyContent: \"center\", alignItems: \"center\", marginTop: 100 }}>\r\n                            <ActivityIndicator size=\"large\" color={colors.primary} />\r\n                        </View>\r\n                    ) : (\r\n                        <View style={{ gap: 24 }}>\r\n                            <View>\r\n                                <Text style={styles.sectionTitle}>\r\n                                    Quick Actions\r\n                                </Text>\r\n\r\n                                <View style={{ flexDirection: \"row\", flexWrap: \"wrap\", gap: 12 }}>\r\n                                    <MenuCard\r\n                                        title=\"Report Card\"\r\n                                        icon=\"assessment\"\r\n                                        color=\"#FF9800\"\r\n                                        onPress={() => router.push(\"/student/report-card\")}\r\n                                    />\r\n                                    <MenuCard\r\n                                        title=\"Timetable\"\r\n                                        icon=\"calendar-today\"\r\n                                        color=\"#009688\"\r\n                                        onPress={() => router.push(\"/student/timetable\")}\r\n                                    />\r\n                                    <MenuCard\r\n                                        title=\"Fees\"\r\n                                        icon=\"attach-money\"\r\n                                        color=\"#FF5722\"\r\n                                        onPress={() => router.push(\"/student/fees\")}\r\n                                    />\r\n                                    <MenuCard\r\n                                        title=\"Exams\"\r\n                                        icon=\"event\"\r\n                                        color=\"#E91E63\"\r\n                                        onPress={() => router.push(\"/student/exam-schedule\")}\r\n                                    />\r\n                                </View>\r\n                            </View>\r\n\r\n                            <View>\r\n                                <Text style={styles.sectionTitle}>\r\n                                    Subjects\r\n                                </Text>\r\n\r\n                                {subjects.length === 0 ? (\r\n                                    <View style={{ alignItems: \"center\", marginTop: 40, opacity: 0.6 }}>\r\n                                        <MaterialIcons name=\"library-books\" size={48} color={colors.textSecondary} />\r\n                                        <Text style={{ color: colors.textSecondary, marginTop: 16, fontSize: 16, fontFamily: \"DMSans-Medium\" }}>\r\n                                            No subjects added yet.\r\n                                        </Text>\r\n                                    </View>\r\n                                ) : (\r\n                                    <View style={{ gap: 12 }}>\r\n                                        {subjects.map((subject) => (\r\n                                            <Pressable\r\n                                                key={subject._id}\r\n                                                onPress={() => router.push({\r\n                                                    pathname: \"/student/class/subject/[subjectId]\",\r\n                                                    params: { id: classData._id, subjectId: subject._id }\r\n                                                })}\r\n                                                style={({ pressed }) => [\r\n                                                    styles.cardMinimal,\r\n                                                    {\r\n                                                        flexDirection: \"row\",\r\n                                                        justifyContent: \"space-between\",\r\n                                                        alignItems: \"center\",\r\n                                                        padding: 16,\r\n                                                        opacity: pressed ? 0.9 : 1,\r\n                                                    }\r\n                                                ]}\r\n                                            >\r\n                                                <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 14, flex: 1 }}>\r\n                                                    <View style={{\r\n                                                        backgroundColor: colors.primary + \"15\",\r\n                                                        padding: 12,\r\n                                                        borderRadius: 12\r\n                                                    }}>\r\n                                                        <MaterialIcons name=\"book\" size={24} color={colors.primary} />\r\n                                                    </View>\r\n                                                    <View style={{ flex: 1 }}>\r\n                                                        <Text style={{\r\n                                                            fontSize: 16,\r\n                                                            fontFamily: \"DMSans-Bold\",\r\n                                                            color: colors.textPrimary,\r\n                                                            marginBottom: 4\r\n                                                        }}>\r\n                                                            {subject.name}\r\n                                                        </Text>\r\n                                                        {subject.teachers && subject.teachers.length > 0 ? (\r\n                                                            <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 4 }}>\r\n                                                                <MaterialIcons name=\"person\" size={14} color={colors.textSecondary} />\r\n                                                                <Text style={{\r\n                                                                    fontSize: 13,\r\n                                                                    color: colors.textSecondary,\r\n                                                                    fontFamily: \"DMSans-Medium\"\r\n                                                                }}>\r\n                                                                    {subject.teachers.map(t => t.name).join(\", \")}\r\n                                                                </Text>\r\n                                                            </View>\r\n                                                        ) : (\r\n                                                            <Text style={{\r\n                                                                fontSize: 12,\r\n                                                                color: colors.textSecondary,\r\n                                                                fontStyle: \"italic\",\r\n                                                                fontFamily: \"DMSans-Regular\"\r\n                                                            }}>\r\n                                                                No teacher assigned\r\n                                                            </Text>\r\n                                                        )}\r\n                                                    </View>\r\n                                                </View>\r\n                                                <MaterialIcons name=\"chevron-right\" size={24} color={colors.textSecondary} />\r\n                                            </Pressable>\r\n                                        ))}\r\n                                    </View>\r\n                                )}\r\n                            </View>\r\n                        </View>\r\n                    )}\r\n                </View>\r\n            </ScrollView>\r\n        </View>\r\n    );\r\n}\r\n\r\n// Helper Component for Menu Cards\r\nconst MenuCard = ({ title, icon, color, onPress }) => {\r\n    const { colors } = useTheme();\r\n\r\n    return (\r\n        <Pressable\r\n            onPress={onPress}\r\n            style={({ pressed }) => ({\r\n                flex: 1,\r\n                minWidth: \"45%\",\r\n                backgroundColor: colors.cardBackground,\r\n                padding: 20,\r\n                borderRadius: 24,\r\n                alignItems: \"center\",\r\n                opacity: pressed ? 0.9 : 1,\r\n                shadowColor: \"#000\",\r\n                shadowOffset: { width: 0, height: 4 },\r\n                shadowOpacity: 0.05,\r\n                shadowRadius: 12,\r\n                elevation: 3,\r\n                borderWidth: 1,\r\n                borderColor: colors.border\r\n            })}\r\n        >\r\n            <View style={{\r\n                backgroundColor: color + \"15\",\r\n                padding: 16,\r\n                borderRadius: 20,\r\n                marginBottom: 12\r\n            }}>\r\n                <MaterialIcons name={icon} size={28} color={color} />\r\n            </View>\r\n            <Text style={{\r\n                fontSize: 15,\r\n                fontFamily: \"DMSans-Bold\",\r\n                color: colors.textPrimary,\r\n                textAlign: \"center\"\r\n            }}>\r\n                {title}\r\n            </Text>\r\n        </Pressable>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\student\\class\\subject\\[subjectId].jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":24,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":25,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    RefreshControl,\r\n    ActivityIndicator,\r\n} from \"react-native\";\r\nimport { useLocalSearchParams, useRouter } from \"expo-router\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useTheme } from \"../../../../theme\";\r\nimport apiConfig from \"../../../../config/apiConfig\";\r\nimport apiFetch from \"../../../../utils/apiFetch\";\r\nimport { useToast } from \"../../../../components/ToastProvider\";\r\nimport Header from \"../../../../components/Header\";\r\nimport { formatDate } from \"../../../../utils/date\";\r\n\r\nimport { getCachedData, setCachedData } from \"../../../../utils/cache\";\r\nimport { useNetworkStatus } from \"../../../../components/NetworkStatusProvider\";\r\n\r\nexport default function StudentSubjectDetailScreen() {\r\n    const { id, subjectId } = useLocalSearchParams(); // classId and subjectId\r\n    const router = useRouter();\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n    const { isConnected } = useNetworkStatus();\r\n\r\n    const [subjectName, setSubjectName] = useState(\"\");\r\n    const [content, setContent] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [refreshing, setRefreshing] = useState(false);\r\n\r\n    useEffect(() => {\r\n        loadData();\r\n    }, []);\r\n\r\n    const loadData = async () => {\r\n        const cacheKeyContent = `@subject_content_${subjectId}`;\r\n        try {\r\n            const token = await AsyncStorage.getItem(\"@auth_token\");\r\n\r\n            // 1. Try cache\r\n            const cachedContent = await getCachedData(cacheKeyContent);\r\n            if (cachedContent) {\r\n                setContent(cachedContent);\r\n                setLoading(false);\r\n\r\n            }\r\n\r\n            // 2. Fetch API\r\n            const fetchFromApi = async () => {\r\n                // Fetch Subject Details (to get name)\r\n                const subjectsRes = await apiFetch(`${apiConfig.baseUrl}/classes/${id}/subjects`, {\r\n                    headers: { Authorization: `Bearer ${token}` },\r\n                    silent: !!cachedContent\r\n                });\r\n\r\n                if (subjectsRes.ok) {\r\n                    const subjects = await subjectsRes.json();\r\n                    const currentSubject = subjects.find(s => s._id === subjectId);\r\n                    if (currentSubject) setSubjectName(currentSubject.name);\r\n                }\r\n\r\n                // Fetch Content for this subject\r\n                const contentRes = await apiFetch(`${apiConfig.baseUrl}/classes/${id}/subjects/${subjectId}/content`, {\r\n                    headers: { Authorization: `Bearer ${token}` },\r\n                    silent: !!cachedContent\r\n                });\r\n\r\n                if (contentRes.ok) {\r\n                    const contentData = await contentRes.json();\r\n                    setContent(contentData);\r\n                    setCachedData(cacheKeyContent, contentData);\r\n\r\n                } else {\r\n                    if (!cachedContent) showToast(\"Failed to load content\", \"error\");\r\n                }\r\n            };\r\n\r\n            if (isConnected) {\r\n                await fetchFromApi();\r\n            } else if (!cachedContent) {\r\n                showToast(\"No internet connection\", \"error\");\r\n            }\r\n\r\n        } catch (error) {\r\n            console.error(error);\r\n            if (!content.length) showToast(\"Error loading data\", \"error\");\r\n        } finally {\r\n            setLoading(false);\r\n            setRefreshing(false);\r\n        }\r\n    };\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        try {\r\n            await loadData();\r\n        } finally {\r\n            setRefreshing(false);\r\n        }\r\n    };\r\n\r\n    const getContentTypeColor = (type) => {\r\n        switch (type) {\r\n            case \"homework\": return colors.error;\r\n            case \"news\": return colors.primary;\r\n            default: return colors.secondary;\r\n        }\r\n    };\r\n\r\n    const getContentTypeIcon = (type) => {\r\n        switch (type) {\r\n            case \"homework\": return \"assignment\";\r\n            case \"news\": return \"campaign\";\r\n            default: return \"note\";\r\n        }\r\n    };\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <ScrollView\r\n                refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} />}\r\n                contentContainerStyle={{ paddingBottom: 100 }}\r\n            >\r\n                <View style={{ padding: 16, paddingTop: 24 }}>\r\n                    <Header title={subjectName || \"Subject Details\"} subtitle=\"Class Content\" showBack />\r\n\r\n                    {loading ? (\r\n                        <View style={{ marginTop: 100, alignItems: \"center\" }}>\r\n                            <ActivityIndicator size=\"large\" color={colors.primary} />\r\n                        </View>\r\n                    ) : (\r\n                        <View style={{ marginTop: 24 }}>\r\n                            {content.length === 0 ? (\r\n                                <View style={{ alignItems: \"center\", marginTop: 40, opacity: 0.6 }}>\r\n                                    <MaterialIcons name=\"article\" size={48} color={colors.textSecondary} />\r\n                                    <Text style={{ color: colors.textSecondary, marginTop: 16, fontSize: 16 }}>\r\n                                        No content posted yet.\r\n                                    </Text>\r\n                                </View>\r\n                            ) : (\r\n                                content.map((item) => (\r\n                                    <View\r\n                                        key={item._id}\r\n                                        style={{\r\n                                            backgroundColor: colors.cardBackground,\r\n                                            borderRadius: 16,\r\n                                            padding: 16,\r\n                                            marginBottom: 12,\r\n                                            borderLeftWidth: 4,\r\n                                            borderLeftColor: getContentTypeColor(item.type),\r\n                                            shadowColor: \"#000\",\r\n                                            shadowOffset: { width: 0, height: 1 },\r\n                                            shadowOpacity: 0.05,\r\n                                            shadowRadius: 4,\r\n                                            elevation: 1,\r\n                                        }}\r\n                                    >\r\n                                        <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"flex-start\", marginBottom: 8 }}>\r\n                                            <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 8 }}>\r\n                                                <View style={{ backgroundColor: getContentTypeColor(item.type) + \"20\", padding: 6, borderRadius: 8 }}>\r\n                                                    <MaterialIcons name={getContentTypeIcon(item.type)} size={20} color={getContentTypeColor(item.type)} />\r\n                                                </View>\r\n                                                <Text style={{ fontSize: 16, fontWeight: \"700\", color: colors.textPrimary }}>\r\n                                                    {item.title}\r\n                                                </Text>\r\n                                            </View>\r\n                                            <Text style={{ fontSize: 12, color: colors.textSecondary }}>\r\n                                                {formatDate(item.createdAt)}\r\n                                            </Text>\r\n                                        </View>\r\n\r\n                                        <Text style={{ fontSize: 14, color: colors.textSecondary, lineHeight: 20 }}>\r\n                                            {item.description}\r\n                                        </Text>\r\n\r\n                                        <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", marginTop: 12, alignItems: \"center\" }}>\r\n                                            <Text style={{ fontSize: 12, color: colors.textSecondary, fontWeight: \"500\" }}>\r\n                                                By: {item.author?.name || \"Teacher\"}\r\n                                            </Text>\r\n                                            <View style={{ backgroundColor: colors.background, paddingHorizontal: 8, paddingVertical: 4, borderRadius: 4 }}>\r\n                                                <Text style={{ fontSize: 10, fontWeight: \"600\", color: colors.textSecondary, textTransform: \"uppercase\" }}>\r\n                                                    {item.type}\r\n                                                </Text>\r\n                                            </View>\r\n                                        </View>\r\n                                    </View>\r\n                                ))\r\n                            )}\r\n                        </View>\r\n                    )}\r\n                </View>\r\n            </ScrollView>\r\n        </View>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\student\\complaints.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":36},{"ruleId":"no-unused-vars","severity":1,"message":"'AsyncStorage' is defined but never used. Allowed unused vars must match /^_/u.","line":15,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":25,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":26,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'error' is defined but never used. Allowed unused args must match /^_/u.","line":58,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":58,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    RefreshControl,\r\n    ActivityIndicator,\r\n    Pressable,\r\n    Modal,\r\n    TextInput,\r\n    KeyboardAvoidingView,\r\n    Platform\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useRouter } from \"expo-router\";\r\nimport { useTheme } from \"../../theme\";\r\nimport { useApiQuery, useApiMutation, createApiMutationFn } from \"../../hooks/useApi\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport Header from \"../../components/Header\";\r\nimport apiConfig from \"../../config/apiConfig\";\r\nimport { useToast } from \"../../components/ToastProvider\";\r\n\r\nexport default function StudentComplaintsScreen() {\r\n    const router = useRouter();\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n\r\n    const queryClient = useQueryClient();\r\n    const [refreshing, setRefreshing] = useState(false);\r\n\r\n    // Create Modal State\r\n    const [showCreateModal, setShowCreateModal] = useState(false);\r\n    const [title, setTitle] = useState(\"\");\r\n    const [description, setDescription] = useState(\"\");\r\n    const [category, setCategory] = useState(\"Academic\");\r\n\r\n    const categories = ['Academic', 'Facility', 'Transport', 'Discipline', 'Other'];\r\n\r\n    // Fetch Complaints\r\n    const { data: complaintsData, isLoading: loading, refetch } = useApiQuery(\r\n        ['studentComplaints'],\r\n        `${apiConfig.baseUrl}/complaints/my-complaints`\r\n    );\r\n    const complaints = complaintsData || [];\r\n\r\n    // Create Complaint Mutation\r\n    const createComplaintMutation = useApiMutation({\r\n        mutationFn: createApiMutationFn(`${apiConfig.baseUrl}/complaints`, 'POST'),\r\n        onSuccess: () => {\r\n            showToast(\"Complaint submitted successfully\", \"success\");\r\n            setShowCreateModal(false);\r\n            setTitle(\"\");\r\n            setDescription(\"\");\r\n            setCategory(\"Academic\");\r\n            queryClient.invalidateQueries({ queryKey: ['studentComplaints'] });\r\n        },\r\n        onError: (error) => showToast(\"Failed to submit complaint\", \"error\")\r\n    });\r\n\r\n    const handleCreate = () => {\r\n        if (!title.trim() || !description.trim()) {\r\n            showToast(\"Please fill all fields\", \"error\");\r\n            return;\r\n        }\r\n\r\n        createComplaintMutation.mutate({\r\n            title,\r\n            description,\r\n            category\r\n        });\r\n    };\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        await refetch();\r\n        setRefreshing(false);\r\n    };\r\n\r\n    const getStatusColor = (status) => {\r\n        switch (status) {\r\n            case 'Resolved': return '#4CAF50';\r\n            case 'In Progress': return '#FF9800';\r\n            case 'Rejected': return '#F44336';\r\n            default: return '#9E9E9E';\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <View style={{ flex: 1, backgroundColor: colors.background, justifyContent: \"center\", alignItems: \"center\" }}>\r\n                <ActivityIndicator size=\"large\" color={colors.primary} />\r\n            </View>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <ScrollView\r\n                refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} />}\r\n                contentContainerStyle={{ paddingBottom: 100 }}\r\n            >\r\n                <View style={{ padding: 16, paddingTop: 24 }}>\r\n                    <Header title=\"Help & Support\" subtitle=\"Report Issues\" showBack />\r\n\r\n                    {complaints.length === 0 ? (\r\n                        <View style={{ alignItems: \"center\", marginTop: 60, opacity: 0.6 }}>\r\n                            <MaterialIcons name=\"feedback\" size={64} color={colors.textSecondary} />\r\n                            <Text style={{ color: colors.textSecondary, marginTop: 16, fontSize: 16 }}>\r\n                                No complaints reported yet.\r\n                            </Text>\r\n                        </View>\r\n                    ) : (\r\n                        <View style={{ marginTop: 16 }}>\r\n                            {complaints.map((complaint) => (\r\n                                <View\r\n                                    key={complaint._id}\r\n                                    style={{\r\n                                        backgroundColor: colors.cardBackground,\r\n                                        borderRadius: 16,\r\n                                        padding: 16,\r\n                                        marginBottom: 16,\r\n                                        borderLeftWidth: 4,\r\n                                        borderLeftColor: getStatusColor(complaint.status),\r\n                                        shadowColor: \"#000\",\r\n                                        shadowOffset: { width: 0, height: 2 },\r\n                                        shadowOpacity: 0.05,\r\n                                        shadowRadius: 4,\r\n                                        elevation: 2,\r\n                                    }}\r\n                                >\r\n                                    <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"flex-start\" }}>\r\n                                        <View style={{ flex: 1 }}>\r\n                                            <Text style={{ fontSize: 16, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginBottom: 4 }}>\r\n                                                {complaint.title}\r\n                                            </Text>\r\n                                            <Text style={{ fontSize: 12, color: colors.textSecondary, fontFamily: \"DMSans-Medium\" }}>\r\n                                                {complaint.category}  {new Date(complaint.createdAt).toLocaleDateString()}\r\n                                            </Text>\r\n                                        </View>\r\n                                        <View style={{ backgroundColor: getStatusColor(complaint.status) + \"15\", paddingHorizontal: 10, paddingVertical: 4, borderRadius: 8 }}>\r\n                                            <Text style={{ color: getStatusColor(complaint.status), fontFamily: \"DMSans-Bold\", fontSize: 12 }}>\r\n                                                {complaint.status}\r\n                                            </Text>\r\n                                        </View>\r\n                                    </View>\r\n\r\n                                    <Text style={{ marginTop: 12, color: colors.textPrimary, fontSize: 14, lineHeight: 20 }}>\r\n                                        {complaint.description}\r\n                                    </Text>\r\n\r\n                                    {complaint.adminResponse && (\r\n                                        <View style={{ marginTop: 12, backgroundColor: colors.background, padding: 12, borderRadius: 8 }}>\r\n                                            <Text style={{ color: colors.primary, fontSize: 12, fontFamily: \"DMSans-Bold\", marginBottom: 4 }}>\r\n                                                Admin Response:\r\n                                            </Text>\r\n                                            <Text style={{ color: colors.textSecondary, fontSize: 13 }}>\r\n                                                {complaint.adminResponse}\r\n                                            </Text>\r\n                                        </View>\r\n                                    )}\r\n                                </View>\r\n                            ))}\r\n                        </View>\r\n                    )}\r\n                </View>\r\n            </ScrollView>\r\n\r\n            {/* FAB */}\r\n            <Pressable\r\n                onPress={() => setShowCreateModal(true)}\r\n                style={{\r\n                    position: \"absolute\",\r\n                    bottom: 110,\r\n                    right: 24,\r\n                    backgroundColor: colors.primary,\r\n                    width: 56,\r\n                    height: 56,\r\n                    borderRadius: 28,\r\n                    justifyContent: \"center\",\r\n                    alignItems: \"center\",\r\n                    elevation: 5,\r\n                    shadowColor: \"#000\",\r\n                    shadowOffset: { width: 0, height: 2 },\r\n                    shadowOpacity: 0.25,\r\n                    shadowRadius: 3.84,\r\n                }}\r\n            >\r\n                <MaterialIcons name=\"add\" size={32} color=\"#fff\" />\r\n            </Pressable>\r\n\r\n            {/* Create Modal */}\r\n            <Modal\r\n                visible={showCreateModal}\r\n                animationType=\"slide\"\r\n                transparent={true}\r\n                onRequestClose={() => setShowCreateModal(false)}\r\n            >\r\n                <KeyboardAvoidingView\r\n                    behavior={Platform.OS === \"ios\" ? \"padding\" : \"height\"}\r\n                    style={{ flex: 1, backgroundColor: \"rgba(0,0,0,0.5)\", justifyContent: \"flex-end\" }}\r\n                >\r\n                    <View style={{ backgroundColor: colors.cardBackground, borderTopLeftRadius: 24, borderTopRightRadius: 24, padding: 24, maxHeight: \"80%\" }}>\r\n                        <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\", marginBottom: 24 }}>\r\n                            <Text style={{ fontSize: 20, fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>\r\n                                New Complaint\r\n                            </Text>\r\n                            <Pressable onPress={() => setShowCreateModal(false)}>\r\n                                <MaterialIcons name=\"close\" size={24} color={colors.textSecondary} />\r\n                            </Pressable>\r\n                        </View>\r\n\r\n                        <ScrollView>\r\n                            <Text style={{ color: colors.textSecondary, marginBottom: 8 }}>Category</Text>\r\n                            <ScrollView horizontal showsHorizontalScrollIndicator={false} style={{ marginBottom: 16 }}>\r\n                                <View style={{ flexDirection: \"row\", gap: 8 }}>\r\n                                    {categories.map(cat => (\r\n                                        <Pressable\r\n                                            key={cat}\r\n                                            onPress={() => setCategory(cat)}\r\n                                            style={{\r\n                                                paddingHorizontal: 16,\r\n                                                paddingVertical: 8,\r\n                                                backgroundColor: category === cat ? colors.primary : colors.background,\r\n                                                borderRadius: 20,\r\n                                                borderWidth: 1,\r\n                                                borderColor: category === cat ? colors.primary : colors.textSecondary + \"20\"\r\n                                            }}\r\n                                        >\r\n                                            <Text style={{ color: category === cat ? \"#fff\" : colors.textPrimary }}>\r\n                                                {cat}\r\n                                            </Text>\r\n                                        </Pressable>\r\n                                    ))}\r\n                                </View>\r\n                            </ScrollView>\r\n\r\n                            <Text style={{ color: colors.textSecondary, marginBottom: 8 }}>Title</Text>\r\n                            <TextInput\r\n                                value={title}\r\n                                onChangeText={setTitle}\r\n                                placeholder=\"Brief summary of the issue\"\r\n                                placeholderTextColor={colors.textSecondary + \"80\"}\r\n                                style={{\r\n                                    borderWidth: 1,\r\n                                    borderColor: colors.textSecondary + \"40\",\r\n                                    borderRadius: 12,\r\n                                    padding: 16,\r\n                                    color: colors.textPrimary,\r\n                                    fontSize: 16,\r\n                                    marginBottom: 16,\r\n                                    backgroundColor: colors.background\r\n                                }}\r\n                            />\r\n\r\n                            <Text style={{ color: colors.textSecondary, marginBottom: 8 }}>Description</Text>\r\n                            <TextInput\r\n                                value={description}\r\n                                onChangeText={setDescription}\r\n                                placeholder=\"Detailed explanation...\"\r\n                                placeholderTextColor={colors.textSecondary + \"80\"}\r\n                                multiline\r\n                                numberOfLines={4}\r\n                                style={{\r\n                                    borderWidth: 1,\r\n                                    borderColor: colors.textSecondary + \"40\",\r\n                                    borderRadius: 12,\r\n                                    padding: 16,\r\n                                    color: colors.textPrimary,\r\n                                    fontSize: 16,\r\n                                    marginBottom: 24,\r\n                                    backgroundColor: colors.background,\r\n                                    minHeight: 100,\r\n                                    textAlignVertical: \"top\"\r\n                                }}\r\n                            />\r\n\r\n                            <Pressable\r\n                                onPress={handleCreate}\r\n                                disabled={createComplaintMutation.isPending}\r\n                                style={{\r\n                                    backgroundColor: colors.primary,\r\n                                    padding: 16,\r\n                                    borderRadius: 16,\r\n                                    alignItems: \"center\",\r\n                                    opacity: createComplaintMutation.isPending ? 0.7 : 1\r\n                                }}\r\n                            >\r\n                                {createComplaintMutation.isPending ? (\r\n                                    <ActivityIndicator color=\"#fff\" />\r\n                                ) : (\r\n                                    <Text style={{ color: \"#fff\", fontSize: 16, fontFamily: \"DMSans-Bold\" }}>\r\n                                        Submit Complaint\r\n                                    </Text>\r\n                                )}\r\n                            </Pressable>\r\n                        </ScrollView>\r\n                    </View>\r\n                </KeyboardAvoidingView>\r\n            </Modal>\r\n        </View>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\student\\exam-schedule.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":36},{"ruleId":"no-unused-vars","severity":1,"message":"'Pressable' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":14},{"ruleId":"no-unused-vars","severity":1,"message":"'AsyncStorage' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":20,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":21,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'showToast' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":22,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    RefreshControl,\r\n    ActivityIndicator,\r\n    Pressable,\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useRouter } from \"expo-router\";\r\nimport { useTheme } from \"../../theme\";\r\nimport { useApiQuery } from \"../../hooks/useApi\";\r\nimport Header from \"../../components/Header\";\r\nimport apiConfig from \"../../config/apiConfig\";\r\nimport { useToast } from \"../../components/ToastProvider\";\r\n\r\nexport default function StudentExamScheduleScreen() {\r\n    const router = useRouter();\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n\r\n    const [refreshing, setRefreshing] = useState(false);\r\n\r\n    // Fetch Exam Schedule\r\n    const { data: examsData, isLoading: loading, refetch } = useApiQuery(\r\n        ['studentExamSchedule'],\r\n        `${apiConfig.baseUrl}/exams/schedule/student`\r\n    );\r\n    const exams = examsData || [];\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        await refetch();\r\n        setRefreshing(false);\r\n    };\r\n\r\n    const getDaysRemaining = (examDate) => {\r\n        const today = new Date();\r\n        today.setHours(0, 0, 0, 0);\r\n        const exam = new Date(examDate);\r\n        exam.setHours(0, 0, 0, 0);\r\n\r\n        const diffTime = exam - today;\r\n        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n\r\n        if (diffDays === 0) return \"Today\";\r\n        if (diffDays === 1) return \"Tomorrow\";\r\n        return `In ${diffDays} days`;\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <View style={{ flex: 1, backgroundColor: colors.background, justifyContent: \"center\", alignItems: \"center\" }}>\r\n                <ActivityIndicator size=\"large\" color={colors.primary} />\r\n            </View>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <ScrollView\r\n                refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} />}\r\n                contentContainerStyle={{ paddingBottom: 100 }}\r\n            >\r\n                <View style={{ padding: 16, paddingTop: 24 }}>\r\n                    <Header title=\"Exam Schedule\" subtitle=\"Upcoming Examinations\" showBack />\r\n\r\n                    {exams.length === 0 ? (\r\n                        <View style={{ alignItems: \"center\", marginTop: 60, opacity: 0.6 }}>\r\n                            <MaterialIcons name=\"event-available\" size={64} color={colors.textSecondary} />\r\n                            <Text style={{ color: colors.textSecondary, marginTop: 16, fontSize: 16 }}>\r\n                                No upcoming exams scheduled.\r\n                            </Text>\r\n                        </View>\r\n                    ) : (\r\n                        <View style={{ marginTop: 16 }}>\r\n                            {exams.map((exam) => (\r\n                                <View\r\n                                    key={exam._id}\r\n                                    style={{\r\n                                        backgroundColor: colors.cardBackground,\r\n                                        borderRadius: 16,\r\n                                        padding: 16,\r\n                                        marginBottom: 16,\r\n                                        borderLeftWidth: 4,\r\n                                        borderLeftColor: colors.primary,\r\n                                        shadowColor: \"#000\",\r\n                                        shadowOffset: { width: 0, height: 2 },\r\n                                        shadowOpacity: 0.05,\r\n                                        shadowRadius: 4,\r\n                                        elevation: 2,\r\n                                    }}\r\n                                >\r\n                                    <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"flex-start\" }}>\r\n                                        <View style={{ flex: 1 }}>\r\n                                            <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginBottom: 4 }}>\r\n                                                {exam.subject?.name}\r\n                                            </Text>\r\n                                            <Text style={{ fontSize: 14, color: colors.textSecondary, fontFamily: \"DMSans-Medium\" }}>\r\n                                                {exam.name}  {exam.type}\r\n                                            </Text>\r\n                                        </View>\r\n                                        <View style={{ backgroundColor: colors.primary + \"15\", paddingHorizontal: 10, paddingVertical: 4, borderRadius: 8 }}>\r\n                                            <Text style={{ color: colors.primary, fontFamily: \"DMSans-Bold\", fontSize: 12 }}>\r\n                                                {getDaysRemaining(exam.date)}\r\n                                            </Text>\r\n                                        </View>\r\n                                    </View>\r\n\r\n                                    <View style={{ height: 1, backgroundColor: colors.textSecondary + \"20\", marginVertical: 12 }} />\r\n\r\n                                    <View style={{ flexDirection: \"row\", gap: 24 }}>\r\n                                        <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 8 }}>\r\n                                            <MaterialIcons name=\"calendar-today\" size={18} color={colors.textSecondary} />\r\n                                            <Text style={{ color: colors.textPrimary, fontFamily: \"DMSans-Medium\" }}>\r\n                                                {new Date(exam.date).toLocaleDateString()}\r\n                                            </Text>\r\n                                        </View>\r\n                                        {exam.duration && (\r\n                                            <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 8 }}>\r\n                                                <MaterialIcons name=\"schedule\" size={18} color={colors.textSecondary} />\r\n                                                <Text style={{ color: colors.textPrimary, fontFamily: \"DMSans-Medium\" }}>\r\n                                                    {exam.duration} mins\r\n                                                </Text>\r\n                                            </View>\r\n                                        )}\r\n                                        {exam.room && (\r\n                                            <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 8 }}>\r\n                                                <MaterialIcons name=\"meeting-room\" size={18} color={colors.textSecondary} />\r\n                                                <Text style={{ color: colors.textPrimary, fontFamily: \"DMSans-Medium\" }}>\r\n                                                    {exam.room}\r\n                                                </Text>\r\n                                            </View>\r\n                                        )}\r\n                                    </View>\r\n\r\n                                    {exam.instructions && (\r\n                                        <View style={{ marginTop: 12, backgroundColor: colors.background, padding: 10, borderRadius: 8 }}>\r\n                                            <Text style={{ color: colors.textSecondary, fontSize: 12, fontFamily: \"DMSans-Regular\" }}>\r\n                                                {exam.instructions}\r\n                                            </Text>\r\n                                        </View>\r\n                                    )}\r\n                                </View>\r\n                            ))}\r\n                        </View>\r\n                    )}\r\n                </View>\r\n            </ScrollView>\r\n        </View>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\student\\fees.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":19,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":20,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'showToast' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":21,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    ActivityIndicator,\r\n    RefreshControl,\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useRouter } from \"expo-router\";\r\nimport { useTheme } from \"../../theme\";\r\nimport { useApiQuery } from \"../../hooks/useApi\";\r\nimport Header from \"../../components/Header\";\r\nimport apiConfig from \"../../config/apiConfig\";\r\nimport { useToast } from \"../../components/ToastProvider\";\r\n\r\nexport default function StudentFeesScreen() {\r\n    const router = useRouter();\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n\r\n    const [refreshing, setRefreshing] = useState(false);\r\n    const [user, setUser] = useState(null);\r\n\r\n    useEffect(() => {\r\n        const loadUser = async () => {\r\n            const storedUser = await AsyncStorage.getItem(\"@auth_user\");\r\n            if (storedUser) {\r\n                setUser(JSON.parse(storedUser));\r\n            }\r\n        };\r\n        loadUser();\r\n    }, []);\r\n\r\n    const userId = user?.id || user?._id;\r\n\r\n    // Fetch Fees Data\r\n    const { data: feeData, isLoading: loading, refetch } = useApiQuery(\r\n        ['studentFees', userId],\r\n        `${apiConfig.baseUrl}/fees/student/${userId}`,\r\n        { enabled: !!userId }\r\n    );\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        await refetch();\r\n        setRefreshing(false);\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <View style={{ flex: 1, backgroundColor: colors.background, justifyContent: \"center\", alignItems: \"center\" }}>\r\n                <ActivityIndicator size=\"large\" color={colors.primary} />\r\n            </View>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <ScrollView\r\n                refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} />}\r\n                contentContainerStyle={{ paddingBottom: 100 }}\r\n            >\r\n                <View style={{ padding: 16, paddingTop: 24 }}>\r\n                    <Header title=\"My Fees\" subtitle=\"Payment Status & History\" showBack />\r\n\r\n                    {/* Summary Cards */}\r\n                    <View style={{ flexDirection: \"row\", gap: 12, marginTop: 24 }}>\r\n                        <View style={{ flex: 1, backgroundColor: colors.cardBackground, padding: 16, borderRadius: 16, alignItems: \"center\" }}>\r\n                            <Text style={{ color: colors.textSecondary, fontSize: 12, marginBottom: 4 }}>Total Fees</Text>\r\n                            <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>\r\n                                {feeData?.totalFees?.toLocaleString() || 0}\r\n                            </Text>\r\n                        </View>\r\n                        <View style={{ flex: 1, backgroundColor: colors.cardBackground, padding: 16, borderRadius: 16, alignItems: \"center\" }}>\r\n                            <Text style={{ color: colors.textSecondary, fontSize: 12, marginBottom: 4 }}>Paid</Text>\r\n                            <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.success }}>\r\n                                {feeData?.paidAmount?.toLocaleString() || 0}\r\n                            </Text>\r\n                        </View>\r\n                        <View style={{ flex: 1, backgroundColor: colors.cardBackground, padding: 16, borderRadius: 16, alignItems: \"center\" }}>\r\n                            <Text style={{ color: colors.textSecondary, fontSize: 12, marginBottom: 4 }}>Pending</Text>\r\n                            <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.error }}>\r\n                                {feeData?.pendingAmount?.toLocaleString() || 0}\r\n                            </Text>\r\n                        </View>\r\n                    </View>\r\n\r\n                    {/* Fee Breakdown */}\r\n                    <View style={{ marginTop: 24 }}>\r\n                        <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginBottom: 16 }}>\r\n                            Fee Breakdown\r\n                        </Text>\r\n                        <View style={{ backgroundColor: colors.cardBackground, borderRadius: 16, padding: 16 }}>\r\n                            {feeData?.feeStructure?.components?.map((comp, index) => (\r\n                                <View key={index} style={{ flexDirection: \"row\", justifyContent: \"space-between\", marginBottom: 12 }}>\r\n                                    <Text style={{ color: colors.textPrimary, fontFamily: \"DMSans-Medium\" }}>{comp.name}</Text>\r\n                                    <Text style={{ color: colors.textPrimary, fontFamily: \"DMSans-Bold\" }}>{comp.amount}</Text>\r\n                                </View>\r\n                            ))}\r\n                            <View style={{ height: 1, backgroundColor: colors.textSecondary + \"20\", marginVertical: 8 }} />\r\n                            <View style={{ flexDirection: \"row\", justifyContent: \"space-between\" }}>\r\n                                <Text style={{ color: colors.textPrimary, fontFamily: \"DMSans-Bold\" }}>Total</Text>\r\n                                <Text style={{ color: colors.primary, fontFamily: \"DMSans-Bold\" }}>{feeData?.totalFees}</Text>\r\n                            </View>\r\n                        </View>\r\n                    </View>\r\n\r\n                    {/* Payment History */}\r\n                    <View style={{ marginTop: 24 }}>\r\n                        <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginBottom: 16 }}>\r\n                            Payment History\r\n                        </Text>\r\n                        {(!feeData?.payments || feeData.payments.length === 0) ? (\r\n                            <View style={{ alignItems: \"center\", padding: 24, opacity: 0.6 }}>\r\n                                <MaterialIcons name=\"receipt-long\" size={48} color={colors.textSecondary} />\r\n                                <Text style={{ color: colors.textSecondary, marginTop: 12 }}>No payments recorded yet</Text>\r\n                            </View>\r\n                        ) : (\r\n                            feeData.payments.map((payment) => (\r\n                                <View\r\n                                    key={payment._id}\r\n                                    style={{\r\n                                        backgroundColor: colors.cardBackground,\r\n                                        borderRadius: 16,\r\n                                        padding: 16,\r\n                                        marginBottom: 12,\r\n                                        flexDirection: \"row\",\r\n                                        justifyContent: \"space-between\",\r\n                                        alignItems: \"center\"\r\n                                    }}\r\n                                >\r\n                                    <View>\r\n                                        <Text style={{ fontFamily: \"DMSans-Bold\", color: colors.textPrimary, fontSize: 16 }}>\r\n                                            {payment.amount}\r\n                                        </Text>\r\n                                        <Text style={{ color: colors.textSecondary, fontSize: 12, marginTop: 4 }}>\r\n                                            {new Date(payment.paymentDate).toLocaleDateString()}  {payment.paymentMethod}\r\n                                        </Text>\r\n                                        <Text style={{ color: colors.textSecondary, fontSize: 12 }}>\r\n                                            Receipt: {payment.receiptNumber}\r\n                                        </Text>\r\n                                        {(payment.bookNumber || payment.manualReceiptNumber) && (\r\n                                            <Text style={{ fontSize: 12, color: '#666', marginTop: 2 }}>\r\n                                                {payment.bookNumber ? `Book: ${payment.bookNumber}` : ''}\r\n                                                {payment.bookNumber && payment.manualReceiptNumber ? ' | ' : ''}\r\n                                                {payment.manualReceiptNumber ? `Receipt: ${payment.manualReceiptNumber}` : ''}\r\n                                            </Text>\r\n                                        )}\r\n                                    </View>\r\n                                    <View style={{ alignItems: \"flex-end\" }}>\r\n                                        <View style={{ backgroundColor: colors.success + \"20\", paddingHorizontal: 8, paddingVertical: 4, borderRadius: 4 }}>\r\n                                            <Text style={{ color: colors.success, fontSize: 10, fontFamily: \"DMSans-Bold\", textTransform: \"uppercase\" }}>\r\n                                                {payment.status}\r\n                                            </Text>\r\n                                        </View>\r\n                                    </View>\r\n                                </View>\r\n                            ))\r\n                        )}\r\n                    </View>\r\n                </View>\r\n            </ScrollView>\r\n        </View>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\student\\leaves.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":36},{"ruleId":"no-unused-vars","severity":1,"message":"'useCallback' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":49}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport { View, Text, StyleSheet, FlatList, TouchableOpacity, Modal, TextInput, RefreshControl, ActivityIndicator, ScrollView, Switch } from 'react-native';\r\nimport { useRouter } from 'expo-router';\r\nimport { Ionicons } from '@expo/vector-icons';\r\nimport DateTimePicker from '@react-native-community/datetimepicker';\r\nimport { useApiQuery, useApiMutation, createApiMutationFn } from '../../hooks/useApi';\r\nimport apiConfig from '../../config/apiConfig';\r\nimport { useToast } from '../../components/ToastProvider';\r\nimport { useQueryClient } from '@tanstack/react-query';\r\n\r\nexport default function StudentLeaves() {\r\n    const router = useRouter();\r\n    const queryClient = useQueryClient();\r\n    const { showToast } = useToast();\r\n    const [refreshing, setRefreshing] = useState(false);\r\n    const [modalVisible, setModalVisible] = useState(false);\r\n\r\n    // Form State\r\n    const [startDate, setStartDate] = useState(new Date());\r\n    const [endDate, setEndDate] = useState(new Date());\r\n    const [reason, setReason] = useState('');\r\n    const [showStartPicker, setShowStartPicker] = useState(false);\r\n    const [showEndPicker, setShowEndPicker] = useState(false);\r\n    const [isHalfDay, setIsHalfDay] = useState(false);\r\n    const [halfDaySlot, setHalfDaySlot] = useState('morning'); // 'morning' or 'afternoon'\r\n\r\n    // Fetch Leaves\r\n    const { data: leavesData, isLoading: loading, refetch } = useApiQuery(\r\n        ['studentLeaves'],\r\n        `${apiConfig.baseUrl}/leaves/my-leaves`\r\n    );\r\n    const leaves = leavesData?.data || [];\r\n\r\n    // Apply Leave Mutation\r\n    const applyLeaveMutation = useApiMutation({\r\n        mutationFn: createApiMutationFn(`${apiConfig.baseUrl}/leaves/apply`, 'POST'),\r\n        onSuccess: () => {\r\n            showToast('Leave applied successfully', 'success');\r\n            setModalVisible(false);\r\n            setReason('');\r\n            setIsHalfDay(false);\r\n            queryClient.invalidateQueries({ queryKey: ['studentLeaves'] });\r\n        },\r\n        onError: (error) => showToast(error.message || 'Failed to apply leave', 'error')\r\n    });\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        await refetch();\r\n        setRefreshing(false);\r\n    };\r\n\r\n    const handleApplyLeave = () => {\r\n        if (!reason.trim()) {\r\n            showToast('Please enter a reason', 'error');\r\n            return;\r\n        }\r\n\r\n        if (!isHalfDay && endDate < startDate) {\r\n            showToast('End date cannot be before start date', 'error');\r\n            return;\r\n        }\r\n\r\n        // If half day, start and end date should be same (usually)\r\n        // But backend handles logic. For UI simplicity, if half day, we can force end date = start date\r\n        let finalEndDate = endDate;\r\n        if (isHalfDay) {\r\n            finalEndDate = startDate;\r\n        }\r\n\r\n        applyLeaveMutation.mutate({\r\n            startDate: startDate.toISOString().split('T')[0],\r\n            endDate: finalEndDate.toISOString().split('T')[0],\r\n            reason,\r\n            leaveType: isHalfDay ? 'half' : 'full',\r\n            halfDaySlot: isHalfDay ? halfDaySlot : undefined\r\n        });\r\n    };\r\n\r\n    const formatDate = (date) => {\r\n        return date.toLocaleDateString('en-GB', {\r\n            day: '2-digit',\r\n            month: 'short',\r\n            year: 'numeric'\r\n        });\r\n    };\r\n\r\n    const getStatusColor = (status) => {\r\n        switch (status) {\r\n            case 'approved': return '#4CAF50';\r\n            case 'rejected': return '#F44336';\r\n            default: return '#FF9800';\r\n        }\r\n    };\r\n\r\n    const renderItem = ({ item }) => (\r\n        <View style={styles.card}>\r\n            <View style={styles.cardHeader}>\r\n                <View>\r\n                    <Text style={styles.dateRange}>\r\n                        {formatDate(new Date(item.startDate))}\r\n                        {item.leaveType === 'full' && item.startDate !== item.endDate && ` - ${formatDate(new Date(item.endDate))}`}\r\n                    </Text>\r\n                    <Text style={styles.leaveTypeBadge}>\r\n                        {item.leaveType === 'half' ? `Half Day (${item.halfDaySlot})` : 'Full Day'}\r\n                    </Text>\r\n                </View>\r\n                <View style={[styles.statusBadge, { backgroundColor: getStatusColor(item.status) }]}>\r\n                    <Text style={styles.statusText}>{(item.status || 'pending').toUpperCase()}</Text>\r\n                </View>\r\n            </View>\r\n\r\n            <Text style={styles.reasonLabel}>Reason:</Text>\r\n            <Text style={styles.reasonText}>{item.reason}</Text>\r\n\r\n            {item.status === 'rejected' && (\r\n                <View style={styles.rejectionBox}>\r\n                    <Text style={styles.rejectionTitle}>Rejection Details:</Text>\r\n                    <Text style={styles.rejectionText}><Text style={{ fontWeight: 'bold' }}>Reason:</Text> {item.rejectionReason}</Text>\r\n                    <Text style={styles.rejectionText}><Text style={{ fontWeight: 'bold' }}>Comments:</Text> {item.rejectionComments}</Text>\r\n                </View>\r\n            )}\r\n        </View>\r\n    );\r\n\r\n    return (\r\n        <View style={styles.container}>\r\n            <View style={styles.header}>\r\n                <TouchableOpacity onPress={() => router.back()} style={styles.backButton}>\r\n                    <Ionicons name=\"arrow-back\" size={24} color=\"#333\" />\r\n                </TouchableOpacity>\r\n                <Text style={styles.headerTitle}>My Leaves</Text>\r\n\r\n            </View>\r\n\r\n            {loading ? (\r\n                <ActivityIndicator size=\"large\" color=\"#2F6CD4\" style={styles.loader} />\r\n            ) : (\r\n                <FlatList\r\n                    data={leaves}\r\n                    renderItem={renderItem}\r\n                    keyExtractor={(item) => item._id}\r\n                    contentContainerStyle={styles.listContent}\r\n                    refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} />}\r\n                    ListEmptyComponent={<Text style={styles.emptyText}>No leave history found.</Text>}\r\n                />\r\n            )}\r\n\r\n            <TouchableOpacity style={styles.fab} onPress={() => setModalVisible(true)}>\r\n                <Ionicons name=\"add\" size={24} color=\"#fff\" />\r\n                <Text style={styles.fabText}>Apply Leave</Text>\r\n            </TouchableOpacity>\r\n\r\n            <Modal\r\n                visible={modalVisible}\r\n                animationType=\"slide\"\r\n                transparent={true}\r\n                onRequestClose={() => setModalVisible(false)}\r\n            >\r\n                <View style={styles.modalContainer}>\r\n                    <View style={styles.modalContent}>\r\n                        <View style={styles.modalHeader}>\r\n                            <Text style={styles.modalTitle}>Apply for Leave</Text>\r\n                            <TouchableOpacity onPress={() => setModalVisible(false)}>\r\n                                <Ionicons name=\"close\" size={24} color=\"#333\" />\r\n                            </TouchableOpacity>\r\n                        </View>\r\n\r\n                        <ScrollView>\r\n                            <View style={styles.inputGroup}>\r\n                                <Text style={styles.label}>Leave Type</Text>\r\n                                <View style={styles.row}>\r\n                                    <Text style={styles.valueText}>{isHalfDay ? 'Half Day' : 'Full Day'}</Text>\r\n                                    <Switch\r\n                                        value={isHalfDay}\r\n                                        onValueChange={setIsHalfDay}\r\n                                        trackColor={{ false: \"#767577\", true: \"#81b0ff\" }}\r\n                                        thumbColor={isHalfDay ? \"#2F6CD4\" : \"#f4f3f4\"}\r\n                                    />\r\n                                </View>\r\n                            </View>\r\n\r\n                            {isHalfDay && (\r\n                                <View style={styles.inputGroup}>\r\n                                    <Text style={styles.label}>Slot</Text>\r\n                                    <View style={styles.slotContainer}>\r\n                                        <TouchableOpacity\r\n                                            style={[styles.slotButton, halfDaySlot === 'morning' && styles.activeSlot]}\r\n                                            onPress={() => setHalfDaySlot('morning')}\r\n                                        >\r\n                                            <Text style={[styles.slotText, halfDaySlot === 'morning' && styles.activeSlotText]}>Morning</Text>\r\n                                        </TouchableOpacity>\r\n                                        <TouchableOpacity\r\n                                            style={[styles.slotButton, halfDaySlot === 'afternoon' && styles.activeSlot]}\r\n                                            onPress={() => setHalfDaySlot('afternoon')}\r\n                                        >\r\n                                            <Text style={[styles.slotText, halfDaySlot === 'afternoon' && styles.activeSlotText]}>Afternoon</Text>\r\n                                        </TouchableOpacity>\r\n                                    </View>\r\n                                </View>\r\n                            )}\r\n\r\n                            <View style={styles.inputGroup}>\r\n                                <Text style={styles.label}>Start Date</Text>\r\n                                <TouchableOpacity\r\n                                    style={styles.dateButton}\r\n                                    onPress={() => setShowStartPicker(true)}\r\n                                >\r\n                                    <Text style={styles.dateText}>{formatDate(startDate)}</Text>\r\n                                    <Ionicons name=\"calendar-outline\" size={20} color=\"#666\" />\r\n                                </TouchableOpacity>\r\n                                {showStartPicker && (\r\n                                    <DateTimePicker\r\n                                        value={startDate}\r\n                                        mode=\"date\"\r\n                                        display=\"default\"\r\n                                        minimumDate={new Date()}\r\n                                        onChange={(event, selectedDate) => {\r\n                                            setShowStartPicker(false);\r\n                                            if (selectedDate) {\r\n                                                setStartDate(selectedDate);\r\n                                                if (selectedDate > endDate) {\r\n                                                    setEndDate(selectedDate);\r\n                                                }\r\n                                            }\r\n                                        }}\r\n                                    />\r\n                                )}\r\n                            </View>\r\n\r\n                            {!isHalfDay && (\r\n                                <View style={styles.inputGroup}>\r\n                                    <Text style={styles.label}>End Date</Text>\r\n                                    <TouchableOpacity\r\n                                        style={styles.dateButton}\r\n                                        onPress={() => setShowEndPicker(true)}\r\n                                    >\r\n                                        <Text style={styles.dateText}>{formatDate(endDate)}</Text>\r\n                                        <Ionicons name=\"calendar-outline\" size={20} color=\"#666\" />\r\n                                    </TouchableOpacity>\r\n                                    {showEndPicker && (\r\n                                        <DateTimePicker\r\n                                            value={endDate}\r\n                                            mode=\"date\"\r\n                                            display=\"default\"\r\n                                            minimumDate={startDate}\r\n                                            onChange={(event, selectedDate) => {\r\n                                                setShowEndPicker(false);\r\n                                                if (selectedDate) setEndDate(selectedDate);\r\n                                            }}\r\n                                        />\r\n                                    )}\r\n                                </View>\r\n                            )}\r\n\r\n                            <View style={styles.inputGroup}>\r\n                                <Text style={styles.label}>Reason</Text>\r\n                                <TextInput\r\n                                    style={[styles.input, styles.textArea]}\r\n                                    placeholder=\"Enter reason for leave...\"\r\n                                    value={reason}\r\n                                    onChangeText={setReason}\r\n                                    multiline\r\n                                    numberOfLines={4}\r\n                                />\r\n                            </View>\r\n\r\n                            <TouchableOpacity\r\n                                style={styles.submitButton}\r\n                                onPress={handleApplyLeave}\r\n                                disabled={applyLeaveMutation.isPending}\r\n                            >\r\n                                {applyLeaveMutation.isPending ? (\r\n                                    <ActivityIndicator color=\"#fff\" />\r\n                                ) : (\r\n                                    <Text style={styles.submitButtonText}>Submit Application</Text>\r\n                                )}\r\n                            </TouchableOpacity>\r\n                        </ScrollView>\r\n                    </View>\r\n                </View>\r\n            </Modal>\r\n        </View>\r\n    );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n    container: {\r\n        flex: 1,\r\n        backgroundColor: '#f5f5f5',\r\n    },\r\n    header: {\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        justifyContent: 'space-between',\r\n        padding: 16,\r\n        backgroundColor: '#fff',\r\n        elevation: 2,\r\n    },\r\n    headerTitle: {\r\n        fontSize: 18,\r\n        fontWeight: 'bold',\r\n        color: '#333',\r\n    },\r\n    backButton: {\r\n        padding: 4,\r\n    },\r\n    fab: {\r\n        position: 'absolute',\r\n        bottom: 100,\r\n        right: 20,\r\n        backgroundColor: '#2F6CD4',\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        paddingVertical: 12,\r\n        paddingHorizontal: 20,\r\n        borderRadius: 30,\r\n        elevation: 4,\r\n    },\r\n    fabText: {\r\n        color: '#fff',\r\n        fontWeight: 'bold',\r\n        marginLeft: 8,\r\n    },\r\n    loader: {\r\n        marginTop: 20,\r\n    },\r\n    listContent: {\r\n        padding: 16,\r\n    },\r\n    card: {\r\n        backgroundColor: '#fff',\r\n        borderRadius: 12,\r\n        padding: 16,\r\n        marginBottom: 12,\r\n        elevation: 2,\r\n    },\r\n    cardHeader: {\r\n        flexDirection: 'row',\r\n        justifyContent: 'space-between',\r\n        alignItems: 'flex-start',\r\n        marginBottom: 8,\r\n    },\r\n    dateRange: {\r\n        fontSize: 16,\r\n        fontWeight: 'bold',\r\n        color: '#333',\r\n    },\r\n    leaveTypeBadge: {\r\n        fontSize: 12,\r\n        color: '#666',\r\n        marginTop: 2,\r\n        fontStyle: 'italic'\r\n    },\r\n    statusBadge: {\r\n        paddingHorizontal: 8,\r\n        paddingVertical: 4,\r\n        borderRadius: 12,\r\n    },\r\n    statusText: {\r\n        color: '#fff',\r\n        fontSize: 12,\r\n        fontWeight: 'bold',\r\n    },\r\n    reasonLabel: {\r\n        fontSize: 14,\r\n        color: '#666',\r\n        marginTop: 8,\r\n        marginBottom: 2,\r\n    },\r\n    reasonText: {\r\n        fontSize: 14,\r\n        color: '#333',\r\n    },\r\n    rejectionBox: {\r\n        marginTop: 12,\r\n        padding: 10,\r\n        backgroundColor: '#FFEBEE',\r\n        borderRadius: 8,\r\n        borderLeftWidth: 3,\r\n        borderLeftColor: '#F44336'\r\n    },\r\n    rejectionTitle: {\r\n        fontSize: 12,\r\n        fontWeight: 'bold',\r\n        color: '#D32F2F',\r\n        marginBottom: 4\r\n    },\r\n    rejectionText: {\r\n        fontSize: 12,\r\n        color: '#D32F2F',\r\n        marginBottom: 2\r\n    },\r\n    emptyText: {\r\n        textAlign: 'center',\r\n        marginTop: 40,\r\n        color: '#666',\r\n        fontSize: 16,\r\n    },\r\n    modalContainer: {\r\n        flex: 1,\r\n        backgroundColor: 'rgba(0,0,0,0.5)',\r\n        justifyContent: 'flex-end',\r\n    },\r\n    modalContent: {\r\n        backgroundColor: '#fff',\r\n        borderTopLeftRadius: 20,\r\n        borderTopRightRadius: 20,\r\n        padding: 20,\r\n        maxHeight: '90%',\r\n    },\r\n    modalHeader: {\r\n        flexDirection: 'row',\r\n        justifyContent: 'space-between',\r\n        alignItems: 'center',\r\n        marginBottom: 20,\r\n    },\r\n    modalTitle: {\r\n        fontSize: 20,\r\n        fontWeight: 'bold',\r\n        color: '#333',\r\n    },\r\n    inputGroup: {\r\n        marginBottom: 20,\r\n    },\r\n    label: {\r\n        fontSize: 14,\r\n        color: '#666',\r\n        marginBottom: 8,\r\n        fontWeight: '500',\r\n    },\r\n    row: {\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        justifyContent: 'space-between',\r\n        backgroundColor: '#f9f9f9',\r\n        padding: 12,\r\n        borderRadius: 8,\r\n        borderWidth: 1,\r\n        borderColor: '#ddd',\r\n    },\r\n    valueText: {\r\n        fontSize: 16,\r\n        color: '#333',\r\n    },\r\n    slotContainer: {\r\n        flexDirection: 'row',\r\n        gap: 12\r\n    },\r\n    slotButton: {\r\n        flex: 1,\r\n        padding: 12,\r\n        borderRadius: 8,\r\n        borderWidth: 1,\r\n        borderColor: '#ddd',\r\n        alignItems: 'center',\r\n        backgroundColor: '#f9f9f9'\r\n    },\r\n    activeSlot: {\r\n        borderColor: '#2F6CD4',\r\n        backgroundColor: '#EDE7F6'\r\n    },\r\n    slotText: {\r\n        color: '#666',\r\n        fontWeight: '500'\r\n    },\r\n    activeSlotText: {\r\n        color: '#2F6CD4',\r\n        fontWeight: 'bold'\r\n    },\r\n    dateButton: {\r\n        flexDirection: 'row',\r\n        justifyContent: 'space-between',\r\n        alignItems: 'center',\r\n        backgroundColor: '#f9f9f9',\r\n        borderWidth: 1,\r\n        borderColor: '#ddd',\r\n        borderRadius: 8,\r\n        padding: 12,\r\n    },\r\n    dateText: {\r\n        fontSize: 16,\r\n        color: '#333',\r\n    },\r\n    input: {\r\n        backgroundColor: '#f9f9f9',\r\n        borderWidth: 1,\r\n        borderColor: '#ddd',\r\n        borderRadius: 8,\r\n        padding: 12,\r\n        fontSize: 16,\r\n    },\r\n    textArea: {\r\n        height: 100,\r\n        textAlignVertical: 'top',\r\n    },\r\n    submitButton: {\r\n        backgroundColor: '#2F6CD4',\r\n        padding: 16,\r\n        borderRadius: 12,\r\n        alignItems: 'center',\r\n        marginTop: 10,\r\n        marginBottom: 20,\r\n    },\r\n    submitButtonText: {\r\n        color: '#fff',\r\n        fontSize: 16,\r\n        fontWeight: 'bold',\r\n    },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\student\\report-card.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'MaterialIcons' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":23,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":24,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'loading' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":43,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":43,"endColumn":49},{"ruleId":"no-unused-vars","severity":1,"message":"'index' is defined but never used. Allowed unused args must match /^_/u.","line":96,"column":44,"nodeType":"Identifier","messageId":"unusedVar","endLine":96,"endColumn":49},{"ruleId":"no-unused-vars","severity":1,"message":"'opacity' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":182,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":182,"endColumn":44},{"ruleId":"no-unused-vars","severity":1,"message":"'opacity' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":183,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":183,"endColumn":49}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    RefreshControl,\r\n    Dimensions,\r\n    TouchableOpacity,\r\n    ActivityIndicator\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useRouter } from \"expo-router\";\r\nimport { useTheme } from \"../../theme\";\r\nimport { useApiQuery } from \"../../hooks/useApi\";\r\nimport Header from \"../../components/Header\";\r\nimport apiConfig from \"../../config/apiConfig\";\r\nimport { LineChart } from \"react-native-chart-kit\";\r\n\r\nconst { width } = Dimensions.get('window');\r\n\r\nexport default function StudentReportCardScreen() {\r\n    const router = useRouter();\r\n    const { styles, colors } = useTheme();\r\n\r\n    const [refreshing, setRefreshing] = useState(false);\r\n    const [user, setUser] = useState(null);\r\n    const [activeTab, setActiveTab] = useState('overview'); // 'overview' | 'insights'\r\n\r\n    useEffect(() => {\r\n        const loadUser = async () => {\r\n            const storedUser = await AsyncStorage.getItem(\"@auth_user\");\r\n            if (storedUser) {\r\n                setUser(JSON.parse(storedUser));\r\n            }\r\n        };\r\n        loadUser();\r\n    }, []);\r\n\r\n    const userId = user?.id || user?._id;\r\n\r\n    // Fetch Standardized Report Card\r\n    const { data: reportCard, isLoading: loading, refetch } = useApiQuery(\r\n        ['studentReportCard', userId],\r\n        `${apiConfig.baseUrl}/reports/student/${userId}`,\r\n        { enabled: !!userId }\r\n    );\r\n\r\n    // Fetch Insights\r\n    const { data: insights, isLoading: loadingInsights } = useApiQuery(\r\n        ['studentInsights', userId],\r\n        `${apiConfig.baseUrl}/reports/insights/${userId}`,\r\n        { enabled: !!userId && activeTab === 'insights' }\r\n    );\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        await refetch();\r\n        setRefreshing(false);\r\n    };\r\n\r\n    const getGradeColor = (grade) => {\r\n        if (grade === 'A+' || grade === 'A') return colors.success;\r\n        if (grade === 'B+' || grade === 'B') return '#2196F3';\r\n        if (grade === 'C') return '#FF9800';\r\n        if (grade === 'D') return '#FF5722';\r\n        return colors.error;\r\n    };\r\n\r\n    const renderOverview = () => (\r\n        <View>\r\n            {/* Overall Stats */}\r\n            <View style={{\r\n                backgroundColor: colors.primary,\r\n                borderRadius: 20,\r\n                padding: 24,\r\n                marginTop: 20,\r\n                elevation: 4\r\n            }}>\r\n                <Text style={{ fontSize: 16, color: \"#fff\", opacity: 0.9, fontFamily: \"DMSans-Medium\", textAlign: \"center\" }}>\r\n                    Overall Percentage\r\n                </Text>\r\n                <Text style={{ fontSize: 64, fontFamily: \"DMSans-Bold\", color: \"#fff\", marginTop: 8, textAlign: \"center\" }}>\r\n                    {reportCard?.overall?.percentage}%\r\n                </Text>\r\n                <Text style={{ fontSize: 24, fontFamily: \"DMSans-Bold\", color: \"#fff\", marginTop: 4, textAlign: \"center\", opacity: 0.9 }}>\r\n                    Grade {reportCard?.overall?.grade}\r\n                </Text>\r\n            </View>\r\n\r\n            {/* Exam Wise Summary */}\r\n            <Text style={{ fontSize: 20, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginTop: 32, marginBottom: 16 }}>\r\n                Exam Summary\r\n            </Text>\r\n\r\n            {reportCard?.exams?.map((exam, index) => (\r\n                <View\r\n                    key={exam.examType}\r\n                    style={{\r\n                        backgroundColor: colors.cardBackground,\r\n                        borderRadius: 16,\r\n                        padding: 18,\r\n                        marginBottom: 14,\r\n                        elevation: 2,\r\n                        opacity: exam.isCompleted ? 1 : 0.7\r\n                    }}\r\n                >\r\n                    <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\", marginBottom: 12 }}>\r\n                        <View>\r\n                            <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>\r\n                                {exam.examType}\r\n                            </Text>\r\n                            <Text style={{ fontSize: 12, color: colors.textSecondary, fontFamily: \"DMSans-Regular\" }}>\r\n                                {exam.isCompleted ? \"Completed\" : \"In Progress / Pending\"}\r\n                            </Text>\r\n                        </View>\r\n                        {exam.isCompleted && (\r\n                            <View style={{ alignItems: \"flex-end\" }}>\r\n                                <Text style={{ fontSize: 20, fontFamily: \"DMSans-Bold\", color: getGradeColor(exam.grade) }}>\r\n                                    {exam.percentage}%\r\n                                </Text>\r\n                                <Text style={{ fontSize: 12, fontFamily: \"DMSans-Bold\", color: getGradeColor(exam.grade) }}>\r\n                                    Grade {exam.grade}\r\n                                </Text>\r\n                            </View>\r\n                        )}\r\n                    </View>\r\n\r\n                    {/* Subjects List for this Exam */}\r\n                    {exam.isCompleted && (\r\n                        <View style={{ marginTop: 8, paddingTop: 12, borderTopWidth: 1, borderTopColor: colors.borderColor }}>\r\n                            {exam.subjects.map((sub, idx) => (\r\n                                <View key={idx} style={{ flexDirection: \"row\", justifyContent: \"space-between\", paddingVertical: 6 }}>\r\n                                    <Text style={{ fontSize: 14, color: colors.textPrimary, fontFamily: \"DMSans-Medium\", flex: 1 }}>\r\n                                        {sub.subject}\r\n                                    </Text>\r\n                                    <Text style={{ fontSize: 14, color: colors.textPrimary, fontFamily: \"DMSans-Regular\" }}>\r\n                                        {sub.obtainedMarks !== null ? `${sub.obtainedMarks}/${sub.maxMarks}` : \"-\"}\r\n                                    </Text>\r\n                                    <Text style={{ fontSize: 14, color: getGradeColor(sub.grade), fontFamily: \"DMSans-Bold\", width: 30, textAlign: \"right\" }}>\r\n                                        {sub.grade}\r\n                                    </Text>\r\n                                </View>\r\n                            ))}\r\n                        </View>\r\n                    )}\r\n                </View>\r\n            ))}\r\n        </View>\r\n    );\r\n\r\n    const renderInsights = () => {\r\n        if (loadingInsights) {\r\n            return <ActivityIndicator color={colors.primary} style={{ marginTop: 40 }} />;\r\n        }\r\n\r\n        if (!insights) return null;\r\n\r\n        const examLabels = insights.examTrends.map(e => e.exam);\r\n        const examData = insights.examTrends.map(e => parseFloat(e.percentage));\r\n\r\n        return (\r\n            <View>\r\n                <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginTop: 24, marginBottom: 16 }}>\r\n                    Performance Trend\r\n                </Text>\r\n\r\n                <View style={{ backgroundColor: colors.cardBackground, borderRadius: 16, padding: 16, elevation: 2 }}>\r\n                    <LineChart\r\n                        data={{\r\n                            labels: examLabels,\r\n                            datasets: [{ data: examData }]\r\n                        }}\r\n                        width={width - 64} // from react-native\r\n                        height={220}\r\n                        yAxisSuffix=\"%\"\r\n                        chartConfig={{\r\n                            backgroundColor: colors.cardBackground,\r\n                            backgroundGradientFrom: colors.cardBackground,\r\n                            backgroundGradientTo: colors.cardBackground,\r\n                            decimalPlaces: 0,\r\n                            color: (opacity = 1) => colors.primary,\r\n                            labelColor: (opacity = 1) => colors.textSecondary,\r\n                            style: { borderRadius: 16 },\r\n                            propsForDots: {\r\n                                r: \"6\",\r\n                                strokeWidth: \"2\",\r\n                                stroke: colors.primary\r\n                            }\r\n                        }}\r\n                        bezier\r\n                        style={{ marginVertical: 8, borderRadius: 16 }}\r\n                    />\r\n                </View>\r\n\r\n                <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginTop: 32, marginBottom: 16 }}>\r\n                    Subject Analysis\r\n                </Text>\r\n\r\n                {Object.entries(insights.subjectTrends).map(([subject, trends]) => (\r\n                    <View key={subject} style={{ marginBottom: 20 }}>\r\n                        <Text style={{ fontSize: 16, fontFamily: \"DMSans-SemiBold\", color: colors.textPrimary, marginBottom: 8 }}>\r\n                            {subject}\r\n                        </Text>\r\n                        <ScrollView horizontal showsHorizontalScrollIndicator={false}>\r\n                            {trends.map((t, i) => (\r\n                                <View key={i} style={{ marginRight: 16, alignItems: \"center\" }}>\r\n                                    <View style={{\r\n                                        height: 100,\r\n                                        width: 40,\r\n                                        justifyContent: \"flex-end\",\r\n                                        backgroundColor: colors.cardBackground,\r\n                                        borderRadius: 20,\r\n                                        overflow: \"hidden\"\r\n                                    }}>\r\n                                        <View style={{\r\n                                            height: `${t.percentage}%`,\r\n                                            backgroundColor: getGradeColor(getGrade(t.percentage)),\r\n                                            width: \"100%\",\r\n                                            borderRadius: 20\r\n                                        }} />\r\n                                    </View>\r\n                                    <Text style={{ fontSize: 12, color: colors.textSecondary, marginTop: 4 }}>{t.exam}</Text>\r\n                                    <Text style={{ fontSize: 10, color: colors.textPrimary, fontFamily: \"DMSans-Bold\" }}>{t.percentage}%</Text>\r\n                                </View>\r\n                            ))}\r\n                        </ScrollView>\r\n                    </View>\r\n                ))}\r\n            </View>\r\n        );\r\n    };\r\n\r\n    // Helper for subject analysis chart color\r\n    const getGrade = (percentage) => {\r\n        if (percentage >= 90) return 'A+';\r\n        if (percentage >= 80) return 'A';\r\n        if (percentage >= 70) return 'B+';\r\n        if (percentage >= 60) return 'B';\r\n        if (percentage >= 50) return 'C';\r\n        if (percentage >= 40) return 'D';\r\n        return 'F';\r\n    };\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <ScrollView\r\n                refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} />}\r\n                contentContainerStyle={{ paddingBottom: 100 }}\r\n            >\r\n                <View style={{ padding: 16, paddingTop: 24 }}>\r\n                    <Header\r\n                        title=\"My Report Card\"\r\n                        subtitle={reportCard?.student?.class?.name ? `${reportCard.student.class.name} ${reportCard.student.class.section || ''}` : \"Academic Performance\"}\r\n                    />\r\n\r\n                    {/* Tabs */}\r\n                    <View style={{ flexDirection: \"row\", marginTop: 20, backgroundColor: colors.cardBackground, borderRadius: 12, padding: 4 }}>\r\n                        <TouchableOpacity\r\n                            style={{\r\n                                flex: 1,\r\n                                paddingVertical: 10,\r\n                                alignItems: \"center\",\r\n                                backgroundColor: activeTab === 'overview' ? colors.primary : 'transparent',\r\n                                borderRadius: 10\r\n                            }}\r\n                            onPress={() => setActiveTab('overview')}\r\n                        >\r\n                            <Text style={{ fontFamily: \"DMSans-Bold\", color: activeTab === 'overview' ? \"#fff\" : colors.textSecondary }}>Overview</Text>\r\n                        </TouchableOpacity>\r\n                        <TouchableOpacity\r\n                            style={{\r\n                                flex: 1,\r\n                                paddingVertical: 10,\r\n                                alignItems: \"center\",\r\n                                backgroundColor: activeTab === 'insights' ? colors.primary : 'transparent',\r\n                                borderRadius: 10\r\n                            }}\r\n                            onPress={() => setActiveTab('insights')}\r\n                        >\r\n                            <Text style={{ fontFamily: \"DMSans-Bold\", color: activeTab === 'insights' ? \"#fff\" : colors.textSecondary }}>Insights</Text>\r\n                        </TouchableOpacity>\r\n                    </View>\r\n\r\n                    {activeTab === 'overview' ? renderOverview() : renderInsights()}\r\n\r\n                </View>\r\n            </ScrollView>\r\n        </View>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\student\\timetable.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'AsyncStorage' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":22,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":23,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'showToast' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":24,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    Pressable,\r\n    ActivityIndicator,\r\n    RefreshControl,\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useRouter } from \"expo-router\";\r\nimport { useTheme } from \"../../theme\";\r\nimport { useApiQuery } from \"../../hooks/useApi\";\r\nimport AppHeader from \"../../components/Header\";\r\nimport apiConfig from \"../../config/apiConfig\";\r\nimport { useToast } from \"../../components/ToastProvider\";\r\n\r\nconst DAYS = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\r\n\r\nexport default function StudentTimetableScreen() {\r\n    const router = useRouter();\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n\r\n    const [refreshing, setRefreshing] = useState(false);\r\n    const [selectedDay, setSelectedDay] = useState('Monday');\r\n    const [currentDay, setCurrentDay] = useState('');\r\n\r\n    useEffect(() => {\r\n        // Set current day\r\n        const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\r\n        const today = days[new Date().getDay()];\r\n        if (DAYS.includes(today)) {\r\n            setSelectedDay(today);\r\n            setCurrentDay(today);\r\n        } else {\r\n            setSelectedDay('Monday'); // Default to Monday if Sunday\r\n        }\r\n    }, []);\r\n\r\n    // Fetch Timetable\r\n    const { data: timetableData, isLoading: loading, refetch } = useApiQuery(\r\n        ['studentTimetable'],\r\n        `${apiConfig.baseUrl}/timetable/my-timetable`\r\n    );\r\n\r\n    // Process timetable data\r\n    const schedule = {};\r\n    DAYS.forEach(day => schedule[day] = []);\r\n\r\n    if (timetableData?.schedule) {\r\n        timetableData.schedule.forEach(daySchedule => {\r\n            schedule[daySchedule.day] = daySchedule.periods.sort((a, b) => a.periodNumber - b.periodNumber);\r\n        });\r\n    }\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        await refetch();\r\n        setRefreshing(false);\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <View style={{ flex: 1, backgroundColor: colors.background, justifyContent: \"center\", alignItems: \"center\" }}>\r\n                <ActivityIndicator size=\"large\" color={colors.primary} />\r\n            </View>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <ScrollView\r\n                refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} />}\r\n                contentContainerStyle={{ paddingBottom: 100 }}\r\n            >\r\n                <View style={{ padding: 16, paddingTop: 24 }}>\r\n                    <AppHeader title=\"My Timetable\" subtitle=\"Class Schedule\" showBack />\r\n\r\n                    {/* Day Tabs */}\r\n                    <View style={{ marginTop: 24 }}>\r\n                        <ScrollView horizontal showsHorizontalScrollIndicator={false}>\r\n                            <View style={{ flexDirection: \"row\", gap: 8 }}>\r\n                                {DAYS.map((day) => (\r\n                                    <Pressable\r\n                                        key={day}\r\n                                        onPress={() => setSelectedDay(day)}\r\n                                        style={{\r\n                                            paddingHorizontal: 16,\r\n                                            paddingVertical: 8,\r\n                                            backgroundColor: selectedDay === day ? colors.primary : colors.cardBackground,\r\n                                            borderRadius: 12,\r\n                                            borderWidth: 1,\r\n                                            borderColor: selectedDay === day ? colors.primary : colors.textSecondary + \"20\"\r\n                                        }}\r\n                                    >\r\n                                        <Text style={{\r\n                                            color: selectedDay === day ? \"#fff\" : colors.textPrimary,\r\n                                            fontFamily: selectedDay === day ? \"DMSans-Bold\" : \"DMSans-Medium\"\r\n                                        }}>\r\n                                            {day.slice(0, 3)}\r\n                                        </Text>\r\n                                    </Pressable>\r\n                                ))}\r\n                            </View>\r\n                        </ScrollView>\r\n                    </View>\r\n\r\n                    {/* Schedule List */}\r\n                    <View style={{ marginTop: 24 }}>\r\n                        <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\", marginBottom: 16 }}>\r\n                            <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>\r\n                                {selectedDay}\r\n                            </Text>\r\n                            {selectedDay === currentDay && (\r\n                                <View style={{ backgroundColor: colors.success + \"20\", paddingHorizontal: 8, paddingVertical: 4, borderRadius: 4 }}>\r\n                                    <Text style={{ fontSize: 12, color: colors.success, fontFamily: \"DMSans-Bold\" }}>TODAY</Text>\r\n                                </View>\r\n                            )}\r\n                        </View>\r\n\r\n                        {(!schedule[selectedDay] || schedule[selectedDay].length === 0) ? (\r\n                            <View style={{ alignItems: \"center\", marginTop: 40, opacity: 0.6 }}>\r\n                                <MaterialIcons name=\"event-busy\" size={48} color={colors.textSecondary} />\r\n                                <Text style={{ color: colors.textSecondary, marginTop: 16, fontSize: 16 }}>\r\n                                    No classes scheduled\r\n                                </Text>\r\n                            </View>\r\n                        ) : (\r\n                            schedule[selectedDay].map((period, index) => (\r\n                                <View\r\n                                    key={index}\r\n                                    style={{\r\n                                        backgroundColor: colors.cardBackground,\r\n                                        borderRadius: 16,\r\n                                        padding: 16,\r\n                                        marginBottom: 12,\r\n                                        flexDirection: \"row\",\r\n                                        gap: 16,\r\n                                        shadowColor: \"#000\",\r\n                                        shadowOffset: { width: 0, height: 1 },\r\n                                        shadowOpacity: 0.05,\r\n                                        shadowRadius: 4,\r\n                                        elevation: 1,\r\n                                    }}\r\n                                >\r\n                                    {/* Time Column */}\r\n                                    <View style={{ alignItems: \"center\", justifyContent: \"center\", width: 60 }}>\r\n                                        <Text style={{ fontSize: 14, fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>\r\n                                            {period.startTime}\r\n                                        </Text>\r\n                                        <View style={{ width: 1, height: 10, backgroundColor: colors.textSecondary + \"40\", marginVertical: 2 }} />\r\n                                        <Text style={{ fontSize: 12, color: colors.textSecondary }}>\r\n                                            {period.endTime}\r\n                                        </Text>\r\n                                    </View>\r\n\r\n                                    {/* Divider */}\r\n                                    <View style={{ width: 4, backgroundColor: colors.primary, borderRadius: 2 }} />\r\n\r\n                                    {/* Details Column */}\r\n                                    <View style={{ flex: 1, justifyContent: \"center\" }}>\r\n                                        <Text style={{ fontSize: 16, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginBottom: 4 }}>\r\n                                            {period.subject?.name || \"Subject\"}\r\n                                        </Text>\r\n                                        <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 12 }}>\r\n                                            <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 4 }}>\r\n                                                <MaterialIcons name=\"person\" size={14} color={colors.textSecondary} />\r\n                                                <Text style={{ fontSize: 13, color: colors.textSecondary }}>\r\n                                                    {period.teacher?.name || \"Teacher\"}\r\n                                                </Text>\r\n                                            </View>\r\n                                            {period.roomNumber && (\r\n                                                <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 4 }}>\r\n                                                    <MaterialIcons name=\"room\" size={14} color={colors.textSecondary} />\r\n                                                    <Text style={{ fontSize: 13, color: colors.textSecondary }}>\r\n                                                        Room {period.roomNumber}\r\n                                                    </Text>\r\n                                                </View>\r\n                                            )}\r\n                                        </View>\r\n                                    </View>\r\n                                </View>\r\n                            ))\r\n                        )}\r\n                    </View>\r\n                </View>\r\n            </ScrollView>\r\n        </View>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\subjects.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":36},{"ruleId":"no-unused-vars","severity":1,"message":"'AsyncStorage' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":16,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'showToast' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":17,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport { View, Text, ScrollView, RefreshControl, ActivityIndicator, Pressable } from \"react-native\";\r\nimport { useRouter } from \"expo-router\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useTheme } from \"../theme\";\r\nimport apiConfig from \"../config/apiConfig\";\r\nimport apiFetch from \"../utils/apiFetch\";\r\nimport { useApiQuery } from \"../hooks/useApi\";\r\nimport { useQuery } from \"@tanstack/react-query\";\r\nimport { useToast } from \"../components/ToastProvider\";\r\nimport Header from \"../components/Header\";\r\n\r\nexport default function SubjectsScreen() {\r\n    const router = useRouter();\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n    const [refreshing, setRefreshing] = useState(false);\r\n\r\n    const { data: userData } = useApiQuery(['currentUser'], `${apiConfig.baseUrl}/auth/me`);\r\n    const user = userData || {};\r\n\r\n    // Student Subjects Query\r\n    const { data: studentSubjectsData, isLoading: loadingStudent, refetch: refetchStudent } = useApiQuery(\r\n        ['studentSubjects', user?.currentClass?._id || user?.currentClass],\r\n        `${apiConfig.baseUrl}/classes/${user?.currentClass?._id || user?.currentClass}/full-details`,\r\n        {\r\n            enabled: !!(user?.role === 'student' && user?.currentClass),\r\n            select: (data) => data.subjects || []\r\n        }\r\n    );\r\n\r\n    // Teacher Subjects Query\r\n    const { data: teacherClassesData, isLoading: loadingTeacher, refetch: refetchTeacher } = useQuery({\r\n        queryKey: ['teacherSubjectsFull'],\r\n        queryFn: async () => {\r\n            const response = await apiFetch(`${apiConfig.baseUrl}/classes/my-classes`);\r\n            if (!response.ok) throw new Error('Failed to fetch classes');\r\n            const classes = await response.json();\r\n\r\n            const classesWithSubjects = await Promise.all(classes.map(async (cls) => {\r\n                try {\r\n                    const res = await apiFetch(`${apiConfig.baseUrl}/classes/${cls._id}/full-details`);\r\n                    if (res.ok) {\r\n                        const data = await res.json();\r\n                        return { ...cls, subjects: data.subjects || [] };\r\n                    }\r\n                    return cls;\r\n                } catch (e) {\r\n                    return cls;\r\n                }\r\n            }));\r\n            return classesWithSubjects;\r\n        },\r\n        enabled: !!(user && (user.role === 'class teacher' || user.role === 'staff' || user.role === 'teacher'))\r\n    });\r\n\r\n    const loading = (user?.role === 'student' ? loadingStudent : loadingTeacher);\r\n    const studentSubjects = studentSubjectsData || [];\r\n    const teacherClasses = teacherClassesData || [];\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        if (user?.role === 'student') await refetchStudent();\r\n        else await refetchTeacher();\r\n        setRefreshing(false);\r\n    };\r\n\r\n    const renderStudentView = () => (\r\n        <View>\r\n            {studentSubjects.length === 0 ? (\r\n                <View style={{ alignItems: \"center\", marginTop: 40, opacity: 0.6 }}>\r\n                    <MaterialIcons name=\"library-books\" size={48} color={colors.textSecondary} />\r\n                    <Text style={{ color: colors.textSecondary, marginTop: 16, fontSize: 16 }}>\r\n                        No subjects assigned.\r\n                    </Text>\r\n                </View>\r\n            ) : (\r\n                studentSubjects.map((subject) => (\r\n                    <Pressable\r\n                        key={subject._id}\r\n                        onPress={() => router.push({\r\n                            pathname: \"/student/class/subject/[subjectId]\",\r\n                            params: { id: user.currentClass._id || user.currentClass, subjectId: subject._id }\r\n                        })}\r\n                        style={({ pressed }) => ({\r\n                            backgroundColor: colors.cardBackground,\r\n                            borderRadius: 16,\r\n                            padding: 16,\r\n                            marginBottom: 12,\r\n                            shadowColor: \"#000\",\r\n                            shadowOffset: { width: 0, height: 1 },\r\n                            shadowOpacity: 0.05,\r\n                            shadowRadius: 4,\r\n                            elevation: 1,\r\n                            opacity: pressed ? 0.9 : 1,\r\n                            flexDirection: \"row\",\r\n                            justifyContent: \"space-between\",\r\n                            alignItems: \"center\"\r\n                        })}\r\n                    >\r\n                        <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 12 }}>\r\n                            <View style={{ backgroundColor: colors.primary + \"20\", padding: 10, borderRadius: 10 }}>\r\n                                <MaterialIcons name=\"book\" size={24} color={colors.primary} />\r\n                            </View>\r\n                            <View>\r\n                                <Text style={{ fontSize: 16, fontWeight: \"700\", color: colors.textPrimary }}>\r\n                                    {subject.name}\r\n                                </Text>\r\n                                <Text style={{ fontSize: 12, color: colors.textSecondary, marginTop: 2 }}>\r\n                                    Tap to view content\r\n                                </Text>\r\n                            </View>\r\n                        </View>\r\n                        <MaterialIcons name=\"chevron-right\" size={24} color={colors.textSecondary} />\r\n                    </Pressable>\r\n                ))\r\n            )}\r\n        </View>\r\n    );\r\n\r\n    const renderTeacherView = () => (\r\n        <View>\r\n            {teacherClasses.length === 0 ? (\r\n                <View style={{ alignItems: \"center\", marginTop: 40, opacity: 0.6 }}>\r\n                    <MaterialIcons name=\"class\" size={48} color={colors.textSecondary} />\r\n                    <Text style={{ color: colors.textSecondary, marginTop: 16, fontSize: 16 }}>\r\n                        No classes assigned.\r\n                    </Text>\r\n                </View>\r\n            ) : (\r\n                teacherClasses.map((cls) => (\r\n                    <View key={cls._id} style={{ marginBottom: 24 }}>\r\n                        <Text style={{ fontSize: 16, fontWeight: \"700\", color: colors.textSecondary, marginBottom: 12, marginLeft: 4 }}>\r\n                            {cls.name} {cls.section ? `- ${cls.section}` : \"\"}\r\n                        </Text>\r\n\r\n                        {(!cls.subjects || cls.subjects.length === 0) ? (\r\n                            <Text style={{ color: colors.textSecondary, fontStyle: 'italic', marginLeft: 16 }}>No subjects found</Text>\r\n                        ) : (\r\n                            cls.subjects.map((subject) => (\r\n                                <Pressable\r\n                                    key={subject._id}\r\n                                    onPress={() => router.push({\r\n                                        pathname: \"/teacher/class/subject/[subjectId]\",\r\n                                        params: { id: cls._id, subjectId: subject._id }\r\n                                    })}\r\n                                    style={({ pressed }) => ({\r\n                                        backgroundColor: colors.cardBackground,\r\n                                        borderRadius: 12,\r\n                                        padding: 14,\r\n                                        marginBottom: 8,\r\n                                        opacity: pressed ? 0.9 : 1,\r\n                                        flexDirection: \"row\",\r\n                                        justifyContent: \"space-between\",\r\n                                        alignItems: \"center\",\r\n                                        borderLeftWidth: 4,\r\n                                        borderLeftColor: colors.primary\r\n                                    })}\r\n                                >\r\n                                    <Text style={{ fontSize: 15, fontWeight: \"600\", color: colors.textPrimary }}>\r\n                                        {subject.name}\r\n                                    </Text>\r\n                                    <MaterialIcons name=\"chevron-right\" size={20} color={colors.textSecondary} />\r\n                                </Pressable>\r\n                            ))\r\n                        )}\r\n                    </View>\r\n                ))\r\n            )}\r\n        </View>\r\n    );\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <ScrollView\r\n                refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} />}\r\n                contentContainerStyle={{ paddingBottom: 100 }}\r\n            >\r\n                <View style={{ padding: 16, paddingTop: 24 }}>\r\n                    <Header title=\"Subjects\" subtitle=\"Access your course materials\" />\r\n\r\n                    {loading ? (\r\n                        <View style={{ flex: 1, justifyContent: \"center\", alignItems: \"center\", marginTop: 100 }}>\r\n                            <ActivityIndicator size=\"large\" color={colors.primary} />\r\n                        </View>\r\n                    ) : (\r\n                        <View style={{ marginTop: 16 }}>\r\n                            {user?.role === 'student' ? renderStudentView() : renderTeacherView()}\r\n                        </View>\r\n                    )}\r\n                </View>\r\n            </ScrollView>\r\n        </View>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\teacher\\assessments.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":22,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    TouchableOpacity,\r\n    ActivityIndicator,\r\n    Alert,\r\n    StyleSheet\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport { useRouter } from \"expo-router\";\r\nimport { useTheme } from \"../../theme\";\r\nimport { useApiQuery, useApiMutation } from \"../../hooks/useApi\";\r\nimport { useToast } from \"../../components/ToastProvider\";\r\nimport AppHeader from \"../../components/Header\";\r\nimport apiConfig from \"../../config/apiConfig\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\n\r\nexport default function AssessmentDashboard() {\r\n    const router = useRouter();\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n\r\n    const [user, setUser] = useState(null);\r\n    const [selectedClass, setSelectedClass] = useState(null);\r\n    const [selectedSubject, setSelectedSubject] = useState(null);\r\n\r\n    useEffect(() => {\r\n        const loadUser = async () => {\r\n            const storedUser = await AsyncStorage.getItem(\"@auth_user\");\r\n            if (storedUser) {\r\n                setUser(JSON.parse(storedUser));\r\n            }\r\n        };\r\n        loadUser();\r\n    }, []);\r\n\r\n    // Fetch Teacher's Classes (Assuming generic teacher classes endpoint or filtering)\r\n    // For now, let's use the existing teacher classes endpoint\r\n    const { data: teacherClasses, isLoading: loadingClasses } = useApiQuery(\r\n        ['teacherClasses', user?.id],\r\n        `${apiConfig.baseUrl}/teachers/${user?.id}/classes`,\r\n        { enabled: !!user?.id }\r\n    );\r\n\r\n    // Fetch Subjects for selected class (if class teacher) or just teacher's subjects\r\n    // This part depends on how the backend exposes subjects. \r\n    // Let's assume we can get subjects for a class that the teacher teaches.\r\n    const { data: subjects, isLoading: loadingSubjects } = useApiQuery(\r\n        ['classSubjects', selectedClass?._id],\r\n        `${apiConfig.baseUrl}/classes/${selectedClass?._id}/subjects`, // This might need adjustment based on actual API\r\n        { enabled: !!selectedClass }\r\n    );\r\n\r\n    // Fetch Standardized Exams Status\r\n    const { data: examStatus, isLoading: loadingExams, refetch: refetchExams } = useApiQuery(\r\n        ['standardizedExams', selectedClass?._id, selectedSubject?._id],\r\n        `${apiConfig.baseUrl}/exams/standardized?classId=${selectedClass?._id}&subjectId=${selectedSubject?._id}`,\r\n        { enabled: !!selectedClass && !!selectedSubject }\r\n    );\r\n\r\n    const createExamMutation = useApiMutation(`${apiConfig.baseUrl}/exams/standardized`, 'POST');\r\n\r\n    const handleCreateExam = async (type) => {\r\n        if (!selectedClass || !selectedSubject) return;\r\n\r\n        Alert.alert(\r\n            \"Initialize Exam\",\r\n            `Are you sure you want to initialize ${type} for ${selectedClass.name} - ${selectedSubject.name}?`,\r\n            [\r\n                { text: \"Cancel\", style: \"cancel\" },\r\n                {\r\n                    text: \"Create\",\r\n                    onPress: async () => {\r\n                        try {\r\n                            await createExamMutation.mutateAsync({\r\n                                type,\r\n                                classId: selectedClass._id,\r\n                                subjectId: selectedSubject._id,\r\n                                totalMarks: type.startsWith('SA') ? 80 : 20, // Default marks, can be editable later\r\n                                instructions: `Standardized ${type} Assessment`\r\n                            });\r\n                            showToast(`${type} created successfully`, \"success\");\r\n                            refetchExams();\r\n                        } catch (error) {\r\n                            showToast(error.message || \"Failed to create exam\", \"error\");\r\n                        }\r\n                    }\r\n                }\r\n            ]\r\n        );\r\n    };\r\n\r\n    const handleEnterMarks = (exam) => {\r\n        router.push({\r\n            pathname: \"/teacher/marks-entry\",\r\n            params: {\r\n                examId: exam._id,\r\n                examName: exam.name,\r\n                className: selectedClass.name,\r\n                subjectName: selectedSubject.name\r\n            }\r\n        });\r\n    };\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <AppHeader title=\"Assessments\" subtitle=\"Manage Standardized Exams\" />\r\n\r\n            <ScrollView contentContainerStyle={{ padding: 16, paddingBottom: 100 }}>\r\n\r\n                {/* Class Selection */}\r\n                <Text style={[localStyles.label, { color: colors.textPrimary }]}>Select Class</Text>\r\n                <ScrollView horizontal showsHorizontalScrollIndicator={false} style={{ marginBottom: 20 }}>\r\n                    {loadingClasses ? (\r\n                        <ActivityIndicator color={colors.primary} />\r\n                    ) : (\r\n                        teacherClasses?.map((cls) => (\r\n                            <TouchableOpacity\r\n                                key={cls._id}\r\n                                style={[\r\n                                    localStyles.chip,\r\n                                    {\r\n                                        backgroundColor: selectedClass?._id === cls._id ? colors.primary : colors.cardBackground,\r\n                                        borderColor: selectedClass?._id === cls._id ? colors.primary : colors.borderColor\r\n                                    }\r\n                                ]}\r\n                                onPress={() => {\r\n                                    setSelectedClass(cls);\r\n                                    setSelectedSubject(null); // Reset subject\r\n                                }}\r\n                            >\r\n                                <Text style={{\r\n                                    color: selectedClass?._id === cls._id ? \"#fff\" : colors.textPrimary,\r\n                                    fontFamily: \"DMSans-Medium\"\r\n                                }}>\r\n                                    {cls.name} {cls.section}\r\n                                </Text>\r\n                            </TouchableOpacity>\r\n                        ))\r\n                    )}\r\n                </ScrollView>\r\n\r\n                {/* Subject Selection */}\r\n                {selectedClass && (\r\n                    <>\r\n                        <Text style={[localStyles.label, { color: colors.textPrimary }]}>Select Subject</Text>\r\n                        <ScrollView horizontal showsHorizontalScrollIndicator={false} style={{ marginBottom: 20 }}>\r\n                            {loadingSubjects ? (\r\n                                <ActivityIndicator color={colors.primary} />\r\n                            ) : (\r\n                                subjects?.map((sub) => (\r\n                                    <TouchableOpacity\r\n                                        key={sub._id}\r\n                                        style={[\r\n                                            localStyles.chip,\r\n                                            {\r\n                                                backgroundColor: selectedSubject?._id === sub._id ? colors.primary : colors.cardBackground,\r\n                                                borderColor: selectedSubject?._id === sub._id ? colors.primary : colors.borderColor\r\n                                            }\r\n                                        ]}\r\n                                        onPress={() => setSelectedSubject(sub)}\r\n                                    >\r\n                                        <Text style={{\r\n                                            color: selectedSubject?._id === sub._id ? \"#fff\" : colors.textPrimary,\r\n                                            fontFamily: \"DMSans-Medium\"\r\n                                        }}>\r\n                                            {sub.name}\r\n                                        </Text>\r\n                                    </TouchableOpacity>\r\n                                ))\r\n                            )}\r\n                        </ScrollView>\r\n                    </>\r\n                )}\r\n\r\n                {/* Exam Grid */}\r\n                {selectedClass && selectedSubject ? (\r\n                    loadingExams ? (\r\n                        <ActivityIndicator size=\"large\" color={colors.primary} style={{ marginTop: 40 }} />\r\n                    ) : (\r\n                        <View style={localStyles.grid}>\r\n                            {examStatus?.map((item) => (\r\n                                <View\r\n                                    key={item.type}\r\n                                    style={[localStyles.card, { backgroundColor: colors.cardBackground }]}\r\n                                >\r\n                                    <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\", marginBottom: 12 }}>\r\n                                        <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>\r\n                                            {item.type}\r\n                                        </Text>\r\n                                        {item.exists ? (\r\n                                            <MaterialIcons name=\"check-circle\" size={20} color={colors.success} />\r\n                                        ) : (\r\n                                            <MaterialIcons name=\"radio-button-unchecked\" size={20} color={colors.textSecondary} />\r\n                                        )}\r\n                                    </View>\r\n\r\n                                    {item.exists ? (\r\n                                        <>\r\n                                            <View style={{ marginBottom: 16 }}>\r\n                                                <Text style={{ fontSize: 12, color: colors.textSecondary, fontFamily: \"DMSans-Regular\" }}>\r\n                                                    Status: {item.marksEntered ? \"Marks Entered\" : \"Pending Entry\"}\r\n                                                </Text>\r\n                                                <Text style={{ fontSize: 12, color: colors.textSecondary, fontFamily: \"DMSans-Regular\", marginTop: 4 }}>\r\n                                                    Students Graded: {item.marksCount}\r\n                                                </Text>\r\n                                            </View>\r\n                                            <TouchableOpacity\r\n                                                style={[localStyles.button, { backgroundColor: colors.primary }]}\r\n                                                onPress={() => handleEnterMarks(item.exam)}\r\n                                            >\r\n                                                <Text style={localStyles.buttonText}>Manage Marks</Text>\r\n                                            </TouchableOpacity>\r\n                                        </>\r\n                                    ) : (\r\n                                        <>\r\n                                            <View style={{ marginBottom: 16 }}>\r\n                                                <Text style={{ fontSize: 12, color: colors.textSecondary, fontFamily: \"DMSans-Regular\" }}>\r\n                                                    Not Created Yet\r\n                                                </Text>\r\n                                            </View>\r\n                                            <TouchableOpacity\r\n                                                style={[localStyles.button, { backgroundColor: colors.cardBackground, borderWidth: 1, borderColor: colors.primary }]}\r\n                                                onPress={() => handleCreateExam(item.type)}\r\n                                            >\r\n                                                <Text style={[localStyles.buttonText, { color: colors.primary }]}>Initialize</Text>\r\n                                            </TouchableOpacity>\r\n                                        </>\r\n                                    )}\r\n                                </View>\r\n                            ))}\r\n                        </View>\r\n                    )\r\n                ) : (\r\n                    <View style={{ alignItems: \"center\", marginTop: 60 }}>\r\n                        <MaterialIcons name=\"assignment\" size={60} color={colors.textSecondary + \"40\"} />\r\n                        <Text style={{ color: colors.textSecondary, marginTop: 16, fontFamily: \"DMSans-Medium\" }}>\r\n                            Select a Class and Subject to view exams\r\n                        </Text>\r\n                    </View>\r\n                )}\r\n\r\n            </ScrollView>\r\n        </View>\r\n    );\r\n}\r\n\r\nconst localStyles = StyleSheet.create({\r\n    label: {\r\n        fontSize: 14,\r\n        fontFamily: \"DMSans-Bold\",\r\n        marginBottom: 12,\r\n        marginLeft: 4\r\n    },\r\n    chip: {\r\n        paddingHorizontal: 16,\r\n        paddingVertical: 8,\r\n        borderRadius: 20,\r\n        borderWidth: 1,\r\n        marginRight: 10,\r\n        minWidth: 80,\r\n        alignItems: \"center\"\r\n    },\r\n    grid: {\r\n        flexDirection: \"row\",\r\n        flexWrap: \"wrap\",\r\n        gap: 12,\r\n        marginTop: 10\r\n    },\r\n    card: {\r\n        width: \"48%\",\r\n        padding: 16,\r\n        borderRadius: 16,\r\n        elevation: 2,\r\n        marginBottom: 4\r\n    },\r\n    button: {\r\n        paddingVertical: 8,\r\n        borderRadius: 8,\r\n        alignItems: \"center\"\r\n    },\r\n    buttonText: {\r\n        color: \"#fff\",\r\n        fontSize: 12,\r\n        fontFamily: \"DMSans-Bold\"\r\n    }\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\teacher\\attendance.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":36},{"ruleId":"no-unused-vars","severity":1,"message":"'useCallback' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":49},{"ruleId":"no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":10,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'showToast' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":11,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport { View, StyleSheet } from 'react-native';\r\nimport { useRouter } from 'expo-router';\r\nimport { useApiQuery } from '../../hooks/useApi';\r\nimport apiConfig from '../../config/apiConfig';\r\nimport { useToast } from '../../components/ToastProvider';\r\nimport AttendanceView from '../../components/AttendanceView';\r\n\r\nexport default function TeacherAttendance() {\r\n    const router = useRouter();\r\n    const { showToast } = useToast();\r\n\r\n    const [refreshing, setRefreshing] = useState(false);\r\n\r\n    // Fetch Attendance\r\n    const { data: attendanceData, isLoading: loading, refetch } = useApiQuery(\r\n        ['teacherAttendance'],\r\n        `${apiConfig.baseUrl}/attendance/my-attendance`\r\n    );\r\n\r\n    const myAttendance = attendanceData?.attendance || [];\r\n    const mySummary = attendanceData?.summary || null;\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        await refetch();\r\n        setRefreshing(false);\r\n    };\r\n\r\n    return (\r\n        <View style={styles.container}>\r\n            <AttendanceView\r\n                attendanceHistory={myAttendance}\r\n                summary={mySummary}\r\n                loading={loading}\r\n                refreshing={refreshing}\r\n                onRefresh={onRefresh}\r\n                title=\"My Attendance\"\r\n                subtitle=\"Track your teaching attendance\"\r\n            />\r\n        </View>\r\n    );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n    container: { flex: 1, backgroundColor: '#f5f5f5' },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\teacher\\class\\[id].jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'FlatList' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":13},{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":28,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":28,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'loading' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":61,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":61,"endColumn":37},{"ruleId":"no-undef","severity":2,"message":"'formatDate' is not defined.","line":467,"column":68,"nodeType":"Identifier","messageId":"undef","endLine":467,"endColumn":78},{"ruleId":"no-undef","severity":2,"message":"'formatDate' is not defined.","line":730,"column":68,"nodeType":"Identifier","messageId":"undef","endLine":730,"endColumn":78}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    Pressable,\r\n    TextInput,\r\n    RefreshControl,\r\n    ActivityIndicator,\r\n    Modal,\r\n    Alert,\r\n    FlatList\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useRouter, useLocalSearchParams } from \"expo-router\";\r\nimport { useTheme } from \"../../../theme\";\r\nimport { useApiQuery, useApiMutation, createApiMutationFn } from \"../../../hooks/useApi\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport apiConfig from \"../../../config/apiConfig\";\r\nimport { useToast } from \"../../../components/ToastProvider\";\r\nimport AppHeader from \"../../../components/Header\";\r\n\r\nexport default function ClassDetailsScreen() {\r\n    const router = useRouter();\r\n    const { id } = useLocalSearchParams();\r\n    const queryClient = useQueryClient();\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n\r\n    const [refreshing, setRefreshing] = useState(false);\r\n\r\n    // Modals\r\n    const [showAddSubjectModal, setShowAddSubjectModal] = useState(false);\r\n    const [showAddStudentModal, setShowAddStudentModal] = useState(false);\r\n\r\n    const [activeTab, setActiveTab] = useState(\"subjects\"); // subjects, students\r\n    const [searchQuery, setSearchQuery] = useState(\"\");\r\n    const [user, setUser] = useState(null);\r\n\r\n    const [selectedGlobalSubjectIds, setSelectedGlobalSubjectIds] = useState([]);\r\n    const [selectedStudentIds, setSelectedStudentIds] = useState([]);\r\n\r\n    useEffect(() => {\r\n        loadUserData();\r\n    }, []);\r\n\r\n    const loadUserData = async () => {\r\n        try {\r\n            const storedUser = await AsyncStorage.getItem(\"@auth_user\");\r\n            if (storedUser) {\r\n                const parsedUser = JSON.parse(storedUser);\r\n                setUser(parsedUser);\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to load user:\", error);\r\n        }\r\n    };\r\n\r\n    // Fetch Class Details\r\n    const { data, isLoading: loading, refetch } = useApiQuery(\r\n        ['classDetails', id],\r\n        `${apiConfig.baseUrl}/classes/${id}/full-details`,\r\n        { enabled: !!id }\r\n    );\r\n\r\n    const classData = data?.classData;\r\n    const subjects = data?.subjects || [];\r\n    const students = data?.students || [];\r\n\r\n    // Fetch Global Subjects\r\n    const { data: globalSubjectsData } = useApiQuery(\r\n        ['globalSubjects'],\r\n        `${apiConfig.baseUrl}/subjects`\r\n    );\r\n    const globalSubjects = globalSubjectsData || [];\r\n\r\n    // Fetch Available Students\r\n    const { data: availableStudentsData } = useApiQuery(\r\n        ['availableStudents'],\r\n        `${apiConfig.baseUrl}/users?role=student&limit=1000`\r\n    );\r\n    // Handle both new paginated structure and potential old array structure\r\n    const availableStudents = Array.isArray(availableStudentsData)\r\n        ? availableStudentsData.filter(s => !s.currentClass)\r\n        : (availableStudentsData?.data || []).filter(s => !s.currentClass);\r\n\r\n    // Mutations\r\n    const addSubjectMutation = useApiMutation({\r\n        mutationFn: async (subjectId) => {\r\n            const subject = globalSubjects.find(s => s._id === subjectId);\r\n            if (!subject) throw new Error(\"Subject not found\");\r\n            return createApiMutationFn(`${apiConfig.baseUrl}/classes/${id}/subjects`, 'POST')({\r\n                name: subject.name,\r\n                globalSubjectId: subject._id\r\n            });\r\n        }\r\n    });\r\n\r\n    const removeSubjectMutation = useApiMutation({\r\n        mutationFn: createApiMutationFn((subjectId) => `${apiConfig.baseUrl}/classes/${id}/subjects/${subjectId}`, 'DELETE'),\r\n        onSuccess: () => {\r\n            showToast(\"Subject removed successfully\", \"success\");\r\n            queryClient.invalidateQueries({ queryKey: ['classDetails', id] });\r\n        },\r\n        onError: (error) => showToast(error.message || \"Failed to remove subject\", \"error\")\r\n    });\r\n\r\n    const addStudentsMutation = useApiMutation({\r\n        mutationFn: createApiMutationFn(`${apiConfig.baseUrl}/classes/${id}/students`, 'POST'),\r\n        onSuccess: (data) => {\r\n            showToast(data.message || \"Students added successfully\", \"success\");\r\n            setShowAddStudentModal(false);\r\n            setSearchQuery(\"\");\r\n            setSelectedStudentIds([]);\r\n            queryClient.invalidateQueries({ queryKey: ['classDetails', id] });\r\n            queryClient.invalidateQueries({ queryKey: ['availableStudents'] });\r\n        },\r\n        onError: (error) => showToast(error.message || \"Failed to add students\", \"error\")\r\n    });\r\n\r\n    const removeStudentMutation = useApiMutation({\r\n        mutationFn: createApiMutationFn((studentId) => `${apiConfig.baseUrl}/classes/${id}/students/${studentId}`, 'DELETE'),\r\n        onSuccess: () => {\r\n            showToast(\"Student removed successfully\", \"success\");\r\n            queryClient.invalidateQueries({ queryKey: ['classDetails', id] });\r\n            queryClient.invalidateQueries({ queryKey: ['availableStudents'] });\r\n        },\r\n        onError: (error) => showToast(error.message || \"Failed to remove student\", \"error\")\r\n    });\r\n\r\n    const toggleSubjectSelection = (subjectId) => {\r\n        setSelectedGlobalSubjectIds(prev => {\r\n            if (prev.includes(subjectId)) {\r\n                return prev.filter(id => id !== subjectId);\r\n            } else {\r\n                return [...prev, subjectId];\r\n            }\r\n        });\r\n    };\r\n\r\n    const handleAddSubject = async () => {\r\n        if (selectedGlobalSubjectIds.length === 0) {\r\n            showToast(\"Please select at least one subject\", \"error\");\r\n            return;\r\n        }\r\n\r\n        try {\r\n            // Add subjects one by one\r\n            let successCount = 0;\r\n            let failCount = 0;\r\n\r\n            await Promise.all(selectedGlobalSubjectIds.map(async (subjectId) => {\r\n                try {\r\n                    await addSubjectMutation.mutateAsync(subjectId);\r\n                    successCount++;\r\n                } catch (error) {\r\n                    failCount++;\r\n                }\r\n            }));\r\n\r\n            if (successCount > 0) {\r\n                showToast(`${successCount} subject(s) added successfully`, \"success\");\r\n            }\r\n            if (failCount > 0) {\r\n                showToast(`${failCount} subject(s) failed to add`, \"error\");\r\n            }\r\n\r\n            setShowAddSubjectModal(false);\r\n            setSelectedGlobalSubjectIds([]);\r\n            setSearchQuery(\"\");\r\n            queryClient.invalidateQueries({ queryKey: ['classDetails', id] });\r\n        } catch (error) {\r\n            console.error(error);\r\n            showToast(\"Error adding subjects\", \"error\");\r\n        }\r\n    };\r\n\r\n    const handleRemoveSubject = (subjectId, subjectName) => {\r\n        Alert.alert(\r\n            \"Remove Subject\",\r\n            `Are you sure you want to remove ${subjectName}?`,\r\n            [\r\n                { text: \"Cancel\", style: \"cancel\" },\r\n                {\r\n                    text: \"Remove\",\r\n                    style: \"destructive\",\r\n                    onPress: () => removeSubjectMutation.mutate(subjectId),\r\n                },\r\n            ]\r\n        );\r\n    };\r\n\r\n\r\n\r\n    const toggleStudentSelection = (studentId) => {\r\n        setSelectedStudentIds(prev => {\r\n            if (prev.includes(studentId)) {\r\n                return prev.filter(id => id !== studentId);\r\n            } else {\r\n                return [...prev, studentId];\r\n            }\r\n        });\r\n    };\r\n\r\n    const handleBulkAddStudents = () => {\r\n        if (selectedStudentIds.length === 0) {\r\n            showToast(\"Please select at least one student\", \"error\");\r\n            return;\r\n        }\r\n\r\n        addStudentsMutation.mutate({ studentIds: selectedStudentIds });\r\n    };\r\n\r\n    const handleRemoveStudent = (studentId, studentName) => {\r\n        Alert.alert(\r\n            \"Remove Student\",\r\n            `Are you sure you want to remove ${studentName} from this class?`,\r\n            [\r\n                { text: \"Cancel\", style: \"cancel\" },\r\n                {\r\n                    text: \"Remove\",\r\n                    style: \"destructive\",\r\n                    onPress: () => removeStudentMutation.mutate(studentId),\r\n                },\r\n            ]\r\n        );\r\n    };\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        await refetch();\r\n        setRefreshing(false);\r\n    };\r\n\r\n    const isClassTeacher = (() => {\r\n        if (!user || !classData || !classData.classTeacher) return false;\r\n\r\n        const teacherId = typeof classData.classTeacher === 'object' ? classData.classTeacher._id : classData.classTeacher;\r\n        const userId = user._id || user.id;\r\n\r\n        return String(teacherId) === String(userId);\r\n    })();\r\n\r\n    const canManageClass = (() => {\r\n        if (!user) return false;\r\n        return user.role === 'admin' || user.role === 'super admin';\r\n    })();\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    const filteredAvailableStudents = availableStudents.filter(s =>\r\n        s.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        s.phone.includes(searchQuery)\r\n    );\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <ScrollView\r\n                refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} />}\r\n                contentContainerStyle={{ paddingBottom: 100 }}\r\n            >\r\n                <View style={{ padding: 16, paddingTop: 24 }}>\r\n                    <AppHeader\r\n                        title={classData ? `${classData.name} ${classData.section || ''}` : \"Class Details\"}\r\n                        subtitle=\"Manage subjects and students\"\r\n                        showBack\r\n                    />\r\n\r\n                    {/* Quick Actions */}\r\n                    {isClassTeacher && (\r\n                        <View style={{ flexDirection: \"row\", gap: 12, marginTop: 20, marginBottom: 16 }}>\r\n                            <Pressable\r\n                                onPress={() => router.push({\r\n                                    pathname: \"/teacher/class/attendance\",\r\n                                    params: { id }\r\n                                })}\r\n                                style={({ pressed }) => ({\r\n                                    flex: 1,\r\n                                    backgroundColor: colors.cardBackground,\r\n                                    borderRadius: 12,\r\n                                    padding: 16,\r\n                                    alignItems: \"center\",\r\n                                    opacity: pressed ? 0.7 : 1,\r\n                                    elevation: 2\r\n                                })}\r\n                            >\r\n                                <MaterialIcons name=\"how-to-reg\" size={28} color={colors.primary} />\r\n                                <Text style={{ fontSize: 13, fontFamily: \"DMSans-SemiBold\", color: colors.textPrimary, marginTop: 8 }}>\r\n                                    Attendance\r\n                                </Text>\r\n                            </Pressable>\r\n                            <Pressable\r\n                                onPress={() => router.push({\r\n                                    pathname: \"/teacher/class/performance\",\r\n                                    params: { classId: id }\r\n                                })}\r\n                                style={({ pressed }) => ({\r\n                                    flex: 1,\r\n                                    backgroundColor: colors.cardBackground,\r\n                                    borderRadius: 12,\r\n                                    padding: 16,\r\n                                    alignItems: \"center\",\r\n                                    opacity: pressed ? 0.7 : 1,\r\n                                    elevation: 2\r\n                                })}\r\n                            >\r\n                                <MaterialIcons name=\"insights\" size={28} color={colors.success} />\r\n                                <Text style={{ fontSize: 13, fontFamily: \"DMSans-SemiBold\", color: colors.textPrimary, marginTop: 8 }}>\r\n                                    Performance\r\n                                </Text>\r\n                            </Pressable>\r\n                        </View>\r\n                    )}\r\n\r\n\r\n\r\n                    {/* Tabs */}\r\n                    <View style={{ flexDirection: \"row\", marginBottom: 24, backgroundColor: colors.cardBackground, padding: 4, borderRadius: 12 }}>\r\n                        <Pressable\r\n                            onPress={() => setActiveTab(\"subjects\")}\r\n                            style={{\r\n                                flex: 1,\r\n                                paddingVertical: 10,\r\n                                alignItems: \"center\",\r\n                                backgroundColor: activeTab === \"subjects\" ? colors.primary : \"transparent\",\r\n                                borderRadius: 8\r\n                            }}\r\n                        >\r\n                            <Text style={{ fontWeight: \"600\", color: activeTab === \"subjects\" ? \"#fff\" : colors.textSecondary }}>Subjects</Text>\r\n                        </Pressable>\r\n                        <Pressable\r\n                            onPress={() => setActiveTab(\"students\")}\r\n                            style={{\r\n                                flex: 1,\r\n                                paddingVertical: 10,\r\n                                alignItems: \"center\",\r\n                                backgroundColor: activeTab === \"students\" ? colors.primary : \"transparent\",\r\n                                borderRadius: 8\r\n                            }}\r\n                        >\r\n                            <Text style={{ fontWeight: \"600\", color: activeTab === \"students\" ? \"#fff\" : colors.textSecondary }}>Students</Text>\r\n                        </Pressable>\r\n                    </View>\r\n\r\n                    {activeTab === \"subjects\" ? (\r\n                        <View>\r\n                            {subjects.length === 0 ? (\r\n                                <View style={{ alignItems: \"center\", marginTop: 40, opacity: 0.6 }}>\r\n                                    <MaterialIcons name=\"library-books\" size={48} color={colors.textSecondary} />\r\n                                    <Text style={{ color: colors.textSecondary, marginTop: 16, fontSize: 16 }}>\r\n                                        No subjects added yet.\r\n                                    </Text>\r\n                                </View>\r\n                            ) : (\r\n                                subjects.map((subject) => (\r\n                                    <Pressable\r\n                                        key={subject._id}\r\n                                        onPress={() => router.push({\r\n                                            pathname: \"/teacher/class/subject/[subjectId]\",\r\n                                            params: { id, subjectId: subject._id }\r\n                                        })}\r\n                                        style={({ pressed }) => ({\r\n                                            backgroundColor: colors.cardBackground,\r\n                                            borderRadius: 16,\r\n                                            padding: 16,\r\n                                            marginBottom: 12,\r\n                                            shadowColor: \"#000\",\r\n                                            shadowOffset: { width: 0, height: 1 },\r\n                                            shadowOpacity: 0.05,\r\n                                            shadowRadius: 4,\r\n                                            elevation: 1,\r\n                                            opacity: pressed ? 0.9 : 1,\r\n                                            flexDirection: \"row\",\r\n                                            justifyContent: \"space-between\",\r\n                                            alignItems: \"center\"\r\n                                        })}\r\n                                    >\r\n                                        <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 12, flex: 1 }}>\r\n                                            <View style={{ backgroundColor: colors.primary + \"20\", padding: 10, borderRadius: 10 }}>\r\n                                                <MaterialIcons name=\"book\" size={24} color={colors.primary} />\r\n                                            </View>\r\n                                            <View style={{ flex: 1 }}>\r\n                                                <Text style={{ fontSize: 16, fontWeight: \"700\", color: colors.textPrimary }}>\r\n                                                    {subject.name}\r\n                                                </Text>\r\n                                                {subject.teachers && subject.teachers.length > 0 ? (\r\n                                                    <Text style={{ fontSize: 13, color: colors.textSecondary, marginTop: 2, fontFamily: \"DMSans-Medium\" }}>\r\n                                                        {subject.teachers.map(t => t.name).join(\", \")}\r\n                                                    </Text>\r\n                                                ) : (\r\n                                                    <Text style={{ fontSize: 12, color: colors.textSecondary, marginTop: 2, fontStyle: \"italic\" }}>\r\n                                                        No teachers assigned\r\n                                                    </Text>\r\n                                                )}\r\n                                            </View>\r\n                                        </View>\r\n\r\n                                        <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 8 }}>\r\n                                            {canManageClass && (\r\n                                                <Pressable\r\n                                                    onPress={(e) => {\r\n                                                        e.stopPropagation();\r\n                                                        handleRemoveSubject(subject._id, subject.name);\r\n                                                    }}\r\n                                                    style={{ padding: 8 }}\r\n                                                >\r\n                                                    <MaterialIcons name=\"delete-outline\" size={24} color={colors.error} />\r\n                                                </Pressable>\r\n                                            )}\r\n                                            <MaterialIcons name=\"chevron-right\" size={24} color={colors.textSecondary} />\r\n                                        </View>\r\n                                    </Pressable>\r\n                                ))\r\n                            )}\r\n                        </View>\r\n                    ) : (\r\n                        <View>\r\n                            {students.length === 0 ? (\r\n                                <View style={{ alignItems: \"center\", marginTop: 40, opacity: 0.6 }}>\r\n                                    <MaterialIcons name=\"people-outline\" size={48} color={colors.textSecondary} />\r\n                                    <Text style={{ color: colors.textSecondary, marginTop: 16, fontSize: 16 }}>\r\n                                        No students in this class yet.\r\n                                    </Text>\r\n                                </View>\r\n                            ) : (\r\n                                students.map((student) => (\r\n                                    <View\r\n                                        key={student._id}\r\n                                        style={{\r\n                                            backgroundColor: colors.cardBackground,\r\n                                            borderRadius: 16,\r\n                                            padding: 16,\r\n                                            marginBottom: 12,\r\n                                            shadowColor: \"#000\",\r\n                                            shadowOffset: { width: 0, height: 1 },\r\n                                            shadowOpacity: 0.05,\r\n                                            shadowRadius: 4,\r\n                                            elevation: 1,\r\n                                        }}\r\n                                    >\r\n                                        <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"flex-start\" }}>\r\n                                            <View style={{ flex: 1 }}>\r\n                                                <Text style={{ fontSize: 16, fontWeight: \"700\", color: colors.textPrimary }}>\r\n                                                    {student.name}\r\n                                                </Text>\r\n                                                <Text style={{ fontSize: 14, color: colors.textSecondary, marginTop: 4 }}>\r\n                                                    {student.phone}\r\n                                                </Text>\r\n                                                {student.email && (\r\n                                                    <Text style={{ fontSize: 14, color: colors.textSecondary, marginTop: 2 }}>\r\n                                                        {student.email}\r\n                                                    </Text>\r\n                                                )}\r\n                                                {student.guardianName && (\r\n                                                    <Text style={{ fontSize: 13, color: colors.textSecondary, marginTop: 6 }}>\r\n                                                        Guardian: {student.guardianName}\r\n                                                        {student.guardianPhone && ` (${student.guardianPhone})`}\r\n                                                    </Text>\r\n                                                )}\r\n                                                {student.admissionDate && (\r\n                                                    <Text style={{ fontSize: 12, color: colors.textSecondary, marginTop: 4 }}>\r\n                                                        Admitted: {formatDate(student.admissionDate)}\r\n                                                    </Text>\r\n                                                )}\r\n                                            </View>\r\n                                            {canManageClass && (\r\n                                                <Pressable\r\n                                                    onPress={() => handleRemoveStudent(student._id, student.name)}\r\n                                                    style={{ padding: 8 }}\r\n                                                >\r\n                                                    <MaterialIcons name=\"remove-circle-outline\" size={24} color={colors.error} />\r\n                                                </Pressable>\r\n                                            )}\r\n                                        </View>\r\n                                    </View>\r\n                                ))\r\n                            )}\r\n                        </View>\r\n                    )\r\n                    }\r\n\r\n                </View >\r\n            </ScrollView >\r\n\r\n            {/* FAB for Add Subject or Add Student */}\r\n            {\r\n                canManageClass && (\r\n                    <Pressable\r\n                        onPress={() => {\r\n                            if (activeTab === \"subjects\") {\r\n                                // Pre-select already added subjects\r\n                                const alreadyAddedIds = subjects\r\n                                    .filter(s => s.globalSubject)\r\n                                    .map(s => typeof s.globalSubject === 'object' ? s.globalSubject._id : s.globalSubject);\r\n                                setSelectedGlobalSubjectIds(alreadyAddedIds);\r\n                                setShowAddSubjectModal(true);\r\n                                setSearchQuery(\"\");\r\n                            } else {\r\n                                setShowAddStudentModal(true);\r\n                                setSelectedStudentIds([]); // Reset selection\r\n                            }\r\n                        }}\r\n                        style={{\r\n                            position: \"absolute\",\r\n                            bottom: 90,\r\n                            right: 24,\r\n                            backgroundColor: colors.primary,\r\n                            width: 56,\r\n                            height: 56,\r\n                            borderRadius: 28,\r\n                            justifyContent: \"center\",\r\n                            alignItems: \"center\",\r\n                            elevation: 6,\r\n                            zIndex: 9999,\r\n                        }}\r\n                    >\r\n                        <MaterialIcons name=\"add\" size={28} color=\"#fff\" />\r\n                    </Pressable>\r\n                )\r\n            }\r\n\r\n            {/* Add Subject Modal */}\r\n            <Modal visible={showAddSubjectModal} animationType=\"slide\" transparent>\r\n                <View style={{ flex: 1, justifyContent: \"center\", backgroundColor: \"rgba(0,0,0,0.5)\", padding: 20 }}>\r\n                    <View style={{ backgroundColor: colors.cardBackground, borderRadius: 16, padding: 24, maxHeight: \"80%\" }}>\r\n                        <Text style={{ fontSize: 20, fontWeight: \"700\", color: colors.textPrimary, marginBottom: 16 }}>\r\n                            Add Subjects to Class\r\n                        </Text>\r\n\r\n                        <TextInput\r\n                            placeholder=\"Search subjects...\"\r\n                            placeholderTextColor={colors.textSecondary}\r\n                            style={{\r\n                                backgroundColor: colors.background,\r\n                                padding: 12,\r\n                                borderRadius: 8,\r\n                                color: colors.textPrimary,\r\n                                marginBottom: 16\r\n                            }}\r\n                            value={searchQuery}\r\n                            onChangeText={setSearchQuery}\r\n                        />\r\n\r\n                        <ScrollView style={{ maxHeight: 400 }}>\r\n                            {globalSubjects.filter(s => s.name.toLowerCase().includes(searchQuery.toLowerCase())).length === 0 ? (\r\n                                <View style={{ alignItems: \"center\", paddingVertical: 40 }}>\r\n                                    <MaterialIcons name=\"library-books\" size={48} color={colors.textSecondary} />\r\n                                    <Text style={{ color: colors.textSecondary, marginTop: 16 }}>\r\n                                        {searchQuery ? \"No subjects found\" : \"No subjects available. Please ask admin to add subjects to the master list.\"}\r\n                                    </Text>\r\n                                </View>\r\n                            ) : (\r\n                                globalSubjects.filter(s => s.name.toLowerCase().includes(searchQuery.toLowerCase())).map((item) => {\r\n                                    const isSelected = selectedGlobalSubjectIds.includes(item._id);\r\n                                    // Check if this subject is already added to the class\r\n                                    const isAlreadyAdded = subjects.some(s =>\r\n                                        s.globalSubject && (\r\n                                            typeof s.globalSubject === 'object'\r\n                                                ? s.globalSubject._id === item._id\r\n                                                : s.globalSubject === item._id\r\n                                        )\r\n                                    );\r\n                                    return (\r\n                                        <Pressable\r\n                                            key={item._id}\r\n                                            onPress={() => !isAlreadyAdded && toggleSubjectSelection(item._id)}\r\n                                            disabled={isAlreadyAdded}\r\n                                            style={({ pressed }) => ({\r\n                                                backgroundColor: isAlreadyAdded\r\n                                                    ? colors.disabled + \"30\"\r\n                                                    : isSelected ? colors.primary + \"10\" : (pressed ? colors.background : colors.cardBackground),\r\n                                                borderRadius: 12,\r\n                                                padding: 12,\r\n                                                marginBottom: 8,\r\n                                                borderWidth: 1,\r\n                                                borderColor: isAlreadyAdded\r\n                                                    ? colors.textSecondary\r\n                                                    : isSelected ? colors.primary : colors.border,\r\n                                                flexDirection: \"row\",\r\n                                                alignItems: \"center\",\r\n                                                gap: 12,\r\n                                                opacity: isAlreadyAdded ? 0.6 : 1\r\n                                            })}\r\n                                        >\r\n                                            <View style={{\r\n                                                width: 24,\r\n                                                height: 24,\r\n                                                borderRadius: 12,\r\n                                                borderWidth: 2,\r\n                                                borderColor: isAlreadyAdded || isSelected ? colors.primary : colors.textSecondary,\r\n                                                alignItems: \"center\",\r\n                                                justifyContent: \"center\",\r\n                                                backgroundColor: isAlreadyAdded || isSelected ? colors.primary : \"transparent\"\r\n                                            }}>\r\n                                                {(isSelected || isAlreadyAdded) && <MaterialIcons name=\"check\" size={16} color=\"#fff\" />}\r\n                                            </View>\r\n                                            <View style={{ flex: 1 }}>\r\n                                                <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 8 }}>\r\n                                                    <Text style={{ fontSize: 16, fontWeight: \"600\", color: colors.textPrimary }}>\r\n                                                        {item.name}\r\n                                                    </Text>\r\n                                                    {isAlreadyAdded && (\r\n                                                        <View style={{ backgroundColor: colors.success + \"20\", paddingHorizontal: 8, paddingVertical: 2, borderRadius: 8 }}>\r\n                                                            <Text style={{ fontSize: 11, color: colors.success, fontWeight: \"600\" }}>ADDED</Text>\r\n                                                        </View>\r\n                                                    )}\r\n                                                </View>\r\n                                                {item.code && (\r\n                                                    <Text style={{ fontSize: 14, color: colors.textSecondary, marginTop: 2 }}>\r\n                                                        Code: {item.code}\r\n                                                    </Text>\r\n                                                )}\r\n                                            </View>\r\n                                        </Pressable>\r\n                                    );\r\n                                })\r\n                            )}\r\n                        </ScrollView>\r\n\r\n                        <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\", marginTop: 16, borderTopWidth: 1, borderTopColor: colors.border, paddingTop: 16 }}>\r\n                            <Pressable\r\n                                onPress={() => {\r\n                                    setShowAddSubjectModal(false);\r\n                                    setSelectedGlobalSubjectIds([]);\r\n                                    setSearchQuery(\"\");\r\n                                }}\r\n                                style={{ padding: 12 }}\r\n                            >\r\n                                <Text style={{ color: colors.textSecondary, fontWeight: \"600\" }}>Cancel</Text>\r\n                            </Pressable>\r\n\r\n                            <Pressable\r\n                                onPress={handleAddSubject}\r\n                                disabled={selectedGlobalSubjectIds.length === 0 || addSubjectMutation.isPending}\r\n                                style={{\r\n                                    backgroundColor: (selectedGlobalSubjectIds.length > 0 && !addSubjectMutation.isPending) ? colors.primary : colors.disabled,\r\n                                    paddingHorizontal: 20,\r\n                                    paddingVertical: 12,\r\n                                    borderRadius: 8,\r\n                                    flexDirection: \"row\",\r\n                                    alignItems: \"center\",\r\n                                    gap: 8\r\n                                }}\r\n                            >\r\n                                {addSubjectMutation.isPending && <ActivityIndicator size=\"small\" color=\"#fff\" />}\r\n                                <Text style={{ color: \"#fff\", fontWeight: \"600\" }}>\r\n                                    {addSubjectMutation.isPending ? \"Adding...\" : `Add ${selectedGlobalSubjectIds.length > 0 ? `${selectedGlobalSubjectIds.length} ` : \"\"}Selected`}\r\n                                </Text>\r\n                            </Pressable>\r\n                        </View>\r\n                    </View>\r\n                </View>\r\n            </Modal>\r\n\r\n            {/* Add Student Modal */}\r\n            <Modal visible={showAddStudentModal} animationType=\"slide\" transparent>\r\n                <View style={{ flex: 1, justifyContent: \"center\", backgroundColor: \"rgba(0,0,0,0.5)\", padding: 20 }}>\r\n                    <View style={{ backgroundColor: colors.cardBackground, borderRadius: 16, padding: 24, maxHeight: \"80%\" }}>\r\n                        <Text style={{ fontSize: 20, fontWeight: \"700\", color: colors.textPrimary, marginBottom: 16 }}>\r\n                            Add Students to Class\r\n                        </Text>\r\n\r\n                        <TextInput\r\n                            placeholder=\"Search by name or phone...\"\r\n                            placeholderTextColor={colors.textSecondary}\r\n                            style={{\r\n                                backgroundColor: colors.background,\r\n                                padding: 12,\r\n                                borderRadius: 8,\r\n                                color: colors.textPrimary,\r\n                                marginBottom: 16\r\n                            }}\r\n                            value={searchQuery}\r\n                            onChangeText={setSearchQuery}\r\n                        />\r\n\r\n                        <ScrollView style={{ maxHeight: 400 }}>\r\n                            {filteredAvailableStudents.length === 0 ? (\r\n                                <View style={{ alignItems: \"center\", paddingVertical: 40 }}>\r\n                                    <MaterialIcons name=\"person-off\" size={48} color={colors.textSecondary} />\r\n                                    <Text style={{ color: colors.textSecondary, marginTop: 16 }}>\r\n                                        {searchQuery ? \"No students found\" : \"No unassigned students available\"}\r\n                                    </Text>\r\n                                </View>\r\n                            ) : (\r\n                                filteredAvailableStudents.map((student) => {\r\n                                    const isSelected = selectedStudentIds.includes(student._id);\r\n                                    return (\r\n                                        <Pressable\r\n                                            key={student._id}\r\n                                            onPress={() => toggleStudentSelection(student._id)}\r\n                                            style={({ pressed }) => ({\r\n                                                backgroundColor: isSelected ? colors.primary + \"10\" : (pressed ? colors.background : colors.cardBackground),\r\n                                                borderRadius: 12,\r\n                                                padding: 12,\r\n                                                marginBottom: 8,\r\n                                                borderWidth: 1,\r\n                                                borderColor: isSelected ? colors.primary : colors.border,\r\n                                                flexDirection: \"row\",\r\n                                                alignItems: \"center\",\r\n                                                gap: 12\r\n                                            })}\r\n                                        >\r\n                                            <View style={{\r\n                                                width: 24,\r\n                                                height: 24,\r\n                                                borderRadius: 12,\r\n                                                borderWidth: 2,\r\n                                                borderColor: isSelected ? colors.primary : colors.textSecondary,\r\n                                                alignItems: \"center\",\r\n                                                justifyContent: \"center\",\r\n                                                backgroundColor: isSelected ? colors.primary : \"transparent\"\r\n                                            }}>\r\n                                                {isSelected && <MaterialIcons name=\"check\" size={16} color=\"#fff\" />}\r\n                                            </View>\r\n                                            <View style={{ flex: 1 }}>\r\n                                                <Text style={{ fontSize: 16, fontWeight: \"600\", color: colors.textPrimary }}>\r\n                                                    {student.name}\r\n                                                </Text>\r\n                                                <Text style={{ fontSize: 14, color: colors.textSecondary, marginTop: 2 }}>\r\n                                                    {student.phone}\r\n                                                </Text>\r\n                                                {student.admissionDate && (\r\n                                                    <Text style={{ fontSize: 12, color: colors.textSecondary, marginTop: 4 }}>\r\n                                                        Admitted: {formatDate(student.admissionDate)}\r\n                                                    </Text>\r\n                                                )}\r\n                                            </View>\r\n                                        </Pressable>\r\n                                    );\r\n                                })\r\n                            )}\r\n                        </ScrollView>\r\n\r\n                        <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\", marginTop: 16, borderTopWidth: 1, borderTopColor: colors.border, paddingTop: 16 }}>\r\n                            <Pressable\r\n                                onPress={() => {\r\n                                    setShowAddStudentModal(false);\r\n                                    setSearchQuery(\"\");\r\n                                    setSelectedStudentIds([]);\r\n                                }}\r\n                                style={{ padding: 12 }}\r\n                            >\r\n                                <Text style={{ color: colors.textSecondary, fontWeight: \"600\" }}>Cancel</Text>\r\n                            </Pressable>\r\n\r\n                            <Pressable\r\n                                onPress={handleBulkAddStudents}\r\n                                disabled={selectedStudentIds.length === 0 || addStudentsMutation.isPending}\r\n                                style={{\r\n                                    backgroundColor: (selectedStudentIds.length > 0 && !addStudentsMutation.isPending) ? colors.primary : colors.disabled,\r\n                                    paddingHorizontal: 20,\r\n                                    paddingVertical: 12,\r\n                                    borderRadius: 8,\r\n                                    flexDirection: \"row\",\r\n                                    alignItems: \"center\",\r\n                                    gap: 8\r\n                                }}\r\n                            >\r\n                                {addStudentsMutation.isPending && <ActivityIndicator size=\"small\" color=\"#fff\" />}\r\n                                <Text style={{ color: \"#fff\", fontWeight: \"600\" }}>\r\n                                    {addStudentsMutation.isPending ? \"Adding...\" : `Add ${selectedStudentIds.length > 0 ? `${selectedStudentIds.length} ` : \"\"}Selected`}\r\n                                </Text>\r\n                            </Pressable>\r\n                        </View>\r\n                    </View>\r\n                </View>\r\n            </Modal>\r\n        </View >\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\teacher\\class\\attendance.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":21,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":23,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    Pressable,\r\n    ActivityIndicator,\r\n    RefreshControl,\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useRouter, useLocalSearchParams } from \"expo-router\";\r\nimport { useTheme } from \"../../../theme\";\r\nimport apiConfig from \"../../../config/apiConfig\";\r\nimport apiFetch from \"../../../utils/apiFetch\";\r\nimport { useToast } from \"../../../components/ToastProvider\";\r\nimport AppHeader from \"../../../components/Header\";\r\nimport DateTimePicker from \"@react-native-community/datetimepicker\";\r\n\r\nexport default function MarkAttendanceScreen() {\r\n    const router = useRouter();\r\n    const params = useLocalSearchParams();\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n\r\n    const { classId, subjectId } = params;\r\n\r\n    const [loading, setLoading] = useState(true);\r\n    const [refreshing, setRefreshing] = useState(false);\r\n    const [saving, setSaving] = useState(false);\r\n    const [selectedDate, setSelectedDate] = useState(new Date());\r\n    const [showDatePicker, setShowDatePicker] = useState(false);\r\n    const [students, setStudents] = useState([]);\r\n    const [classData, setClassData] = useState(null);\r\n    const [subjectData, setSubjectData] = useState(null);\r\n\r\n    useEffect(() => {\r\n        loadData();\r\n    }, [selectedDate]);\r\n\r\n    const loadData = async () => {\r\n        try {\r\n            const token = await AsyncStorage.getItem(\"@auth_token\");\r\n\r\n            // Load class/subject info\r\n            if (classId) {\r\n                const classResponse = await apiFetch(`${apiConfig.baseUrl}/classes/${classId}`, {\r\n                    headers: { Authorization: `Bearer ${token}` }\r\n                });\r\n                if (classResponse.ok) {\r\n                    const data = await classResponse.json();\r\n                    setClassData(data);\r\n                }\r\n            }\r\n\r\n            if (subjectId) {\r\n                const subjectResponse = await apiFetch(`${apiConfig.baseUrl}/subjects/${subjectId}`, {\r\n                    headers: { Authorization: `Bearer ${token}` }\r\n                });\r\n                if (subjectResponse.ok) {\r\n                    const data = await subjectResponse.json();\r\n                    setSubjectData(data);\r\n                }\r\n            }\r\n\r\n            // Load attendance for selected date\r\n            const dateStr = selectedDate.toISOString().split('T')[0];\r\n            const endpoint = subjectId\r\n                ? `/attendance/subject/${subjectId}/date/${dateStr}`\r\n                : `/attendance/class/${classId}/date/${dateStr}`;\r\n\r\n            const response = await apiFetch(`${apiConfig.baseUrl}${endpoint}`, {\r\n                headers: { Authorization: `Bearer ${token}` }\r\n            });\r\n\r\n            if (response.ok) {\r\n                const data = await response.json();\r\n                setStudents(data);\r\n            } else {\r\n                showToast(\"Failed to load attendance\", \"error\");\r\n            }\r\n        } catch (error) {\r\n            console.error(error);\r\n            showToast(\"Error loading data\", \"error\");\r\n        } finally {\r\n            setLoading(false);\r\n            setRefreshing(false);\r\n        }\r\n    };\r\n\r\n    const onRefresh = () => {\r\n        setRefreshing(true);\r\n        loadData();\r\n    };\r\n\r\n    const handleStatusChange = (studentId, newStatus) => {\r\n        setStudents(prevStudents =>\r\n            prevStudents.map(s =>\r\n                s.student._id === studentId\r\n                    ? { ...s, status: newStatus }\r\n                    : s\r\n            )\r\n        );\r\n    };\r\n\r\n    const handleMarkAllPresent = () => {\r\n        setStudents(prevStudents =>\r\n            prevStudents.map(s => ({ ...s, status: 'present' }))\r\n        );\r\n    };\r\n\r\n\r\n\r\n    const handleSaveAttendance = async () => {\r\n        try {\r\n            setSaving(true);\r\n            const token = await AsyncStorage.getItem(\"@auth_token\");\r\n\r\n            // Prepare attendance records\r\n            const attendanceRecords = students\r\n                .filter(s => s.status !== null)\r\n                .map(s => ({\r\n                    studentId: s.student._id,\r\n                    status: s.status,\r\n                    remarks: s.remarks || ''\r\n                }));\r\n\r\n            if (attendanceRecords.length === 0) {\r\n                showToast(\"Please mark attendance for at least one student\", \"warning\");\r\n                setSaving(false);\r\n                return;\r\n            }\r\n\r\n            const dateStr = selectedDate.toISOString().split('T')[0];\r\n\r\n            const response = await apiFetch(`${apiConfig.baseUrl}/attendance/mark`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    Authorization: `Bearer ${token}`\r\n                },\r\n                body: JSON.stringify({\r\n                    classId,\r\n                    subjectId: null, // Force class-based attendance\r\n                    date: dateStr,\r\n                    attendanceRecords\r\n                })\r\n            });\r\n\r\n            if (response.ok) {\r\n                showToast(\"Attendance saved successfully\", \"success\");\r\n                loadData();\r\n            } else {\r\n                const error = await response.json();\r\n                showToast(error.message || \"Failed to save attendance\", \"error\");\r\n            }\r\n        } catch (error) {\r\n            console.error(error);\r\n            showToast(\"Error saving attendance\", \"error\");\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    const onDateChange = (event, selectedDate) => {\r\n        setShowDatePicker(false);\r\n        if (selectedDate) {\r\n            setSelectedDate(selectedDate);\r\n        }\r\n    };\r\n\r\n    const getStatusColor = (status) => {\r\n        switch (status) {\r\n            case 'present': return colors.success;\r\n            case 'absent': return colors.error;\r\n            case 'late': return '#FF9800';\r\n            case 'excused': return '#2196F3';\r\n            default: return colors.textSecondary;\r\n        }\r\n    };\r\n\r\n    const getStatusIcon = (status) => {\r\n        switch (status) {\r\n            case 'present': return 'check-circle';\r\n            case 'absent': return 'cancel';\r\n            case 'late': return 'schedule';\r\n            case 'excused': return 'verified';\r\n            default: return 'radio-button-unchecked';\r\n        }\r\n    };\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <ScrollView\r\n                refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} />}\r\n                contentContainerStyle={{ paddingBottom: 100 }}\r\n            >\r\n                <View style={{ padding: 16, paddingTop: 24 }}>\r\n                    <AppHeader\r\n                        title=\"Mark Attendance\"\r\n                        subtitle={subjectData ? `${subjectData.name} - ${classData?.name}` : classData?.name}\r\n                    />\r\n\r\n                    {/* Date Picker */}\r\n                    <Pressable\r\n                        onPress={() => setShowDatePicker(true)}\r\n                        style={{\r\n                            backgroundColor: colors.cardBackground,\r\n                            borderRadius: 12,\r\n                            padding: 16,\r\n                            marginTop: 20,\r\n                            flexDirection: \"row\",\r\n                            alignItems: \"center\",\r\n                            justifyContent: \"space-between\",\r\n                            elevation: 2\r\n                        }}\r\n                    >\r\n                        <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 12 }}>\r\n                            <MaterialIcons name=\"calendar-today\" size={24} color={colors.primary} />\r\n                            <View>\r\n                                <Text style={{ fontSize: 12, color: colors.textSecondary, fontFamily: \"DMSans-Medium\" }}>\r\n                                    Selected Date\r\n                                </Text>\r\n                                <Text style={{ fontSize: 17, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginTop: 2 }}>\r\n                                    {selectedDate.toLocaleDateString('en-GB', {\r\n                                        day: '2-digit',\r\n                                        month: 'short',\r\n                                        year: 'numeric'\r\n                                    })}\r\n                                </Text>\r\n                            </View>\r\n                        </View>\r\n                        <MaterialIcons name=\"edit\" size={20} color={colors.textSecondary} />\r\n                    </Pressable>\r\n\r\n                    {showDatePicker && (\r\n                        <DateTimePicker\r\n                            value={selectedDate}\r\n                            mode=\"date\"\r\n                            display=\"default\"\r\n                            onChange={onDateChange}\r\n                            maximumDate={new Date()}\r\n                        />\r\n                    )}\r\n\r\n                    {/* Quick Actions */}\r\n                    <View style={{ flexDirection: \"row\", gap: 12, marginTop: 20 }}>\r\n                        <Pressable\r\n                            onPress={handleMarkAllPresent}\r\n                            style={({ pressed }) => ({\r\n                                flex: 1,\r\n                                backgroundColor: colors.success + \"15\",\r\n                                borderRadius: 12,\r\n                                padding: 14,\r\n                                flexDirection: \"row\",\r\n                                alignItems: \"center\",\r\n                                justifyContent: \"center\",\r\n                                gap: 8,\r\n                                opacity: pressed ? 0.7 : 1\r\n                            })}\r\n                        >\r\n                            <MaterialIcons name=\"check-circle\" size={20} color={colors.success} />\r\n                            <Text style={{ fontSize: 14, fontFamily: \"DMSans-Bold\", color: colors.success }}>\r\n                                All Present\r\n                            </Text>\r\n                        </Pressable>\r\n\r\n\r\n                    </View>\r\n\r\n                    {/* Attendance Summary */}\r\n                    <View style={{ flexDirection: 'row', gap: 12, marginTop: 24, marginBottom: 8 }}>\r\n                        <View style={{ flex: 1, backgroundColor: colors.success + '15', padding: 12, borderRadius: 12, alignItems: 'center' }}>\r\n                            <Text style={{ fontSize: 20, fontFamily: \"DMSans-Bold\", color: colors.success }}>\r\n                                {students.filter(s => s.status === 'present').length}\r\n                            </Text>\r\n                            <Text style={{ fontSize: 12, color: colors.success, fontFamily: \"DMSans-Medium\" }}>Present</Text>\r\n                        </View>\r\n                        <View style={{ flex: 1, backgroundColor: colors.error + '15', padding: 12, borderRadius: 12, alignItems: 'center' }}>\r\n                            <Text style={{ fontSize: 20, fontFamily: \"DMSans-Bold\", color: colors.error }}>\r\n                                {students.filter(s => s.status === 'absent').length}\r\n                            </Text>\r\n                            <Text style={{ fontSize: 12, color: colors.error, fontFamily: \"DMSans-Medium\" }}>Absent</Text>\r\n                        </View>\r\n                        <View style={{ flex: 1, backgroundColor: colors.primary + '15', padding: 12, borderRadius: 12, alignItems: 'center' }}>\r\n                            <Text style={{ fontSize: 20, fontFamily: \"DMSans-Bold\", color: colors.primary }}>\r\n                                {students.length}\r\n                            </Text>\r\n                            <Text style={{ fontSize: 12, color: colors.primary, fontFamily: \"DMSans-Medium\" }}>Total</Text>\r\n                        </View>\r\n                    </View>\r\n\r\n                    {/* Students List */}\r\n                    <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginBottom: 16 }}>\r\n                        Students List\r\n                    </Text>\r\n\r\n                    {loading ? (\r\n                        <View style={{ flex: 1, justifyContent: \"center\", alignItems: \"center\", marginTop: 60 }}>\r\n                            <ActivityIndicator size=\"large\" color={colors.primary} />\r\n                        </View>\r\n                    ) : (\r\n                        students.map((studentData, index) => (\r\n                            <View\r\n                                key={studentData.student._id}\r\n                                style={{\r\n                                    backgroundColor: colors.cardBackground,\r\n                                    borderRadius: 12,\r\n                                    padding: 14,\r\n                                    marginBottom: 10,\r\n                                    elevation: 1\r\n                                }}\r\n                            >\r\n                                <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\", marginBottom: 12 }}>\r\n                                    <View style={{ flex: 1 }}>\r\n                                        <Text style={{ fontSize: 16, fontFamily: \"DMSans-SemiBold\", color: colors.textPrimary }}>\r\n                                            {index + 1}. {studentData.student.name}\r\n                                        </Text>\r\n                                        {studentData.student.email && (\r\n                                            <Text style={{ fontSize: 12, color: colors.textSecondary, marginTop: 2, fontFamily: \"DMSans-Regular\" }}>\r\n                                                {studentData.student.email}\r\n                                            </Text>\r\n                                        )}\r\n                                    </View>\r\n                                    {studentData.status && (\r\n                                        <MaterialIcons\r\n                                            name={getStatusIcon(studentData.status)}\r\n                                            size={24}\r\n                                            color={getStatusColor(studentData.status)}\r\n                                        />\r\n                                    )}\r\n                                </View>\r\n\r\n                                {/* Status Buttons */}\r\n                                <View style={{ flexDirection: \"row\", gap: 8 }}>\r\n                                    {['present', 'absent', 'late', 'excused'].map((status) => (\r\n                                        <Pressable\r\n                                            key={status}\r\n                                            onPress={() => handleStatusChange(studentData.student._id, status)}\r\n                                            style={({ pressed }) => ({\r\n                                                flex: 1,\r\n                                                backgroundColor: studentData.status === status\r\n                                                    ? getStatusColor(status) + \"20\"\r\n                                                    : colors.background,\r\n                                                borderWidth: studentData.status === status ? 2 : 1,\r\n                                                borderColor: studentData.status === status\r\n                                                    ? getStatusColor(status)\r\n                                                    : colors.textSecondary + \"30\",\r\n                                                borderRadius: 8,\r\n                                                paddingVertical: 10,\r\n                                                alignItems: \"center\",\r\n                                                opacity: pressed ? 0.7 : 1\r\n                                            })}\r\n                                        >\r\n                                            <Text style={{\r\n                                                fontSize: 11,\r\n                                                fontFamily: \"DMSans-Bold\",\r\n                                                color: studentData.status === status\r\n                                                    ? getStatusColor(status)\r\n                                                    : colors.textSecondary,\r\n                                                textTransform: \"uppercase\"\r\n                                            }}>\r\n                                                {status === 'present' ? 'P' : status === 'absent' ? 'A' : status === 'late' ? 'L' : 'E'}\r\n                                            </Text>\r\n                                        </Pressable>\r\n                                    ))}\r\n                                </View>\r\n                            </View>\r\n                        ))\r\n                    )}\r\n\r\n                    {/* Save Button */}\r\n                    {!loading && (\r\n                        <Pressable\r\n                            onPress={handleSaveAttendance}\r\n                            disabled={saving}\r\n                            style={({ pressed }) => ({\r\n                                backgroundColor: colors.primary,\r\n                                borderRadius: 12,\r\n                                padding: 16,\r\n                                marginTop: 24,\r\n                                flexDirection: \"row\",\r\n                                alignItems: \"center\",\r\n                                justifyContent: \"center\",\r\n                                gap: 8,\r\n                                opacity: pressed || saving ? 0.7 : 1,\r\n                                elevation: 3\r\n                            })}\r\n                        >\r\n                            {saving ? (\r\n                                <ActivityIndicator size=\"small\" color=\"#fff\" />\r\n                            ) : (\r\n                                <>\r\n                                    <MaterialIcons name=\"save\" size={24} color=\"#fff\" />\r\n                                    <Text style={{ fontSize: 17, fontFamily: \"DMSans-Bold\", color: \"#fff\" }}>\r\n                                        Save Attendance\r\n                                    </Text>\r\n                                </>\r\n                            )}\r\n                        </Pressable>\r\n                    )}\r\n                </View>\r\n            </ScrollView>\r\n        </View>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\teacher\\class\\performance.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Pressable' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":14},{"ruleId":"no-unused-vars","severity":1,"message":"'BarChart' is defined but never used. Allowed unused vars must match /^_/u.","line":17,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":29},{"ruleId":"no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":31,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":31,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'opacity' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":162,"column":45,"nodeType":"Identifier","messageId":"unusedVar","endLine":162,"endColumn":52},{"ruleId":"no-unused-vars","severity":1,"message":"'opacity' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":163,"column":50,"nodeType":"Identifier","messageId":"unusedVar","endLine":163,"endColumn":57}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    RefreshControl,\r\n    ActivityIndicator,\r\n    Pressable,\r\n    Dimensions,\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport { useRouter, useLocalSearchParams } from \"expo-router\";\r\nimport { useTheme } from \"../../../theme\";\r\nimport { useApiQuery } from \"../../../hooks/useApi\";\r\nimport AppHeader from \"../../../components/Header\";\r\nimport apiConfig from \"../../../config/apiConfig\";\r\nimport { LineChart, BarChart } from \"react-native-chart-kit\";\r\n\r\nconst { width } = Dimensions.get('window');\r\n\r\nconst EXAM_COLORS = {\r\n    'FA1': '#4CAF50',\r\n    'FA2': '#2196F3',\r\n    'SA1': '#FF9800',\r\n    'FA3': '#9C27B0',\r\n    'FA4': '#E91E63',\r\n    'SA2': '#F44336'\r\n};\r\n\r\nexport default function ClassPerformanceScreen() {\r\n    const router = useRouter();\r\n    const params = useLocalSearchParams();\r\n    const { colors } = useTheme();\r\n    const { classId } = params;\r\n\r\n    const [refreshing, setRefreshing] = useState(false);\r\n\r\n    // Fetch class performance data\r\n    const { data: performanceData, isLoading, refetch } = useApiQuery(\r\n        ['classPerformance', classId],\r\n        `${apiConfig.baseUrl}/exams/performance/class/${classId}`,\r\n        { enabled: !!classId }\r\n    );\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        await refetch();\r\n        setRefreshing(false);\r\n    };\r\n\r\n    const getGradeColor = (percentage) => {\r\n        if (percentage >= 90) return colors.success;\r\n        if (percentage >= 75) return '#2196F3';\r\n        if (percentage >= 60) return '#FF9800';\r\n        if (percentage >= 40) return '#FF5722';\r\n        return colors.error;\r\n    };\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <View style={{ flex: 1, backgroundColor: colors.background, justifyContent: 'center', alignItems: 'center' }}>\r\n                <ActivityIndicator size=\"large\" color={colors.primary} />\r\n            </View>\r\n        );\r\n    }\r\n\r\n    if (!performanceData) {\r\n        return (\r\n            <View style={{ flex: 1, backgroundColor: colors.background, justifyContent: 'center', alignItems: 'center', padding: 20 }}>\r\n                <MaterialIcons name=\"info-outline\" size={64} color={colors.textSecondary} />\r\n                <Text style={{ color: colors.textSecondary, marginTop: 16, fontSize: 16, textAlign: 'center' }}>\r\n                    No performance data available\r\n                </Text>\r\n            </View>\r\n        );\r\n    }\r\n\r\n    const { performance = [], totalStudents = 0 } = performanceData;\r\n\r\n    // Prepare chart data\r\n    const completedExams = performance.filter(p => p.avgPercentage > 0);\r\n    const chartLabels = completedExams.map(p => p.examType);\r\n    const chartData = completedExams.map(p => p.avgPercentage);\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <ScrollView\r\n                refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} />}\r\n                contentContainerStyle={{ paddingBottom: 100 }}\r\n            >\r\n                <View style={{ padding: 16, paddingTop: 24 }}>\r\n                    <AppHeader\r\n                        title=\"Class Performance\"\r\n                        subtitle={`Exam-wise analytics for ${totalStudents} students`}\r\n                        showBack\r\n                    />\r\n\r\n                    {/* Overall Stats */}\r\n                    <View style={{\r\n                        backgroundColor: colors.cardBackground,\r\n                        borderRadius: 16,\r\n                        padding: 20,\r\n                        marginTop: 20,\r\n                        elevation: 2\r\n                    }}>\r\n                        <Text style={{ fontSize: 16, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginBottom: 16 }}>\r\n                            Overall Statistics\r\n                        </Text>\r\n                        <View style={{ flexDirection: \"row\", justifyContent: \"space-around\" }}>\r\n                            <View style={{ alignItems: \"center\" }}>\r\n                                <Text style={{ fontSize: 32, fontFamily: \"DMSans-Bold\", color: colors.primary }}>\r\n                                    {totalStudents}\r\n                                </Text>\r\n                                <Text style={{ fontSize: 12, color: colors.textSecondary, fontFamily: \"DMSans-Regular\" }}>\r\n                                    Students\r\n                                </Text>\r\n                            </View>\r\n                            <View style={{ alignItems: \"center\" }}>\r\n                                <Text style={{ fontSize: 32, fontFamily: \"DMSans-Bold\", color: colors.success }}>\r\n                                    {performance.filter(p => p.isComplete).length}\r\n                                </Text>\r\n                                <Text style={{ fontSize: 12, color: colors.textSecondary, fontFamily: \"DMSans-Regular\" }}>\r\n                                    Completed\r\n                                </Text>\r\n                            </View>\r\n                            <View style={{ alignItems: \"center\" }}>\r\n                                <Text style={{ fontSize: 32, fontFamily: \"DMSans-Bold\", color: colors.textSecondary }}>\r\n                                    {6 - performance.filter(p => p.isComplete).length}\r\n                                </Text>\r\n                                <Text style={{ fontSize: 12, color: colors.textSecondary, fontFamily: \"DMSans-Regular\" }}>\r\n                                    Pending\r\n                                </Text>\r\n                            </View>\r\n                        </View>\r\n                    </View>\r\n\r\n                    {/* Performance Trend Chart */}\r\n                    {completedExams.length > 0 && (\r\n                        <View style={{\r\n                            backgroundColor: colors.cardBackground,\r\n                            borderRadius: 16,\r\n                            padding: 16,\r\n                            marginTop: 20,\r\n                            elevation: 2\r\n                        }}>\r\n                            <Text style={{ fontSize: 16, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginBottom: 16 }}>\r\n                                Performance Trend\r\n                            </Text>\r\n                            <LineChart\r\n                                data={{\r\n                                    labels: chartLabels,\r\n                                    datasets: [{ data: chartData }]\r\n                                }}\r\n                                width={width - 64}\r\n                                height={220}\r\n                                yAxisSuffix=\"%\"\r\n                                chartConfig={{\r\n                                    backgroundColor: colors.cardBackground,\r\n                                    backgroundGradientFrom: colors.cardBackground,\r\n                                    backgroundGradientTo: colors.cardBackground,\r\n                                    decimalPlaces: 0,\r\n                                    color: (opacity = 1) => colors.primary,\r\n                                    labelColor: (opacity = 1) => colors.textSecondary,\r\n                                    style: { borderRadius: 16 },\r\n                                    propsForDots: {\r\n                                        r: \"6\",\r\n                                        strokeWidth: \"2\",\r\n                                        stroke: colors.primary\r\n                                    }\r\n                                }}\r\n                                bezier\r\n                                style={{ marginVertical: 8, borderRadius: 16 }}\r\n                            />\r\n                        </View>\r\n                    )}\r\n\r\n                    {/* Exam-wise Cards */}\r\n                    <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginTop: 24, marginBottom: 12 }}>\r\n                        Exam-wise Breakdown\r\n                    </Text>\r\n\r\n                    {performance.map((exam) => (\r\n                        <View\r\n                            key={exam.examType}\r\n                            style={{\r\n                                backgroundColor: colors.cardBackground,\r\n                                borderRadius: 16,\r\n                                padding: 18,\r\n                                marginBottom: 12,\r\n                                borderLeftWidth: 4,\r\n                                borderLeftColor: EXAM_COLORS[exam.examType],\r\n                                elevation: 2\r\n                            }}\r\n                        >\r\n                            <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\", marginBottom: 12 }}>\r\n                                <View>\r\n                                    <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>\r\n                                        {exam.examType}\r\n                                    </Text>\r\n                                    <Text style={{ fontSize: 12, color: colors.textSecondary, fontFamily: \"DMSans-Regular\", marginTop: 2 }}>\r\n                                        {exam.subjectsCount} subject{exam.subjectsCount !== 1 ? 's' : ''}\r\n                                    </Text>\r\n                                </View>\r\n                                {exam.isComplete ? (\r\n                                    <View style={{\r\n                                        backgroundColor: colors.success + '20',\r\n                                        paddingHorizontal: 12,\r\n                                        paddingVertical: 6,\r\n                                        borderRadius: 8\r\n                                    }}>\r\n                                        <Text style={{ color: colors.success, fontFamily: \"DMSans-Bold\", fontSize: 11 }}>\r\n                                            COMPLETE\r\n                                        </Text>\r\n                                    </View>\r\n                                ) : (\r\n                                    <View style={{\r\n                                        backgroundColor: colors.textSecondary + '20',\r\n                                        paddingHorizontal: 12,\r\n                                        paddingVertical: 6,\r\n                                        borderRadius: 8\r\n                                    }}>\r\n                                        <Text style={{ color: colors.textSecondary, fontFamily: \"DMSans-Bold\", fontSize: 11 }}>\r\n                                            {exam.studentsWithMarks}/{totalStudents}\r\n                                        </Text>\r\n                                    </View>\r\n                                )}\r\n                            </View>\r\n\r\n                            <View style={{ height: 1, backgroundColor: colors.textSecondary + '20', marginVertical: 12 }} />\r\n\r\n                            <View style={{ flexDirection: \"row\", justifyContent: \"space-between\" }}>\r\n                                <View style={{ flex: 1 }}>\r\n                                    <Text style={{ fontSize: 12, color: colors.textSecondary, fontFamily: \"DMSans-Regular\" }}>\r\n                                        Class Average\r\n                                    </Text>\r\n                                    <Text style={{\r\n                                        fontSize: 24,\r\n                                        fontFamily: \"DMSans-Bold\",\r\n                                        color: getGradeColor(exam.avgPercentage)\r\n                                    }}>\r\n                                        {exam.avgPercentage.toFixed(1)}%\r\n                                    </Text>\r\n                                </View>\r\n                                <View style={{ flex: 1, alignItems: \"center\" }}>\r\n                                    <Text style={{ fontSize: 12, color: colors.textSecondary, fontFamily: \"DMSans-Regular\" }}>\r\n                                        Highest\r\n                                    </Text>\r\n                                    <Text style={{ fontSize: 20, fontFamily: \"DMSans-Bold\", color: colors.success }}>\r\n                                        {exam.highest.toFixed(1)}%\r\n                                    </Text>\r\n                                </View>\r\n                                <View style={{ flex: 1, alignItems: \"flex-end\" }}>\r\n                                    <Text style={{ fontSize: 12, color: colors.textSecondary, fontFamily: \"DMSans-Regular\" }}>\r\n                                        Lowest\r\n                                    </Text>\r\n                                    <Text style={{ fontSize: 20, fontFamily: \"DMSans-Bold\", color: colors.error }}>\r\n                                        {exam.lowest.toFixed(1)}%\r\n                                    </Text>\r\n                                </View>\r\n                            </View>\r\n                        </View>\r\n                    ))}\r\n\r\n                    {performance.length === 0 && (\r\n                        <View style={{ alignItems: \"center\", marginTop: 40, opacity: 0.6 }}>\r\n                            <MaterialIcons name=\"assessment\" size={64} color={colors.textSecondary} />\r\n                            <Text style={{ color: colors.textSecondary, marginTop: 16, fontSize: 16, textAlign: 'center' }}>\r\n                                No exam data available yet.{'\\n'}Initialize exams to see performance.\r\n                            </Text>\r\n                        </View>\r\n                    )}\r\n                </View>\r\n            </ScrollView>\r\n        </View>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\teacher\\class\\subject\\[subjectId].jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Alert' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":10},{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":26,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":31,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":31,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'formatDate' is not defined.","line":207,"column":50,"nodeType":"Identifier","messageId":"undef","endLine":207,"endColumn":60}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    Pressable,\r\n    RefreshControl,\r\n    ActivityIndicator,\r\n    Alert,\r\n} from \"react-native\";\r\nimport { useLocalSearchParams, useRouter } from \"expo-router\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useTheme } from \"../../../../theme\";\r\nimport { useApiQuery, useApiMutation, createApiMutationFn } from \"../../../../hooks/useApi\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport PostContentModal from \"../../../../components/PostContentModal\";\r\nimport apiConfig from \"../../../../config/apiConfig\";\r\nimport { useToast } from \"../../../../components/ToastProvider\";\r\nimport AppHeader from \"../../../../components/Header\";\r\n\r\nexport default function SubjectDetailScreen() {\r\n    const { id, subjectId } = useLocalSearchParams(); // classId and subjectId\r\n    const router = useRouter();\r\n    const queryClient = useQueryClient();\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n\r\n    const [refreshing, setRefreshing] = useState(false);\r\n    const [showPostModal, setShowPostModal] = useState(false);\r\n    const [user, setUser] = useState(null);\r\n\r\n    useEffect(() => {\r\n        loadUserData();\r\n    }, []);\r\n\r\n    const loadUserData = async () => {\r\n        try {\r\n            const storedUser = await AsyncStorage.getItem(\"@auth_user\");\r\n            if (storedUser) setUser(JSON.parse(storedUser));\r\n        } catch (error) {\r\n            console.error(\"Failed to load user:\", error);\r\n        }\r\n    };\r\n\r\n    // Fetch Subject Details\r\n    const { data: subjects } = useApiQuery(\r\n        ['classSubjects', id],\r\n        `${apiConfig.baseUrl}/classes/${id}/subjects`,\r\n        { enabled: !!id }\r\n    );\r\n\r\n    const currentSubject = subjects?.find(s => s._id === subjectId);\r\n    const subjectName = currentSubject?.name || \"\";\r\n    const subjectTeachers = currentSubject?.teachers || [];\r\n\r\n    // Fetch Content\r\n    const { data: contentData, isLoading: loading, refetch } = useApiQuery(\r\n        ['subjectContent', subjectId],\r\n        `${apiConfig.baseUrl}/classes/${id}/subjects/${subjectId}/content`,\r\n        { enabled: !!subjectId && !!id }\r\n    );\r\n    const content = contentData || [];\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        await refetch();\r\n        setRefreshing(false);\r\n    };\r\n\r\n    const postContentMutation = useApiMutation({\r\n        mutationFn: createApiMutationFn(`${apiConfig.baseUrl}/classes/${id}/content`, 'POST'),\r\n        onSuccess: () => {\r\n            showToast(\"Content posted successfully\", \"success\");\r\n            setShowPostModal(false);\r\n            queryClient.invalidateQueries({ queryKey: ['subjectContent', subjectId] });\r\n        },\r\n        onError: (error) => showToast(error.message || \"Failed to post content\", \"error\")\r\n    });\r\n\r\n    const handlePostContent = (data) => {\r\n        // Add subjectId to the data\r\n        const payload = { ...data, subject: subjectId };\r\n        postContentMutation.mutate(payload);\r\n    };\r\n\r\n    const getContentTypeColor = (type) => {\r\n        switch (type) {\r\n            case \"homework\": return colors.error;\r\n            case \"news\": return colors.primary;\r\n            default: return colors.secondary;\r\n        }\r\n    };\r\n\r\n    const getContentTypeIcon = (type) => {\r\n        switch (type) {\r\n            case \"homework\": return \"assignment\";\r\n            case \"news\": return \"campaign\";\r\n            default: return \"note\";\r\n        }\r\n    };\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <ScrollView\r\n                refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} />}\r\n                contentContainerStyle={{ paddingBottom: 100 }}\r\n            >\r\n                <View style={{ padding: 16, paddingTop: 24 }}>\r\n                    <AppHeader\r\n                        title={subjectName || \"Subject Details\"}\r\n                        subtitle={subjectTeachers.length > 0 ? `Teachers: ${subjectTeachers.map(t => t.name).join(\", \")}` : \"Class Content\"}\r\n                        showBack\r\n                    />\r\n\r\n                    {/* Quick Actions */}\r\n                    <View style={{ flexDirection: \"row\", gap: 12, marginTop: 20 }}>\r\n                        <Pressable\r\n                            onPress={() => router.push({\r\n                                pathname: \"/teacher/subject/create-exam\",\r\n                                params: { subjectId, classId: id }\r\n                            })}\r\n                            style={({ pressed }) => ({\r\n                                flex: 1,\r\n                                backgroundColor: colors.primary,\r\n                                borderRadius: 12,\r\n                                padding: 16,\r\n                                flexDirection: \"row\",\r\n                                alignItems: \"center\",\r\n                                justifyContent: \"center\",\r\n                                gap: 8,\r\n                                opacity: pressed ? 0.9 : 1,\r\n                                elevation: 3\r\n                            })}\r\n                        >\r\n                            <MaterialIcons name=\"assignment\" size={20} color=\"#fff\" />\r\n                            <Text style={{ fontSize: 14, fontFamily: \"DMSans-Bold\", color: \"#fff\" }}>\r\n                                Manage Exams\r\n                            </Text>\r\n                        </Pressable>\r\n                        <Pressable\r\n                            onPress={() => router.push({\r\n                                pathname: \"/teacher/subject/performance\",\r\n                                params: { subjectId }\r\n                            })}\r\n                            style={({ pressed }) => ({\r\n                                flex: 1,\r\n                                backgroundColor: colors.success,\r\n                                borderRadius: 12,\r\n                                padding: 16,\r\n                                flexDirection: \"row\",\r\n                                alignItems: \"center\",\r\n                                justifyContent: \"center\",\r\n                                gap: 8,\r\n                                opacity: pressed ? 0.9 : 1,\r\n                                elevation: 3\r\n                            })}\r\n                        >\r\n                            <MaterialIcons name=\"leaderboard\" size={20} color=\"#fff\" />\r\n                            <Text style={{ fontSize: 14, fontFamily: \"DMSans-Bold\", color: \"#fff\" }}>\r\n                                Performance\r\n                            </Text>\r\n                        </Pressable>\r\n                    </View>\r\n\r\n                    {loading ? (\r\n                        <View style={{ marginTop: 100, alignItems: \"center\" }}>\r\n                            <ActivityIndicator size=\"large\" color={colors.primary} />\r\n                        </View>\r\n                    ) : (\r\n                        <View style={{ marginTop: 24 }}>\r\n                            {content.length === 0 ? (\r\n                                <View style={{ alignItems: \"center\", marginTop: 40, opacity: 0.6 }}>\r\n                                    <MaterialIcons name=\"article\" size={48} color={colors.textSecondary} />\r\n                                    <Text style={{ color: colors.textSecondary, marginTop: 16, fontSize: 16 }}>\r\n                                        No content posted yet.\r\n                                    </Text>\r\n                                </View>\r\n                            ) : (\r\n                                content.map((item) => (\r\n                                    <View\r\n                                        key={item._id}\r\n                                        style={{\r\n                                            backgroundColor: colors.cardBackground,\r\n                                            borderRadius: 16,\r\n                                            padding: 16,\r\n                                            marginBottom: 12,\r\n                                            borderLeftWidth: 4,\r\n                                            borderLeftColor: getContentTypeColor(item.type),\r\n                                            shadowColor: \"#000\",\r\n                                            shadowOffset: { width: 0, height: 1 },\r\n                                            shadowOpacity: 0.05,\r\n                                            shadowRadius: 4,\r\n                                            elevation: 1,\r\n                                        }}\r\n                                    >\r\n                                        <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"flex-start\", marginBottom: 8 }}>\r\n                                            <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 8 }}>\r\n                                                <View style={{ backgroundColor: getContentTypeColor(item.type) + \"20\", padding: 6, borderRadius: 8 }}>\r\n                                                    <MaterialIcons name={getContentTypeIcon(item.type)} size={20} color={getContentTypeColor(item.type)} />\r\n                                                </View>\r\n                                                <Text style={{ fontSize: 16, fontWeight: \"700\", color: colors.textPrimary }}>\r\n                                                    {item.title}\r\n                                                </Text>\r\n                                            </View>\r\n                                            <Text style={{ fontSize: 12, color: colors.textSecondary }}>\r\n                                                {formatDate(item.createdAt)}\r\n                                            </Text>\r\n                                        </View>\r\n\r\n                                        <Text style={{ fontSize: 14, color: colors.textSecondary, lineHeight: 20 }}>\r\n                                            {item.description}\r\n                                        </Text>\r\n\r\n                                        <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", marginTop: 12, alignItems: \"center\" }}>\r\n                                            <Text style={{ fontSize: 12, color: colors.textSecondary, fontWeight: \"500\" }}>\r\n                                                By: {item.author?.name || item.teacher?.name || \"Teacher\"}\r\n                                            </Text>\r\n                                            <View style={{ backgroundColor: colors.background, paddingHorizontal: 8, paddingVertical: 4, borderRadius: 4 }}>\r\n                                                <Text style={{ fontSize: 10, fontWeight: \"600\", color: colors.textSecondary, textTransform: \"uppercase\" }}>\r\n                                                    {item.type}\r\n                                                </Text>\r\n                                            </View>\r\n                                        </View>\r\n                                    </View>\r\n                                ))\r\n                            )}\r\n                        </View>\r\n                    )}\r\n                </View>\r\n            </ScrollView>\r\n\r\n            {/* FAB to Post Content */}\r\n            <Pressable\r\n                onPress={() => setShowPostModal(true)}\r\n                style={({ pressed }) => ({\r\n                    position: \"absolute\",\r\n                    bottom: 110,\r\n                    right: 24,\r\n                    backgroundColor: colors.primary,\r\n                    width: 56,\r\n                    height: 56,\r\n                    borderRadius: 28,\r\n                    justifyContent: \"center\",\r\n                    alignItems: \"center\",\r\n                    elevation: 4,\r\n                    zIndex: 9999,\r\n                    shadowColor: \"#000\",\r\n                    shadowOffset: { width: 0, height: 2 },\r\n                    shadowOpacity: 0.25,\r\n                    shadowRadius: 3.84,\r\n                    opacity: pressed ? 0.9 : 1,\r\n                })}\r\n            >\r\n                <MaterialIcons name=\"add\" size={28} color=\"#fff\" />\r\n            </Pressable>\r\n\r\n            <PostContentModal\r\n                visible={showPostModal}\r\n                onClose={() => setShowPostModal(false)}\r\n                onSubmit={handlePostContent}\r\n            />\r\n        </View>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\teacher\\classes.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'showToast' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":24,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":22},{"ruleId":"no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":25,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'setRefreshing' is not defined.","line":52,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":52,"endColumn":22},{"ruleId":"no-undef","severity":2,"message":"'setRefreshing' is not defined.","line":54,"column":9,"nodeType":"Identifier","messageId":"undef","endLine":54,"endColumn":22},{"ruleId":"no-undef","severity":2,"message":"'refreshing' is not defined.","line":60,"column":61,"nodeType":"Identifier","messageId":"undef","endLine":60,"endColumn":71}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    Pressable,\r\n    RefreshControl,\r\n    ActivityIndicator,\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useRouter, useLocalSearchParams } from \"expo-router\";\r\nimport { useTheme } from \"../../theme\";\r\nimport apiConfig from \"../../config/apiConfig\";\r\nimport { useApiQuery } from \"../../hooks/useApi\";\r\nimport { useToast } from \"../../components/ToastProvider\";\r\nimport AppHeader from \"../../components/Header\";\r\n\r\nexport default function TeacherClassesScreen() {\r\n    const router = useRouter();\r\n    const params = useLocalSearchParams();\r\n    const { action } = params;\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n    const [user, setUser] = useState(null);\r\n\r\n    useEffect(() => {\r\n        const loadUser = async () => {\r\n            const storedUser = await AsyncStorage.getItem(\"@auth_user\");\r\n            if (!storedUser) {\r\n                router.replace(\"/login\");\r\n                return;\r\n            }\r\n            try {\r\n                setUser(JSON.parse(storedUser));\r\n            } catch (e) {\r\n                console.error(\"Failed to parse stored user:\", e);\r\n                await AsyncStorage.removeItem(\"@auth_user\");\r\n                router.replace(\"/login\");\r\n            }\r\n        };\r\n        loadUser();\r\n    }, []);\r\n\r\n    const { data: classesData, isLoading: loading, refetch } = useApiQuery(\r\n        ['teacherClasses'],\r\n        `${apiConfig.baseUrl}/classes/my-classes`\r\n    );\r\n    const classes = classesData || [];\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        await refetch();\r\n        setRefreshing(false);\r\n    };\r\n\r\n    return (\r\n        <View style={styles.container}>\r\n            <ScrollView\r\n                refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} tintColor={colors.primary} />}\r\n                contentContainerStyle={{ paddingBottom: 100, minHeight: \"100%\" }}\r\n                showsVerticalScrollIndicator={false}\r\n            >\r\n                <View style={{ paddingHorizontal: 20, paddingTop: 20 }}>\r\n                    <AppHeader title=\"My Classes\" subtitle=\"Manage your assigned classes\" />\r\n\r\n                    {loading ? (\r\n                        <View style={{ flex: 1, justifyContent: \"center\", alignItems: \"center\", marginTop: 100 }}>\r\n                            <ActivityIndicator size=\"large\" color={colors.primary} />\r\n                        </View>\r\n                    ) : (\r\n                        <View style={{ gap: 24 }}>\r\n                            <View>\r\n                                <Text style={styles.sectionTitle}>\r\n                                    My Classes\r\n                                </Text>\r\n                                {classes.length === 0 ? (\r\n                                    <View style={{ alignItems: \"center\", marginTop: 40, opacity: 0.6 }}>\r\n                                        <MaterialIcons name=\"class\" size={48} color={colors.textSecondary} />\r\n                                        <Text style={{ color: colors.textSecondary, marginTop: 16, fontSize: 16, fontFamily: \"DMSans-Medium\" }}>\r\n                                            No classes assigned to you yet.\r\n                                        </Text>\r\n                                    </View>\r\n                                ) : (\r\n                                    <View style={{ gap: 12 }}>\r\n                                        {classes.map((cls) => (\r\n                                            <Pressable\r\n                                                key={cls._id}\r\n                                                onPress={() => {\r\n                                                    if (action === 'attendance') {\r\n                                                        router.push({\r\n                                                            pathname: \"/teacher/class/attendance\",\r\n                                                            params: { classId: cls._id }\r\n                                                        });\r\n                                                    } else {\r\n                                                        router.push(`/teacher/class/${cls._id}`);\r\n                                                    }\r\n                                                }}\r\n                                                style={({ pressed }) => [\r\n                                                    styles.cardMinimal,\r\n                                                    {\r\n                                                        flexDirection: \"row\",\r\n                                                        justifyContent: \"space-between\",\r\n                                                        alignItems: \"center\",\r\n                                                        padding: 20,\r\n                                                        opacity: pressed ? 0.9 : 1,\r\n                                                    }\r\n                                                ]}\r\n                                            >\r\n                                                <View>\r\n                                                    <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>\r\n                                                        {cls.name} {cls.section ? `- ${cls.section}` : \"\"}\r\n                                                    </Text>\r\n                                                    <Text style={{ fontSize: 14, color: colors.textSecondary, marginTop: 4, fontFamily: \"DMSans-Regular\" }}>\r\n                                                        {cls.academicYear?.name}  {cls.branch}\r\n                                                    </Text>\r\n                                                    <View style={{\r\n                                                        backgroundColor: colors.primary + \"15\",\r\n                                                        alignSelf: \"flex-start\",\r\n                                                        paddingHorizontal: 10,\r\n                                                        paddingVertical: 4,\r\n                                                        borderRadius: 8,\r\n                                                        marginTop: 10\r\n                                                    }}>\r\n                                                        <Text style={{ color: colors.primary, fontSize: 11, fontFamily: \"DMSans-Bold\" }}>CLASS TEACHER</Text>\r\n                                                    </View>\r\n                                                </View>\r\n                                                <MaterialIcons name=\"chevron-right\" size={24} color={colors.textSecondary} />\r\n                                            </Pressable>\r\n                                        ))}\r\n                                    </View>\r\n                                )}\r\n                            </View>\r\n                        </View>\r\n                    )}\r\n                </View>\r\n            </ScrollView>\r\n        </View>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\teacher\\dashboard.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":21,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'showToast' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":22,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":22},{"ruleId":"no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":25,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":16},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":90,"column":31,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[3236,3333],"text":"\r\n                        Check &quot;My Subjects\" tab to see subjects you teach\r\n                    "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[3236,3333],"text":"\r\n                        Check &ldquo;My Subjects\" tab to see subjects you teach\r\n                    "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[3236,3333],"text":"\r\n                        Check &#34;My Subjects\" tab to see subjects you teach\r\n                    "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[3236,3333],"text":"\r\n                        Check &rdquo;My Subjects\" tab to see subjects you teach\r\n                    "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":90,"column":43,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[3236,3333],"text":"\r\n                        Check \"My Subjects&quot; tab to see subjects you teach\r\n                    "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[3236,3333],"text":"\r\n                        Check \"My Subjects&ldquo; tab to see subjects you teach\r\n                    "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[3236,3333],"text":"\r\n                        Check \"My Subjects&#34; tab to see subjects you teach\r\n                    "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[3236,3333],"text":"\r\n                        Check \"My Subjects&rdquo; tab to see subjects you teach\r\n                    "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":198,"column":31,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[8668,8765],"text":"\r\n                        Check &quot;My Subjects\" tab to see subjects you teach\r\n                    "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[8668,8765],"text":"\r\n                        Check &ldquo;My Subjects\" tab to see subjects you teach\r\n                    "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[8668,8765],"text":"\r\n                        Check &#34;My Subjects\" tab to see subjects you teach\r\n                    "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[8668,8765],"text":"\r\n                        Check &rdquo;My Subjects\" tab to see subjects you teach\r\n                    "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":198,"column":43,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[8668,8765],"text":"\r\n                        Check \"My Subjects&quot; tab to see subjects you teach\r\n                    "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[8668,8765],"text":"\r\n                        Check \"My Subjects&ldquo; tab to see subjects you teach\r\n                    "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[8668,8765],"text":"\r\n                        Check \"My Subjects&#34; tab to see subjects you teach\r\n                    "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[8668,8765],"text":"\r\n                        Check \"My Subjects&rdquo; tab to see subjects you teach\r\n                    "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    Pressable,\r\n    RefreshControl,\r\n    ActivityIndicator,\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useRouter } from \"expo-router\";\r\nimport { useTheme } from \"../../theme\";\r\nimport apiConfig from \"../../config/apiConfig\";\r\nimport { useApiQuery } from \"../../hooks/useApi\";\r\nimport { useToast } from \"../../components/ToastProvider\";\r\nimport AppHeader from \"../../components/Header\";\r\n\r\nexport default function TeacherDashboard() {\r\n    const router = useRouter();\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n\r\n    const [refreshing, setRefreshing] = useState(false);\r\n    const [user, setUser] = useState(null);\r\n    const [activeTab, setActiveTab] = useState('classTeacher'); // 'classTeacher' or 'mySubjects'\r\n\r\n    useEffect(() => {\r\n        const loadUser = async () => {\r\n            const storedUser = await AsyncStorage.getItem(\"@auth_user\");\r\n            if (!storedUser) {\r\n                router.replace(\"/login\");\r\n                return;\r\n            }\r\n            try {\r\n                setUser(JSON.parse(storedUser));\r\n            } catch (e) {\r\n                console.error(\"Failed to parse stored user:\", e);\r\n                await AsyncStorage.removeItem(\"@auth_user\");\r\n                router.replace(\"/login\");\r\n            }\r\n        };\r\n        loadUser();\r\n    }, []);\r\n\r\n    const { data: dashboardData, isLoading: loading, refetch } = useApiQuery(\r\n        ['teacherDashboard'],\r\n        `${apiConfig.baseUrl}/teachers/my-classes-and-subjects`\r\n    );\r\n\r\n    const asClassTeacher = dashboardData?.asClassTeacher || [];\r\n    const allMySubjects = dashboardData?.allMySubjects || [];\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        await refetch();\r\n        setRefreshing(false);\r\n    };\r\n\r\n    // Group subjects by subject name for display\r\n    const groupedSubjects = allMySubjects.reduce((acc, subj) => {\r\n        if (!acc[subj.name]) {\r\n            acc[subj.name] = [];\r\n        }\r\n        acc[subj.name].push(subj);\r\n        return acc;\r\n    }, {});\r\n\r\n    const renderClassTeacherTab = () => (\r\n        <View>\r\n            {asClassTeacher.length === 0 ? (\r\n                <View style={{ alignItems: \"center\", marginTop: 60, opacity: 0.6 }}>\r\n                    <MaterialIcons name=\"class\" size={56} color={colors.textSecondary} />\r\n                    <Text style={{\r\n                        color: colors.textSecondary,\r\n                        marginTop: 20,\r\n                        fontSize: 16,\r\n                        fontFamily: \"DMSans-Medium\"\r\n                    }}>\r\n                        You are not a class teacher of any class\r\n                    </Text>\r\n                    <Text style={{\r\n                        color: colors.textSecondary,\r\n                        marginTop: 8,\r\n                        fontSize: 13,\r\n                        fontFamily: \"DMSans-Regular\",\r\n                        textAlign: \"center\",\r\n                        paddingHorizontal: 40\r\n                    }}>\r\n                        Check \"My Subjects\" tab to see subjects you teach\r\n                    </Text>\r\n                </View>\r\n            ) : (\r\n                asClassTeacher.map((cls) => (\r\n                    <Pressable\r\n                        key={cls._id}\r\n                        onPress={() => router.push(`/teacher/class/${cls._id}`)}\r\n                        style={({ pressed }) => ({\r\n                            backgroundColor: colors.cardBackground,\r\n                            borderRadius: 16,\r\n                            padding: 18,\r\n                            marginBottom: 12,\r\n                            flexDirection: \"row\",\r\n                            justifyContent: \"space-between\",\r\n                            alignItems: \"center\",\r\n                            opacity: pressed ? 0.9 : 1,\r\n                            shadowColor: \"#000\",\r\n                            shadowOffset: { width: 0, height: 2 },\r\n                            shadowOpacity: 0.06,\r\n                            shadowRadius: 6,\r\n                            elevation: 2,\r\n                        })}\r\n                    >\r\n                        <View style={{ flex: 1 }}>\r\n                            <View style={{ flexDirection: \"row\", alignItems: \"center\", marginBottom: 6 }}>\r\n                                <Text style={{\r\n                                    fontSize: 18,\r\n                                    fontFamily: \"DMSans-Bold\",\r\n                                    color: colors.textPrimary\r\n                                }}>\r\n                                    {cls.name} {cls.section ? `- ${cls.section}` : \"\"}\r\n                                </Text>\r\n                            </View>\r\n\r\n                            <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 12, marginTop: 4 }}>\r\n                                <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 4 }}>\r\n                                    <MaterialIcons name=\"people\" size={16} color={colors.textSecondary} />\r\n                                    <Text style={{\r\n                                        fontSize: 13,\r\n                                        color: colors.textSecondary,\r\n                                        fontFamily: \"DMSans-Medium\"\r\n                                    }}>\r\n                                        {cls.studentCount} students\r\n                                    </Text>\r\n                                </View>\r\n\r\n                                {cls.mySubjects && cls.mySubjects.length > 0 && (\r\n                                    <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 4 }}>\r\n                                        <MaterialIcons name=\"book\" size={16} color={colors.textSecondary} />\r\n                                        <Text style={{\r\n                                            fontSize: 13,\r\n                                            color: colors.textSecondary,\r\n                                            fontFamily: \"DMSans-Medium\"\r\n                                        }}>\r\n                                            Teaching: {cls.mySubjects.join(\", \")}\r\n                                        </Text>\r\n                                    </View>\r\n                                )}\r\n                            </View>\r\n\r\n                            <View style={{\r\n                                backgroundColor: colors.primary + \"15\",\r\n                                alignSelf: \"flex-start\",\r\n                                paddingHorizontal: 10,\r\n                                paddingVertical: 3,\r\n                                borderRadius: 6,\r\n                                marginTop: 10\r\n                            }}>\r\n                                <Text style={{\r\n                                    color: colors.primary,\r\n                                    fontSize: 11,\r\n                                    fontFamily: \"DMSans-Bold\",\r\n                                    textTransform: \"uppercase\"\r\n                                }}>\r\n                                    CLASS TEACHER\r\n                                </Text>\r\n                            </View>\r\n                        </View>\r\n\r\n                        <MaterialIcons name=\"chevron-right\" size={24} color={colors.textSecondary} />\r\n                    </Pressable>\r\n                ))\r\n            )}\r\n        </View>\r\n    );\r\n\r\n    const renderMySubjectsTab = () => (\r\n        <View>\r\n            {Object.keys(groupedSubjects).length === 0 ? (\r\n                <View style={{ alignItems: \"center\", marginTop: 60, opacity: 0.6 }}>\r\n                    <MaterialIcons name=\"library-books\" size={56} color={colors.textSecondary} />\r\n                    <Text style={{\r\n                        color: colors.textSecondary,\r\n                        marginTop: 20,\r\n                        fontSize: 16,\r\n                        fontFamily: \"DMSans-Medium\"\r\n                    }}>\r\n                        No subjects assigned to you yet\r\n                    </Text>\r\n                    <Text style={{\r\n                        color: colors.textSecondary,\r\n                        marginTop: 8,\r\n                        fontSize: 13,\r\n                        fontFamily: \"DMSans-Regular\",\r\n                        textAlign: \"center\",\r\n                        paddingHorizontal: 40\r\n                    }}>\r\n                        Check \"My Subjects\" tab to see subjects you teach\r\n                    </Text>\r\n                </View>\r\n            ) : (\r\n                allMySubjects.map((subj) => (\r\n                    <Pressable\r\n                        key={subj._id}\r\n                        onPress={() => router.push({\r\n                            pathname: `/teacher/class/subject/${subj._id}`,\r\n                            params: { id: subj.class._id, subjectId: subj._id }\r\n                        })}\r\n                        style={({ pressed }) => ({\r\n                            backgroundColor: colors.cardBackground,\r\n                            borderRadius: 12,\r\n                            padding: 14,\r\n                            marginBottom: 8,\r\n                            marginLeft: 12,\r\n                            opacity: pressed ? 0.9 : 1,\r\n                            flexDirection: \"row\",\r\n                            justifyContent: \"space-between\",\r\n                            alignItems: \"center\",\r\n                            borderLeftWidth: 3,\r\n                            borderLeftColor: colors.primary\r\n                        })}\r\n                    >\r\n                        <View style={{ flex: 1 }}>\r\n                            <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 8 }}>\r\n                                <Text style={{\r\n                                    fontSize: 16,\r\n                                    fontFamily: \"DMSans-SemiBold\",\r\n                                    color: colors.textPrimary\r\n                                }}>\r\n                                    {subj.class.name} {subj.class.section ? `- ${subj.class.section}` : \"\"}\r\n                                </Text>\r\n                                {subj.isClassTeacher && (\r\n                                    <View style={{\r\n                                        backgroundColor: colors.success + \"20\",\r\n                                        paddingHorizontal: 6,\r\n                                        paddingVertical: 2,\r\n                                        borderRadius: 4\r\n                                    }}>\r\n                                        <Text style={{\r\n                                            fontSize: 10,\r\n                                            color: colors.success,\r\n                                            fontFamily: \"DMSans-Bold\"\r\n                                        }}>\r\n                                            MY CLASS\r\n                                        </Text>\r\n                                    </View>\r\n                                )}\r\n                            </View>\r\n                            {subj.class.branch && (\r\n                                <Text style={{\r\n                                    fontSize: 12,\r\n                                    color: colors.textSecondary,\r\n                                    fontFamily: \"DMSans-Regular\",\r\n                                    marginTop: 2\r\n                                }}>\r\n                                    {subj.class.branch}\r\n                                </Text>\r\n                            )}\r\n                        </View>\r\n                        <MaterialIcons name=\"chevron-right\" size={20} color={colors.textSecondary} />\r\n                    </Pressable>\r\n                ))\r\n            )}\r\n        </View>\r\n    );\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <ScrollView\r\n                refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} />}\r\n                contentContainerStyle={{ paddingBottom: 100 }}\r\n            >\r\n                <View style={{ padding: 16, paddingTop: 24 }}>\r\n                    <AppHeader title=\"My Teaching\" subtitle=\"Manage your classes and subjects\" />\r\n\r\n                    {/* Quick Action: History */}\r\n                    <Pressable\r\n                        onPress={() => router.push(\"/history\")}\r\n                        style={({ pressed }) => ({\r\n                            backgroundColor: colors.cardBackground,\r\n                            borderRadius: 16,\r\n                            padding: 16,\r\n                            marginBottom: 24,\r\n                            shadowColor: \"#000\",\r\n                            shadowOffset: { width: 0, height: 1 },\r\n                            shadowOpacity: 0.05,\r\n                            shadowRadius: 4,\r\n                            elevation: 1,\r\n                            opacity: pressed ? 0.9 : 1,\r\n                            flexDirection: \"row\",\r\n                            justifyContent: \"space-between\",\r\n                            alignItems: \"center\"\r\n                        })}\r\n                    >\r\n                        <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 12 }}>\r\n                            <View style={{ backgroundColor: \"#795548\" + \"20\", padding: 10, borderRadius: 10 }}>\r\n                                <MaterialIcons name=\"history\" size={24} color=\"#795548\" />\r\n                            </View>\r\n                            <View>\r\n                                <Text style={{ fontSize: 16, fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>\r\n                                    History\r\n                                </Text>\r\n                                <Text style={{ fontSize: 12, color: colors.textSecondary, marginTop: 2, fontFamily: \"DMSans-Regular\" }}>\r\n                                    View past exams\r\n                                </Text>\r\n                            </View>\r\n                        </View>\r\n                        <MaterialIcons name=\"chevron-right\" size={24} color={colors.textSecondary} />\r\n                    </Pressable>\r\n\r\n                    {loading ? (\r\n                        <View style={{ flex: 1, justifyContent: \"center\", alignItems: \"center\", marginTop: 100 }}>\r\n                            <ActivityIndicator size=\"large\" color={colors.primary} />\r\n                        </View>\r\n                    ) : (\r\n                        <>\r\n                            {/* Tab Switcher */}\r\n                            <View style={{\r\n                                flexDirection: \"row\",\r\n                                backgroundColor: colors.cardBackground,\r\n                                borderRadius: 12,\r\n                                padding: 4,\r\n                                marginBottom: 20\r\n                            }}>\r\n                                <Pressable\r\n                                    onPress={() => setActiveTab('classTeacher')}\r\n                                    style={{\r\n                                        flex: 1,\r\n                                        paddingVertical: 10,\r\n                                        borderRadius: 10,\r\n                                        backgroundColor: activeTab === 'classTeacher' ? colors.primary : 'transparent',\r\n                                        alignItems: \"center\"\r\n                                    }}\r\n                                >\r\n                                    <Text style={{\r\n                                        fontSize: 14,\r\n                                        fontFamily: \"DMSans-Bold\",\r\n                                        color: activeTab === 'classTeacher' ? '#fff' : colors.textSecondary\r\n                                    }}>\r\n                                        As Class Teacher\r\n                                    </Text>\r\n                                </Pressable>\r\n\r\n                                <Pressable\r\n                                    onPress={() => setActiveTab('mySubjects')}\r\n                                    style={{\r\n                                        flex: 1,\r\n                                        paddingVertical: 10,\r\n                                        borderRadius: 10,\r\n                                        backgroundColor: activeTab === 'mySubjects' ? colors.primary : 'transparent',\r\n                                        alignItems: \"center\"\r\n                                    }}\r\n                                >\r\n                                    <Text style={{\r\n                                        fontSize: 14,\r\n                                        fontFamily: \"DMSans-Bold\",\r\n                                        color: activeTab === 'mySubjects' ? '#fff' : colors.textSecondary\r\n                                    }}>\r\n                                        My Subjects\r\n                                    </Text>\r\n                                </Pressable>\r\n                            </View>\r\n\r\n                            {/* Tab Content */}\r\n                            {activeTab === 'classTeacher' ? renderClassTeacherTab() : renderMySubjectsTab()}\r\n                        </>\r\n                    )}\r\n                </View>\r\n            </ScrollView>\r\n        </View>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\teacher\\exam\\enter-marks.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'AsyncStorage' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":22,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":25,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'existingMarks' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":56,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":56,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    Pressable,\r\n    TextInput,\r\n    ActivityIndicator,\r\n    RefreshControl,\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useRouter, useLocalSearchParams } from \"expo-router\";\r\nimport { useTheme } from \"../../../theme\";\r\nimport apiConfig from \"../../../config/apiConfig\";\r\nimport { useApiQuery, useApiMutation, createApiMutationFn } from \"../../../hooks/useApi\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport { useToast } from \"../../../components/ToastProvider\";\r\nimport AppHeader from \"../../../components/Header\";\r\n\r\nexport default function EnterMarksScreen() {\r\n    const router = useRouter();\r\n    const params = useLocalSearchParams();\r\n    const queryClient = useQueryClient();\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n\r\n    const { examId } = params;\r\n\r\n    const [refreshing, setRefreshing] = useState(false);\r\n    const [marksData, setMarksData] = useState({});\r\n\r\n    // Fetch Exam Details\r\n    const { data: exam, isLoading: examLoading } = useApiQuery(\r\n        ['examDetails', examId],\r\n        `${apiConfig.baseUrl}/exams/${examId}`,\r\n        { enabled: !!examId }\r\n    );\r\n\r\n    // Fetch Students (using exam.class._id)\r\n    const { data: classData, isLoading: studentsLoading } = useApiQuery(\r\n        ['classStudents', exam?.class?._id],\r\n        `${apiConfig.baseUrl}/classes/${exam?.class?._id}/full-details`,\r\n        { enabled: !!exam?.class?._id }\r\n    );\r\n    const students = classData?.students || [];\r\n\r\n    // Fetch Existing Marks\r\n    const { data: existingMarksData, isLoading: marksLoading, refetch: refetchMarks } = useApiQuery(\r\n        ['examMarks', examId],\r\n        `${apiConfig.baseUrl}/marks/exam/${examId}`,\r\n        { enabled: !!examId }\r\n    );\r\n\r\n    // Process existing marks into maps\r\n    const existingMarks = {};\r\n    useEffect(() => {\r\n        if (existingMarksData) {\r\n            const marksMap = {};\r\n            const existingMap = {};\r\n            existingMarksData.forEach(mark => {\r\n                const studentId = mark.student._id;\r\n                marksMap[studentId] = mark.marksObtained.toString();\r\n                existingMap[studentId] = mark;\r\n            });\r\n            setMarksData(marksMap);\r\n            // We can't set existingMarks state directly as it's derived, \r\n            // but we can use a ref or just use the data directly if we memoize it.\r\n            // For now, let's just use the existingMarksData in render.\r\n        }\r\n    }, [existingMarksData]);\r\n\r\n    // Create a map for easy lookup in render\r\n    const existingMarksMap = React.useMemo(() => {\r\n        const map = {};\r\n        if (existingMarksData) {\r\n            existingMarksData.forEach(mark => {\r\n                map[mark.student._id] = mark;\r\n            });\r\n        }\r\n        return map;\r\n    }, [existingMarksData]);\r\n\r\n\r\n    const saveMarksMutation = useApiMutation({\r\n        mutationFn: createApiMutationFn(`${apiConfig.baseUrl}/marks/bulk`, 'POST'),\r\n        onSuccess: (result) => {\r\n            const failures = result.results.filter(r => !r.success);\r\n            if (failures.length > 0) {\r\n                showToast(`Marks saved with ${failures.length} errors`, \"warning\");\r\n            } else {\r\n                showToast(\"All marks saved successfully\", \"success\");\r\n            }\r\n            queryClient.invalidateQueries({ queryKey: ['examMarks', examId] });\r\n            refetchMarks();\r\n        },\r\n        onError: (error) => showToast(error.message || \"Failed to save marks\", \"error\")\r\n    });\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        await Promise.all([\r\n            queryClient.invalidateQueries({ queryKey: ['examDetails', examId] }),\r\n            queryClient.invalidateQueries({ queryKey: ['classStudents', exam?.class?._id] }),\r\n            refetchMarks()\r\n        ]);\r\n        setRefreshing(false);\r\n    };\r\n\r\n    const handleMarksChange = (studentId, value) => {\r\n        setMarksData(prev => ({\r\n            ...prev,\r\n            [studentId]: value\r\n        }));\r\n    };\r\n\r\n    const handleSaveMarks = () => {\r\n        // Prepare marks data for bulk upload\r\n        const marksArray = Object.keys(marksData)\r\n            .filter(studentId => marksData[studentId] !== '' && marksData[studentId] !== undefined)\r\n            .map(studentId => ({\r\n                studentId,\r\n                marksObtained: parseFloat(marksData[studentId])\r\n            }));\r\n\r\n        if (marksArray.length === 0) {\r\n            showToast(\"Please enter marks for at least one student\", \"warning\");\r\n            return;\r\n        }\r\n\r\n        // Validate all marks\r\n        const invalidMarks = marksArray.filter(\r\n            m => isNaN(m.marksObtained) || m.marksObtained < 0 || m.marksObtained > exam.totalMarks\r\n        );\r\n\r\n        if (invalidMarks.length > 0) {\r\n            showToast(`Marks must be between 0 and ${exam.totalMarks}`, \"error\");\r\n            return;\r\n        }\r\n\r\n        saveMarksMutation.mutate({\r\n            examId,\r\n            marksData: marksArray\r\n        });\r\n    };\r\n\r\n    const getGradeColor = (grade) => {\r\n        if (grade === 'A+' || grade === 'A') return colors.success;\r\n        if (grade === 'B+' || grade === 'B') return '#2196F3';\r\n        if (grade === 'C') return '#FF9800';\r\n        if (grade === 'D') return '#FF5722';\r\n        return colors.error;\r\n    };\r\n\r\n    const loading = examLoading || studentsLoading || marksLoading;\r\n\r\n    if (loading) {\r\n        return (\r\n            <View style={{ flex: 1, backgroundColor: colors.background, justifyContent: \"center\", alignItems: \"center\" }}>\r\n                <ActivityIndicator size=\"large\" color={colors.primary} />\r\n            </View>\r\n        );\r\n    }\r\n\r\n    if (!exam) {\r\n        return (\r\n            <View style={{ flex: 1, backgroundColor: colors.background, justifyContent: \"center\", alignItems: \"center\", padding: 20 }}>\r\n                <MaterialIcons name=\"error-outline\" size={64} color={colors.error} />\r\n                <Text style={{ fontSize: 18, fontFamily: \"DMSans-SemiBold\", color: colors.textPrimary, marginTop: 16 }}>\r\n                    Exam not found\r\n                </Text>\r\n            </View>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <ScrollView\r\n                refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} />}\r\n                contentContainerStyle={{ paddingBottom: 100 }}\r\n            >\r\n                <View style={{ padding: 16, paddingTop: 24 }}>\r\n                    <AppHeader\r\n                        title=\"Enter Marks\"\r\n                        subtitle={`${exam.name} - ${exam.subject.name}`}\r\n                        showBack\r\n                    />\r\n\r\n                    {/* Exam Info Card */}\r\n                    <View style={{\r\n                        backgroundColor: colors.primary + \"15\",\r\n                        borderRadius: 16,\r\n                        padding: 16,\r\n                        marginTop: 20,\r\n                        borderLeftWidth: 4,\r\n                        borderLeftColor: colors.primary\r\n                    }}>\r\n                        <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", marginBottom: 8 }}>\r\n                            <Text style={{ fontSize: 14, color: colors.textSecondary, fontFamily: \"DMSans-Medium\" }}>\r\n                                Class\r\n                            </Text>\r\n                            <Text style={{ fontSize: 14, fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>\r\n                                {exam.class.name} {exam.class.section}\r\n                            </Text>\r\n                        </View>\r\n                        <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", marginBottom: 8 }}>\r\n                            <Text style={{ fontSize: 14, color: colors.textSecondary, fontFamily: \"DMSans-Medium\" }}>\r\n                                Type\r\n                            </Text>\r\n                            <Text style={{ fontSize: 14, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, textTransform: \"capitalize\" }}>\r\n                                {exam.type.replace('-', ' ')}\r\n                            </Text>\r\n                        </View>\r\n                        <View style={{ flexDirection: \"row\", justifyContent: \"space-between\" }}>\r\n                            <Text style={{ fontSize: 14, color: colors.textSecondary, fontFamily: \"DMSans-Medium\" }}>\r\n                                Total Marks\r\n                            </Text>\r\n                            <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.primary }}>\r\n                                {exam.totalMarks}\r\n                            </Text>\r\n                        </View>\r\n                    </View>\r\n\r\n                    {/* Students List with Marks Entry */}\r\n                    <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginTop: 28, marginBottom: 16 }}>\r\n                        Student Marks ({students.length})\r\n                    </Text>\r\n\r\n                    {students.length === 0 ? (\r\n                        <View style={{ alignItems: \"center\", marginTop: 40 }}>\r\n                            <MaterialIcons name=\"people-outline\" size={64} color={colors.textSecondary} />\r\n                            <Text style={{ fontSize: 16, color: colors.textSecondary, marginTop: 16, fontFamily: \"DMSans-Medium\" }}>\r\n                                No students in this class\r\n                            </Text>\r\n                        </View>\r\n                    ) : (\r\n                        students.map((student, index) => {\r\n                            const existingMark = existingMarksMap[student._id];\r\n                            const currentValue = marksData[student._id] || '';\r\n\r\n                            return (\r\n                                <View\r\n                                    key={student._id}\r\n                                    style={{\r\n                                        backgroundColor: colors.cardBackground,\r\n                                        borderRadius: 12,\r\n                                        padding: 16,\r\n                                        marginBottom: 12,\r\n                                        elevation: 1\r\n                                    }}\r\n                                >\r\n                                    <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\", marginBottom: 12 }}>\r\n                                        <View style={{ flex: 1 }}>\r\n                                            <Text style={{ fontSize: 16, fontFamily: \"DMSans-SemiBold\", color: colors.textPrimary }}>\r\n                                                {index + 1}. {student.name}\r\n                                            </Text>\r\n                                            {student.email && (\r\n                                                <Text style={{ fontSize: 12, color: colors.textSecondary, marginTop: 2, fontFamily: \"DMSans-Regular\" }}>\r\n                                                    {student.email}\r\n                                                </Text>\r\n                                            )}\r\n                                        </View>\r\n\r\n                                        {existingMark && (\r\n                                            <View style={{\r\n                                                backgroundColor: getGradeColor(existingMark.grade) + \"20\",\r\n                                                paddingHorizontal: 12,\r\n                                                paddingVertical: 6,\r\n                                                borderRadius: 8\r\n                                            }}>\r\n                                                <Text style={{\r\n                                                    fontSize: 16,\r\n                                                    fontFamily: \"DMSans-Bold\",\r\n                                                    color: getGradeColor(existingMark.grade)\r\n                                                }}>\r\n                                                    {existingMark.grade}\r\n                                                </Text>\r\n                                            </View>\r\n                                        )}\r\n                                    </View>\r\n\r\n                                    {/* Marks Input */}\r\n                                    <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 12 }}>\r\n                                        <View style={{ flex: 1 }}>\r\n                                            <Text style={{ fontSize: 12, color: colors.textSecondary, marginBottom: 6, fontFamily: \"DMSans-Medium\" }}>\r\n                                                Marks Obtained (out of {exam.totalMarks})\r\n                                            </Text>\r\n                                            <TextInput\r\n                                                placeholder=\"0\"\r\n                                                placeholderTextColor={colors.textSecondary + \"60\"}\r\n                                                keyboardType=\"numeric\"\r\n                                                style={{\r\n                                                    backgroundColor: colors.background,\r\n                                                    padding: 12,\r\n                                                    borderRadius: 10,\r\n                                                    color: colors.textPrimary,\r\n                                                    fontSize: 18,\r\n                                                    fontFamily: \"DMSans-Bold\",\r\n                                                    borderWidth: 2,\r\n                                                    borderColor: currentValue !== '' ? colors.primary : colors.textSecondary + \"20\"\r\n                                                }}\r\n                                                value={currentValue}\r\n                                                onChangeText={(value) => handleMarksChange(student._id, value)}\r\n                                            />\r\n                                        </View>\r\n\r\n                                        {currentValue !== '' && !isNaN(currentValue) && (\r\n                                            <View style={{ alignItems: \"center\", minWidth: 60 }}>\r\n                                                <Text style={{ fontSize: 11, color: colors.textSecondary, marginBottom: 4, fontFamily: \"DMSans-Medium\" }}>\r\n                                                    %\r\n                                                </Text>\r\n                                                <Text style={{ fontSize: 24, fontFamily: \"DMSans-Bold\", color: colors.primary }}>\r\n                                                    {((parseFloat(currentValue) / exam.totalMarks) * 100).toFixed(0)}\r\n                                                </Text>\r\n                                            </View>\r\n                                        )}\r\n                                    </View>\r\n                                </View>\r\n                            );\r\n                        })\r\n                    )}\r\n\r\n                    {/* Save Button */}\r\n                    {students.length > 0 && (\r\n                        <Pressable\r\n                            onPress={handleSaveMarks}\r\n                            disabled={saveMarksMutation.isPending}\r\n                            style={({ pressed }) => ({\r\n                                backgroundColor: colors.primary,\r\n                                borderRadius: 12,\r\n                                padding: 16,\r\n                                marginTop: 24,\r\n                                flexDirection: \"row\",\r\n                                alignItems: \"center\",\r\n                                justifyContent: \"center\",\r\n                                gap: 8,\r\n                                opacity: pressed || saveMarksMutation.isPending ? 0.7 : 1,\r\n                                elevation: 3\r\n                            })}\r\n                        >\r\n                            {saveMarksMutation.isPending ? (\r\n                                <ActivityIndicator size=\"small\" color=\"#fff\" />\r\n                            ) : (\r\n                                <>\r\n                                    <MaterialIcons name=\"save\" size={24} color=\"#fff\" />\r\n                                    <Text style={{ fontSize: 17, fontFamily: \"DMSans-Bold\", color: \"#fff\" }}>\r\n                                        Save All Marks\r\n                                    </Text>\r\n                                </>\r\n                            )}\r\n                        </Pressable>\r\n                    )}\r\n                </View>\r\n            </ScrollView>\r\n        </View>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\teacher\\leaves.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":36},{"ruleId":"no-unused-vars","severity":1,"message":"'useCallback' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":49},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used. Allowed unused args must match /^_/u.","line":79,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":79,"endColumn":25},{"ruleId":"no-unused-vars","severity":1,"message":"'data' is defined but never used. Allowed unused args must match /^_/u.","line":89,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":89,"endColumn":25},{"ruleId":"no-dupe-keys","severity":2,"message":"Duplicate key 'dateText'.","line":563,"column":5,"nodeType":"ObjectExpression","messageId":"unexpected","endLine":563,"endColumn":13}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport { View, Text, StyleSheet, FlatList, TouchableOpacity, Modal, TextInput, RefreshControl, ActivityIndicator, ScrollView, Switch } from 'react-native';\r\nimport { useRouter } from 'expo-router';\r\nimport { Ionicons } from '@expo/vector-icons';\r\nimport DateTimePicker from '@react-native-community/datetimepicker';\r\nimport { useApiQuery, useApiMutation, createApiMutationFn } from '../../hooks/useApi';\r\nimport { useQueryClient } from '@tanstack/react-query';\r\nimport apiConfig from '../../config/apiConfig';\r\nimport { useToast } from '../../components/ToastProvider';\r\n\r\nexport default function TeacherLeaves() {\r\n    const router = useRouter();\r\n    const queryClient = useQueryClient();\r\n    const { showToast } = useToast();\r\n    const [activeTab, setActiveTab] = useState('requests'); // 'requests' or 'my_leaves'\r\n\r\n    // Data State\r\n    const [refreshing, setRefreshing] = useState(false);\r\n\r\n    // Action Modal State\r\n    const [actionModalVisible, setActionModalVisible] = useState(false);\r\n    const [selectedRequest, setSelectedRequest] = useState(null);\r\n    const [actionType, setActionType] = useState(''); // 'approved' or 'rejected'\r\n    const [actionReason, setActionReason] = useState('');\r\n    const [rejectionReason, setRejectionReason] = useState('');\r\n    const [rejectionComments, setRejectionComments] = useState('');\r\n\r\n    // Apply Leave Modal State\r\n    const [applyModalVisible, setApplyModalVisible] = useState(false);\r\n    const [startDate, setStartDate] = useState(new Date());\r\n    const [endDate, setEndDate] = useState(new Date());\r\n    const [reason, setReason] = useState('');\r\n    const [showStartPicker, setShowStartPicker] = useState(false);\r\n    const [showEndPicker, setShowEndPicker] = useState(false);\r\n    const [isHalfDay, setIsHalfDay] = useState(false);\r\n    const [halfDaySlot, setHalfDaySlot] = useState('morning');\r\n\r\n    // Fetch Pending Requests\r\n    const { data: requestsData, isLoading: requestsLoading, refetch: refetchRequests } = useApiQuery(\r\n        ['teacherLeaveRequests'],\r\n        `${apiConfig.baseUrl}/leaves/pending`,\r\n        { enabled: activeTab === 'requests' }\r\n    );\r\n    const requests = requestsData?.data || [];\r\n\r\n    // Fetch My Leaves\r\n    const { data: myLeavesData, isLoading: myLeavesLoading, refetch: refetchMyLeaves } = useApiQuery(\r\n        ['teacherMyLeaves'],\r\n        `${apiConfig.baseUrl}/leaves/my-leaves`,\r\n        { enabled: activeTab === 'my_leaves' }\r\n    );\r\n    const myLeaves = myLeavesData?.data || [];\r\n\r\n    // Fetch Leave Balance\r\n    const { data: balanceData, isLoading: balanceLoading, refetch: refetchBalance } = useApiQuery(\r\n        ['teacherLeaveBalance'],\r\n        `${apiConfig.baseUrl}/leaves/balance`,\r\n        { enabled: activeTab === 'my_leaves' }\r\n    );\r\n    const leaveBalance = balanceData?.data || null;\r\n\r\n    const loading = activeTab === 'requests' ? requestsLoading : (myLeavesLoading || balanceLoading);\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        if (activeTab === 'requests') {\r\n            await refetchRequests();\r\n        } else {\r\n            await Promise.all([refetchMyLeaves(), refetchBalance()]);\r\n        }\r\n        setRefreshing(false);\r\n    };\r\n\r\n    // Mutations\r\n    const actionMutation = useApiMutation({\r\n        mutationFn: async ({ requestId, payload }) => {\r\n            return createApiMutationFn(`${apiConfig.baseUrl}/leaves/${requestId}/action`, 'PUT')(payload);\r\n        },\r\n        onSuccess: (data) => {\r\n            showToast(`Leave ${actionType} successfully`, 'success');\r\n            setActionModalVisible(false);\r\n            queryClient.invalidateQueries({ queryKey: ['teacherLeaveRequests'] });\r\n        },\r\n        onError: (error) => showToast(error.message || 'Error updating status', 'error')\r\n    });\r\n\r\n    const applyLeaveMutation = useApiMutation({\r\n        mutationFn: createApiMutationFn(`${apiConfig.baseUrl}/leaves/apply`, 'POST'),\r\n        onSuccess: (data) => {\r\n            showToast('Leave applied successfully', 'success');\r\n            setApplyModalVisible(false);\r\n            setReason('');\r\n            setIsHalfDay(false);\r\n            queryClient.invalidateQueries({ queryKey: ['teacherMyLeaves'] });\r\n            queryClient.invalidateQueries({ queryKey: ['teacherLeaveBalance'] });\r\n        },\r\n        onError: (error) => showToast(error.message || 'Error applying leave', 'error')\r\n    });\r\n\r\n    // --- Action Handlers ---\r\n\r\n    const openActionModal = (request, type) => {\r\n        setSelectedRequest(request);\r\n        setActionType(type);\r\n        setActionReason('');\r\n        setRejectionReason('');\r\n        setRejectionComments('');\r\n        setActionModalVisible(true);\r\n    };\r\n\r\n    const handleAction = () => {\r\n        if (actionType === 'rejected' && (!rejectionReason || !rejectionComments)) {\r\n            showToast('Rejection reason and comments are required', 'error');\r\n            return;\r\n        }\r\n\r\n        const payload = {\r\n            status: actionType,\r\n            reason: actionReason,\r\n            rejectionReason: actionType === 'rejected' ? rejectionReason : undefined,\r\n            rejectionComments: actionType === 'rejected' ? rejectionComments : undefined\r\n        };\r\n\r\n        actionMutation.mutate({ requestId: selectedRequest._id, payload });\r\n    };\r\n\r\n    // --- Apply Leave Handlers ---\r\n\r\n    const handleApplyLeave = () => {\r\n        if (!reason.trim()) {\r\n            showToast('Please enter a reason', 'error');\r\n            return;\r\n        }\r\n\r\n        if (!isHalfDay && endDate < startDate) {\r\n            showToast('End date cannot be before start date', 'error');\r\n            return;\r\n        }\r\n\r\n        let finalEndDate = endDate;\r\n        if (isHalfDay) finalEndDate = startDate;\r\n\r\n        const payload = {\r\n            startDate: startDate.toISOString().split('T')[0],\r\n            endDate: finalEndDate.toISOString().split('T')[0],\r\n            reason,\r\n            leaveType: isHalfDay ? 'half' : 'full',\r\n            halfDaySlot: isHalfDay ? halfDaySlot : undefined\r\n        };\r\n\r\n        applyLeaveMutation.mutate(payload);\r\n    };\r\n\r\n    // --- Render Items ---\r\n\r\n    const formatDate = (dateString) => {\r\n        if (!dateString) return '';\r\n        return new Date(dateString).toLocaleDateString('en-GB', { day: '2-digit', month: 'short' });\r\n    };\r\n\r\n    const getStatusColor = (status) => {\r\n        switch (status) {\r\n            case 'approved': return '#4CAF50';\r\n            case 'rejected': return '#F44336';\r\n            default: return '#FF9800';\r\n        }\r\n    };\r\n\r\n    const renderRequestItem = ({ item }) => (\r\n        <View style={styles.card}>\r\n            <View style={styles.cardHeader}>\r\n                <View>\r\n                    <Text style={styles.studentName}>{item.applicant?.name || 'Unknown'}</Text>\r\n                    <Text style={styles.classInfo}>\r\n                        {item.applicantRole === 'student' ? `Class: ${item.class?.name || ''} ${item.class?.section || ''}` : 'Teacher'}\r\n                    </Text>\r\n                </View>\r\n                <View style={styles.dateContainer}>\r\n                    <Text style={styles.dateText}>\r\n                        {formatDate(item.startDate)}\r\n                        {item.leaveType === 'full' && item.startDate !== item.endDate && ` - ${formatDate(item.endDate)}`}\r\n                    </Text>\r\n                    <Text style={styles.leaveTypeBadge}>\r\n                        {item.leaveType === 'half' ? `Half Day (${item.halfDaySlot})` : 'Full Day'}\r\n                    </Text>\r\n                </View>\r\n            </View>\r\n\r\n            <Text style={styles.reasonLabel}>Reason:</Text>\r\n            <Text style={styles.reasonText}>{item.reason}</Text>\r\n\r\n            <View style={styles.actionButtons}>\r\n                <TouchableOpacity\r\n                    style={[styles.actionButton, styles.rejectButton]}\r\n                    onPress={() => openActionModal(item, 'rejected')}\r\n                >\r\n                    <Text style={styles.actionButtonText}>Reject</Text>\r\n                </TouchableOpacity>\r\n                <TouchableOpacity\r\n                    style={[styles.actionButton, styles.approveButton]}\r\n                    onPress={() => openActionModal(item, 'approved')}\r\n                >\r\n                    <Text style={styles.actionButtonText}>Approve</Text>\r\n                </TouchableOpacity>\r\n            </View>\r\n        </View>\r\n    );\r\n\r\n    const renderMyLeaveItem = ({ item }) => (\r\n        <View style={styles.card}>\r\n            <View style={styles.cardHeader}>\r\n                <View>\r\n                    <Text style={styles.dateText}>\r\n                        {formatDate(item.startDate)}\r\n                        {item.leaveType === 'full' && item.startDate !== item.endDate && ` - ${formatDate(item.endDate)}`}\r\n                    </Text>\r\n                    <Text style={styles.leaveTypeBadge}>\r\n                        {item.leaveType === 'half' ? `Half Day (${item.halfDaySlot})` : 'Full Day'}\r\n                    </Text>\r\n                </View>\r\n                <View style={[styles.statusBadge, { backgroundColor: getStatusColor(item.status) }]}>\r\n                    <Text style={styles.statusText}>{(item.status || 'pending').toUpperCase()}</Text>\r\n                </View>\r\n            </View>\r\n            <Text style={styles.reasonLabel}>Reason:</Text>\r\n            <Text style={styles.reasonText}>{item.reason}</Text>\r\n            {item.status === 'rejected' && (\r\n                <View style={styles.rejectionBox}>\r\n                    <Text style={styles.rejectionTitle}>Rejection Details:</Text>\r\n                    <Text style={styles.rejectionText}><Text style={{ fontWeight: 'bold' }}>Reason:</Text> {item.rejectionReason}</Text>\r\n                    <Text style={styles.rejectionText}><Text style={{ fontWeight: 'bold' }}>Comments:</Text> {item.rejectionComments}</Text>\r\n                </View>\r\n            )}\r\n        </View>\r\n    );\r\n\r\n    return (\r\n        <View style={styles.container}>\r\n            <View style={styles.header}>\r\n                <TouchableOpacity onPress={() => router.back()} style={styles.backButton}>\r\n                    <Ionicons name=\"arrow-back\" size={24} color=\"#333\" />\r\n                </TouchableOpacity>\r\n                <Text style={styles.headerTitle}>Leave Management</Text>\r\n                <View style={{ width: 24 }} />\r\n            </View>\r\n\r\n            <View style={styles.tabContainer}>\r\n                <TouchableOpacity\r\n                    style={[styles.tab, activeTab === 'requests' && styles.activeTab]}\r\n                    onPress={() => setActiveTab('requests')}\r\n                >\r\n                    <Text style={[styles.tabText, activeTab === 'requests' && styles.activeTabText]}>Requests</Text>\r\n                </TouchableOpacity>\r\n                <TouchableOpacity\r\n                    style={[styles.tab, activeTab === 'my_leaves' && styles.activeTab]}\r\n                    onPress={() => setActiveTab('my_leaves')}\r\n                >\r\n                    <Text style={[styles.tabText, activeTab === 'my_leaves' && styles.activeTabText]}>My Leaves</Text>\r\n                </TouchableOpacity>\r\n            </View>\r\n\r\n            {activeTab === 'my_leaves' && leaveBalance && (\r\n                <View style={styles.balanceCard}>\r\n                    <View style={styles.balanceItem}>\r\n                        <Text style={styles.balanceLabel}>Total</Text>\r\n                        <Text style={styles.balanceValue}>{leaveBalance.total}</Text>\r\n                    </View>\r\n                    <View style={styles.balanceDivider} />\r\n                    <View style={styles.balanceItem}>\r\n                        <Text style={styles.balanceLabel}>Used</Text>\r\n                        <Text style={styles.balanceValue}>{leaveBalance.used}</Text>\r\n                    </View>\r\n                    <View style={styles.balanceDivider} />\r\n                    <View style={styles.balanceItem}>\r\n                        <Text style={styles.balanceLabel}>Remaining</Text>\r\n                        <Text style={[styles.balanceValue, { color: '#4CAF50' }]}>{leaveBalance.remaining}</Text>\r\n                    </View>\r\n                </View>\r\n            )}\r\n\r\n            {loading ? (\r\n                <ActivityIndicator size=\"large\" color=\"#2F6CD4\" style={styles.loader} />\r\n            ) : (\r\n                <FlatList\r\n                    data={activeTab === 'requests' ? requests : myLeaves}\r\n                    renderItem={activeTab === 'requests' ? renderRequestItem : renderMyLeaveItem}\r\n                    keyExtractor={(item) => item._id}\r\n                    contentContainerStyle={styles.listContent}\r\n                    refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} />}\r\n                    ListEmptyComponent={<Text style={styles.emptyText}>No records found.</Text>}\r\n                />\r\n            )}\r\n\r\n            {activeTab === 'my_leaves' && (\r\n                <TouchableOpacity style={styles.fab} onPress={() => setApplyModalVisible(true)}>\r\n                    <Ionicons name=\"add\" size={24} color=\"#fff\" />\r\n                    <Text style={styles.fabText}>Apply Leave</Text>\r\n                </TouchableOpacity>\r\n            )}\r\n\r\n            {/* Action Modal */}\r\n            <Modal\r\n                visible={actionModalVisible}\r\n                animationType=\"fade\"\r\n                transparent={true}\r\n                onRequestClose={() => setActionModalVisible(false)}\r\n            >\r\n                <View style={styles.modalContainer}>\r\n                    <View style={styles.modalContent}>\r\n                        <Text style={styles.modalTitle}>\r\n                            {actionType === 'approved' ? 'Approve Leave' : 'Reject Leave'}\r\n                        </Text>\r\n\r\n                        {actionType === 'rejected' && (\r\n                            <>\r\n                                <Text style={styles.label}>Rejection Reason *</Text>\r\n                                <TextInput\r\n                                    style={styles.input}\r\n                                    placeholder=\"e.g., Exam Period, Staff Shortage\"\r\n                                    value={rejectionReason}\r\n                                    onChangeText={setRejectionReason}\r\n                                />\r\n                                <Text style={styles.label}>Comments *</Text>\r\n                                <TextInput\r\n                                    style={[styles.input, styles.textArea]}\r\n                                    placeholder=\"Add detailed comments...\"\r\n                                    value={rejectionComments}\r\n                                    onChangeText={setRejectionComments}\r\n                                    multiline\r\n                                    numberOfLines={3}\r\n                                />\r\n                            </>\r\n                        )}\r\n\r\n                        {actionType === 'approved' && (\r\n                            <>\r\n                                <Text style={styles.label}>Note (Optional)</Text>\r\n                                <TextInput\r\n                                    style={[styles.input, styles.textArea]}\r\n                                    placeholder=\"Add a note...\"\r\n                                    value={actionReason}\r\n                                    onChangeText={setActionReason}\r\n                                    multiline\r\n                                    numberOfLines={3}\r\n                                />\r\n                            </>\r\n                        )}\r\n\r\n                        <View style={styles.modalButtons}>\r\n                            <TouchableOpacity\r\n                                style={[styles.button, styles.cancelButton]}\r\n                                onPress={() => setActionModalVisible(false)}\r\n                            >\r\n                                <Text style={styles.cancelButtonText}>Cancel</Text>\r\n                            </TouchableOpacity>\r\n                            <TouchableOpacity\r\n                                style={[styles.button, actionType === 'approved' ? styles.approveButton : styles.rejectButton]}\r\n                                onPress={handleAction}\r\n                                disabled={actionMutation.isPending}\r\n                            >\r\n                                {actionMutation.isPending ? (\r\n                                    <ActivityIndicator color=\"#fff\" size=\"small\" />\r\n                                ) : (\r\n                                    <Text style={styles.submitButtonText}>\r\n                                        {actionType === 'approved' ? 'Approve' : 'Reject'}\r\n                                    </Text>\r\n                                )}\r\n                            </TouchableOpacity>\r\n                        </View>\r\n                    </View>\r\n                </View>\r\n            </Modal>\r\n\r\n            {/* Apply Leave Modal */}\r\n            <Modal\r\n                visible={applyModalVisible}\r\n                animationType=\"slide\"\r\n                transparent={true}\r\n                onRequestClose={() => setApplyModalVisible(false)}\r\n            >\r\n                <View style={styles.modalContainer}>\r\n                    <View style={styles.modalContent}>\r\n                        <View style={styles.modalHeader}>\r\n                            <Text style={styles.modalTitle}>Apply for Leave</Text>\r\n                            <TouchableOpacity onPress={() => setApplyModalVisible(false)}>\r\n                                <Ionicons name=\"close\" size={24} color=\"#333\" />\r\n                            </TouchableOpacity>\r\n                        </View>\r\n\r\n                        <ScrollView>\r\n                            <View style={styles.inputGroup}>\r\n                                <Text style={styles.label}>Leave Type</Text>\r\n                                <View style={styles.row}>\r\n                                    <Text style={styles.valueText}>{isHalfDay ? 'Half Day' : 'Full Day'}</Text>\r\n                                    <Switch\r\n                                        value={isHalfDay}\r\n                                        onValueChange={setIsHalfDay}\r\n                                        trackColor={{ false: \"#767577\", true: \"#81b0ff\" }}\r\n                                        thumbColor={isHalfDay ? \"#2F6CD4\" : \"#f4f3f4\"}\r\n                                    />\r\n                                </View>\r\n                            </View>\r\n\r\n                            {isHalfDay && (\r\n                                <View style={styles.inputGroup}>\r\n                                    <Text style={styles.label}>Slot</Text>\r\n                                    <View style={styles.slotContainer}>\r\n                                        <TouchableOpacity\r\n                                            style={[styles.slotButton, halfDaySlot === 'morning' && styles.activeSlot]}\r\n                                            onPress={() => setHalfDaySlot('morning')}\r\n                                        >\r\n                                            <Text style={[styles.slotText, halfDaySlot === 'morning' && styles.activeSlotText]}>Morning</Text>\r\n                                        </TouchableOpacity>\r\n                                        <TouchableOpacity\r\n                                            style={[styles.slotButton, halfDaySlot === 'afternoon' && styles.activeSlot]}\r\n                                            onPress={() => setHalfDaySlot('afternoon')}\r\n                                        >\r\n                                            <Text style={[styles.slotText, halfDaySlot === 'afternoon' && styles.activeSlotText]}>Afternoon</Text>\r\n                                        </TouchableOpacity>\r\n                                    </View>\r\n                                </View>\r\n                            )}\r\n\r\n                            <View style={styles.inputGroup}>\r\n                                <Text style={styles.label}>Start Date</Text>\r\n                                <TouchableOpacity\r\n                                    style={styles.dateButton}\r\n                                    onPress={() => setShowStartPicker(true)}\r\n                                >\r\n                                    <Text style={styles.dateText}>{formatDate(startDate.toISOString())}</Text>\r\n                                    <Ionicons name=\"calendar-outline\" size={20} color=\"#666\" />\r\n                                </TouchableOpacity>\r\n                                {showStartPicker && (\r\n                                    <DateTimePicker\r\n                                        value={startDate}\r\n                                        mode=\"date\"\r\n                                        display=\"default\"\r\n                                        minimumDate={new Date()}\r\n                                        onChange={(event, selectedDate) => {\r\n                                            setShowStartPicker(false);\r\n                                            if (selectedDate) {\r\n                                                setStartDate(selectedDate);\r\n                                                if (selectedDate > endDate) setEndDate(selectedDate);\r\n                                            }\r\n                                        }}\r\n                                    />\r\n                                )}\r\n                            </View>\r\n\r\n                            {!isHalfDay && (\r\n                                <View style={styles.inputGroup}>\r\n                                    <Text style={styles.label}>End Date</Text>\r\n                                    <TouchableOpacity\r\n                                        style={styles.dateButton}\r\n                                        onPress={() => setShowEndPicker(true)}\r\n                                    >\r\n                                        <Text style={styles.dateText}>{formatDate(endDate.toISOString())}</Text>\r\n                                        <Ionicons name=\"calendar-outline\" size={20} color=\"#666\" />\r\n                                    </TouchableOpacity>\r\n                                    {showEndPicker && (\r\n                                        <DateTimePicker\r\n                                            value={endDate}\r\n                                            mode=\"date\"\r\n                                            display=\"default\"\r\n                                            minimumDate={startDate}\r\n                                            onChange={(event, selectedDate) => {\r\n                                                setShowEndPicker(false);\r\n                                                if (selectedDate) setEndDate(selectedDate);\r\n                                            }}\r\n                                        />\r\n                                    )}\r\n                                </View>\r\n                            )}\r\n\r\n                            <View style={styles.inputGroup}>\r\n                                <Text style={styles.label}>Reason</Text>\r\n                                <TextInput\r\n                                    style={[styles.input, styles.textArea]}\r\n                                    placeholder=\"Enter reason for leave...\"\r\n                                    value={reason}\r\n                                    onChangeText={setReason}\r\n                                    multiline\r\n                                    numberOfLines={4}\r\n                                />\r\n                            </View>\r\n\r\n                            <TouchableOpacity\r\n                                style={styles.submitButton}\r\n                                onPress={handleApplyLeave}\r\n                                disabled={applyLeaveMutation.isPending}\r\n                            >\r\n                                {applyLeaveMutation.isPending ? (\r\n                                    <ActivityIndicator color=\"#fff\" />\r\n                                ) : (\r\n                                    <Text style={styles.submitButtonText}>Submit Application</Text>\r\n                                )}\r\n                            </TouchableOpacity>\r\n                        </ScrollView>\r\n                    </View>\r\n                </View>\r\n            </Modal>\r\n        </View>\r\n    );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n    container: { flex: 1, backgroundColor: '#f5f5f5' },\r\n    header: { flexDirection: 'row', alignItems: 'center', justifyContent: 'space-between', padding: 16, backgroundColor: '#fff', elevation: 2 },\r\n    headerTitle: { fontSize: 18, fontWeight: 'bold', color: '#333' },\r\n    backButton: { padding: 4 },\r\n    tabContainer: { flexDirection: 'row', backgroundColor: '#fff', paddingHorizontal: 16, paddingBottom: 12, borderBottomWidth: 1, borderBottomColor: '#eee' },\r\n    tab: { flex: 1, paddingVertical: 10, alignItems: 'center', borderBottomWidth: 2, borderBottomColor: 'transparent' },\r\n    activeTab: { borderBottomColor: '#2F6CD4' },\r\n    tabText: { fontSize: 16, color: '#666', fontWeight: '500' },\r\n    activeTabText: { color: '#2F6CD4', fontWeight: 'bold' },\r\n    loader: { marginTop: 20 },\r\n    listContent: { padding: 16, paddingBottom: 80 },\r\n    card: { backgroundColor: '#fff', borderRadius: 12, padding: 16, marginBottom: 12, elevation: 2 },\r\n    cardHeader: { flexDirection: 'row', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: 8 },\r\n    studentName: { fontSize: 16, fontWeight: 'bold', color: '#333' },\r\n    classInfo: { fontSize: 14, color: '#666' },\r\n    dateContainer: { alignItems: 'flex-end' },\r\n    dateText: { fontSize: 14, color: '#333', fontWeight: '500' },\r\n    leaveTypeBadge: { fontSize: 12, color: '#666', marginTop: 2, fontStyle: 'italic' },\r\n    statusBadge: { paddingHorizontal: 8, paddingVertical: 4, borderRadius: 12 },\r\n    statusText: { color: '#fff', fontSize: 12, fontWeight: 'bold' },\r\n    reasonLabel: { fontSize: 14, color: '#666', marginTop: 8, marginBottom: 2 },\r\n    reasonText: { fontSize: 14, color: '#333', marginBottom: 12 },\r\n    actionButtons: { flexDirection: 'row', justifyContent: 'flex-end', marginTop: 8, borderTopWidth: 1, borderTopColor: '#eee', paddingTop: 12 },\r\n    actionButton: { paddingHorizontal: 16, paddingVertical: 8, borderRadius: 20, marginLeft: 12 },\r\n    approveButton: { backgroundColor: '#4CAF50' },\r\n    rejectButton: { backgroundColor: '#F44336' },\r\n    actionButtonText: { color: '#fff', fontWeight: '600', fontSize: 14 },\r\n    emptyText: { textAlign: 'center', marginTop: 40, color: '#666', fontSize: 16 },\r\n    fab: { position: 'absolute', bottom: 100, right: 20, backgroundColor: '#2F6CD4', flexDirection: 'row', alignItems: 'center', paddingVertical: 12, paddingHorizontal: 20, borderRadius: 30, elevation: 4 },\r\n    fabText: { color: '#fff', fontWeight: 'bold', marginLeft: 8 },\r\n    balanceCard: { flexDirection: 'row', backgroundColor: '#fff', margin: 16, marginBottom: 0, padding: 16, borderRadius: 12, elevation: 2, justifyContent: 'space-around' },\r\n    balanceItem: { alignItems: 'center' },\r\n    balanceLabel: { fontSize: 12, color: '#666', marginBottom: 4 },\r\n    balanceValue: { fontSize: 20, fontWeight: 'bold', color: '#333' },\r\n    balanceDivider: { width: 1, backgroundColor: '#eee' },\r\n    modalContainer: { flex: 1, backgroundColor: 'rgba(0,0,0,0.5)', justifyContent: 'center', padding: 20 },\r\n    modalContent: { backgroundColor: '#fff', borderRadius: 16, padding: 20, maxHeight: '90%' },\r\n    modalHeader: { flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center', marginBottom: 20 },\r\n    modalTitle: { fontSize: 20, fontWeight: 'bold', color: '#333', marginBottom: 10 },\r\n    label: { fontSize: 14, color: '#666', marginBottom: 6, fontWeight: '500', marginTop: 10 },\r\n    input: { backgroundColor: '#f9f9f9', borderWidth: 1, borderColor: '#ddd', borderRadius: 8, padding: 12, fontSize: 16 },\r\n    textArea: { height: 80, textAlignVertical: 'top' },\r\n    modalButtons: { flexDirection: 'row', justifyContent: 'space-between', marginTop: 20 },\r\n    button: { flex: 1, padding: 14, borderRadius: 8, alignItems: 'center' },\r\n    cancelButton: { backgroundColor: '#f5f5f5', marginRight: 10 },\r\n    cancelButtonText: { color: '#666', fontWeight: '600', fontSize: 16 },\r\n    submitButtonText: { color: '#fff', fontWeight: '600', fontSize: 16 },\r\n    inputGroup: { marginBottom: 20 },\r\n    row: { flexDirection: 'row', alignItems: 'center', justifyContent: 'space-between', backgroundColor: '#f9f9f9', padding: 12, borderRadius: 8, borderWidth: 1, borderColor: '#ddd' },\r\n    valueText: { fontSize: 16, color: '#333' },\r\n    slotContainer: { flexDirection: 'row', gap: 12 },\r\n    slotButton: { flex: 1, padding: 12, borderRadius: 8, borderWidth: 1, borderColor: '#ddd', alignItems: 'center', backgroundColor: '#f9f9f9' },\r\n    activeSlot: { borderColor: '#2F6CD4', backgroundColor: '#EDE7F6' },\r\n    slotText: { color: '#666', fontWeight: '500' },\r\n    activeSlotText: { color: '#2F6CD4', fontWeight: 'bold' },\r\n    dateButton: { flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center', backgroundColor: '#f9f9f9', borderWidth: 1, borderColor: '#ddd', borderRadius: 8, padding: 12 },\r\n    dateText: { fontSize: 16, color: '#333' },\r\n    submitButton: { backgroundColor: '#2F6CD4', padding: 16, borderRadius: 12, alignItems: 'center', marginTop: 10, marginBottom: 20 },\r\n    rejectionBox: { marginTop: 12, padding: 10, backgroundColor: '#FFEBEE', borderRadius: 8, borderLeftWidth: 3, borderLeftColor: '#F44336' },\r\n    rejectionTitle: { fontSize: 12, fontWeight: 'bold', color: '#D32F2F', marginBottom: 4 },\r\n    rejectionText: { fontSize: 12, color: '#D32F2F', marginBottom: 2 },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\teacher\\marks-entry.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'MaterialIcons' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":25,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    TextInput,\r\n    TouchableOpacity,\r\n    ActivityIndicator,\r\n    StyleSheet,\r\n    KeyboardAvoidingView,\r\n    Platform\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport { useLocalSearchParams, useRouter } from \"expo-router\";\r\nimport { useTheme } from \"../../theme\";\r\nimport { useApiQuery, useApiMutation } from \"../../hooks/useApi\";\r\nimport { useToast } from \"../../components/ToastProvider\";\r\nimport AppHeader from \"../../components/Header\";\r\nimport apiConfig from \"../../config/apiConfig\";\r\n\r\nexport default function MarksEntryScreen() {\r\n    const router = useRouter();\r\n    const params = useLocalSearchParams();\r\n    const { examId, examName, className, subjectName } = params;\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n\r\n    const [marksData, setMarksData] = useState({});\r\n    const [saving, setSaving] = useState(false);\r\n\r\n    // Fetch Exam Details (to get total marks)\r\n    const { data: examDetails } = useApiQuery(\r\n        ['examDetails', examId],\r\n        `${apiConfig.baseUrl}/exams/${examId}`,\r\n        { enabled: !!examId }\r\n    );\r\n\r\n    // Fetch Students in Class\r\n    // We need to fetch students of the class associated with the exam\r\n    // Assuming examDetails has class info or we use the classId from params if we passed it (we didn't pass classId explicitly but we can get it from examDetails)\r\n    const classId = examDetails?.class?._id || examDetails?.class;\r\n\r\n    const { data: students, isLoading: loadingStudents } = useApiQuery(\r\n        ['classStudents', classId],\r\n        `${apiConfig.baseUrl}/classes/${classId}/students`,\r\n        { enabled: !!classId }\r\n    );\r\n\r\n    // Fetch Existing Marks\r\n    const { data: existingMarks, isLoading: loadingMarks } = useApiQuery(\r\n        ['examMarks', examId],\r\n        `${apiConfig.baseUrl}/marks/exam/${examId}`,\r\n        { enabled: !!examId }\r\n    );\r\n\r\n    // Initialize marks data when students or existing marks load\r\n    useEffect(() => {\r\n        if (students && existingMarks) {\r\n            const initialData = {};\r\n            students.forEach(student => {\r\n                const markEntry = existingMarks.find(m => m.student._id === student._id || m.student === student._id);\r\n                initialData[student._id] = {\r\n                    marksObtained: markEntry ? String(markEntry.marksObtained) : \"\",\r\n                    remarks: markEntry ? markEntry.remarks : \"\"\r\n                };\r\n            });\r\n            setMarksData(initialData);\r\n        } else if (students) {\r\n            const initialData = {};\r\n            students.forEach(student => {\r\n                initialData[student._id] = {\r\n                    marksObtained: \"\",\r\n                    remarks: \"\"\r\n                };\r\n            });\r\n            setMarksData(initialData);\r\n        }\r\n    }, [students, existingMarks]);\r\n\r\n    const bulkMarksMutation = useApiMutation(`${apiConfig.baseUrl}/marks/bulk`, 'POST');\r\n\r\n    const handleMarksChange = (studentId, value) => {\r\n        // Validate input (allow empty or numbers)\r\n        if (value === \"\" || /^\\d*\\.?\\d*$/.test(value)) {\r\n            setMarksData(prev => ({\r\n                ...prev,\r\n                [studentId]: { ...prev[studentId], marksObtained: value }\r\n            }));\r\n        }\r\n    };\r\n\r\n    const handleSave = async () => {\r\n        setSaving(true);\r\n        try {\r\n            const payload = {\r\n                examId,\r\n                marksData: Object.entries(marksData)\r\n                    .filter(([_, data]) => data.marksObtained !== \"\") // Only send entries with marks\r\n                    .map(([studentId, data]) => ({\r\n                        studentId,\r\n                        marksObtained: parseFloat(data.marksObtained),\r\n                        remarks: data.remarks\r\n                    }))\r\n            };\r\n\r\n            await bulkMarksMutation.mutateAsync(payload);\r\n            showToast(\"Marks saved successfully\", \"success\");\r\n            router.back();\r\n        } catch (error) {\r\n            showToast(error.message || \"Failed to save marks\", \"error\");\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    const totalMarks = examDetails?.totalMarks || 0;\r\n\r\n    if (loadingStudents || loadingMarks) {\r\n        return (\r\n            <View style={{ flex: 1, justifyContent: \"center\", alignItems: \"center\", backgroundColor: colors.background }}>\r\n                <ActivityIndicator size=\"large\" color={colors.primary} />\r\n            </View>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <AppHeader\r\n                title={`${examName} Marks`}\r\n                subtitle={`${className} - ${subjectName} (Max: ${totalMarks})`}\r\n            />\r\n\r\n            <KeyboardAvoidingView\r\n                behavior={Platform.OS === \"ios\" ? \"padding\" : \"height\"}\r\n                style={{ flex: 1 }}\r\n            >\r\n                <ScrollView contentContainerStyle={{ padding: 16, paddingBottom: 100 }}>\r\n                    <View style={localStyles.headerRow}>\r\n                        <Text style={[localStyles.headerText, { color: colors.textSecondary, flex: 2 }]}>Student</Text>\r\n                        <Text style={[localStyles.headerText, { color: colors.textSecondary, flex: 1, textAlign: \"center\" }]}>Marks</Text>\r\n                    </View>\r\n\r\n                    {students?.map((student) => (\r\n                        <View\r\n                            key={student._id}\r\n                            style={[localStyles.row, { backgroundColor: colors.cardBackground, borderColor: colors.borderColor }]}\r\n                        >\r\n                            <View style={{ flex: 2 }}>\r\n                                <Text style={{ fontSize: 16, fontFamily: \"DMSans-Medium\", color: colors.textPrimary }}>\r\n                                    {student.name}\r\n                                </Text>\r\n                                <Text style={{ fontSize: 12, color: colors.textSecondary }}>\r\n                                    Roll: {student.rollNumber || \"-\"}\r\n                                </Text>\r\n                            </View>\r\n\r\n                            <View style={{ flex: 1, alignItems: \"center\" }}>\r\n                                <TextInput\r\n                                    style={[\r\n                                        localStyles.input,\r\n                                        {\r\n                                            color: colors.textPrimary,\r\n                                            borderColor: colors.borderColor,\r\n                                            backgroundColor: colors.background\r\n                                        }\r\n                                    ]}\r\n                                    keyboardType=\"numeric\"\r\n                                    maxLength={5}\r\n                                    value={marksData[student._id]?.marksObtained || \"\"}\r\n                                    onChangeText={(text) => handleMarksChange(student._id, text)}\r\n                                    placeholder=\"-\"\r\n                                    placeholderTextColor={colors.textSecondary}\r\n                                />\r\n                            </View>\r\n                        </View>\r\n                    ))}\r\n                </ScrollView>\r\n            </KeyboardAvoidingView>\r\n\r\n            <View style={[localStyles.footer, { backgroundColor: colors.cardBackground, borderTopColor: colors.borderColor }]}>\r\n                <TouchableOpacity\r\n                    style={[localStyles.saveButton, { backgroundColor: colors.primary, opacity: saving ? 0.7 : 1 }]}\r\n                    onPress={handleSave}\r\n                    disabled={saving}\r\n                >\r\n                    {saving ? (\r\n                        <ActivityIndicator color=\"#fff\" />\r\n                    ) : (\r\n                        <Text style={localStyles.saveButtonText}>Save Marks</Text>\r\n                    )}\r\n                </TouchableOpacity>\r\n            </View>\r\n        </View>\r\n    );\r\n}\r\n\r\nconst localStyles = StyleSheet.create({\r\n    headerRow: {\r\n        flexDirection: \"row\",\r\n        paddingBottom: 8,\r\n        marginBottom: 8,\r\n        borderBottomWidth: 1,\r\n        borderBottomColor: \"#e0e0e0\"\r\n    },\r\n    headerText: {\r\n        fontSize: 12,\r\n        fontFamily: \"DMSans-Bold\",\r\n        textTransform: \"uppercase\"\r\n    },\r\n    row: {\r\n        flexDirection: \"row\",\r\n        alignItems: \"center\",\r\n        padding: 12,\r\n        borderRadius: 12,\r\n        marginBottom: 8,\r\n        borderWidth: 1\r\n    },\r\n    input: {\r\n        width: 60,\r\n        height: 40,\r\n        borderWidth: 1,\r\n        borderRadius: 8,\r\n        textAlign: \"center\",\r\n        fontSize: 16,\r\n        fontFamily: \"DMSans-Bold\"\r\n    },\r\n    footer: {\r\n        position: \"absolute\",\r\n        bottom: 0,\r\n        left: 0,\r\n        right: 0,\r\n        padding: 16,\r\n        borderTopWidth: 1,\r\n        elevation: 10\r\n    },\r\n    saveButton: {\r\n        paddingVertical: 14,\r\n        borderRadius: 12,\r\n        alignItems: \"center\",\r\n        justifyContent: \"center\"\r\n    },\r\n    saveButtonText: {\r\n        color: \"#fff\",\r\n        fontSize: 16,\r\n        fontFamily: \"DMSans-Bold\"\r\n    }\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\teacher\\schedule.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'AsyncStorage' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":22,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":23,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'showToast' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":24,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    Pressable,\r\n    ActivityIndicator,\r\n    RefreshControl,\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useRouter } from \"expo-router\";\r\nimport { useTheme } from \"../../theme\";\r\nimport apiConfig from \"../../config/apiConfig\";\r\nimport { useApiQuery } from \"../../hooks/useApi\";\r\nimport { useToast } from \"../../components/ToastProvider\";\r\nimport AppHeader from \"../../components/Header\";\r\n\r\nconst DAYS = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\r\n\r\nexport default function TeacherScheduleScreen() {\r\n    const router = useRouter();\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n\r\n    const [refreshing, setRefreshing] = useState(false);\r\n    const [selectedDay, setSelectedDay] = useState('Monday');\r\n    const [currentDay, setCurrentDay] = useState('');\r\n\r\n    useEffect(() => {\r\n        // Set current day\r\n        const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\r\n        const today = days[new Date().getDay()];\r\n        if (DAYS.includes(today)) {\r\n            setSelectedDay(today);\r\n            setCurrentDay(today);\r\n        } else {\r\n            setSelectedDay('Monday');\r\n        }\r\n    }, []);\r\n\r\n    const { data: scheduleData, isLoading: loading, refetch } = useApiQuery(\r\n        ['teacherSchedule'],\r\n        `${apiConfig.baseUrl}/timetable/my-schedule`\r\n    );\r\n\r\n    // Process schedule data\r\n    const schedule = React.useMemo(() => {\r\n        if (!scheduleData) return {};\r\n\r\n        const scheduleMap = {};\r\n        DAYS.forEach(day => {\r\n            scheduleMap[day] = (scheduleData[day] || []).sort((a, b) => {\r\n                const timeA = a.startTime || \"\";\r\n                const timeB = b.startTime || \"\";\r\n                return timeA.localeCompare(timeB);\r\n            });\r\n        });\r\n        return scheduleMap;\r\n    }, [scheduleData]);\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        await refetch();\r\n        setRefreshing(false);\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <View style={{ flex: 1, backgroundColor: colors.background, justifyContent: \"center\", alignItems: \"center\" }}>\r\n                <ActivityIndicator size=\"large\" color={colors.primary} />\r\n            </View>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <ScrollView\r\n                refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} />}\r\n                contentContainerStyle={{ paddingBottom: 100 }}\r\n            >\r\n                <View style={{ padding: 16, paddingTop: 24 }}>\r\n                    <AppHeader title=\"My Schedule\" subtitle=\"Teaching Timetable\" showBack />\r\n\r\n                    {/* Day Tabs */}\r\n                    <View style={{ marginTop: 24 }}>\r\n                        <ScrollView horizontal showsHorizontalScrollIndicator={false}>\r\n                            <View style={{ flexDirection: \"row\", gap: 8 }}>\r\n                                {DAYS.map((day) => (\r\n                                    <Pressable\r\n                                        key={day}\r\n                                        onPress={() => setSelectedDay(day)}\r\n                                        style={{\r\n                                            paddingHorizontal: 16,\r\n                                            paddingVertical: 8,\r\n                                            backgroundColor: selectedDay === day ? colors.primary : colors.cardBackground,\r\n                                            borderRadius: 12,\r\n                                            borderWidth: 1,\r\n                                            borderColor: selectedDay === day ? colors.primary : colors.textSecondary + \"20\"\r\n                                        }}\r\n                                    >\r\n                                        <Text style={{\r\n                                            color: selectedDay === day ? \"#fff\" : colors.textPrimary,\r\n                                            fontFamily: selectedDay === day ? \"DMSans-Bold\" : \"DMSans-Medium\"\r\n                                        }}>\r\n                                            {day.slice(0, 3)}\r\n                                        </Text>\r\n                                    </Pressable>\r\n                                ))}\r\n                            </View>\r\n                        </ScrollView>\r\n                    </View>\r\n\r\n                    {/* Schedule List */}\r\n                    <View style={{ marginTop: 24 }}>\r\n                        <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\", marginBottom: 16 }}>\r\n                            <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>\r\n                                {selectedDay}\r\n                            </Text>\r\n                            {selectedDay === currentDay && (\r\n                                <View style={{ backgroundColor: colors.success + \"20\", paddingHorizontal: 8, paddingVertical: 4, borderRadius: 4 }}>\r\n                                    <Text style={{ fontSize: 12, color: colors.success, fontFamily: \"DMSans-Bold\" }}>TODAY</Text>\r\n                                </View>\r\n                            )}\r\n                        </View>\r\n\r\n                        {(!schedule[selectedDay] || schedule[selectedDay].length === 0) ? (\r\n                            <View style={{ alignItems: \"center\", marginTop: 40, opacity: 0.6 }}>\r\n                                <MaterialIcons name=\"free-breakfast\" size={48} color={colors.textSecondary} />\r\n                                <Text style={{ color: colors.textSecondary, marginTop: 16, fontSize: 16 }}>\r\n                                    No classes scheduled\r\n                                </Text>\r\n                            </View>\r\n                        ) : (\r\n                            schedule[selectedDay].map((period, index) => (\r\n                                <View\r\n                                    key={index}\r\n                                    style={{\r\n                                        backgroundColor: colors.cardBackground,\r\n                                        borderRadius: 16,\r\n                                        padding: 16,\r\n                                        marginBottom: 12,\r\n                                        flexDirection: \"row\",\r\n                                        gap: 16,\r\n                                        shadowColor: \"#000\",\r\n                                        shadowOffset: { width: 0, height: 1 },\r\n                                        shadowOpacity: 0.05,\r\n                                        shadowRadius: 4,\r\n                                        elevation: 1,\r\n                                        borderLeftWidth: 4,\r\n                                        borderLeftColor: colors.secondary\r\n                                    }}\r\n                                >\r\n                                    {/* Time Column */}\r\n                                    <View style={{ alignItems: \"center\", justifyContent: \"center\", width: 60 }}>\r\n                                        <Text style={{ fontSize: 14, fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>\r\n                                            {period.startTime}\r\n                                        </Text>\r\n                                        <View style={{ width: 1, height: 10, backgroundColor: colors.textSecondary + \"40\", marginVertical: 2 }} />\r\n                                        <Text style={{ fontSize: 12, color: colors.textSecondary }}>\r\n                                            {period.endTime}\r\n                                        </Text>\r\n                                    </View>\r\n\r\n                                    {/* Divider */}\r\n                                    <View style={{ width: 1, backgroundColor: colors.textSecondary + \"20\" }} />\r\n\r\n                                    {/* Details Column */}\r\n                                    <View style={{ flex: 1, justifyContent: \"center\" }}>\r\n                                        <Text style={{ fontSize: 16, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginBottom: 4 }}>\r\n                                            {period.className}\r\n                                        </Text>\r\n                                        <Text style={{ fontSize: 14, color: colors.primary, fontFamily: \"DMSans-Medium\", marginBottom: 4 }}>\r\n                                            {period.subject?.name || \"Subject\"}\r\n                                        </Text>\r\n\r\n                                        {period.roomNumber && (\r\n                                            <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 4 }}>\r\n                                                <MaterialIcons name=\"room\" size={14} color={colors.textSecondary} />\r\n                                                <Text style={{ fontSize: 13, color: colors.textSecondary }}>\r\n                                                    Room {period.roomNumber}\r\n                                                </Text>\r\n                                            </View>\r\n                                        )}\r\n                                    </View>\r\n                                </View>\r\n                            ))\r\n                        )}\r\n                    </View>\r\n                </View>\r\n            </ScrollView>\r\n        </View>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\teacher\\subject\\create-exam.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":36},{"ruleId":"no-unused-vars","severity":1,"message":"'AsyncStorage' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":34,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    Pressable,\r\n    TextInput,\r\n    ActivityIndicator,\r\n    Modal,\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useRouter, useLocalSearchParams } from \"expo-router\";\r\nimport { useTheme } from \"../../../theme\";\r\nimport apiConfig from \"../../../config/apiConfig\";\r\nimport { useToast } from \"../../../components/ToastProvider\";\r\nimport { useApiMutation, createApiMutationFn, useApiQuery } from \"../../../hooks/useApi\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport AppHeader from \"../../../components/Header\";\r\nimport DateTimePicker from \"@react-native-community/datetimepicker\";\r\n\r\nconst EXAM_TYPES = [\r\n    { type: 'FA1', label: 'Formative Assessment 1', color: '#4CAF50', icon: 'assignment' },\r\n    { type: 'FA2', label: 'Formative Assessment 2', color: '#2196F3', icon: 'assignment' },\r\n    { type: 'SA1', label: 'Summative Assessment 1', color: '#FF9800', icon: 'assessment' },\r\n    { type: 'FA3', label: 'Formative Assessment 3', color: '#9C27B0', icon: 'assignment' },\r\n    { type: 'FA4', label: 'Formative Assessment 4', color: '#E91E63', icon: 'assignment' },\r\n    { type: 'SA2', label: 'Summative Assessment 2', color: '#F44336', icon: 'assessment' },\r\n];\r\n\r\nexport default function InitializeExamScreen() {\r\n    const router = useRouter();\r\n    const params = useLocalSearchParams();\r\n    const { styles, colors } = useTheme();\r\n    const { showToast } = useToast();\r\n    const queryClient = useQueryClient();\r\n\r\n    const { subjectId, classId } = params;\r\n\r\n    const [showInitModal, setShowInitModal] = useState(false);\r\n    const [selectedType, setSelectedType] = useState(null);\r\n    const [totalMarks, setTotalMarks] = useState(\"\");\r\n    const [date, setDate] = useState(new Date());\r\n    const [showDatePicker, setShowDatePicker] = useState(false);\r\n    const [instructions, setInstructions] = useState(\"\");\r\n    const [duration, setDuration] = useState(\"\");\r\n\r\n    // Fetch exam status\r\n    const { data: examStatus, isLoading, refetch } = useApiQuery(\r\n        ['examStatus', classId, subjectId],\r\n        `${apiConfig.baseUrl}/exams/standardized?classId=${classId}&subjectId=${subjectId}`,\r\n        { enabled: !!classId && !!subjectId }\r\n    );\r\n\r\n    const createExamMutation = useApiMutation({\r\n        mutationFn: createApiMutationFn(`${apiConfig.baseUrl}/exams/standardized`, 'POST'),\r\n        onSuccess: (exam) => {\r\n            showToast(`${selectedType} initialized successfully`, \"success\");\r\n            setShowInitModal(false);\r\n            resetForm();\r\n            refetch();\r\n            queryClient.invalidateQueries({ queryKey: ['classExams', classId] });\r\n            // Navigate to marks entry screen\r\n            router.push({\r\n                pathname: \"/teacher/exam/enter-marks\",\r\n                params: { examId: exam._id }\r\n            });\r\n        },\r\n        onError: (error) => showToast(error.message || \"Failed to initialize exam\", \"error\")\r\n    });\r\n\r\n    const resetForm = () => {\r\n        setSelectedType(null);\r\n        setTotalMarks(\"\");\r\n        setDate(new Date());\r\n        setInstructions(\"\");\r\n        setDuration(\"\");\r\n    };\r\n\r\n    const handleInitializeExam = () => {\r\n        if (!totalMarks || isNaN(totalMarks) || parseFloat(totalMarks) <= 0) {\r\n            showToast(\"Please enter valid total marks\", \"error\");\r\n            return;\r\n        }\r\n\r\n        createExamMutation.mutate({\r\n            type: selectedType,\r\n            classId,\r\n            subjectId,\r\n            totalMarks: parseFloat(totalMarks),\r\n            date: date.toISOString(),\r\n            instructions,\r\n            duration: duration ? parseInt(duration) : null\r\n        });\r\n    };\r\n\r\n    const openInitModal = (type) => {\r\n        setSelectedType(type);\r\n        setShowInitModal(true);\r\n    };\r\n\r\n    const onDateChange = (event, selectedDate) => {\r\n        setShowDatePicker(false);\r\n        if (selectedDate) {\r\n            setDate(selectedDate);\r\n        }\r\n    };\r\n\r\n    const getExamCardStatus = (type) => {\r\n        const status = examStatus?.find(e => e.type === type);\r\n        if (!status) return { initialized: false, marksEntered: false };\r\n        return {\r\n            initialized: status.exists,\r\n            marksEntered: status.marksEntered,\r\n            marksCount: status.marksCount || 0,\r\n            exam: status.exam\r\n        };\r\n    };\r\n\r\n    const handleExamCardPress = (type) => {\r\n        const status = getExamCardStatus(type);\r\n        if (status.initialized && status.exam) {\r\n            // Navigate to marks entry\r\n            router.push({\r\n                pathname: \"/teacher/exam/enter-marks\",\r\n                params: { examId: status.exam._id }\r\n            });\r\n        } else {\r\n            // Open initialization modal\r\n            openInitModal(type);\r\n        }\r\n    };\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <View style={{ flex: 1, backgroundColor: colors.background, justifyContent: 'center', alignItems: 'center' }}>\r\n                <ActivityIndicator size=\"large\" color={colors.primary} />\r\n            </View>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <ScrollView contentContainerStyle={{ paddingBottom: 100 }}>\r\n                <View style={{ padding: 16, paddingTop: 24 }}>\r\n                    <AppHeader\r\n                        title=\"Manage Assessments\"\r\n                        subtitle=\"Initialize and manage the 6 fixed assessments\"\r\n                        showBack\r\n                    />\r\n\r\n                    <Text style={{\r\n                        fontSize: 14,\r\n                        color: colors.textSecondary,\r\n                        marginTop: 20,\r\n                        marginBottom: 16,\r\n                        fontFamily: \"DMSans-Regular\"\r\n                    }}>\r\n                        Tap on an assessment to initialize or enter marks\r\n                    </Text>\r\n\r\n                    {/* Exam Cards */}\r\n                    <View style={{ gap: 12 }}>\r\n                        {EXAM_TYPES.map((examType) => {\r\n                            const status = getExamCardStatus(examType.type);\r\n                            return (\r\n                                <Pressable\r\n                                    key={examType.type}\r\n                                    onPress={() => handleExamCardPress(examType.type)}\r\n                                    style={({ pressed }) => ({\r\n                                        backgroundColor: colors.cardBackground,\r\n                                        borderRadius: 16,\r\n                                        padding: 18,\r\n                                        borderWidth: 2,\r\n                                        borderColor: status.initialized ? examType.color + '40' : colors.textSecondary + '20',\r\n                                        opacity: pressed ? 0.7 : 1,\r\n                                        elevation: status.initialized ? 3 : 1\r\n                                    })}\r\n                                >\r\n                                    <View style={{ flexDirection: \"row\", alignItems: \"center\", justifyContent: \"space-between\" }}>\r\n                                        <View style={{ flexDirection: \"row\", alignItems: \"center\", flex: 1 }}>\r\n                                            <View style={{\r\n                                                width: 48,\r\n                                                height: 48,\r\n                                                borderRadius: 12,\r\n                                                backgroundColor: examType.color + '20',\r\n                                                alignItems: 'center',\r\n                                                justifyContent: 'center',\r\n                                                marginRight: 12\r\n                                            }}>\r\n                                                <MaterialIcons name={examType.icon} size={24} color={examType.color} />\r\n                                            </View>\r\n                                            <View style={{ flex: 1 }}>\r\n                                                <Text style={{\r\n                                                    fontSize: 18,\r\n                                                    fontFamily: \"DMSans-Bold\",\r\n                                                    color: colors.textPrimary\r\n                                                }}>\r\n                                                    {examType.type}\r\n                                                </Text>\r\n                                                <Text style={{\r\n                                                    fontSize: 13,\r\n                                                    color: colors.textSecondary,\r\n                                                    fontFamily: \"DMSans-Regular\"\r\n                                                }}>\r\n                                                    {examType.label}\r\n                                                </Text>\r\n                                                {status.initialized && (\r\n                                                    <Text style={{\r\n                                                        fontSize: 12,\r\n                                                        color: examType.color,\r\n                                                        fontFamily: \"DMSans-Medium\",\r\n                                                        marginTop: 4\r\n                                                    }}>\r\n                                                        {status.marksEntered\r\n                                                            ? ` ${status.marksCount} marks entered`\r\n                                                            : \"Tap to enter marks\"}\r\n                                                    </Text>\r\n                                                )}\r\n                                            </View>\r\n                                        </View>\r\n\r\n                                        {status.initialized ? (\r\n                                            <MaterialIcons\r\n                                                name={status.marksEntered ? \"check-circle\" : \"edit\"}\r\n                                                size={28}\r\n                                                color={status.marksEntered ? colors.success : examType.color}\r\n                                            />\r\n                                        ) : (\r\n                                            <MaterialIcons name=\"add-circle-outline\" size={28} color={colors.textSecondary} />\r\n                                        )}\r\n                                    </View>\r\n                                </Pressable>\r\n                            );\r\n                        })}\r\n                    </View>\r\n\r\n                    {/* Legend */}\r\n                    <View style={{\r\n                        backgroundColor: colors.cardBackground,\r\n                        borderRadius: 12,\r\n                        padding: 16,\r\n                        marginTop: 24\r\n                    }}>\r\n                        <Text style={{ fontSize: 14, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginBottom: 12 }}>\r\n                            Legend\r\n                        </Text>\r\n                        <View style={{ gap: 8 }}>\r\n                            <View style={{ flexDirection: \"row\", alignItems: \"center\" }}>\r\n                                <MaterialIcons name=\"add-circle-outline\" size={20} color={colors.textSecondary} />\r\n                                <Text style={{ fontSize: 13, color: colors.textSecondary, marginLeft: 8, fontFamily: \"DMSans-Regular\" }}>\r\n                                    Not initialized - Tap to set up\r\n                                </Text>\r\n                            </View>\r\n                            <View style={{ flexDirection: \"row\", alignItems: \"center\" }}>\r\n                                <MaterialIcons name=\"edit\" size={20} color={colors.primary} />\r\n                                <Text style={{ fontSize: 13, color: colors.textSecondary, marginLeft: 8, fontFamily: \"DMSans-Regular\" }}>\r\n                                    Initialized - Tap to enter marks\r\n                                </Text>\r\n                            </View>\r\n                            <View style={{ flexDirection: \"row\", alignItems: \"center\" }}>\r\n                                <MaterialIcons name=\"check-circle\" size={20} color={colors.success} />\r\n                                <Text style={{ fontSize: 13, color: colors.textSecondary, marginLeft: 8, fontFamily: \"DMSans-Regular\" }}>\r\n                                    Marks entered - Tap to edit\r\n                                </Text>\r\n                            </View>\r\n                        </View>\r\n                    </View>\r\n                </View>\r\n            </ScrollView>\r\n\r\n            {/* Initialize Exam Modal */}\r\n            <Modal\r\n                visible={showInitModal}\r\n                transparent={true}\r\n                animationType=\"slide\"\r\n                onRequestClose={() => {\r\n                    setShowInitModal(false);\r\n                    resetForm();\r\n                }}\r\n            >\r\n                <View style={{\r\n                    flex: 1,\r\n                    backgroundColor: 'rgba(0,0,0,0.5)',\r\n                    justifyContent: 'flex-end'\r\n                }}>\r\n                    <View style={{\r\n                        backgroundColor: colors.background,\r\n                        borderTopLeftRadius: 24,\r\n                        borderTopRightRadius: 24,\r\n                        padding: 24,\r\n                        maxHeight: '80%'\r\n                    }}>\r\n                        <ScrollView showsVerticalScrollIndicator={false}>\r\n                            <View style={{ flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\", marginBottom: 20 }}>\r\n                                <Text style={{ fontSize: 20, fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>\r\n                                    Initialize {selectedType}\r\n                                </Text>\r\n                                <Pressable onPress={() => { setShowInitModal(false); resetForm(); }}>\r\n                                    <MaterialIcons name=\"close\" size={24} color={colors.textSecondary} />\r\n                                </Pressable>\r\n                            </View>\r\n\r\n                            {/* Total Marks */}\r\n                            <View style={{ marginBottom: 16 }}>\r\n                                <Text style={{ fontSize: 14, fontFamily: \"DMSans-Medium\", color: colors.textSecondary, marginBottom: 8 }}>\r\n                                    Total Marks *\r\n                                </Text>\r\n                                <TextInput\r\n                                    placeholder=\"100\"\r\n                                    placeholderTextColor={colors.textSecondary}\r\n                                    keyboardType=\"numeric\"\r\n                                    style={{\r\n                                        backgroundColor: colors.cardBackground,\r\n                                        padding: 14,\r\n                                        borderRadius: 12,\r\n                                        color: colors.textPrimary,\r\n                                        fontSize: 16,\r\n                                        fontFamily: \"DMSans-Regular\",\r\n                                        borderWidth: 1,\r\n                                        borderColor: colors.textSecondary + \"20\"\r\n                                    }}\r\n                                    value={totalMarks}\r\n                                    onChangeText={setTotalMarks}\r\n                                />\r\n                            </View>\r\n\r\n                            {/* Date */}\r\n                            <View style={{ marginBottom: 16 }}>\r\n                                <Text style={{ fontSize: 14, fontFamily: \"DMSans-Medium\", color: colors.textSecondary, marginBottom: 8 }}>\r\n                                    Exam Date\r\n                                </Text>\r\n                                <Pressable\r\n                                    onPress={() => setShowDatePicker(true)}\r\n                                    style={{\r\n                                        backgroundColor: colors.cardBackground,\r\n                                        padding: 14,\r\n                                        borderRadius: 12,\r\n                                        borderWidth: 1,\r\n                                        borderColor: colors.textSecondary + \"20\",\r\n                                        flexDirection: \"row\",\r\n                                        alignItems: \"center\",\r\n                                        justifyContent: \"space-between\"\r\n                                    }}\r\n                                >\r\n                                    <Text style={{ fontSize: 16, fontFamily: \"DMSans-Regular\", color: colors.textPrimary }}>\r\n                                        {date.toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' })}\r\n                                    </Text>\r\n                                    <MaterialIcons name=\"calendar-today\" size={20} color={colors.textSecondary} />\r\n                                </Pressable>\r\n\r\n                                {showDatePicker && (\r\n                                    <DateTimePicker\r\n                                        value={date}\r\n                                        mode=\"date\"\r\n                                        display=\"default\"\r\n                                        onChange={onDateChange}\r\n                                    />\r\n                                )}\r\n                            </View>\r\n\r\n                            {/* Duration */}\r\n                            <View style={{ marginBottom: 16 }}>\r\n                                <Text style={{ fontSize: 14, fontFamily: \"DMSans-Medium\", color: colors.textSecondary, marginBottom: 8 }}>\r\n                                    Duration (minutes)\r\n                                </Text>\r\n                                <TextInput\r\n                                    placeholder=\"90\"\r\n                                    placeholderTextColor={colors.textSecondary}\r\n                                    keyboardType=\"numeric\"\r\n                                    style={{\r\n                                        backgroundColor: colors.cardBackground,\r\n                                        padding: 14,\r\n                                        borderRadius: 12,\r\n                                        color: colors.textPrimary,\r\n                                        fontSize: 16,\r\n                                        fontFamily: \"DMSans-Regular\",\r\n                                        borderWidth: 1,\r\n                                        borderColor: colors.textSecondary + \"20\"\r\n                                    }}\r\n                                    value={duration}\r\n                                    onChangeText={setDuration}\r\n                                />\r\n                            </View>\r\n\r\n                            {/* Instructions */}\r\n                            <View style={{ marginBottom: 24 }}>\r\n                                <Text style={{ fontSize: 14, fontFamily: \"DMSans-Medium\", color: colors.textSecondary, marginBottom: 8 }}>\r\n                                    Instructions (Optional)\r\n                                </Text>\r\n                                <TextInput\r\n                                    placeholder=\"Enter exam instructions...\"\r\n                                    placeholderTextColor={colors.textSecondary}\r\n                                    multiline\r\n                                    numberOfLines={3}\r\n                                    textAlignVertical=\"top\"\r\n                                    style={{\r\n                                        backgroundColor: colors.cardBackground,\r\n                                        padding: 14,\r\n                                        borderRadius: 12,\r\n                                        color: colors.textPrimary,\r\n                                        fontSize: 16,\r\n                                        fontFamily: \"DMSans-Regular\",\r\n                                        borderWidth: 1,\r\n                                        borderColor: colors.textSecondary + \"20\",\r\n                                        minHeight: 80\r\n                                    }}\r\n                                    value={instructions}\r\n                                    onChangeText={setInstructions}\r\n                                />\r\n                            </View>\r\n\r\n                            {/* Initialize Button */}\r\n                            <Pressable\r\n                                onPress={handleInitializeExam}\r\n                                disabled={createExamMutation.isPending}\r\n                                style={({ pressed }) => ({\r\n                                    backgroundColor: colors.primary,\r\n                                    borderRadius: 12,\r\n                                    padding: 16,\r\n                                    flexDirection: \"row\",\r\n                                    alignItems: \"center\",\r\n                                    justifyContent: \"center\",\r\n                                    gap: 8,\r\n                                    opacity: pressed || createExamMutation.isPending ? 0.7 : 1\r\n                                })}\r\n                            >\r\n                                {createExamMutation.isPending ? (\r\n                                    <ActivityIndicator size=\"small\" color=\"#fff\" />\r\n                                ) : (\r\n                                    <>\r\n                                        <MaterialIcons name=\"check-circle\" size={24} color=\"#fff\" />\r\n                                        <Text style={{ fontSize: 17, fontFamily: \"DMSans-Bold\", color: \"#fff\" }}>\r\n                                            Initialize & Enter Marks\r\n                                        </Text>\r\n                                    </>\r\n                                )}\r\n                            </Pressable>\r\n                        </ScrollView>\r\n                    </View>\r\n                </View>\r\n            </Modal>\r\n        </View>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\app\\teacher\\subject\\performance.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'BarChart' is defined but never used. Allowed unused vars must match /^_/u.","line":16,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":18},{"ruleId":"no-unused-vars","severity":1,"message":"'width' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":18,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":14},{"ruleId":"no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":30,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":30,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    RefreshControl,\r\n    ActivityIndicator,\r\n    Dimensions,\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport { useRouter, useLocalSearchParams } from \"expo-router\";\r\nimport { useTheme } from \"../../../theme\";\r\nimport { useApiQuery } from \"../../../hooks/useApi\";\r\nimport AppHeader from \"../../../components/Header\";\r\nimport apiConfig from \"../../../config/apiConfig\";\r\nimport { BarChart } from \"react-native-chart-kit\";\r\n\r\nconst { width } = Dimensions.get('window');\r\n\r\nconst EXAM_COLORS = {\r\n    'FA1': '#4CAF50',\r\n    'FA2': '#2196F3',\r\n    'SA1': '#FF9800',\r\n    'FA3': '#9C27B0',\r\n    'FA4': '#E91E63',\r\n    'SA2': '#F44336'\r\n};\r\n\r\nexport default function SubjectPerformanceScreen() {\r\n    const router = useRouter();\r\n    const params = useLocalSearchParams();\r\n    const { colors } = useTheme();\r\n    const { subjectId } = params;\r\n\r\n    const [refreshing, setRefreshing] = useState(false);\r\n\r\n    // Fetch subject performance data\r\n    const { data: performanceData, isLoading, refetch } = useApiQuery(\r\n        ['subjectPerformance', subjectId],\r\n        `${apiConfig.baseUrl}/exams/performance/subject/${subjectId}`,\r\n        { enabled: !!subjectId }\r\n    );\r\n\r\n    const onRefresh = async () => {\r\n        setRefreshing(true);\r\n        await refetch();\r\n        setRefreshing(false);\r\n    };\r\n\r\n    const getGradeColor = (percentage) => {\r\n        if (percentage >= 90) return colors.success;\r\n        if (percentage >= 75) return '#2196F3';\r\n        if (percentage >= 60) return '#FF9800';\r\n        if (percentage >= 40) return '#FF5722';\r\n        return colors.error;\r\n    };\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <View style={{ flex: 1, backgroundColor: colors.background, justifyContent: 'center', alignItems: 'center' }}>\r\n                <ActivityIndicator size=\"large\" color={colors.primary} />\r\n            </View>\r\n        );\r\n    }\r\n\r\n    if (!performanceData) {\r\n        return (\r\n            <View style={{ flex: 1, backgroundColor: colors.background, justifyContent: 'center', alignItems: 'center', padding: 20 }}>\r\n                <MaterialIcons name=\"info-outline\" size={64} color={colors.textSecondary} />\r\n                <Text style={{ color: colors.textSecondary, marginTop: 16, fontSize: 16, textAlign: 'center' }}>\r\n                    No performance data available\r\n                </Text>\r\n            </View>\r\n        );\r\n    }\r\n\r\n    const { performance = [] } = performanceData;\r\n\r\n    // Calculate overall stats\r\n    const totalExamsWithData = performance.filter(p => p.overallAvgPercentage > 0).length;\r\n    const overallAvg = totalExamsWithData > 0\r\n        ? (performance.reduce((sum, p) => sum + p.overallAvgPercentage, 0) / totalExamsWithData).toFixed(1)\r\n        : 0;\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <ScrollView\r\n                refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} />}\r\n                contentContainerStyle={{ paddingBottom: 100 }}\r\n            >\r\n                <View style={{ padding: 16, paddingTop: 24 }}>\r\n                    <AppHeader\r\n                        title=\"Subject Performance\"\r\n                        subtitle=\"Exam-wise analytics across all classes\"\r\n                        showBack\r\n                    />\r\n\r\n                    {/* Overall Subject Stats */}\r\n                    <View style={{\r\n                        backgroundColor: colors.primary,\r\n                        borderRadius: 20,\r\n                        padding: 24,\r\n                        marginTop: 20,\r\n                        elevation: 4\r\n                    }}>\r\n                        <Text style={{ fontSize: 16, color: \"#fff\", opacity: 0.9, fontFamily: \"DMSans-Medium\", textAlign: \"center\" }}>\r\n                            Overall Subject Average\r\n                        </Text>\r\n                        <Text style={{ fontSize: 56, fontFamily: \"DMSans-Bold\", color: \"#fff\", marginTop: 8, textAlign: \"center\" }}>\r\n                            {overallAvg}%\r\n                        </Text>\r\n                        <Text style={{ fontSize: 14, fontFamily: \"DMSans-Regular\", color: \"#fff\", marginTop: 4, textAlign: \"center\", opacity: 0.8 }}>\r\n                            Across {totalExamsWithData} completed assessments\r\n                        </Text>\r\n                    </View>\r\n\r\n                    {/* Exam-wise Performance */}\r\n                    <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginTop: 28, marginBottom: 12 }}>\r\n                        Assessment Performance\r\n                    </Text>\r\n\r\n                    {performance.map((exam) => (\r\n                        <View\r\n                            key={exam.examType}\r\n                            style={{\r\n                                backgroundColor: colors.cardBackground,\r\n                                borderRadius: 16,\r\n                                padding: 18,\r\n                                marginBottom: 16,\r\n                                elevation: 2\r\n                            }}\r\n                        >\r\n                            {/* Exam Header */}\r\n                            <View style={{ flexDirection: \"row\", alignItems: \"center\", marginBottom: 16 }}>\r\n                                <View style={{\r\n                                    width: 48,\r\n                                    height: 48,\r\n                                    borderRadius: 12,\r\n                                    backgroundColor: EXAM_COLORS[exam.examType] + '20',\r\n                                    alignItems: 'center',\r\n                                    justifyContent: 'center',\r\n                                    marginRight: 12\r\n                                }}>\r\n                                    <Text style={{ fontSize: 16, fontFamily: \"DMSans-Bold\", color: EXAM_COLORS[exam.examType] }}>\r\n                                        {exam.examType}\r\n                                    </Text>\r\n                                </View>\r\n                                <View style={{ flex: 1 }}>\r\n                                    <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary }}>\r\n                                        {exam.examType === 'FA1' && 'Formative Assessment 1'}\r\n                                        {exam.examType === 'FA2' && 'Formative Assessment 2'}\r\n                                        {exam.examType === 'SA1' && 'Summative Assessment 1'}\r\n                                        {exam.examType === 'FA3' && 'Formative Assessment 3'}\r\n                                        {exam.examType === 'FA4' && 'Formative Assessment 4'}\r\n                                        {exam.examType === 'SA2' && 'Summative Assessment 2'}\r\n                                    </Text>\r\n                                    <Text style={{\r\n                                        fontSize: 20,\r\n                                        fontFamily: \"DMSans-Bold\",\r\n                                        color: getGradeColor(exam.overallAvgPercentage),\r\n                                        marginTop: 4\r\n                                    }}>\r\n                                        {exam.overallAvgPercentage.toFixed(1)}% avg\r\n                                    </Text>\r\n                                </View>\r\n                            </View>\r\n\r\n                            {/* Class-wise Breakdown */}\r\n                            {exam.classwiseData && exam.classwiseData.length > 0 && (\r\n                                <>\r\n                                    <View style={{ height: 1, backgroundColor: colors.textSecondary + '20', marginBottom: 12 }} />\r\n                                    <Text style={{ fontSize: 14, fontFamily: \"DMSans-SemiBold\", color: colors.textPrimary, marginBottom: 12 }}>\r\n                                        Class-wise Performance\r\n                                    </Text>\r\n                                    {exam.classwiseData.map((classData, idx) => (\r\n                                        <View\r\n                                            key={idx}\r\n                                            style={{\r\n                                                backgroundColor: colors.background,\r\n                                                borderRadius: 12,\r\n                                                padding: 12,\r\n                                                marginBottom: 8,\r\n                                                flexDirection: \"row\",\r\n                                                justifyContent: \"space-between\",\r\n                                                alignItems: \"center\"\r\n                                            }}\r\n                                        >\r\n                                            <View style={{ flex: 1 }}>\r\n                                                <Text style={{ fontSize: 14, fontFamily: \"DMSans-SemiBold\", color: colors.textPrimary }}>\r\n                                                    {classData.className}\r\n                                                </Text>\r\n                                                <Text style={{ fontSize: 11, color: colors.textSecondary, fontFamily: \"DMSans-Regular\" }}>\r\n                                                    {classData.studentsCount} student{classData.studentsCount !== 1 ? 's' : ''}\r\n                                                </Text>\r\n                                            </View>\r\n                                            <View style={{ alignItems: \"flex-end\" }}>\r\n                                                <Text style={{\r\n                                                    fontSize: 18,\r\n                                                    fontFamily: \"DMSans-Bold\",\r\n                                                    color: getGradeColor(classData.avgPercentage)\r\n                                                }}>\r\n                                                    {classData.avgPercentage}%\r\n                                                </Text>\r\n                                                <View style={{ flexDirection: \"row\", gap: 8, marginTop: 2 }}>\r\n                                                    <Text style={{ fontSize: 10, color: colors.success, fontFamily: \"DMSans-Regular\" }}>\r\n                                                        H: {classData.highest}%\r\n                                                    </Text>\r\n                                                    <Text style={{ fontSize: 10, color: colors.error, fontFamily: \"DMSans-Regular\" }}>\r\n                                                        L: {classData.lowest}%\r\n                                                    </Text>\r\n                                                </View>\r\n                                            </View>\r\n                                        </View>\r\n                                    ))}\r\n                                </>\r\n                            )}\r\n\r\n                            {(!exam.classwiseData || exam.classwiseData.length === 0) && (\r\n                                <View style={{ alignItems: \"center\", paddingVertical: 20, opacity: 0.5 }}>\r\n                                    <MaterialIcons name=\"info-outline\" size={32} color={colors.textSecondary} />\r\n                                    <Text style={{ color: colors.textSecondary, marginTop: 8, fontSize: 12 }}>\r\n                                        No data yet for this assessment\r\n                                    </Text>\r\n                                </View>\r\n                            )}\r\n                        </View>\r\n                    ))}\r\n\r\n                    {performance.length === 0 && (\r\n                        <View style={{ alignItems: \"center\", marginTop: 40, opacity: 0.6 }}>\r\n                            <MaterialIcons name=\"assessment\" size={64} color={colors.textSecondary} />\r\n                            <Text style={{ color: colors.textSecondary, marginTop: 16, fontSize: 16, textAlign: 'center' }}>\r\n                                No exam data available yet.{'\\n'}Initialize exams to see performance.\r\n                            </Text>\r\n                        </View>\r\n                    )}\r\n                </View>\r\n            </ScrollView>\r\n        </View>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\babel.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\components\\AttendanceView.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Pressable' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":14},{"ruleId":"no-unused-vars","severity":1,"message":"'MaterialIcons' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'cellSize' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":17,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":15},{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":28,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":28,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useMemo } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    ScrollView,\r\n    Pressable,\r\n    ActivityIndicator,\r\n    RefreshControl,\r\n    Dimensions,\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport { useTheme } from \"../theme\";\r\nimport Header from \"./Header\";\r\nimport ModernCalendar from \"./ModernCalendar\";\r\n\r\nconst { width } = Dimensions.get('window');\r\nconst cellSize = (width - 80) / 7; // 7 days in a week, accounting for padding\r\n\r\nexport default function AttendanceView({\r\n    attendanceHistory,\r\n    summary,\r\n    loading,\r\n    onRefresh,\r\n    refreshing,\r\n    title = \"My Attendance\",\r\n    subtitle = \"Track your attendance record\"\r\n}) {\r\n    const { styles, colors } = useTheme();\r\n    const [selectedMonth, setSelectedMonth] = useState(new Date().toISOString().split('T')[0]);\r\n\r\n    const getStatusColor = (status) => {\r\n        switch (status) {\r\n            case 'present': return colors.success;\r\n            case 'absent': return colors.error;\r\n            case 'late': return '#FF9800';\r\n            case 'excused': return '#2196F3';\r\n            default: return colors.textSecondary;\r\n        }\r\n    };\r\n\r\n    const markedDates = useMemo(() => {\r\n        const marks = {};\r\n        attendanceHistory.forEach(record => {\r\n            const dateStr = new Date(record.date).toISOString().split('T')[0];\r\n            const color = getStatusColor(record.status);\r\n            marks[dateStr] = {\r\n                customStyles: {\r\n                    container: {\r\n                        backgroundColor: color + '20',\r\n                        borderWidth: 1,\r\n                        borderColor: color,\r\n                        borderRadius: 8,\r\n                    },\r\n                    text: {\r\n                        color: color,\r\n                        fontFamily: 'DMSans-Bold',\r\n                    }\r\n                }\r\n            };\r\n        });\r\n        return marks;\r\n    }, [attendanceHistory, colors]);\r\n\r\n    if (loading) {\r\n        return (\r\n            <View style={{ flex: 1, backgroundColor: colors.background, justifyContent: \"center\", alignItems: \"center\" }}>\r\n                <ActivityIndicator size=\"large\" color={colors.primary} />\r\n            </View>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <View style={{ flex: 1, backgroundColor: colors.background }}>\r\n            <ScrollView\r\n                refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} colors={[colors.primary]} />}\r\n                contentContainerStyle={{ paddingBottom: 100 }}\r\n            >\r\n                <View style={{ padding: 16, paddingTop: 24 }}>\r\n                    <Header\r\n                        title={title}\r\n                        subtitle={subtitle}\r\n                    />\r\n\r\n                    {/* Overall Percentage - Big Display */}\r\n                    <View style={{\r\n                        backgroundColor: colors.primary,\r\n                        borderRadius: 20,\r\n                        padding: 24,\r\n                        marginTop: 20,\r\n                        alignItems: \"center\",\r\n                        elevation: 4\r\n                    }}>\r\n                        <Text style={{ fontSize: 16, color: \"#fff\", opacity: 0.9, fontFamily: \"DMSans-Medium\" }}>\r\n                            Overall Attendance\r\n                        </Text>\r\n                        <Text style={{ fontSize: 64, fontFamily: \"DMSans-Bold\", color: \"#fff\", marginTop: 8 }}>\r\n                            {summary?.percentage || 0}%\r\n                        </Text>\r\n                        <View style={{ flexDirection: \"row\", gap: 24, marginTop: 16 }}>\r\n                            <View style={{ alignItems: \"center\" }}>\r\n                                <Text style={{ fontSize: 28, fontFamily: \"DMSans-Bold\", color: \"#fff\" }}>\r\n                                    {summary?.present || 0}\r\n                                </Text>\r\n                                <Text style={{ fontSize: 12, color: \"#fff\", opacity: 0.8, fontFamily: \"DMSans-Regular\" }}>\r\n                                    Present\r\n                                </Text>\r\n                            </View>\r\n                            <View style={{ alignItems: \"center\" }}>\r\n                                <Text style={{ fontSize: 28, fontFamily: \"DMSans-Bold\", color: \"#fff\" }}>\r\n                                    {summary?.total || 0}\r\n                                </Text>\r\n                                <Text style={{ fontSize: 12, color: \"#fff\", opacity: 0.8, fontFamily: \"DMSans-Regular\" }}>\r\n                                    Total Days\r\n                                </Text>\r\n                            </View>\r\n                        </View>\r\n                    </View>\r\n\r\n                    {/* Calendar View */}\r\n                    <View style={{\r\n                        backgroundColor: colors.cardBackground,\r\n                        borderRadius: 16,\r\n                        padding: 16,\r\n                        marginTop: 24,\r\n                        elevation: 2\r\n                    }}>\r\n                        <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginBottom: 4 }}>\r\n                            Attendance Calendar\r\n                        </Text>\r\n                        <ModernCalendar\r\n                            current={selectedMonth}\r\n                            markedDates={markedDates}\r\n                            onMonthChange={(month) => setSelectedMonth(month.dateString)}\r\n                            markingType={'custom'}\r\n                            theme={{\r\n                                calendarBackground: 'transparent',\r\n                            }}\r\n                        />\r\n\r\n                        {/* Legend */}\r\n                        <View style={{ flexDirection: \"row\", flexWrap: \"wrap\", gap: 12, marginTop: 16, justifyContent: \"center\" }}>\r\n                            <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 6 }}>\r\n                                <View style={{ width: 16, height: 16, borderRadius: 4, backgroundColor: colors.success + \"40\" }} />\r\n                                <Text style={{ fontSize: 11, color: colors.textSecondary, fontFamily: \"DMSans-Medium\" }}>Present</Text>\r\n                            </View>\r\n                            <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 6 }}>\r\n                                <View style={{ width: 16, height: 16, borderRadius: 4, backgroundColor: colors.error + \"40\" }} />\r\n                                <Text style={{ fontSize: 11, color: colors.textSecondary, fontFamily: \"DMSans-Medium\" }}>Absent</Text>\r\n                            </View>\r\n                            <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 6 }}>\r\n                                <View style={{ width: 16, height: 16, borderRadius: 4, backgroundColor: \"#FF9800\" + \"40\" }} />\r\n                                <Text style={{ fontSize: 11, color: colors.textSecondary, fontFamily: \"DMSans-Medium\" }}>Late</Text>\r\n                            </View>\r\n                            <View style={{ flexDirection: \"row\", alignItems: \"center\", gap: 6 }}>\r\n                                <View style={{ width: 16, height: 16, borderRadius: 4, backgroundColor: \"#2196F3\" + \"40\" }} />\r\n                                <Text style={{ fontSize: 11, color: colors.textSecondary, fontFamily: \"DMSans-Medium\" }}>Excused</Text>\r\n                            </View>\r\n                        </View>\r\n                    </View>\r\n\r\n                    {/* Monthly Summary */}\r\n                    {summary?.monthlyBreakdown && summary.monthlyBreakdown.length > 0 && (\r\n                        <View style={{ marginTop: 24 }}>\r\n                            <Text style={{ fontSize: 18, fontFamily: \"DMSans-Bold\", color: colors.textPrimary, marginBottom: 12 }}>\r\n                                Monthly Summary\r\n                            </Text>\r\n                            {summary.monthlyBreakdown.slice(0, 6).map((month) => (\r\n                                <View\r\n                                    key={month.month}\r\n                                    style={{\r\n                                        backgroundColor: colors.cardBackground,\r\n                                        borderRadius: 12,\r\n                                        padding: 16,\r\n                                        marginBottom: 8,\r\n                                        flexDirection: \"row\",\r\n                                        justifyContent: \"space-between\",\r\n                                        alignItems: \"center\",\r\n                                        elevation: 1\r\n                                    }}\r\n                                >\r\n                                    <View>\r\n                                        <Text style={{ fontSize: 15, fontFamily: \"DMSans-SemiBold\", color: colors.textPrimary }}>\r\n                                            {month.month}\r\n                                        </Text>\r\n                                        <Text style={{ fontSize: 12, color: colors.textSecondary, marginTop: 2, fontFamily: \"DMSans-Regular\" }}>\r\n                                            {month.present} / {month.total} days\r\n                                        </Text>\r\n                                    </View>\r\n                                    <Text style={{\r\n                                        fontSize: 20,\r\n                                        fontFamily: \"DMSans-Bold\",\r\n                                        color: parseFloat(month.percentage) >= 75 ? colors.success : colors.error\r\n                                    }}>\r\n                                        {month.percentage}%\r\n                                    </Text>\r\n                                </View>\r\n                            ))}\r\n                        </View>\r\n                    )}\r\n                </View>\r\n            </ScrollView>\r\n        </View>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\components\\BottomNavigation.jsx","messages":[{"ruleId":"react/display-name","severity":2,"message":"Component definition is missing display name","line":138,"column":17,"nodeType":"CallExpression","messageId":"noDisplayName","endLine":236,"endColumn":3},{"ruleId":"no-unused-vars","severity":1,"message":"'mode' is defined but never used. Allowed unused args must match /^_/u.","line":138,"column":58,"nodeType":"Identifier","messageId":"unusedVar","endLine":138,"endColumn":62}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useMemo, useCallback, memo, useRef } from \"react\";\r\nimport { View, Text, Pressable, StyleSheet, Animated, Platform } from \"react-native\";\r\nimport { useRouter, usePathname } from \"expo-router\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport * as Haptics from \"expo-haptics\";\r\nimport { useTheme } from \"../theme\";\r\nimport { ROUTES } from \"../constants/routes\";\r\nimport AsyncStorage from '@react-native-async-storage/async-storage';\r\n\r\nfunction BottomNavigation() {\r\n  const router = useRouter();\r\n  const pathname = usePathname();\r\n  const { colors, mode } = useTheme();\r\n  const [activeTab, setActiveTab] = useState(ROUTES.HOME);\r\n  const [user, setUser] = useState(null);\r\n\r\n  // Load user only on mount - no need to reload on every pathname change\r\n  useEffect(() => {\r\n    const loadUser = async () => {\r\n      try {\r\n        const storedUser = await AsyncStorage.getItem('@auth_user');\r\n        if (storedUser) {\r\n          setUser(JSON.parse(storedUser));\r\n        } else {\r\n          setUser(null);\r\n        }\r\n      } catch (e) {\r\n        console.warn('Failed to load user', e);\r\n        setUser(null);\r\n      }\r\n    };\r\n    loadUser();\r\n  }, [pathname]); // Reload user when route changes (e.g. login/logout)\r\n\r\n  // Memoize navigation items to prevent recalculation on every render\r\n  const navigationItems = useMemo(() => [\r\n    {\r\n      route: ROUTES.HOME,\r\n      label: \"Home\",\r\n      icon: \"home\",\r\n    },\r\n    // Show My Class menu if user is a student\r\n    ...(user && user.role === 'student' ? [{\r\n      route: ROUTES.STUDENT_CLASS,\r\n      label: \"My Class\",\r\n      icon: \"school\",\r\n    }] : []),\r\n    // Show My Teach menu if user is a teacher\r\n    ...(user && (user.role === 'class teacher' || user.role === 'teacher' || user.role === 'staff') ? [{\r\n      route: ROUTES.TEACHER_CLASSES,\r\n      label: \"My Teach\",\r\n      icon: \"school\",\r\n    }] : []),\r\n    // Admin gets Admin tab first, then Classes tab\r\n    ...(user && (user.role === 'admin' || user.role === 'super admin') ? [{\r\n      route: ROUTES.ADMIN,\r\n      label: \"Admin\",\r\n      icon: \"admin-panel-settings\",\r\n    }, {\r\n      route: \"/admin/classes\",\r\n      label: \"Classes\",\r\n      icon: \"class\",\r\n    }] : []),\r\n    // Requests Tab - for logged-in students and teachers\r\n    ...(user && (user.role === 'student' || user.role === 'class teacher' || user.role === 'teacher' || user.role === 'staff' || user.role === 'admin' || user.role === 'super admin') ? [{\r\n      route: \"/requests\",\r\n      label: \"Attendance\",\r\n      icon: \"assignment\",\r\n    }] : []),\r\n\r\n    // Menu Tab\r\n    {\r\n      route: \"/menu\",\r\n      label: \"Menu\",\r\n      icon: \"grid-view\",\r\n    },\r\n  ], [user]);\r\n\r\n  useEffect(() => {\r\n    const matchingItem = navigationItems\r\n      .filter(item => item.route === '/' ? pathname === '/' : pathname.startsWith(item.route))\r\n      .sort((a, b) => b.route.length - a.route.length)[0];\r\n\r\n    if (matchingItem) {\r\n      setActiveTab(matchingItem.route);\r\n    }\r\n  }, [pathname, navigationItems]);\r\n\r\n  // Memoize handleTabPress to prevent creating new function on every render\r\n  const handleTabPress = useCallback((route) => {\r\n    // Haptic feedback for better UX\r\n    Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light).catch(() => { });\r\n\r\n    if (pathname === route) return;\r\n\r\n    // Use requestAnimationFrame to ensure the UI update (ripple effect) happens\r\n    // before the heavy navigation work starts\r\n    requestAnimationFrame(() => {\r\n      setActiveTab(route);\r\n      // Use replace instead of push to prevent stack buildup and memory leaks\r\n      router.replace(route);\r\n    });\r\n  }, [pathname, router]);\r\n\r\n  // Glassmorphism background color\r\n  const glassBackground = mode === 'dark'\r\n    ? 'rgba(30, 41, 59, 0.9)' // Darker slate\r\n    : 'rgba(255, 255, 255, 0.9)';\r\n\r\n  return (\r\n    <View style={styles.wrapper}>\r\n      <View style={[\r\n        styles.container,\r\n        {\r\n          backgroundColor: glassBackground,\r\n          borderColor: mode === 'dark' ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.05)',\r\n        }\r\n      ]}>\r\n        {navigationItems.map((item) => {\r\n          const isActive = activeTab === item.route;\r\n          return (\r\n            <TabItem\r\n              key={item.label}\r\n              item={item}\r\n              isActive={isActive}\r\n              onPress={() => handleTabPress(item.route)}\r\n              colors={colors}\r\n              mode={mode}\r\n            />\r\n          );\r\n        })}\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\n// Separate TabItem component for better performance and animations\r\nconst TabItem = memo(({ item, isActive, onPress, colors, mode }) => {\r\n  const scaleAnim = useRef(new Animated.Value(1)).current;\r\n  const iconScaleAnim = useRef(new Animated.Value(1)).current;\r\n\r\n  // Animate on press\r\n  const handlePressIn = () => {\r\n    Animated.spring(scaleAnim, {\r\n      toValue: 0.9,\r\n      useNativeDriver: true,\r\n      tension: 300,\r\n      friction: 10,\r\n    }).start();\r\n  };\r\n\r\n  const handlePressOut = () => {\r\n    Animated.spring(scaleAnim, {\r\n      toValue: 1,\r\n      useNativeDriver: true,\r\n      tension: 300,\r\n      friction: 10,\r\n    }).start();\r\n  };\r\n\r\n  // Animate icon when active state changes\r\n  useEffect(() => {\r\n    Animated.sequence([\r\n      Animated.spring(iconScaleAnim, {\r\n        toValue: isActive ? 1.15 : 1,\r\n        useNativeDriver: true,\r\n        tension: 300,\r\n        friction: 8,\r\n      }),\r\n      Animated.spring(iconScaleAnim, {\r\n        toValue: 1,\r\n        useNativeDriver: true,\r\n        tension: 300,\r\n        friction: 8,\r\n      }),\r\n    ]).start();\r\n  }, [isActive]);\r\n\r\n  const activePillBackground = colors.primaryLight;\r\n\r\n  return (\r\n    <Animated.View style={{ transform: [{ scale: scaleAnim }] }}>\r\n      <Pressable\r\n        onPress={onPress}\r\n        onPressIn={handlePressIn}\r\n        onPressOut={handlePressOut}\r\n        style={styles.tabItem}\r\n        hitSlop={{ top: 8, bottom: 8, left: 4, right: 4 }}\r\n      >\r\n        {/* Active Pill Background */}\r\n        {isActive && (\r\n          <View style={[\r\n            styles.activePill,\r\n            { backgroundColor: activePillBackground }\r\n          ]} />\r\n        )}\r\n\r\n        {/* Icon with glow effect */}\r\n        <Animated.View\r\n          style={[\r\n            styles.iconContainer,\r\n            isActive && {\r\n              shadowColor: colors.primary,\r\n              shadowOffset: { width: 0, height: 0 },\r\n              shadowOpacity: 0.4,\r\n              shadowRadius: 8,\r\n              elevation: 4,\r\n            },\r\n            { transform: [{ scale: iconScaleAnim }] }\r\n          ]}\r\n        >\r\n          <MaterialIcons\r\n            name={item.icon}\r\n            size={24}\r\n            color={isActive ? colors.primary : colors.textSecondary}\r\n          />\r\n        </Animated.View>\r\n\r\n        {/* Label */}\r\n        <Text\r\n          style={[\r\n            styles.label,\r\n            {\r\n              color: isActive ? colors.primary : colors.textSecondary,\r\n              fontFamily: isActive ? \"DMSans-Bold\" : \"DMSans-Regular\",\r\n              opacity: isActive ? 1 : 0.7,\r\n            }\r\n          ]}\r\n          numberOfLines={1}\r\n        >\r\n          {item.label}\r\n        </Text>\r\n      </Pressable>\r\n    </Animated.View>\r\n  );\r\n});\r\n\r\n// Export memoized component to prevent unnecessary re-renders\r\nexport default memo(BottomNavigation);\r\n\r\nconst styles = StyleSheet.create({\r\n  wrapper: {\r\n    position: \"absolute\",\r\n    bottom: 0,\r\n    left: 0,\r\n    right: 0,\r\n    paddingHorizontal: 16,\r\n    paddingBottom: Platform.OS === 'ios' ? 24 : 20,\r\n  },\r\n  container: {\r\n    flexDirection: \"row\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"space-around\",\r\n    paddingVertical: 12,\r\n    paddingHorizontal: 8,\r\n    borderRadius: 24,\r\n    borderWidth: 1,\r\n    // Enhanced shadow for floating effect\r\n    shadowColor: \"#000\",\r\n    shadowOffset: { width: 0, height: 8 },\r\n    shadowOpacity: 0.15,\r\n    shadowRadius: 16,\r\n    elevation: 12,\r\n    // Backdrop blur simulation\r\n    overflow: 'hidden',\r\n  },\r\n  tabItem: {\r\n    flex: 1,\r\n    alignItems: \"center\",\r\n    justifyContent: \"center\",\r\n    paddingVertical: 8,\r\n    paddingHorizontal: 4,\r\n    position: \"relative\",\r\n  },\r\n  activePill: {\r\n    position: \"absolute\",\r\n    top: 0,\r\n    left: -4,\r\n    right: -4,\r\n    bottom: 0,\r\n    borderRadius: 16,\r\n    zIndex: 0,\r\n  },\r\n  iconContainer: {\r\n    marginBottom: 4,\r\n    zIndex: 1,\r\n  },\r\n  label: {\r\n    fontSize: 10,\r\n    letterSpacing: 0.5,\r\n    textAlign: 'center',\r\n    zIndex: 1,\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\components\\ErrorBoundary.jsx","messages":[{"ruleId":null,"fatal":true,"severity":2,"message":"Parsing error: Unexpected token =","line":22,"column":18,"nodeType":null}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { View, Text, StyleSheet, TouchableOpacity, ScrollView } from 'react-native';\r\nimport { MaterialIcons } from '@expo/vector-icons';\r\n\r\nclass ErrorBoundary extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { hasError: false, error: null, errorInfo: null };\r\n  }\r\n\r\n  static getDerivedStateFromError(error) {\r\n    // Update state so the next render will show the fallback UI.\r\n    return { hasError: true, error };\r\n  }\r\n\r\n  componentDidCatch(error, errorInfo) {\r\n    // You can also log the error to an error reporting service\r\n    console.error(\"Uncaught error:\", error, errorInfo);\r\n    this.setState({ errorInfo });\r\n  }\r\n\r\n  handleTryAgain = () => {\r\n    // Attempt to recover by resetting state\r\n    this.setState({ hasError: false, error: null, errorInfo: null });\r\n  };\r\n\r\n  render() {\r\n    if (this.state.hasError) {\r\n      // You can render any custom fallback UI\r\n      return (\r\n        <View style={styles.container}>\r\n          <View style={styles.content}>\r\n            <MaterialIcons name=\"error\" size={64} color=\"#FF6B6B\" />\r\n            <Text style={styles.title}>Oops! Something went wrong.</Text>\r\n            <Text style={styles.subtitle}>\r\n              We're sorry, but an unexpected error occurred. Please try again.\r\n            </Text>\r\n            \r\n            <TouchableOpacity style={styles.button} onPress={this.handleTryAgain}>\r\n              <Text style={styles.buttonText}>Try Again</Text>\r\n            </TouchableOpacity>\r\n\r\n            {/* Optional: Show error details in development */}\r\n            {__DEV__ && this.state.error && (\r\n              <ScrollView style={styles.debugBox}>\r\n                <Text style={styles.debugText}>{this.state.error.toString()}</Text>\r\n              </ScrollView>\r\n            )}\r\n          </View>\r\n        </View>\r\n      );\r\n    }\r\n\r\n    return this.props.children;\r\n  }\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: '#fff',\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n    padding: 20,\r\n  },\r\n  content: {\r\n    alignItems: 'center',\r\n    maxWidth: 400,\r\n    width: '100%',\r\n  },\r\n  title: {\r\n    fontSize: 24,\r\n    fontWeight: 'bold',\r\n    color: '#333',\r\n    marginTop: 20,\r\n    marginBottom: 10,\r\n    textAlign: 'center',\r\n  },\r\n  subtitle: {\r\n    fontSize: 16,\r\n    color: '#666',\r\n    textAlign: 'center',\r\n    marginBottom: 30,\r\n    lineHeight: 24,\r\n  },\r\n  button: {\r\n    backgroundColor: '#4A90E2',\r\n    paddingVertical: 12,\r\n    paddingHorizontal: 30,\r\n    borderRadius: 25,\r\n    elevation: 3,\r\n    shadowColor: '#000',\r\n    shadowOffset: { width: 0, height: 2 },\r\n    shadowOpacity: 0.2,\r\n    shadowRadius: 4,\r\n  },\r\n  buttonText: {\r\n    color: '#fff',\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n  },\r\n  debugBox: {\r\n    marginTop: 30,\r\n    padding: 10,\r\n    backgroundColor: '#f5f5f5',\r\n    borderRadius: 5,\r\n    width: '100%',\r\n    maxHeight: 200,\r\n  },\r\n  debugText: {\r\n    color: '#d63031',\r\n    fontFamily: 'monospace',\r\n    fontSize: 12,\r\n  },\r\n});\r\n\r\nexport default ErrorBoundary;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\components\\EventFormModal.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'AsyncStorage' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'apiConfig' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'apiFetch' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":16},{"ruleId":"no-unused-vars","severity":1,"message":"'setLoading' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":34,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":29},{"ruleId":"no-unused-vars","severity":1,"message":"'showToast' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":38,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":38,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { View, Text, TextInput, Modal, Pressable, StyleSheet } from 'react-native';\r\nimport { MaterialIcons } from '@expo/vector-icons';\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useTheme } from '../theme';\r\nimport { useToast } from './ToastProvider';\r\nimport apiConfig from '../config/apiConfig';\r\nimport apiFetch from '../utils/apiFetch';\r\n\r\n\r\n// Helper to format dates for display in Indian format (DD-MM-YYYY)\r\nconst formatIndianDate = (dateInput) => {\r\n  if (!dateInput) return \"\";\r\n  try {\r\n    // handle yyyy-mm-dd strings (selectedDate from calendar) by forcing midnight\r\n    const d =\r\n      typeof dateInput === \"string\" && /^\\d{4}-\\d{2}-\\d{2}$/.test(dateInput)\r\n        ? new Date(dateInput + \"T00:00:00\")\r\n        : new Date(dateInput);\r\n    if (isNaN(d)) return String(dateInput);\r\n    const day = String(d.getDate()).padStart(2, \"0\");\r\n    const month = String(d.getMonth() + 1).padStart(2, \"0\");\r\n    const year = d.getFullYear();\r\n    return `${day}-${month}-${year}`;\r\n  } catch (e) {\r\n    return String(dateInput);\r\n  }\r\n};\r\n\r\nexport default function EventFormModal({ isVisible, onClose, selectedDate, onSuccess, editItem = null }) {\r\n  const [title, setTitle] = useState('');\r\n  const [description, setDescription] = useState('');\r\n  const [isSchoolEvent, setIsSchoolEvent] = useState(false);\r\n  const [loading, setLoading] = useState(false);\r\n  const [errors, setErrors] = useState({});\r\n  const [touched, setTouched] = useState({});\r\n  const { colors, styles: globalStyles } = useTheme();\r\n  const { showToast } = useToast();\r\n\r\n  const isEditing = !!editItem;\r\n\r\n  useEffect(() => {\r\n    if (isVisible) {\r\n      if (isEditing && editItem) {\r\n        setTitle(editItem.title || '');\r\n        setDescription(editItem.description || '');\r\n        setIsSchoolEvent(editItem.isSchoolEvent !== undefined ? editItem.isSchoolEvent : false);\r\n      } else {\r\n        setTitle('');\r\n        setDescription('');\r\n        setIsSchoolEvent(false);\r\n      }\r\n      setErrors({});\r\n      setTouched({});\r\n    }\r\n  }, [isVisible, isEditing, editItem]);\r\n\r\n  const validateField = (name, value) => {\r\n    let error = \"\";\r\n    switch (name) {\r\n      case \"title\":\r\n        if (!value.trim()) error = \"Title is required\";\r\n        else if (value.trim().length < 3) error = \"Title must be at least 3 characters\";\r\n        break;\r\n      case \"description\":\r\n        if (value.trim() && value.trim().length < 10) error = \"Description must be at least 10 characters if provided\";\r\n        break;\r\n    }\r\n    return error;\r\n  };\r\n\r\n  const handleBlur = (field, value) => {\r\n    setTouched(prev => ({ ...prev, [field]: true }));\r\n    const error = validateField(field, value);\r\n    setErrors(prev => ({ ...prev, [field]: error }));\r\n  };\r\n\r\n  const handleChange = (field, value) => {\r\n    if (field === 'title') setTitle(value);\r\n    if (field === 'description') setDescription(value);\r\n\r\n    if (touched[field]) {\r\n      const error = validateField(field, value);\r\n      setErrors(prev => ({ ...prev, [field]: error }));\r\n    }\r\n  };\r\n\r\n  const handleSubmit = () => {\r\n    const titleError = validateField(\"title\", title);\r\n    const descriptionError = validateField(\"description\", description);\r\n\r\n    setErrors({\r\n      title: titleError,\r\n      description: descriptionError\r\n    });\r\n    setTouched({\r\n      title: true,\r\n      description: true\r\n    });\r\n\r\n    if (titleError || descriptionError) {\r\n      return;\r\n    }\r\n\r\n    // Pass data to parent component\r\n    onSuccess({\r\n      title: title.trim(),\r\n      date: isEditing ? editItem.date : selectedDate,\r\n      description: description.trim(),\r\n      isSchoolEvent: isSchoolEvent,\r\n      _id: editItem?._id // Pass ID if editing\r\n    });\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      visible={isVisible}\r\n      transparent\r\n      animationType=\"fade\"\r\n      onRequestClose={onClose}\r\n    >\r\n      <View style={styles.overlay}>\r\n        <View style={[styles.container, { backgroundColor: colors.cardBackground }]}>\r\n          <View style={styles.header}>\r\n            <Text style={[globalStyles.title, { fontSize: 20, color: colors.textPrimary }]}>\r\n              {isEditing ? 'Edit Event' : 'New Event'}\r\n            </Text>\r\n            <Pressable onPress={onClose} hitSlop={8}>\r\n              <MaterialIcons name=\"close\" size={24} color={colors.textSecondary} />\r\n            </Pressable>\r\n          </View>\r\n\r\n          <View style={styles.dateRow}>\r\n            <Text style={[styles.dateLabel, { color: colors.textSecondary }]}>Date:</Text>\r\n            <Text style={[styles.dateValue, { color: colors.textPrimary }]}>{isEditing ? formatIndianDate(editItem.date) : formatIndianDate(selectedDate)}</Text>\r\n          </View>\r\n\r\n          <View style={{ marginBottom: 12 }}>\r\n            <Text style={{ fontSize: 13, fontWeight: \"600\", color: colors.textSecondary, marginBottom: 8, marginLeft: 4 }}>TITLE</Text>\r\n            <TextInput\r\n              style={[globalStyles.input, {\r\n                backgroundColor: colors.cardBackground,\r\n                color: colors.textPrimary,\r\n                borderColor: errors.title && touched.title ? colors.error : colors.border,\r\n                borderWidth: 1\r\n              }]}\r\n              placeholder=\"Event title\"\r\n              placeholderTextColor={colors.textSecondary}\r\n              value={title}\r\n              onChangeText={(text) => handleChange('title', text)}\r\n              onBlur={() => handleBlur('title', title)}\r\n              maxLength={100}\r\n            />\r\n            {errors.title && touched.title && (\r\n              <Text style={{ color: colors.error, fontSize: 12, marginTop: 4, marginLeft: 4 }}>{errors.title}</Text>\r\n            )}\r\n          </View>\r\n\r\n          <View style={{ marginBottom: 12 }}>\r\n            <Text style={{ fontSize: 13, fontWeight: \"600\", color: colors.textSecondary, marginBottom: 8, marginLeft: 4 }}>DESCRIPTION (OPTIONAL)</Text>\r\n            <TextInput\r\n              style={[globalStyles.input, {\r\n                backgroundColor: colors.cardBackground,\r\n                color: colors.textPrimary,\r\n                borderColor: errors.description && touched.description ? colors.error : colors.border,\r\n                borderWidth: 1,\r\n                minHeight: 100,\r\n                paddingTop: 12,\r\n              }]}\r\n              placeholder=\"Description (optional)\"\r\n              placeholderTextColor={colors.textSecondary}\r\n              value={description}\r\n              onChangeText={(text) => handleChange('description', text)}\r\n              onBlur={() => handleBlur('description', description)}\r\n              maxLength={500}\r\n              multiline\r\n            />\r\n            {errors.description && touched.description && (\r\n              <Text style={{ color: colors.error, fontSize: 12, marginTop: 4, marginLeft: 4 }}>{errors.description}</Text>\r\n            )}\r\n          </View>\r\n\r\n          <Pressable\r\n            style={{ marginBottom: 16, flexDirection: 'row', alignItems: 'center' }}\r\n            onPress={() => setIsSchoolEvent(!isSchoolEvent)}\r\n          >\r\n            <MaterialIcons\r\n              name={isSchoolEvent ? \"check-box\" : \"check-box-outline-blank\"}\r\n              size={24}\r\n              color={colors.primary}\r\n              style={{ marginRight: 8 }}\r\n            />\r\n            <Text style={[globalStyles.cardText, { color: colors.textPrimary }]}>Mark as School Event</Text>\r\n          </Pressable>\r\n\r\n          <Pressable\r\n            style={[globalStyles.buttonLarge, { width: \"100%\", backgroundColor: colors.primary }, loading && { opacity: 0.6 }]}\r\n            onPress={handleSubmit}\r\n            disabled={loading}\r\n          >\r\n            <Text style={[globalStyles.buttonText, { color: colors.white }]}>\r\n              {isEditing ? 'Update Event' : 'Create Event'}\r\n            </Text>\r\n          </Pressable>\r\n        </View>\r\n      </View>\r\n    </Modal>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  overlay: {\r\n    flex: 1,\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n    backgroundColor: 'rgba(0,0,0,0.6)',\r\n    padding: 20,\r\n  },\r\n  container: {\r\n    width: '100%',\r\n    maxWidth: 400,\r\n    padding: 24,\r\n    borderRadius: 20,\r\n    elevation: 8,\r\n    shadowColor: '#000',\r\n    shadowOffset: { width: 0, height: 4 },\r\n    shadowOpacity: 0.3,\r\n    shadowRadius: 12,\r\n  },\r\n  header: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-between',\r\n    alignItems: 'center',\r\n    marginBottom: 20,\r\n  },\r\n  dateRow: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    marginBottom: 16,\r\n    padding: 12,\r\n    borderRadius: 12,\r\n    backgroundColor: 'rgba(0,0,0,0.03)',\r\n  },\r\n  dateLabel: {\r\n    fontSize: 14,\r\n    fontWeight: '500',\r\n    marginRight: 8,\r\n  },\r\n  dateValue: {\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\components\\Header.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\components\\ModernCalendar.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Text' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'StyleSheet' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":32},{"ruleId":"no-unused-vars","severity":1,"message":"'Pressable' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":43}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo } from 'react';\r\nimport { View, Text, StyleSheet, Pressable } from 'react-native';\r\nimport { Calendar } from 'react-native-calendars';\r\nimport { MaterialIcons } from '@expo/vector-icons';\r\nimport { useTheme } from '../theme';\r\n\r\nconst ModernCalendar = ({\r\n    current,\r\n    onDayPress,\r\n    markedDates,\r\n    onMonthChange,\r\n    dayComponent,\r\n    style,\r\n    markingType,\r\n    theme: customTheme,\r\n}) => {\r\n    const { colors, styles } = useTheme();\r\n\r\n    const defaultTheme = useMemo(() => ({\r\n        backgroundColor: colors.cardBackground,\r\n        calendarBackground: colors.cardBackground,\r\n        textSectionTitleColor: colors.textSecondary,\r\n        selectedDayBackgroundColor: colors.primary,\r\n        selectedDayTextColor: colors.white,\r\n        todayTextColor: colors.primary,\r\n        dayTextColor: colors.textPrimary,\r\n        textDisabledColor: colors.textSecondary + '50',\r\n        dotColor: colors.primary,\r\n        selectedDotColor: colors.white,\r\n        arrowColor: colors.primary,\r\n        monthTextColor: colors.textPrimary,\r\n        indicatorColor: colors.primary,\r\n        textDayFontFamily: 'DMSans-Medium',\r\n        textMonthFontFamily: 'DMSans-Bold',\r\n        textDayHeaderFontFamily: 'DMSans-Bold',\r\n        textDayFontSize: 14,\r\n        textMonthFontSize: 16,\r\n        textDayHeaderFontSize: 12,\r\n        'stylesheet.calendar.header': {\r\n            header: {\r\n                flexDirection: 'row',\r\n                justifyContent: 'space-between',\r\n                paddingLeft: 10,\r\n                paddingRight: 10,\r\n                marginTop: 6,\r\n                marginBottom: 6,\r\n                alignItems: 'center',\r\n            },\r\n            monthText: {\r\n                fontSize: 18,\r\n                fontFamily: 'DMSans-Bold',\r\n                color: colors.textPrimary,\r\n                margin: 10,\r\n            },\r\n            arrow: {\r\n                padding: 10,\r\n            },\r\n        },\r\n        'stylesheet.day.basic': {\r\n            base: {\r\n                width: 32,\r\n                height: 32,\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n            },\r\n        },\r\n    }), [colors]);\r\n\r\n    return (\r\n        <View style={[styles.cardMinimal, { padding: 0, overflow: 'hidden' }, style]}>\r\n            <Calendar\r\n                current={current}\r\n                onDayPress={onDayPress}\r\n                markedDates={markedDates}\r\n                onMonthChange={onMonthChange}\r\n                dayComponent={dayComponent}\r\n                markingType={markingType}\r\n                theme={{ ...defaultTheme, ...customTheme }}\r\n                enableSwipeMonths={true}\r\n                hideExtraDays={false}\r\n                renderArrow={(direction) => (\r\n                    <View style={{\r\n                        backgroundColor: colors.background,\r\n                        borderRadius: 8,\r\n                        padding: 4,\r\n                    }}>\r\n                        <MaterialIcons\r\n                            name={direction === 'left' ? 'chevron-left' : 'chevron-right'}\r\n                            size={20}\r\n                            color={colors.textPrimary}\r\n                        />\r\n                    </View>\r\n                )}\r\n            />\r\n        </View>\r\n    );\r\n};\r\n\r\nexport default ModernCalendar;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\components\\ModernTimePicker.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Platform' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":40,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":48}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { View, Text, Modal, Pressable, Platform, StyleSheet } from 'react-native';\r\nimport DateTimePicker from '@react-native-community/datetimepicker';\r\nimport { useTheme } from '../theme';\r\n\r\n/**\r\n * ModernTimePicker\r\n * A consistent, minimalist time picker that uses a modal with a spinner style on both platforms.\r\n * \r\n * @param {boolean} visible - Whether the picker is visible\r\n * @param {Function} onClose - Callback when closed/cancelled\r\n * @param {Function} onConfirm - Callback when time is selected (returns Date object)\r\n * @param {Date} value - Current/Initial time value\r\n * @param {string} title - Optional title for the header\r\n */\r\nexport default function ModernTimePicker({ visible, onClose, onConfirm, value, title = \"Select Time\" }) {\r\n    const { colors } = useTheme();\r\n    const [tempDate, setTempDate] = useState(value || new Date());\r\n\r\n    useEffect(() => {\r\n        if (visible && value) {\r\n            setTempDate(value);\r\n        }\r\n    }, [visible, value]);\r\n\r\n    const handleChange = (event, selectedDate) => {\r\n        if (selectedDate) {\r\n            setTempDate(selectedDate);\r\n        }\r\n    };\r\n\r\n    const handleConfirm = () => {\r\n        onConfirm(tempDate);\r\n        onClose();\r\n    };\r\n\r\n    if (!visible) return null;\r\n\r\n    return (\r\n        <Modal\r\n            animationType=\"fade\"\r\n            transparent={true}\r\n            visible={visible}\r\n            onRequestClose={onClose}\r\n        >\r\n            <Pressable style={styles.overlay} onPress={onClose}>\r\n                <Pressable style={[styles.container, { backgroundColor: colors.cardBackground }]} onPress={e => e.stopPropagation()}>\r\n                    {/* Header */}\r\n                    <View style={[styles.header, { borderBottomColor: colors.border }]}>\r\n                        <Text style={[styles.title, { color: colors.textPrimary }]}>{title}</Text>\r\n                    </View>\r\n\r\n                    {/* Picker */}\r\n                    <View style={styles.pickerContainer}>\r\n                        <DateTimePicker\r\n                            value={tempDate}\r\n                            mode=\"time\"\r\n                            display=\"spinner\"\r\n                            onChange={handleChange}\r\n                            textColor={colors.textPrimary}\r\n                            themeVariant={colors.dark ? \"dark\" : \"light\"}\r\n                            style={styles.picker}\r\n                        />\r\n                    </View>\r\n\r\n                    {/* Footer Actions */}\r\n                    <View style={[styles.footer, { borderTopColor: colors.border }]}>\r\n                        <Pressable onPress={onClose} style={[styles.button, styles.cancelButton]}>\r\n                            <Text style={[styles.buttonText, { color: colors.textSecondary }]}>Cancel</Text>\r\n                        </Pressable>\r\n                        <Pressable onPress={handleConfirm} style={[styles.button, { backgroundColor: colors.primary }]}>\r\n                            <Text style={[styles.buttonText, { color: '#fff' }]}>Confirm</Text>\r\n                        </Pressable>\r\n                    </View>\r\n                </Pressable>\r\n            </Pressable>\r\n        </Modal>\r\n    );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n    overlay: {\r\n        flex: 1,\r\n        backgroundColor: 'rgba(0, 0, 0, 0.5)',\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n        padding: 20,\r\n    },\r\n    container: {\r\n        width: '90%',\r\n        maxWidth: 340,\r\n        borderRadius: 20,\r\n        overflow: 'hidden',\r\n        shadowColor: \"#000\",\r\n        shadowOffset: {\r\n            width: 0,\r\n            height: 2,\r\n        },\r\n        shadowOpacity: 0.25,\r\n        shadowRadius: 3.84,\r\n        elevation: 5,\r\n    },\r\n    header: {\r\n        padding: 16,\r\n        alignItems: 'center',\r\n        borderBottomWidth: 1,\r\n    },\r\n    title: {\r\n        fontSize: 18,\r\n        fontFamily: 'DMSans-Bold',\r\n    },\r\n    pickerContainer: {\r\n        paddingVertical: 10,\r\n        alignItems: 'center',\r\n        justifyContent: 'center',\r\n    },\r\n    picker: {\r\n        height: 180,\r\n        width: '100%',\r\n    },\r\n    footer: {\r\n        flexDirection: 'row',\r\n        padding: 16,\r\n        gap: 12,\r\n        borderTopWidth: 1,\r\n    },\r\n    button: {\r\n        flex: 1,\r\n        paddingVertical: 12,\r\n        borderRadius: 12,\r\n        alignItems: 'center',\r\n        justifyContent: 'center',\r\n    },\r\n    cancelButton: {\r\n        backgroundColor: 'transparent',\r\n    },\r\n    buttonText: {\r\n        fontSize: 16,\r\n        fontFamily: 'DMSans-Bold',\r\n    }\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\components\\NetworkStatusProvider.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\components\\NewsFormModal.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'AsyncStorage' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'apiConfig' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'apiFetch' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":16},{"ruleId":"no-unused-vars","severity":1,"message":"'setLoading' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":16,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":29},{"ruleId":"no-unused-vars","severity":1,"message":"'showToast' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":20,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { View, Text, TextInput, Modal, Pressable, StyleSheet } from 'react-native';\r\nimport { MaterialIcons } from '@expo/vector-icons';\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { useTheme } from '../theme';\r\nimport { useToast } from './ToastProvider';\r\nimport apiConfig from '../config/apiConfig';\r\nimport apiFetch from '../utils/apiFetch';\r\n\r\n\r\nexport default function NewsFormModal({ isVisible, onClose, onSubmit, editItem = null }) {\r\n  const [title, setTitle] = useState('');\r\n  const [description, setDescription] = useState('');\r\n  const [url, setUrl] = useState('');\r\n  const [privateNews, setPrivateNews] = useState(true);\r\n  const [loading, setLoading] = useState(false);\r\n  const [errors, setErrors] = useState({});\r\n  const [touched, setTouched] = useState({});\r\n  const { colors, styles: globalStyles } = useTheme();\r\n  const { showToast } = useToast();\r\n\r\n  const isEditing = !!editItem;\r\n\r\n  useEffect(() => {\r\n    if (isVisible) {\r\n      if (isEditing && editItem) {\r\n        setTitle(editItem.title || '');\r\n        setDescription(editItem.description || '');\r\n        setUrl(editItem.url || '');\r\n        setPrivateNews(editItem.privateNews !== undefined ? editItem.privateNews : true);\r\n      } else {\r\n        setTitle('');\r\n        setDescription('');\r\n        setUrl('');\r\n        setPrivateNews(true);\r\n      }\r\n      setErrors({});\r\n      setTouched({});\r\n    }\r\n  }, [isVisible, isEditing, editItem]);\r\n\r\n  const validateField = (name, value) => {\r\n    let error = \"\";\r\n    switch (name) {\r\n      case \"title\":\r\n        if (!value.trim()) error = \"Title is required\";\r\n        else if (value.trim().length < 3) error = \"Title must be at least 3 characters\";\r\n        break;\r\n      case \"description\":\r\n        if (!value.trim()) error = \"Description is required\";\r\n        else if (value.trim().length < 10) error = \"Description must be at least 10 characters\";\r\n        break;\r\n      case \"url\":\r\n        // No validation - accept any input\r\n        break;\r\n    }\r\n    return error;\r\n  };\r\n\r\n  const handleBlur = (field, value) => {\r\n    setTouched(prev => ({ ...prev, [field]: true }));\r\n    const error = validateField(field, value);\r\n    setErrors(prev => ({ ...prev, [field]: error }));\r\n  };\r\n\r\n  const handleChange = (field, value) => {\r\n    if (field === 'title') setTitle(value);\r\n    if (field === 'description') setDescription(value);\r\n    if (field === 'url') setUrl(value);\r\n\r\n    if (touched[field]) {\r\n      const error = validateField(field, value);\r\n      setErrors(prev => ({ ...prev, [field]: error }));\r\n    }\r\n  };\r\n\r\n  const handleSubmit = () => {\r\n    const titleError = validateField(\"title\", title);\r\n    const descriptionError = validateField(\"description\", description);\r\n    const urlError = validateField(\"url\", url);\r\n\r\n    setErrors({\r\n      title: titleError,\r\n      description: descriptionError,\r\n      url: urlError\r\n    });\r\n    setTouched({\r\n      title: true,\r\n      description: true,\r\n      url: true\r\n    });\r\n\r\n    if (titleError || descriptionError || urlError) {\r\n      return;\r\n    }\r\n\r\n    // Pass data to parent component\r\n    onSubmit({\r\n      title: title.trim(),\r\n      description: description.trim(),\r\n      url: url.trim() || undefined,\r\n      privateNews: privateNews,\r\n      _id: editItem?._id // Pass ID if editing\r\n    });\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      visible={isVisible}\r\n      transparent\r\n      animationType=\"fade\"\r\n      onRequestClose={onClose}\r\n    >\r\n      <View style={styles.overlay}>\r\n        <View style={[styles.container, { backgroundColor: colors.cardBackground }]}>\r\n          <View style={styles.header}>\r\n            <Text style={[globalStyles.title, { fontSize: 20, color: colors.textPrimary }]}>\r\n              {isEditing ? 'Edit News' : 'Add News'}\r\n            </Text>\r\n            <Pressable onPress={onClose} hitSlop={8}>\r\n              <MaterialIcons name=\"close\" size={24} color={colors.textSecondary} />\r\n            </Pressable>\r\n          </View>\r\n\r\n          <View style={{ marginBottom: 12 }}>\r\n            <Text style={{ fontSize: 13, fontWeight: \"600\", color: colors.textSecondary, marginBottom: 8, marginLeft: 4 }}>TITLE</Text>\r\n            <TextInput\r\n              style={[globalStyles.input, {\r\n                backgroundColor: colors.cardBackground,\r\n                color: colors.textPrimary,\r\n                borderColor: errors.title && touched.title ? colors.error : colors.border,\r\n                borderWidth: 1\r\n              }]}\r\n              placeholder=\"News title\"\r\n              placeholderTextColor={colors.textSecondary}\r\n              value={title}\r\n              onChangeText={(text) => handleChange('title', text)}\r\n              onBlur={() => handleBlur('title', title)}\r\n              maxLength={100}\r\n            />\r\n            {errors.title && touched.title && (\r\n              <Text style={{ color: colors.error, fontSize: 12, marginTop: 4, marginLeft: 4 }}>{errors.title}</Text>\r\n            )}\r\n          </View>\r\n\r\n          <View style={{ marginBottom: 12 }}>\r\n            <Text style={{ fontSize: 13, fontWeight: \"600\", color: colors.textSecondary, marginBottom: 8, marginLeft: 4 }}>DESCRIPTION</Text>\r\n            <TextInput\r\n              style={[globalStyles.input, {\r\n                backgroundColor: colors.cardBackground,\r\n                color: colors.textPrimary,\r\n                borderColor: errors.description && touched.description ? colors.error : colors.border,\r\n                borderWidth: 1,\r\n                minHeight: 100,\r\n                paddingTop: 12,\r\n              }]}\r\n              placeholder=\"Description\"\r\n              placeholderTextColor={colors.textSecondary}\r\n              value={description}\r\n              onChangeText={(text) => handleChange('description', text)}\r\n              onBlur={() => handleBlur('description', description)}\r\n              multiline\r\n              numberOfLines={4}\r\n              maxLength={500}\r\n            />\r\n            {errors.description && touched.description && (\r\n              <Text style={{ color: colors.error, fontSize: 12, marginTop: 4, marginLeft: 4 }}>{errors.description}</Text>\r\n            )}\r\n          </View>\r\n\r\n          <View style={{ marginBottom: 16 }}>\r\n            <Text style={{ fontSize: 13, fontWeight: \"600\", color: colors.textSecondary, marginBottom: 8, marginLeft: 4 }}>URL (OPTIONAL)</Text>\r\n            <TextInput\r\n              style={[globalStyles.input, {\r\n                backgroundColor: colors.cardBackground,\r\n                color: colors.textPrimary,\r\n                borderColor: errors.url && touched.url ? colors.error : colors.border,\r\n                borderWidth: 1\r\n              }]}\r\n              placeholder=\"https://example.com\"\r\n              placeholderTextColor={colors.textSecondary}\r\n              value={url}\r\n              onChangeText={(text) => handleChange('url', text)}\r\n              onBlur={() => handleBlur('url', url)}\r\n              maxLength={200}\r\n              autoCapitalize=\"none\"\r\n              keyboardType=\"url\"\r\n            />\r\n            {errors.url && touched.url && (\r\n              <Text style={{ color: colors.error, fontSize: 12, marginTop: 4, marginLeft: 4 }}>{errors.url}</Text>\r\n            )}\r\n          </View>\r\n\r\n          <Pressable\r\n            style={{ marginBottom: 16, flexDirection: 'row', alignItems: 'center' }}\r\n            onPress={() => setPrivateNews(!privateNews)}\r\n          >\r\n            <MaterialIcons\r\n              name={privateNews ? \"check-box\" : \"check-box-outline-blank\"}\r\n              size={24}\r\n              color={colors.primary}\r\n              style={{ marginRight: 8 }}\r\n            />\r\n            <Text style={[globalStyles.cardText, { color: colors.textPrimary }]}>Private News</Text>\r\n          </Pressable>\r\n\r\n          <Pressable\r\n            style={[globalStyles.buttonLarge, { width: \"100%\", backgroundColor: colors.primary }, loading && { opacity: 0.6 }]}\r\n            onPress={handleSubmit}\r\n            disabled={loading}\r\n          >\r\n            <Text style={[globalStyles.buttonText, { color: colors.white }]}>\r\n              {isEditing ? 'Update News' : 'Create News'}\r\n            </Text>\r\n          </Pressable>\r\n        </View>\r\n      </View>\r\n    </Modal>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  overlay: {\r\n    flex: 1,\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n    backgroundColor: 'rgba(0,0,0,0.6)',\r\n    padding: 20,\r\n  },\r\n  container: {\r\n    width: '100%',\r\n    maxWidth: 400,\r\n    padding: 24,\r\n    borderRadius: 20,\r\n    elevation: 8,\r\n    shadowColor: '#000',\r\n    shadowOffset: { width: 0, height: 4 },\r\n    shadowOpacity: 0.3,\r\n    shadowRadius: 12,\r\n  },\r\n  header: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-between',\r\n    alignItems: 'center',\r\n    marginBottom: 20,\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\components\\PostContentModal.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'ScrollView' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":15},{"ruleId":"no-unused-vars","severity":1,"message":"'MaterialIcons' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'styles' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":14,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from \"react\";\r\nimport {\r\n    View,\r\n    Text,\r\n    Modal,\r\n    TextInput,\r\n    Pressable,\r\n    ScrollView,\r\n} from \"react-native\";\r\nimport { MaterialIcons } from \"@expo/vector-icons\";\r\nimport { useTheme } from \"../theme\";\r\n\r\nexport default function PostContentModal({ visible, onClose, onSubmit }) {\r\n    const { styles, colors } = useTheme();\r\n    const [form, setForm] = useState({\r\n        title: \"\",\r\n        description: \"\",\r\n        type: \"note\", // note, homework, news\r\n    });\r\n\r\n    const handleSubmit = () => {\r\n        if (!form.title || !form.description) {\r\n            // Basic validation, parent can do more\r\n            return;\r\n        }\r\n        onSubmit(form);\r\n        // Reset form after submit (optional, depending on UX preference)\r\n        setForm({ title: \"\", description: \"\", type: \"note\" });\r\n    };\r\n\r\n    const getContentTypeColor = (type) => {\r\n        switch (type) {\r\n            case \"homework\": return colors.error;\r\n            case \"news\": return colors.primary;\r\n            default: return colors.secondary;\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Modal visible={visible} animationType=\"slide\" transparent>\r\n            <View style={{ flex: 1, justifyContent: \"center\", backgroundColor: \"rgba(0,0,0,0.5)\", padding: 20 }}>\r\n                <View style={{ backgroundColor: colors.cardBackground, borderRadius: 16, padding: 24 }}>\r\n                    <Text style={{ fontSize: 20, fontWeight: \"700\", color: colors.textPrimary, marginBottom: 16 }}>\r\n                        Post Class Content\r\n                    </Text>\r\n\r\n                    <TextInput\r\n                        placeholder=\"Title (e.g. Math Homework)\"\r\n                        placeholderTextColor={colors.textSecondary}\r\n                        style={{\r\n                            backgroundColor: colors.background,\r\n                            padding: 12,\r\n                            borderRadius: 8,\r\n                            color: colors.textPrimary,\r\n                            marginBottom: 12\r\n                        }}\r\n                        value={form.title}\r\n                        onChangeText={(t) => setForm({ ...form, title: t })}\r\n                    />\r\n\r\n                    <TextInput\r\n                        placeholder=\"Description\"\r\n                        placeholderTextColor={colors.textSecondary}\r\n                        multiline\r\n                        numberOfLines={4}\r\n                        style={{\r\n                            backgroundColor: colors.background,\r\n                            padding: 12,\r\n                            borderRadius: 8,\r\n                            color: colors.textPrimary,\r\n                            marginBottom: 12,\r\n                            height: 100,\r\n                            textAlignVertical: \"top\"\r\n                        }}\r\n                        value={form.description}\r\n                        onChangeText={(t) => setForm({ ...form, description: t })}\r\n                    />\r\n\r\n                    {/* Type Selection */}\r\n                    <View style={{ marginBottom: 24 }}>\r\n                        <Text style={{ color: colors.textSecondary, marginBottom: 8, fontSize: 12 }}>CONTENT TYPE</Text>\r\n                        <View style={{ flexDirection: \"row\", gap: 8 }}>\r\n                            {[\"note\", \"homework\", \"news\"].map(type => (\r\n                                <Pressable\r\n                                    key={type}\r\n                                    onPress={() => setForm({ ...form, type })}\r\n                                    style={{\r\n                                        paddingHorizontal: 12,\r\n                                        paddingVertical: 8,\r\n                                        backgroundColor: form.type === type ? getContentTypeColor(type) : colors.background,\r\n                                        borderRadius: 8,\r\n                                        borderWidth: 1,\r\n                                        borderColor: form.type === type ? getContentTypeColor(type) : colors.border\r\n                                    }}\r\n                                >\r\n                                    <Text style={{ color: form.type === type ? '#fff' : colors.textPrimary, textTransform: \"capitalize\", fontWeight: \"600\" }}>\r\n                                        {type}\r\n                                    </Text>\r\n                                </Pressable>\r\n                            ))}\r\n                        </View>\r\n                    </View>\r\n\r\n                    <View style={{ flexDirection: \"row\", justifyContent: \"flex-end\", gap: 12 }}>\r\n                        <Pressable onPress={onClose} style={{ padding: 12 }}>\r\n                            <Text style={{ color: colors.textSecondary, fontWeight: \"600\" }}>Cancel</Text>\r\n                        </Pressable>\r\n                        <Pressable\r\n                            onPress={handleSubmit}\r\n                            style={{ backgroundColor: colors.primary, paddingHorizontal: 20, paddingVertical: 12, borderRadius: 8 }}\r\n                        >\r\n                            <Text style={{ color: \"#fff\", fontWeight: \"600\" }}>Post</Text>\r\n                        </Pressable>\r\n                    </View>\r\n                </View>\r\n            </View>\r\n        </Modal>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\components\\SchoolPhotoCarousel.jsx","messages":[{"ruleId":"react/display-name","severity":2,"message":"Component definition is missing display name","line":11,"column":22,"nodeType":"CallExpression","messageId":"noDisplayName","endLine":49,"endColumn":3}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useRef, useCallback, useEffect } from 'react';\r\nimport { Image } from 'expo-image';\r\nimport { View, FlatList, Dimensions, StyleSheet, Animated, ActivityIndicator } from 'react-native';\r\nimport { useTheme } from '../theme';\r\nimport { getGoogleDriveEmbedUrl } from '../utils/googleDrive';\r\nimport { MaterialIcons } from '@expo/vector-icons';\r\n\r\nconst { width: SCREEN_WIDTH } = Dimensions.get('window');\r\n\r\n// Carousel Item Component with Lazy Loading and Caching\r\nconst CarouselItem = React.memo(({ item, width, height }) => {\r\n    const { colors } = useTheme();\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState(false);\r\n    const imageUrl = getGoogleDriveEmbedUrl(item);\r\n\r\n    if (!imageUrl) return null;\r\n\r\n    return (\r\n        <View style={[styles.itemContainer, { width, height }]}>\r\n            <View style={[styles.imageContainer, { backgroundColor: colors.cardBackground }]}>\r\n                {loading && (\r\n                    <View style={styles.loadingContainer}>\r\n                        <ActivityIndicator size=\"small\" color={colors.primary} />\r\n                    </View>\r\n                )}\r\n                {error ? (\r\n                    <View style={[styles.errorContainer, { backgroundColor: colors.cardBackground }]}>\r\n                        <MaterialIcons name=\"broken-image\" size={40} color={colors.textSecondary} />\r\n                    </View>\r\n                ) : (\r\n                    <Image\r\n                        source={imageUrl}\r\n                        style={styles.image}\r\n                        contentFit=\"cover\"\r\n                        transition={500}\r\n                        cachePolicy=\"memory-disk\"\r\n                        onLoadStart={() => setLoading(true)}\r\n                        onLoad={() => setLoading(false)}\r\n                        onError={() => {\r\n                            setLoading(false);\r\n                            setError(true);\r\n                        }}\r\n                    />\r\n                )}\r\n            </View>\r\n        </View>\r\n    );\r\n});\r\n\r\nexport default function SchoolPhotoCarousel({ photos }) {\r\n    const { colors } = useTheme();\r\n    const [activeIndex, setActiveIndex] = useState(0);\r\n    const scrollX = useRef(new Animated.Value(0)).current;\r\n    const flatListRef = useRef(null);\r\n\r\n    // Hooks MUST be called before any early return to avoid \"Rendered more hooks\" error\r\n    const handleViewableItemsChanged = useCallback(({ viewableItems }) => {\r\n        if (viewableItems.length > 0) {\r\n            setActiveIndex(viewableItems[0].index || 0);\r\n        }\r\n    }, []);\r\n\r\n    const viewabilityConfig = useRef({\r\n        itemVisiblePercentThreshold: 50,\r\n    }).current;\r\n\r\n    // Auto-scroll logic\r\n    useEffect(() => {\r\n        if (!photos || photos.length <= 1) return;\r\n\r\n        const interval = setInterval(() => {\r\n            if (flatListRef.current) {\r\n                let nextIndex = activeIndex + 1;\r\n                if (nextIndex >= photos.length) {\r\n                    nextIndex = 0; // Loop back to start\r\n                }\r\n\r\n                flatListRef.current.scrollToIndex({\r\n                    index: nextIndex,\r\n                    animated: true,\r\n                });\r\n                // activeIndex will be updated by handleViewableItemsChanged\r\n            }\r\n        }, 3000); // Slower auto-scroll for better UX\r\n\r\n        return () => clearInterval(interval);\r\n    }, [activeIndex, photos]);\r\n\r\n    // If no photos, collapse gracefully\r\n    if (!photos || photos.length === 0) {\r\n        return null;\r\n    }\r\n\r\n    // Calculate item width based on container padding (20px on each side = 40px total)\r\n    // We want the carousel to fill the available width\r\n    const ITEM_WIDTH = SCREEN_WIDTH - 40;\r\n    const ITEM_HEIGHT = ITEM_WIDTH * 0.5625; // 16:9 Aspect Ratio\r\n\r\n    return (\r\n        <View style={styles.container}>\r\n            <FlatList\r\n                ref={flatListRef}\r\n                data={photos}\r\n                renderItem={({ item }) => (\r\n                    <CarouselItem item={item} width={ITEM_WIDTH} height={ITEM_HEIGHT} />\r\n                )}\r\n                keyExtractor={(item, index) => `school-photo-${index}`}\r\n                horizontal\r\n                pagingEnabled\r\n                showsHorizontalScrollIndicator={false}\r\n                bounces={false}\r\n                onScroll={Animated.event(\r\n                    [{ nativeEvent: { contentOffset: { x: scrollX } } }],\r\n                    { useNativeDriver: false }\r\n                )}\r\n                onViewableItemsChanged={handleViewableItemsChanged}\r\n                viewabilityConfig={viewabilityConfig}\r\n                scrollEventThrottle={32}\r\n                decelerationRate=\"fast\"\r\n                snapToInterval={ITEM_WIDTH}\r\n                getItemLayout={(data, index) => ({\r\n                    length: ITEM_WIDTH,\r\n                    offset: ITEM_WIDTH * index,\r\n                    index,\r\n                })}\r\n            />\r\n\r\n            {/* Pagination Dots */}\r\n            {photos.length > 1 && (\r\n                <View style={styles.pagination}>\r\n                    {photos.map((_, index) => {\r\n                        const inputRange = [\r\n                            (index - 1) * ITEM_WIDTH,\r\n                            index * ITEM_WIDTH,\r\n                            (index + 1) * ITEM_WIDTH,\r\n                        ];\r\n\r\n                        const dotWidth = scrollX.interpolate({\r\n                            inputRange,\r\n                            outputRange: [6, 20, 6],\r\n                            extrapolate: 'clamp',\r\n                        });\r\n\r\n                        const opacity = scrollX.interpolate({\r\n                            inputRange,\r\n                            outputRange: [0.3, 1, 0.3],\r\n                            extrapolate: 'clamp',\r\n                        });\r\n\r\n                        return (\r\n                            <Animated.View\r\n                                key={index}\r\n                                style={[\r\n                                    styles.dot,\r\n                                    {\r\n                                        width: dotWidth,\r\n                                        backgroundColor: colors.primary,\r\n                                        opacity,\r\n                                    },\r\n                                ]}\r\n                            />\r\n                        );\r\n                    })}\r\n                </View>\r\n            )}\r\n        </View>\r\n    );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n    container: {\r\n        marginBottom: 24,\r\n        borderRadius: 24,\r\n        overflow: 'hidden',\r\n        // Shadow for the whole carousel container\r\n        shadowColor: \"#000\",\r\n        shadowOffset: { width: 0, height: 10 },\r\n        shadowOpacity: 0.08,\r\n        shadowRadius: 20,\r\n        elevation: 6,\r\n        backgroundColor: 'transparent' // Let the card background show through\r\n    },\r\n    itemContainer: {\r\n        overflow: 'hidden',\r\n        borderRadius: 24,\r\n    },\r\n    imageContainer: {\r\n        flex: 1,\r\n        overflow: 'hidden',\r\n        borderRadius: 24,\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n    },\r\n    image: {\r\n        width: '100%',\r\n        height: '100%',\r\n    },\r\n    loadingContainer: {\r\n        ...StyleSheet.absoluteFillObject,\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n        zIndex: 1,\r\n    },\r\n    errorContainer: {\r\n        ...StyleSheet.absoluteFillObject,\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n    },\r\n    pagination: {\r\n        flexDirection: 'row',\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n        marginTop: 12,\r\n    },\r\n    dot: {\r\n        height: 6,\r\n        borderRadius: 3,\r\n        marginHorizontal: 3,\r\n    },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\components\\ThemeToggle.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\components\\ToastProvider.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'colors' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":21,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'onDismiss' is defined but never used. Allowed unused args must match /^_/u.","line":55,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":55,"endColumn":42}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useState, useCallback } from \"react\";\nimport { StyleSheet, Text, View, Platform } from \"react-native\";\nimport { useTheme } from \"../theme\";\nimport Animated, {\n  SlideInUp,\n  SlideOutUp,\n  Layout\n} from 'react-native-reanimated';\nimport { Feather } from '@expo/vector-icons';\nimport { useSafeAreaInsets } from 'react-native-safe-area-context';\nimport { BlurView } from 'expo-blur';\n\nconst ToastContext = createContext({ showToast: (_msg, _type) => { } });\n\nexport function useToast() {\n  return useContext(ToastContext);\n}\n\nexport function ToastProvider({ children }) {\n  const [toasts, setToasts] = useState([]);\n  const { colors } = useTheme();\n  const insets = useSafeAreaInsets();\n\n  const removeToast = useCallback((id) => {\n    setToasts((prev) => prev.filter((t) => t.id !== id));\n  }, []);\n\n  const showToast = useCallback((msg, type = 'info', duration = 3000) => {\n    const id = Date.now().toString();\n    setToasts((prev) => [...prev, { id, msg, type }]);\n\n    if (duration > 0) {\n      setTimeout(() => {\n        removeToast(id);\n      }, duration);\n    }\n  }, [removeToast]);\n\n  return (\n    <ToastContext.Provider value={{ showToast }}>\n      {children}\n      <View style={[styles.container, { top: insets.top + 10 }]} pointerEvents=\"box-none\">\n        {toasts.map((toast) => (\n          <ToastItem\n            key={toast.id}\n            {...toast}\n            onDismiss={() => removeToast(toast.id)}\n          />\n        ))}\n      </View>\n    </ToastContext.Provider>\n  );\n}\n\nfunction ToastItem({ msg, type, onDismiss }) {\n  const getToastConfig = () => {\n    switch (type) {\n      case 'success':\n        return {\n          icon: 'check-circle',\n          accentColor: '#10B981', // Green\n        };\n      case 'error':\n        return {\n          icon: 'alert-circle',\n          accentColor: '#EF4444', // Red\n        };\n      case 'info':\n      default:\n        return {\n          icon: 'info',\n          accentColor: '#3B82F6', // Blue\n        };\n    }\n  };\n\n  const config = getToastConfig();\n\n  return (\n    <Animated.View\n      entering={SlideInUp.springify().damping(20).stiffness(150)}\n      exiting={SlideOutUp.springify().damping(20).stiffness(150)}\n      layout={Layout.springify()}\n      style={styles.toastWrapper}\n    >\n      {Platform.OS === 'ios' ? (\n        <BlurView intensity={80} tint=\"light\" style={styles.blurContainer}>\n          <ToastContent msg={msg} config={config} />\n        </BlurView>\n      ) : (\n        <View style={[styles.blurContainer, styles.androidBackground]}>\n          <ToastContent msg={msg} config={config} />\n        </View>\n      )}\n    </Animated.View>\n  );\n}\n\nfunction ToastContent({ msg, config }) {\n  return (\n    <View style={styles.contentContainer}>\n      <View style={[styles.iconContainer, { backgroundColor: config.accentColor + '15' }]}>\n        <Feather name={config.icon} size={18} color={config.accentColor} />\n      </View>\n      <Text style={styles.text}>{msg}</Text>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    position: \"absolute\",\n    left: 0,\n    right: 0,\n    alignItems: 'center',\n    zIndex: 9999,\n  },\n  toastWrapper: {\n    width: '90%',\n    maxWidth: 400,\n    marginBottom: 10,\n    borderRadius: 16,\n    overflow: 'hidden',\n    // Shadow\n    shadowColor: \"#000\",\n    shadowOffset: { width: 0, height: 4 },\n    shadowOpacity: 0.1,\n    shadowRadius: 12,\n    elevation: 8,\n  },\n  blurContainer: {\n    paddingHorizontal: 16,\n    paddingVertical: 14,\n    flexDirection: 'row',\n    alignItems: 'center',\n  },\n  androidBackground: {\n    backgroundColor: 'rgba(255, 255, 255, 0.95)',\n    borderWidth: 1,\n    borderColor: 'rgba(0,0,0,0.05)',\n  },\n  contentContainer: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    flex: 1,\n  },\n  iconContainer: {\n    width: 32,\n    height: 32,\n    borderRadius: 16,\n    justifyContent: 'center',\n    alignItems: 'center',\n    marginRight: 12,\n  },\n  text: {\n    fontSize: 14,\n    fontWeight: '600',\n    fontFamily: 'DMSans-Medium',\n    color: '#1F2937', // Dark gray\n    flex: 1,\n  },\n});\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\config\\apiConfig.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\constants\\basic-info.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\constants\\routes.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\context\\NavigationContext.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\hooks\\useApi.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\hooks\\useEvents.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'clearRefreshLock' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":19},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":105,"column":15,"nodeType":"BlockStatement","messageId":"unexpected","endLine":106,"endColumn":6,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3093,3099],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback, useRef } from 'react';\r\nimport AsyncStorage from '@react-native-async-storage/async-storage';\r\nimport apiConfig from '../config/apiConfig';\r\nimport {\r\n  getCachedData,\r\n  setCachedData,\r\n  isCacheStale,\r\n  isRefreshing,\r\n  setRefreshLock,\r\n  clearRefreshLock,\r\n  CACHE_KEYS,\r\n  CACHE_EXPIRY,\r\n  STALE_TIME\r\n} from '../utils/cache';\r\nimport apiFetch from '../utils/apiFetch';\r\nimport { useNetworkStatus } from '../components/NetworkStatusProvider';\r\n\r\nexport default function useEvents() {\r\n  const [events, setEvents] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const isMountedRef = useRef(true);\r\n\r\n  // Track current range for auto-refresh\r\n  const currentRangeRef = useRef({ start: null, end: null });\r\n\r\n  const { isConnected, registerOnlineCallback } = useNetworkStatus();\r\n\r\n  // Fetch events from API  \r\n  const fetchEventsFromAPI = useCallback(async (startDate, endDate, silent = false) => {\r\n    const token = await AsyncStorage.getItem('@auth_token');\r\n    const fetchOptions = { silent }; // Pass silent flag\r\n    if (token) {\r\n      fetchOptions.headers = { Authorization: `Bearer ${token}` };\r\n    }\r\n\r\n    const queryParts = [];\r\n    if (startDate) queryParts.push(`startDate=${encodeURIComponent(startDate)}`);\r\n    if (endDate) queryParts.push(`endDate=${encodeURIComponent(endDate)}`);\r\n    if (!startDate && !endDate) queryParts.push('limit=100');\r\n\r\n    const queryString = queryParts.length > 0 ? `?${queryParts.join('&')}` : '';\r\n\r\n\r\n\r\n    const response = await apiFetch(\r\n      apiConfig.url(`${apiConfig.endpoints.events.list}${queryString}`),\r\n      fetchOptions\r\n    );\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP error! status: ${response.status}`);\r\n    }\r\n\r\n    const data = await response.json();\r\n    const eventsData = data.event || [];\r\n\r\n    if (!Array.isArray(eventsData)) {\r\n      throw new Error('Invalid events data structure from API');\r\n    }\r\n\r\n\r\n    return eventsData;\r\n  }, []);\r\n\r\n  // Fetch events with smart caching\r\n  const fetchEventsRange = useCallback(async (startDate, endDate, callback, silent = false) => {\r\n    const cacheKey = CACHE_KEYS.EVENTS;\r\n\r\n    // Update current range ref\r\n    currentRangeRef.current = { start: startDate, end: endDate };\r\n\r\n    // If offline, just return (we rely on cache which is already loaded)\r\n    if (!isConnected) {\r\n\r\n      if (callback) callback(null, 0);\r\n      return;\r\n    }\r\n\r\n    // Prevent duplicate fetches\r\n    if (isRefreshing(cacheKey)) {\r\n\r\n      if (callback) callback(null, 0);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setRefreshLock(cacheKey);\r\n\r\n      const eventsData = await fetchEventsFromAPI(startDate, endDate, silent);\r\n\r\n      if (isMountedRef.current) {\r\n        setEvents(eventsData);\r\n        setError(null);\r\n      }\r\n\r\n      await setCachedData(cacheKey, eventsData);\r\n\r\n\r\n      if (callback) callback(null, eventsData.length);\r\n    } catch (err) {\r\n\r\n      // Suppress network errors as requested\r\n      if (callback) callback(err);\r\n    } finally {\r\n    }\r\n  }, [fetchEventsFromAPI, isConnected]);\r\n\r\n  // Initial load with cache-first strategy\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n\r\n    const loadEvents = async () => {\r\n      const cacheKey = CACHE_KEYS.EVENTS;\r\n\r\n      try {\r\n        // Step 1: Try to load from cache first\r\n        const cachedEvents = await getCachedData(cacheKey, CACHE_EXPIRY.EVENTS);\r\n\r\n        if (cachedEvents && cachedEvents.length > 0 && !cancelled) {\r\n\r\n          setEvents(cachedEvents);\r\n          setLoading(false);\r\n\r\n          // Step 2: Check if cache is stale or if we should refresh\r\n          const isStale = await isCacheStale(cacheKey, STALE_TIME.EVENTS);\r\n\r\n          if (isStale && isConnected) {\r\n\r\n            // Refresh in background without showing loader\r\n            const now = new Date();\r\n            const startOfMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1).toISOString();\r\n            const endOfMonth = new Date(now.getFullYear(), now.getMonth() + 2, 0).toISOString();\r\n            fetchEventsRange(startOfMonth, endOfMonth, null, true); // silent=true\r\n          }\r\n        } else {\r\n          // Step 3: No cache, fetch from API\r\n\r\n          const now = new Date();\r\n          const startOfMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1).toISOString();\r\n          const endOfMonth = new Date(now.getFullYear(), now.getMonth() + 2, 0).toISOString();\r\n\r\n          await fetchEventsRange(startOfMonth, endOfMonth, null, true); // silent=true (prevent global loader)\r\n\r\n          if (!cancelled) {\r\n            setLoading(false);\r\n          }\r\n        }\r\n      } catch (err) {\r\n\r\n        if (!cancelled) {\r\n          // setError(err.message); // Suppress error\r\n          setLoading(false);\r\n        }\r\n      }\r\n    };\r\n\r\n    loadEvents();\r\n\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [fetchEventsRange, isConnected]);\r\n\r\n  // Register online callback for auto-refresh\r\n  useEffect(() => {\r\n    const unsubscribe = registerOnlineCallback(() => {\r\n\r\n      const { start, end } = currentRangeRef.current;\r\n      if (start && end) {\r\n        fetchEventsRange(start, end, null, true); // silent refresh\r\n      } else {\r\n        // Default range if none set\r\n        const now = new Date();\r\n        const startOfMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1).toISOString();\r\n        const endOfMonth = new Date(now.getFullYear(), now.getMonth() + 2, 0).toISOString();\r\n        fetchEventsRange(startOfMonth, endOfMonth, null, true);\r\n      }\r\n    });\r\n\r\n    return unsubscribe;\r\n  }, [registerOnlineCallback, fetchEventsRange]);\r\n\r\n  // Cleanup on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      isMountedRef.current = false;\r\n    };\r\n  }, []);\r\n\r\n  // Helper functions for CRUD operations\r\n  const addEvent = useCallback((newEvent) => {\r\n    const normalized = { ...newEvent };\r\n    if (!normalized._id && normalized.id) normalized._id = normalized.id;\r\n    // Handle various boolean formats\r\n    if (typeof normalized.isSchoolEvent === 'string') {\r\n      normalized.isSchoolEvent = normalized.isSchoolEvent === 'true';\r\n    } else {\r\n      normalized.isSchoolEvent = Boolean(normalized.isSchoolEvent);\r\n    }\r\n\r\n    setEvents(prev => {\r\n      const updated = [...prev, normalized];\r\n      // Update cache in background\r\n      setCachedData(CACHE_KEYS.EVENTS, updated);\r\n      return updated;\r\n    });\r\n  }, []);\r\n\r\n  const updateEvent = useCallback((updatedEvent) => {\r\n    const normalized = { ...updatedEvent };\r\n    if (!normalized._id && normalized.id) normalized._id = normalized.id;\r\n\r\n    setEvents(prev => {\r\n      const updated = prev.map(event =>\r\n        event._id === normalized._id ? normalized : event\r\n      );\r\n      // Update cache in background\r\n      setCachedData(CACHE_KEYS.EVENTS, updated);\r\n      return updated;\r\n    });\r\n  }, []);\r\n\r\n  const removeEvent = useCallback((eventId) => {\r\n    setEvents(prev => {\r\n      const updated = prev.filter(event => event._id !== eventId);\r\n      // Update cache in background\r\n      setCachedData(CACHE_KEYS.EVENTS, updated);\r\n      return updated;\r\n    });\r\n  }, []);\r\n\r\n  return {\r\n    events,\r\n    loading,\r\n    error,\r\n    addEvent,\r\n    updateEvent,\r\n    removeEvent,\r\n    fetchEventsRange,\r\n    refreshEvents: useCallback(async (silent = true) => {\r\n      const { start, end } = currentRangeRef.current;\r\n      if (start && end) {\r\n        await fetchEventsRange(start, end, null, silent);\r\n      } else {\r\n        // Default to current month if no range set\r\n        const now = new Date();\r\n        const startOfMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1).toISOString();\r\n        const endOfMonth = new Date(now.getFullYear(), now.getMonth() + 2, 0).toISOString();\r\n        await fetchEventsRange(startOfMonth, endOfMonth, null, silent);\r\n      }\r\n    }, [fetchEventsRange])\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\hooks\\useFade.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\hooks\\useSchoolInfo.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useRef' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":37}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef } from 'react';\r\nimport apiConfig from '../config/apiConfig';\r\nimport apiFetch from '../utils/apiFetch';\r\nimport { SCHOOL as FALLBACK_SCHOOL } from '../constants/basic-info';\r\nimport { getCachedData, setCachedData, CACHE_KEYS, CACHE_EXPIRY } from '../utils/cache';\r\nimport { useNetworkStatus } from '../components/NetworkStatusProvider';\r\n\r\n// Global cache for school info to persist across component re-mounts\r\nlet globalSchoolInfo = null;\r\nlet globalLoading = true;\r\nlet globalError = null;\r\nlet isFetched = false;\r\n\r\nexport default function useSchoolInfo() {\r\n  const [schoolInfo, setSchoolInfo] = useState(globalSchoolInfo || FALLBACK_SCHOOL);\r\n  const [loading, setLoading] = useState(globalLoading);\r\n  const [error, setError] = useState(globalError);\r\n\r\n  const { isConnected, registerOnlineCallback } = useNetworkStatus();\r\n\r\n  useEffect(() => {\r\n    if (isFetched) {\r\n      // If already fetched, use cached data\r\n      setSchoolInfo(globalSchoolInfo);\r\n      setLoading(globalLoading);\r\n      setError(globalError);\r\n\r\n      // If we have data but it might be stale, try to refresh silently if connected\r\n      if (isConnected) {\r\n        fetchFreshSchoolInfo(true);\r\n      }\r\n      return;\r\n    }\r\n\r\n    const fetchSchoolInfo = async () => {\r\n      try {\r\n        setLoading(true);\r\n        setError(null);\r\n\r\n        // Try to get cached data first\r\n        const cachedSchoolInfo = await getCachedData(CACHE_KEYS.SCHOOL_INFO, CACHE_EXPIRY.SCHOOL_INFO);\r\n        if (cachedSchoolInfo) {\r\n          globalSchoolInfo = cachedSchoolInfo;\r\n          setSchoolInfo(cachedSchoolInfo);\r\n          setLoading(false);\r\n          globalLoading = false;\r\n          isFetched = true;\r\n\r\n          // Fetch fresh data in background if connected\r\n          if (isConnected) {\r\n            fetchFreshSchoolInfo(true);\r\n          }\r\n          return;\r\n        }\r\n\r\n        // No cache, fetch from API if connected\r\n        if (isConnected) {\r\n          await fetchFreshSchoolInfo(true);\r\n        } else {\r\n          // Offline and no cache, use fallback\r\n\r\n          globalSchoolInfo = FALLBACK_SCHOOL;\r\n          setLoading(false);\r\n          globalLoading = false;\r\n          isFetched = true;\r\n        }\r\n      } catch (err) {\r\n\r\n        // setError(err.message); // Suppress error\r\n        // globalError = err.message;\r\n        // Keep the fallback data already set in state\r\n        globalSchoolInfo = FALLBACK_SCHOOL;\r\n        setLoading(false);\r\n        globalLoading = false;\r\n        isFetched = true;\r\n      }\r\n    };\r\n\r\n    fetchSchoolInfo();\r\n  }, [isConnected]);\r\n\r\n  const fetchFreshSchoolInfo = async (silent = false) => {\r\n    if (!isConnected) return;\r\n\r\n    try {\r\n\r\n      const response = await apiFetch(apiConfig.url(apiConfig.endpoints.schoolInfo.get), { silent });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP error! status: ${response.status}`);\r\n      }\r\n\r\n      const result = await response.json();\r\n\r\n      if (result.success && result.data) {\r\n        // Transform the data to match the expected structure\r\n        const transformedData = {\r\n          name: result.data.name,\r\n          address: result.data.address,\r\n          phone: result.data.phone,\r\n          email: result.data.email,\r\n          mapUrl: result.data.mapUrl,\r\n          mapAppUrl: result.data.mapAppUrl,\r\n          mission: result.data.mission,\r\n          about: result.data.about,\r\n          socials: result.data.socials,\r\n          news: result.data.news || [],\r\n          photoUrl: result.data.photoUrl || []\r\n        };\r\n\r\n        globalSchoolInfo = transformedData;\r\n        setSchoolInfo(transformedData);\r\n\r\n        // Cache the fresh data\r\n        await setCachedData(CACHE_KEYS.SCHOOL_INFO, transformedData);\r\n      } else {\r\n        // If backend doesn't have data, keep fallback\r\n\r\n        if (!globalSchoolInfo) globalSchoolInfo = FALLBACK_SCHOOL;\r\n      }\r\n    } catch (err) {\r\n\r\n      // Don't override existing cached data if fetch fails\r\n      if (!globalSchoolInfo) {\r\n        // setError(err.message); // Suppress error\r\n        // globalError = err.message;\r\n        globalSchoolInfo = FALLBACK_SCHOOL;\r\n      }\r\n    }\r\n  };\r\n\r\n  // Register online callback\r\n  useEffect(() => {\r\n    const unsubscribe = registerOnlineCallback(() => {\r\n\r\n      fetchFreshSchoolInfo(true);\r\n    });\r\n    return unsubscribe;\r\n  }, [registerOnlineCallback]);\r\n\r\n  return { schoolInfo, loading, error, refresh: fetchFreshSchoolInfo };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\theme.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Platform' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":42}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, {\r\n  createContext,\r\n  useContext,\r\n  useMemo,\r\n  useState,\r\n  useEffect,\r\n} from \"react\";\r\nimport { StyleSheet, Appearance, Platform } from \"react-native\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\n\r\nconst FONTS = {\r\n  bold: \"DMSans-Bold\",\r\n  semiBold: \"DMSans-SemiBold\",\r\n  medium: \"DMSans-Medium\",\r\n  regular: \"DMSans-Regular\",\r\n};\r\n\r\n// Modern, Premium Color Palette\r\nconst lightColors = {\r\n  primary: \"#2F6CD4\", // Vibrant Blue (Inter-like)\r\n  secondary: \"#F97316\", // Modern Orange\r\n  background: \"#F8FAFC\", // Cool Gray 50\r\n  cardBackground: \"#FFFFFF\",\r\n  textPrimary: \"#0F172A\", // Slate 900\r\n  textSecondary: \"#64748B\", // Slate 500\r\n  border: \"#E2E8F0\", // Slate 200\r\n  shadow: \"#64748B\",\r\n  error: \"#EF4444\", // Red 500\r\n  white: \"#FFFFFF\",\r\n  roleSuperAdmin: \"#F43F5E\", // Rose 500\r\n  roleAdmin: \"#10B981\", // Emerald 500\r\n  roleStaff: \"#0EA5E9\", // Sky 500\r\n  roleClassTeacher: \"#8B5CF6\", // Violet 500\r\n  roleStudent: \"#F59E0B\", // Amber 500\r\n  success: \"#22C55E\", // Green 500\r\n  // Surface variants for pills/backgrounds\r\n  primaryLight: \"#EFF6FF\", // Blue 50\r\n  successLight: \"#F0FDF4\", // Green 50\r\n  errorLight: \"#FEF2F2\", // Red 50\r\n  warningLight: \"#FFFBEB\", // Amber 50\r\n};\r\n\r\nconst darkColors = {\r\n  primary: \"#3B82F6\", // Blue 500\r\n  secondary: \"#FB923C\", // Orange 400\r\n  background: \"#0F172A\", // Slate 900\r\n  cardBackground: \"#1E293B\", // Slate 800\r\n  textPrimary: \"#F1F5F9\", // Slate 100\r\n  textSecondary: \"#94A3B8\", // Slate 400\r\n  border: \"#334155\", // Slate 700\r\n  shadow: \"#000000\",\r\n  error: \"#F87171\", // Red 400\r\n  white: \"#FFFFFF\",\r\n  roleSuperAdmin: \"#FB7185\", // Rose 400\r\n  roleAdmin: \"#34D399\", // Emerald 400\r\n  roleStaff: \"#38BDF8\", // Sky 400\r\n  roleClassTeacher: \"#A78BFA\", // Violet 400\r\n  roleStudent: \"#FBBF24\", // Amber 400\r\n  success: \"#4ADE80\", // Green 400\r\n  // Surface variants\r\n  primaryLight: \"rgba(59, 130, 246, 0.15)\",\r\n  successLight: \"rgba(74, 222, 128, 0.15)\",\r\n  errorLight: \"rgba(248, 113, 113, 0.15)\",\r\n  warningLight: \"rgba(251, 191, 36, 0.15)\",\r\n};\r\n\r\nfunction createGlobalStyles(COLORS, mode) {\r\n  return StyleSheet.create({\r\n    container: {\r\n      flex: 1,\r\n      backgroundColor: COLORS.background,\r\n      paddingHorizontal: 20, // Increased padding\r\n      paddingTop: 24,\r\n      paddingBottom: 32,\r\n    },\r\n    title: {\r\n      fontSize: 32, // Larger title\r\n      fontFamily: FONTS.bold,\r\n      color: COLORS.textPrimary, // Use textPrimary instead of primary for cleaner look\r\n      marginBottom: 24,\r\n      textAlign: \"left\", // Left align for modern feel\r\n      letterSpacing: -1,\r\n    },\r\n    headerTitle: {\r\n      fontSize: 24,\r\n      fontFamily: FONTS.bold,\r\n      color: COLORS.textPrimary,\r\n      letterSpacing: -0.5,\r\n      marginBottom: 4,\r\n    },\r\n    subHeader: {\r\n      fontSize: 16,\r\n      fontFamily: FONTS.regular,\r\n      color: COLORS.textSecondary,\r\n      marginBottom: 32,\r\n      lineHeight: 24,\r\n    },\r\n    label: {\r\n      fontSize: 13,\r\n      fontFamily: FONTS.semiBold,\r\n      color: COLORS.textSecondary,\r\n      textTransform: \"uppercase\",\r\n      letterSpacing: 0.5,\r\n      marginBottom: 8,\r\n    },\r\n    text: {\r\n      fontSize: 16,\r\n      fontFamily: FONTS.regular,\r\n      color: COLORS.textSecondary,\r\n      lineHeight: 26,\r\n      marginBottom: 12,\r\n    },\r\n    link: {\r\n      fontSize: 16,\r\n      fontFamily: FONTS.semiBold,\r\n      color: COLORS.primary,\r\n    },\r\n    iconLabel: {\r\n      marginTop: 6,\r\n      fontSize: 13,\r\n      fontFamily: FONTS.medium,\r\n      color: COLORS.textSecondary,\r\n    },\r\n    buttonText: {\r\n      fontSize: 16,\r\n      fontFamily: FONTS.semiBold,\r\n      color: COLORS.white,\r\n      textAlign: \"center\",\r\n      letterSpacing: 0.3,\r\n    },\r\n    errorText: {\r\n      fontSize: 14,\r\n      fontFamily: FONTS.medium,\r\n      color: COLORS.error,\r\n      marginTop: 8,\r\n    },\r\n    row: {\r\n      flexDirection: \"row\",\r\n      alignItems: \"center\",\r\n    },\r\n    fullWidth: {\r\n      width: \"100%\",\r\n    },\r\n    divider: {\r\n      height: 1,\r\n      backgroundColor: COLORS.border,\r\n      marginVertical: 24,\r\n    },\r\n    // Premium Card Style\r\n    card: {\r\n      backgroundColor: COLORS.cardBackground,\r\n      borderRadius: 24, // More rounded\r\n      padding: 24,\r\n      marginBottom: 20,\r\n      shadowColor: COLORS.shadow,\r\n      shadowOffset: { width: 0, height: 8 }, // Deeper shadow\r\n      shadowOpacity: mode === 'dark' ? 0.4 : 0.08,\r\n      shadowRadius: 16,\r\n      elevation: 6,\r\n      borderWidth: 1,\r\n      borderColor: mode === 'dark' ? 'rgba(255,255,255,0.05)' : 'rgba(0,0,0,0.02)',\r\n    },\r\n    // Legacy support for cardMinimal (aliased to card for consistency)\r\n    cardMinimal: {\r\n      backgroundColor: COLORS.cardBackground,\r\n      borderRadius: 20,\r\n      padding: 20,\r\n      marginBottom: 16,\r\n      shadowColor: COLORS.shadow,\r\n      shadowOffset: { width: 0, height: 4 },\r\n      shadowOpacity: mode === 'dark' ? 0.3 : 0.05,\r\n      shadowRadius: 12,\r\n      elevation: 3,\r\n      borderWidth: 1,\r\n      borderColor: mode === 'dark' ? 'rgba(255,255,255,0.05)' : 'rgba(0,0,0,0.02)',\r\n    },\r\n    // Glassmorphism Utility\r\n    glass: {\r\n      backgroundColor: mode === 'dark' ? 'rgba(30, 41, 59, 0.7)' : 'rgba(255, 255, 255, 0.7)',\r\n      borderColor: mode === 'dark' ? 'rgba(255, 255, 255, 0.1)' : 'rgba(255, 255, 255, 0.5)',\r\n      borderWidth: 1,\r\n    },\r\n    input: {\r\n      borderWidth: 1,\r\n      borderColor: COLORS.border,\r\n      borderRadius: 16, // More rounded\r\n      paddingVertical: 16,\r\n      paddingHorizontal: 20,\r\n      fontSize: 16,\r\n      fontFamily: FONTS.regular,\r\n      color: COLORS.textPrimary,\r\n      backgroundColor: mode === 'dark' ? 'rgba(255,255,255,0.03)' : '#FFFFFF',\r\n    },\r\n    inputMinimal: {\r\n      backgroundColor: mode === 'dark' ? 'rgba(255,255,255,0.05)' : '#F1F5F9',\r\n      borderRadius: 16,\r\n      paddingHorizontal: 20,\r\n      paddingVertical: 16,\r\n      fontSize: 16,\r\n      color: COLORS.textPrimary,\r\n      borderWidth: 0,\r\n    },\r\n    inputFocused: {\r\n      borderWidth: 2,\r\n      borderColor: COLORS.primary,\r\n      backgroundColor: COLORS.cardBackground,\r\n    },\r\n    inputError: {\r\n      borderWidth: 2,\r\n      borderColor: COLORS.error,\r\n    },\r\n    button: {\r\n      backgroundColor: COLORS.primary,\r\n      paddingVertical: 16,\r\n      paddingHorizontal: 24,\r\n      borderRadius: 16,\r\n      alignItems: \"center\",\r\n      justifyContent: \"center\",\r\n      shadowColor: COLORS.primary,\r\n      shadowOffset: { width: 0, height: 8 },\r\n      shadowOpacity: 0.25,\r\n      shadowRadius: 16,\r\n      elevation: 6,\r\n    },\r\n    buttonSmall: {\r\n      backgroundColor: COLORS.primary,\r\n      paddingVertical: 10,\r\n      paddingHorizontal: 16,\r\n      borderRadius: 12,\r\n      alignItems: \"center\",\r\n      justifyContent: \"center\",\r\n      minHeight: 40,\r\n    },\r\n    buttonIcon: {\r\n      padding: 12,\r\n      borderRadius: 16,\r\n      alignItems: \"center\",\r\n      justifyContent: \"center\",\r\n      minWidth: 48,\r\n      minHeight: 48,\r\n      backgroundColor: COLORS.primaryLight,\r\n    },\r\n    buttonLarge: {\r\n      backgroundColor: COLORS.primary,\r\n      paddingVertical: 18,\r\n      paddingHorizontal: 32,\r\n      borderRadius: 20,\r\n      alignItems: \"center\",\r\n      justifyContent: \"center\",\r\n      minHeight: 60,\r\n      shadowColor: COLORS.primary,\r\n      shadowOffset: { width: 0, height: 10 },\r\n      shadowOpacity: 0.3,\r\n      shadowRadius: 20,\r\n      elevation: 10,\r\n    },\r\n    buttonSecondary: {\r\n      backgroundColor: 'transparent',\r\n      borderWidth: 2,\r\n      borderColor: COLORS.border,\r\n      paddingVertical: 14,\r\n      paddingHorizontal: 20,\r\n      borderRadius: 16,\r\n      alignItems: \"center\",\r\n      justifyContent: \"center\",\r\n    },\r\n    fab: {\r\n      position: \"absolute\",\r\n      bottom: 100,\r\n      right: 24,\r\n      backgroundColor: COLORS.primary,\r\n      width: 64, // Slightly larger\r\n      height: 64,\r\n      borderRadius: 32,\r\n      justifyContent: \"center\",\r\n      alignItems: \"center\",\r\n      shadowColor: COLORS.primary,\r\n      shadowOffset: { width: 0, height: 10 },\r\n      shadowOpacity: 0.35,\r\n      shadowRadius: 20,\r\n      elevation: 10,\r\n    },\r\n    backButton: {\r\n      flexDirection: \"row\",\r\n      alignItems: 'center',\r\n      padding: 8,\r\n      marginLeft: -8,\r\n    },\r\n    iconRow: {\r\n      flexDirection: \"row\",\r\n      alignItems: \"center\",\r\n      marginBottom: 12,\r\n      gap: 12,\r\n    },\r\n    heading: {\r\n      fontSize: 24,\r\n      fontFamily: FONTS.bold,\r\n      color: COLORS.primary,\r\n      textAlign: \"left\",\r\n      marginBottom: 16,\r\n      letterSpacing: -0.5,\r\n    },\r\n    cardText: {\r\n      fontSize: 16,\r\n      fontFamily: FONTS.regular,\r\n      color: COLORS.textPrimary,\r\n      lineHeight: 26,\r\n    },\r\n    cardGroup: {\r\n      marginBottom: 32,\r\n    },\r\n    safeArea: {\r\n      flex: 1,\r\n      backgroundColor: COLORS.background,\r\n    },\r\n    smallLeftMargin: {\r\n      marginLeft: 8,\r\n    },\r\n    contentPaddingBottom: {\r\n      paddingBottom: 120,\r\n    },\r\n    sectionTitle: {\r\n      fontSize: 20,\r\n      color: COLORS.textPrimary,\r\n      fontFamily: FONTS.bold,\r\n      marginBottom: 20,\r\n      letterSpacing: -0.5,\r\n    },\r\n    empty: {\r\n      fontSize: 16,\r\n      color: COLORS.textSecondary,\r\n      marginTop: 32,\r\n      textAlign: \"center\",\r\n      fontFamily: FONTS.medium,\r\n    },\r\n  });\r\n}\r\n\r\nconst ThemeContext = createContext(null);\r\n\r\nexport function ThemeProvider({ children }) {\r\n  const [mode, setMode] = useState(null); // null = not yet loaded\r\n  const [isHydrated, setIsHydrated] = useState(false);\r\n\r\n  // Load saved preference or system preference on mount\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    async function load() {\r\n      try {\r\n        const stored = await AsyncStorage.getItem(\"@theme_mode\");\r\n        if (mounted) {\r\n          if (stored === \"light\" || stored === \"dark\") {\r\n            setMode(stored);\r\n          } else if (stored === \"system\") {\r\n            // Use system preference\r\n            const sys = Appearance.getColorScheme();\r\n            setMode(sys === \"dark\" ? \"dark\" : \"light\");\r\n          } else {\r\n            // No stored preference, use system and set to \"system\" mode\r\n            const sys = Appearance.getColorScheme();\r\n            setMode(sys === \"dark\" ? \"dark\" : \"light\");\r\n          }\r\n        }\r\n      } catch (e) {\r\n        const sys = Appearance.getColorScheme();\r\n        if (mounted) setMode(sys === \"dark\" ? \"dark\" : \"light\");\r\n      } finally {\r\n        if (mounted) setIsHydrated(true);\r\n      }\r\n    }\r\n\r\n    load();\r\n\r\n    const sub = Appearance.addChangeListener(({ colorScheme }) => {\r\n      // If user hasn't chosen yet (no stored pref) or has chosen \"system\", update with system changes\r\n      AsyncStorage.getItem(\"@theme_mode\").then((stored) => {\r\n        if (!stored || stored === \"system\") {\r\n          setMode(colorScheme === \"dark\" ? \"dark\" : \"light\");\r\n        }\r\n      });\r\n    });\r\n\r\n    return () => {\r\n      mounted = false;\r\n      try {\r\n        sub && sub.remove && sub.remove();\r\n      } catch (e) {\r\n        // ignore remove errors during unmount, but log in dev\r\n        if (typeof console !== \"undefined\")\r\n          console.warn(\"Appearance listener remove failed\", e);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  const colors = useMemo(\r\n    () => (mode === \"dark\" ? darkColors : lightColors),\r\n    [mode]\r\n  );\r\n\r\n  // Pass mode to createGlobalStyles to handle conditional styles\r\n  const styles = useMemo(() => createGlobalStyles(colors, mode), [colors, mode]);\r\n\r\n  // Gradient Constants\r\n  const gradients = useMemo(() => ({\r\n    primary: mode === 'dark'\r\n      ? [colors.primary, '#60A5FA'] // Lighter blue for dark mode\r\n      : [colors.primary, '#1D4ED8'], // Darker blue for light mode\r\n    card: mode === 'dark'\r\n      ? [colors.cardBackground, '#1E293B']\r\n      : [colors.cardBackground, '#F8FAFC'],\r\n    success: ['#22C55E', '#16A34A'],\r\n    error: ['#EF4444', '#DC2626'],\r\n  }), [colors, mode]);\r\n\r\n  const setAndPersist = (newMode) => {\r\n    // Update state immediately for instant UI feedback\r\n    setMode(newMode);\r\n\r\n    // Persist to storage in the background\r\n    if (newMode === \"system\") {\r\n      AsyncStorage.removeItem(\"@theme_mode\").catch(() => {\r\n        // ignore persistence error\r\n      });\r\n    } else {\r\n      AsyncStorage.setItem(\"@theme_mode\", newMode).catch(() => {\r\n        // ignore persistence error\r\n      });\r\n    }\r\n  };\r\n\r\n  const toggle = () => setAndPersist(mode === \"dark\" ? \"light\" : \"dark\");\r\n\r\n  // While hydrating, render nothing to avoid flicker. Child components may expect useTheme to exist, so\r\n  // keep provider but return null for children until hydrated.\r\n  return (\r\n    <ThemeContext.Provider\r\n      value={{ mode: mode || \"light\", toggle, colors, styles, gradients }}\r\n    >\r\n      {isHydrated ? children : null}\r\n    </ThemeContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useTheme() {\r\n  const ctx = useContext(ThemeContext);\r\n  if (!ctx) throw new Error(\"useTheme must be used within ThemeProvider\");\r\n  return ctx;\r\n}\r\n\r\nexport default ThemeContext;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\utils\\apiFetch.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'silent' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":6,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import AsyncStorage from '@react-native-async-storage/async-storage';\r\n\r\n// Enhanced wrapper around fetch that:\r\n// 1. Automatically includes auth token if available\r\nexport default async function apiFetch(input, init = {}) {\r\n  const { silent = false, ...fetchInit } = init;\r\n\r\n  // Get auth token from storage\r\n  const token = await AsyncStorage.getItem('@auth_token');\r\n\r\n  // Merge headers with auth token if available\r\n  const headers = {\r\n    ...(fetchInit.headers || {}),\r\n  };\r\n\r\n  // Add Authorization header if token exists and not already set\r\n  if (token && !headers['Authorization'] && !headers['authorization']) {\r\n    headers['Authorization'] = `Bearer ${token}`;\r\n  }\r\n\r\n  // Make the fetch request with merged headers\r\n  const response = await fetch(input, {\r\n    ...fetchInit,\r\n    headers,\r\n  });\r\n\r\n  return response;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\utils\\cache.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\utils\\date.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\utils\\fcm.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'result' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":99,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":99,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as Notifications from 'expo-notifications';\r\nimport { Platform } from 'react-native';\r\n\r\n/**\r\n * Get the FCM (Firebase Cloud Messaging) registration token using Expo Notifications\r\n * This works on both Android and iOS without requiring a rebuild\r\n * @returns {Promise<string>} The FCM/Push token\r\n * @throws {Error} If the token cannot be retrieved\r\n */\r\nexport async function getFCMToken() {\r\n  try {\r\n    // Request permissions first\r\n    const { status: existingStatus } = await Notifications.getPermissionsAsync();\r\n    let finalStatus = existingStatus;\r\n\r\n    if (existingStatus !== 'granted') {\r\n      const { status } = await Notifications.requestPermissionsAsync();\r\n      finalStatus = status;\r\n    }\r\n\r\n    if (finalStatus !== 'granted') {\r\n      throw new Error('Permission to access notifications was denied');\r\n    }\r\n\r\n    // Get the device-specific push token (FCM on Android, APNs on iOS)\r\n    const devicePushToken = await Notifications.getDevicePushTokenAsync();\r\n\r\n    return devicePushToken.data; // This is the actual FCM token on Android\r\n  } catch (error) {\r\n    console.error('[FCM] Failed to get token:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Get the FCM token and log it to console\r\n * Useful for development and debugging\r\n */\r\nexport async function logFCMToken() {\r\n  try {\r\n    const token = await getFCMToken();\r\n    return token;\r\n  } catch (error) {\r\n    console.error('Failed to retrieve FCM token:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Register FCM token with backend server\r\n * This allows the backend to send push notifications to this device\r\n * @param {string} token - The FCM token to register\r\n * @returns {Promise<boolean>} Success status\r\n */\r\nexport async function registerFCMTokenWithBackend(token) {\r\n  try {\r\n    const AsyncStorage = (await import('@react-native-async-storage/async-storage')).default;\r\n    const apiFetch = (await import('./apiFetch')).default;\r\n    const apiConfig = (await import('../config/apiConfig')).default;\r\n\r\n    const authToken = await AsyncStorage.getItem('@auth_token');\r\n    const storedUser = await AsyncStorage.getItem('@auth_user');\r\n\r\n    let userId = 'guest';\r\n    let isAuthenticated = false;\r\n\r\n    if (storedUser) {\r\n      try {\r\n        const user = JSON.parse(storedUser);\r\n        userId = user._id || user.id || 'guest';\r\n        isAuthenticated = !!authToken;\r\n      } catch (e) {\r\n        console.warn('[FCM] Failed to parse user data:', e);\r\n      }\r\n    }\r\n\r\n\r\n\r\n    const response = await apiFetch(apiConfig.url(apiConfig.endpoints.fcm.register), {\r\n      method: 'POST',\r\n      silent: true,\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        ...(authToken && { 'Authorization': `Bearer ${authToken}` })\r\n      },\r\n      body: JSON.stringify({\r\n        token,\r\n        userId,\r\n        platform: Platform.OS,\r\n        isAuthenticated\r\n      })\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errorData = await response.json().catch(() => ({}));\r\n      throw new Error(errorData.message || 'Failed to register FCM token');\r\n    }\r\n\r\n    const result = await response.json();\r\n\r\n    return true;\r\n  } catch (error) {\r\n    console.error('[FCM] Failed to register token with backend:', error);\r\n    // Don't throw - failing to register token shouldn't break the app\r\n    return false;\r\n  }\r\n}\r\n\r\nexport default {\r\n  getFCMToken,\r\n  logFCMToken,\r\n  registerFCMTokenWithBackend,\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\utils\\googleDrive.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\LENOVO\\Desktop\\Avinash\\School\\Mobile app\\frontend\\utils\\queryClient.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]